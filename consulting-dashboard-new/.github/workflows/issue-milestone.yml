name: Issue Milestone Reminder

on:
  issues:
    types: [opened, edited]

jobs:
  check-milestone:
    runs-on: ubuntu-latest
    steps:
      - name: Check for milestone
        uses: actions/github-script@v6
        with:
          github-token: ${{secrets.GITHUB_TOKEN}}
          script: |
            const issue = context.issue;
            const milestone = context.payload.issue.milestone;

            if (!milestone) {
              // ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
              const comment = `
                ğŸ“Œ **ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“**

                ã“ã®issueã«é©åˆ‡ãªãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼š
                - **v1.1.0 - æ©Ÿèƒ½æ”¹å–„ç‰ˆ**: ãƒã‚°ä¿®æ­£ãƒ»åŸºæœ¬æ©Ÿèƒ½æ”¹å–„
                - **v1.2.0 - UI/UXæ”¹å–„ç‰ˆ**: UI/UXæ”¹å–„ãƒ»æ–°æ©Ÿèƒ½è¿½åŠ 
                - **v2.0.0 - ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ç‰ˆ**: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¤‰æ›´
                - **v3.0.0 - ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç‰ˆ**: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ©Ÿèƒ½

                issueã®å†…å®¹ã«åŸºã¥ã„ã¦é©åˆ‡ãªãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚
              `;

              // æ—¢ã«åŒã˜ã‚³ãƒ¡ãƒ³ãƒˆãŒãªã„ã‹ç¢ºèª
              const comments = await github.rest.issues.listComments({
                owner: issue.owner,
                repo: issue.repo,
                issue_number: issue.number
              });

              const hasReminderComment = comments.data.some(comment =>
                comment.body.includes('ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“')
              );

              if (!hasReminderComment) {
                await github.rest.issues.createComment({
                  owner: issue.owner,
                  repo: issue.repo,
                  issue_number: issue.number,
                  body: comment
                });
              }
            }