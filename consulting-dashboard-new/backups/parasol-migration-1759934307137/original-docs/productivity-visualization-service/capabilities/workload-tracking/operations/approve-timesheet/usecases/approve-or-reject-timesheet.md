# ユースケース: 承認・差戻しを実行する

## 基本情報
- **ユースケースID**: UC-PVS-002-003
- **アクター**: マネージャー、PM、人事担当者、承認権限者
- **概要**: レビュー完了したタイムシート申請に対して、承認または差戻しの最終判断を実行し、結果を申請者・関係者に通知する

## 事前条件
- 承認権限を持つユーザーがログインしている
- タイムシート申請のレビューが完了している
- 承認・差戻しの判断根拠・理由が明確である
- システムが正常に稼働している

## 事後条件
### 成功時（承認の場合）
- タイムシートが「承認済み」状態に更新されている
- 正式な工数記録として確定・システム登録されている
- 申請者・関係者に承認完了通知が送信されている
- 承認履歴・承認者情報が記録されている

### 成功時（差戻しの場合）
- タイムシートが「差戻し」状態に更新されている
- 差戻し理由・修正指示が申請者に通知されている
- 申請者がタイムシート修正・再申請可能な状態になっている
- 差戻し履歴・理由が記録されている

### 失敗時
- 承認・差戻し処理が未完了状態で保持されている
- エラー内容・原因が承認者に表示されている
- システム管理者に障害通知が送信されている

## 基本フロー
1. 承認者がレビュー完了したタイムシート詳細画面にアクセスする
2. システムがタイムシート内容・レビュー結果・判断推奨を表示する
3. 承認者が承認・差戻しの判断を最終確認する
4. 承認者が「承認」または「差戻し」ボタンを選択する
5. システムが判断理由・コメント入力フォームを表示する
6. 承認者が判断理由・承認コメント・指示事項を入力する
7. 承認者が判断内容・理由を最終確認・実行する
8. システムがタイムシート状態・承認情報を更新する
9. システムが申請者・関係者に結果通知を送信する
10. システムが承認・差戻し履歴を記録・保存する
11. システムが処理完了メッセージを承認者に表示する

## 代替フロー
### 代替フロー1: 条件付き承認
- 4a. 軽微な修正・条件付きで承認する場合
  - 4a1. 承認者が「条件付き承認」オプションを選択する
  - 4a2. システムが条件・修正要求・注意事項入力フォームを表示
  - 4a3. 承認者が承認条件・今後の注意点・改善要求を入力
  - 4a4. システムが承認・条件通知を申請者に送信
  - 4a5. 基本フロー8に戻る

### 代替フロー2: 一括承認処理
- 3a. 複数タイムシートを一括で承認する場合
  - 3a1. 承認者が一括承認対象を選択・確認する
  - 3a2. システムが一括承認リスト・概要・注意事項を表示
  - 3a3. 承認者が一括承認理由・共通コメントを入力
  - 3a4. システムが全対象タイムシートを一括承認処理
  - 3a5. 基本フロー9に戻る

### 代替フロー3: 保留・継続調査
- 4a. 判断に更なる情報・調査が必要な場合
  - 4a1. 承認者が「保留・継続調査」オプションを選択する
  - 4a2. システムが調査内容・期限・担当者設定フォームを表示
  - 4a3. 承認者が調査事項・期限・追加情報収集方法を設定
  - 4a4. システムが調査依頼・期限通知を関係者に送信
  - 4a5. 調査完了後、基本フロー1から再開

## 例外フロー
### 例外1: システム処理エラー
- 8a. タイムシート状態更新・処理でエラーが発生した場合
  - 8a1. システムが「処理エラー」メッセージ・原因を表示
  - 8a2. データ整合性・ロック・権限・接続エラーの詳細表示
  - 8a3. 自動リトライ・手動再実行・管理者連絡の選択肢提示
  - 8a4. 成功まで再試行・エラー原因解決後の処理継続

### 例外2: 通知送信失敗
- 9a. 申請者・関係者への通知送信が失敗した場合
  - 9a1. システムが「通知送信失敗」警告・代替手段を表示
  - 9a2. メール・アプリ・SMS・電話等の代替通知手段を提案
  - 9a3. 手動通知・直接連絡・代理通知の実行選択肢
  - 9a4. 通知確認・到達確認・受信確認の追跡・記録

### 例外3: 権限失効・変更
- 7a. 承認実行時に権限が失効・変更されている場合
  - 7a1. システムが「権限変更検出」エラー・新権限情報を表示
  - 7a2. 新しい承認者・代理承認者・権限委譲先の自動推薦
  - 7a3. 承認権限の再確認・委譲・転送・エスカレーション実行
  - 7a4. 適切な権限者による承認・差戻し判断の継続・完了

## 特別要件
### 判断確実性・責任明確化要件
- 判断根拠：承認・差戻し判断の明確な根拠・理由・基準の記録・開示
- 責任追跡：承認者・判断日時・根拠・影響・結果の完全追跡・監査対応
- 一貫性：同様ケース・類似状況での判断一貫性・公平性・標準化
- 透明性：判断プロセス・基準・理由の申請者・組織への透明・開示

### データ整合性・システム信頼性要件
- 原子性：承認・差戻し処理の完全実行・部分実行防止・ロールバック機能
- 一貫性：関連データ・システム間の整合性・同期・矛盾防止・修復
- 可用性：承認システムの高可用性・障害耐性・冗長性・復旧・継続性
- セキュリティ：承認権限・データ保護・改ざん防止・監査・証跡・暗号化

### ユーザビリティ・効率性要件
- 簡単操作：最小クリック・直感的操作での承認・差戻し実行・完了
- 迅速処理：承認・差戻し処理の高速実行・レスポンス・待機時間最小化
- 状況把握：処理状況・進捗・完了・エラー・影響の即座可視化・理解
- ガイダンス：判断支援・基準説明・注意事項・ベストプラクティス提供

## 関連ユースケース
### 包含関係
- 判断理由を記録する
- システム状態を更新する
- 通知・コミュニケーションを実行する
- 履歴・監査証跡を記録する

### 拡張関係
- 承認ワークフローを管理する（承認を含む全体プロセス管理）
- 申請タイムシートをレビューする（承認前のレビューユースケース）
- タイムシートを承認申請する（申請者視点・承認対象ユースケース）

### 汎化関係
- ワークフロー判定を実行する（上位概念）

## ビジネスルール
### 承認・差戻し判断基準
- 承認基準：妥当性・適法性・品質・基準適合・例外なしの全項目クリア
- 差戻し基準：重要不備・基準逸脱・品質不足・修正必要の明確な根拠
- 判断優先順位：法的要件・組織基準・プロジェクト要件・個人事情の優先順
- 例外・特別判断：緊急性・特殊事情・上位方針・例外規定の適用・承認

### 承認権限・責任範囲
- 承認権限：承認可能範囲・金額・時間・プロジェクト・部門・影響度の制限
- 権限委譲：一時的・恒久的権限委譲・代理承認・緊急時対応の仕組み
- 責任範囲：承認者責任・影響範囲・リスク・法的責任・組織責任の明確化
- エスカレーション：権限外・困難判断・高リスク案件の上位者・専門部署連携

### 通知・フォローアップルール
- 即座通知：承認・差戻し決定の申請者・関係者への即座・確実通知
- 通知内容：判断結果・理由・次ステップ・期限・連絡先・詳細情報
- フォローアップ：差戻し後の修正支援・再申請促進・進捗確認・期限管理
- 記録・監査：全判断・通知・フォローアップの完全記録・監査・追跡・分析

## データ要件
### 入力データ
- 判断対象タイムシート：申請ID・内容・レビュー結果・推奨判断・根拠
- 承認者情報：承認者ID・権限・署名・承認日時・IP・デバイス・場所
- 判断内容：承認・差戻し・保留・条件・理由・コメント・指示・期限
- 判断根拠：基準・規則・前例・比較・分析・リスク・影響・特記事項

### 出力データ
- 判断結果：承認・差戻し・保留・条件・実行日時・有効期限・署名
- 更新情報：タイムシート状態・承認者・履歴・変更・影響・関連データ
- 通知情報：通知先・内容・方法・送信状況・到達・開封・反応・フォロー
- 監査情報：判断履歴・根拠・影響・責任・変更・アクセス・システム・証跡

## 成功指標
- 判断精度：適切な承認・差戻し判断率98%以上・誤判断・苦情・問題最小化
- 処理効率：判断・実行・通知の迅速性・平均処理時間・期限内完了率99%以上
- システム信頼性：処理成功率・エラー率・復旧時間・可用性・データ整合性確保
- ユーザー満足度：承認者・申請者の操作性・結果満足・プロセス改善・信頼向上
- 組織価値：公正・効率・透明な承認による組織信頼・生産性・コンプライアンス向上