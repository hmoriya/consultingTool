# ユースケース: タイムシートを承認申請する

## 基本情報
- **ユースケースID**: UC-PVS-002-001
- **アクター**: コンサルタント、PM、チームメンバー
- **概要**: 記録したタイムシートデータを上司に承認申請し、正式な工数記録として確定するプロセスを開始する

## 事前条件
- ユーザーがログインしている
- タイムシートデータが入力・保存されている
- 申請対象期間のタイムシートが完成している
- 承認者（上司）が設定されている

## 事後条件
### 成功時
- タイムシートが「承認待ち」状態に変更されている
- 承認者に承認依頼通知が送信されている
- 申請履歴が記録されている
- 申請者に申請完了通知が表示されている

### 失敗時
- タイムシートが「下書き」状態のまま保持されている
- エラー内容がユーザーに表示されている
- 申請失敗の理由が記録されている

## 基本フロー
1. コンサルタントがタイムシート承認申請画面にアクセスする
2. システムが申請可能な期間のタイムシートを表示する
3. コンサルタントが申請対象期間を選択する
4. システムが選択期間のタイムシート詳細・合計工数を表示する
5. コンサルタントがタイムシート内容を最終確認する
6. コンサルタントが申請コメント・備考を入力する
7. コンサルタントが「承認申請」ボタンを押下する
8. システムがタイムシートデータの整合性を検証する
9. システムがタイムシート状態を「承認待ち」に更新する
10. システムが承認者に申請通知メール・アラートを送信する
11. システムが申請完了メッセージを表示する

## 代替フロー
### 代替フロー1: 部分期間申請
- 3a. 月の一部期間のみ申請する場合
  - 3a1. コンサルタントが開始日・終了日を個別に指定する
  - 3a2. システムが指定期間のタイムシートのみを抽出・表示
  - 3a3. 基本フロー4に戻る

### 代替フロー2: 複数プロジェクト一括申請
- 5a. 複数プロジェクトのタイムシートを一括申請する場合
  - 5a1. システムが全プロジェクトの工数合計・内訳を表示
  - 5a2. コンサルタントがプロジェクト別の工数配分を確認
  - 5a3. 基本フロー6に戻る

### 代替フロー3: 承認者指定
- 6a. デフォルト承認者以外に申請する場合
  - 6a1. コンサルタントが承認者選択ボタンを押下
  - 6a2. システムが承認権限を持つユーザー一覧を表示
  - 6a3. コンサルタントが適切な承認者を選択
  - 6a4. 基本フロー7に戻る

## 例外フロー
### 例外1: データ不整合エラー
- 8a. タイムシートデータに不整合がある場合
  - 8a1. システムが具体的なエラー内容・修正箇所を表示
  - 8a2. 「工数合計が勤務時間を超過」「必須項目未入力」等の詳細表示
  - 8a3. システムがタイムシート編集画面への遷移リンクを提供
  - 8a4. コンサルタントがデータ修正後、基本フロー1から再実行

### 例外2: 承認者不在・権限なし
- 10a. 承認者が不在・権限がない場合
  - 10a1. システムが「承認者設定エラー」メッセージを表示
  - 10a2. 代理承認者候補・人事担当者への連絡方法を案内
  - 10a3. 一時保存状態で承認者設定待ちとして処理
  - 10a4. 承認者設定完了後、基本フロー9から再実行

### 例外3: 重複申請エラー
- 9a. 同一期間の申請が既に存在する場合
  - 9a1. システムが「重複申請エラー」と既存申請情報を表示
  - 9a2. 既存申請の取り下げ・修正・追加申請の選択肢を提示
  - 9a3. コンサルタントが適切な処理方法を選択・実行

## 特別要件
### データ整合性要件
- 申請データの完全性：必須項目・時間制限・プロジェクト割当の検証
- 重複申請防止：同一期間・同一プロジェクトの重複申請の防止・検知
- データロック：申請中データの編集防止・整合性保持
- 履歴保持：申請内容・変更履歴・承認プロセスの完全記録

### 通知・コミュニケーション要件
- 即座通知：申請完了・承認者への通知の即座配信・到達確認
- 通知手段：メール・アプリ・ダッシュボード等の複数手段による通知
- 通知内容：申請者・期間・工数・コメント・承認期限等の詳細情報
- エスカレーション：承認遅延時の自動リマインド・上位者通知

### ユーザビリティ要件
- 簡単操作：最小クリック・直感的操作での申請完了
- 確認機能：申請前の内容確認・修正機会・誤申請防止
- 状況把握：申請状況・承認進捗・完了予定の可視化
- ガイダンス：申請手順・注意事項・ヘルプの充実・分かりやすさ

## 関連ユースケース
### 包含関係
- タイムシートデータ検証を実行する
- 承認依頼通知を送信する
- 申請履歴を記録する
- 状態変更を実行する

### 拡張関係
- 申請タイムシートをレビューする（申請後の承認者視点ユースケース）
- 承認・差戻しを実行する（承認者による判定ユースケース）
- 承認ワークフローを管理する（承認プロセス全体管理）

### 汎化関係
- ワークフロー申請を実行する（上位概念）

## ビジネスルール
### 申請タイミング・期間ルール
- 申請期限：月末から5営業日以内の申請期限・遅延ペナルティ
- 申請単位：週単位・月単位・プロジェクト単位の申請粒度選択
- 申請可能時間：営業時間内・システムメンテナンス時間外の申請制限
- 遡及申請：過去期間申請の承認・制限・特別手続きルール

### 承認者・権限ルール
- 承認者階層：直属上司→部門長→人事の段階的承認・権限委譲
- 権限委任：一時的権限委任・代理承認・緊急時対応プロセス
- 承認期限：申請から3営業日以内の承認期限・自動エスカレーション
- 権限範囲：承認可能時間・金額・プロジェクト・部門の制限・範囲

### データ品質・検証ルール
- 必須項目：プロジェクト・タスク・時間・作業内容の必須入力・検証
- 時間制限：日8時間・週40時間・月160時間の上限・検証・例外処理
- 工数合計：100%配分・プロジェクト間配分・妥当性検証
- 承認コメント：申請理由・特記事項・承認者向け説明の推奨・必須化

## データ要件
### 入力データ
- タイムシートID：申請対象タイムシートの一意識別子
- 申請期間：開始日・終了日・申請単位（日・週・月）
- 申請者情報：ユーザーID・氏名・所属・役職・連絡先
- 承認者情報：承認者ID・氏名・承認権限・代理承認者
- 申請コメント：申請理由・備考・承認者向けメッセージ・特記事項

### 出力データ
- 申請受付番号：申請の一意識別・追跡・参照用番号
- 申請ステータス：申請中・承認待ち・承認済み・差戻し・取下げ
- 申請タイムスタンプ：申請日時・処理日時・状態変更履歴
- 通知配信結果：通知送信・到達・開封・承認者反応の記録
- 申請内容サマリー：期間・総工数・プロジェクト配分・工数内訳

## 成功指標
- 申請成功率：99%以上の申請完了・エラー率1%以下・再試行率最小化
- 申請時間：平均3分以内の申請完了・操作性・効率性・ユーザビリティ
- 通知到達率：95%以上の通知到達・開封率・承認者反応率・迅速性
- データ品質：申請データの完全性・正確性・整合性・信頼性確保
- ユーザー満足度：申請プロセスの満足度・使いやすさ・改善要望・継続利用意向