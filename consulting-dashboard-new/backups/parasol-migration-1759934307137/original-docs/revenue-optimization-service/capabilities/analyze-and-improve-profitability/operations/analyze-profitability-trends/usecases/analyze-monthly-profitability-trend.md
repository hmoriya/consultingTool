# ユースケース: 月次収益性トレンドを分析する

## 基本情報
- **ユースケースID**: UC-RPO-001
- **アクター**: 財務マネージャー、エグゼクティブ
- **概要**: プロジェクトや部門の月次収益性トレンドを分析し、傾向と変化要因を特定する

## 事前条件
- 最低12ヶ月分の収益性データが存在する
- 財務マネージャーとしてシステムにログインしている
- 分析対象のプロジェクトまたは部門が選択されている

## 事後条件
### 成功時
- 月次収益性トレンドグラフが生成される
- トレンドの傾向（上昇/横ばい/下降）が明確になる
- 統計サマリー（平均、標準偏差、変動率）が算出される
- レポートが保存され、関係者に共有される

### 失敗時
- データ不足の場合、警告メッセージが表示される
- 異常値が検知された場合、詳細調査が必要な旨が通知される

## 基本フロー
1. 財務マネージャーが分析対象（プロジェクト/部門）を選択する
2. システムが分析期間（デフォルト：過去12ヶ月）を設定する
3. システムが月次収益性データ（粗利率、営業利益率、ROI）を収集する
4. システムがデータを時系列に整理し、トレンドグラフを生成する
5. システムが統計分析（平均、標準偏差、変動率）を実行する
6. システムが季節性パターンを検出する
7. システムがトレンドの傾向（上昇/横ばい/下降）を判定する
8. システムが異常値（平均値±3標準偏差を超える値）を検出する
9. システムが分析結果をレポート形式で表示する
10. 財務マネージャーがレポートを確認し、保存または共有する

## 代替フロー
### 代替フロー1: データ期間のカスタマイズ
- 2a. 財務マネージャーがカスタム期間（例：24ヶ月）を指定する
  - 2a1. システムが指定期間のデータを収集する
  - 2a2. 基本フロー3に戻る

### 代替フロー2: 複数プロジェクトの比較分析
- 1a. 財務マネージャーが複数のプロジェクトを選択する
  - 1a1. システムが各プロジェクトのトレンドを並列表示する
  - 1a2. システムが相対比較グラフを生成する
  - 1a3. 基本フロー9に進む

### 代替フロー3: ベンチマーク比較
- 7a. 財務マネージャーがベンチマーク比較を要求する
  - 7a1. システムが業界平均、社内平均、過去ベストと比較する
  - 7a2. システムが差異分析結果を追加表示する
  - 7a3. 基本フロー9に進む

## 例外フロー
### 例外1: データ不足
- *a. 12ヶ月未満のデータしかない場合
  - *a1. システムが警告メッセージを表示する
  - *a2. システムが「利用可能なデータでの分析」または「キャンセル」の選択肢を提示する
  - *a3. 財務マネージャーが選択を行う
  - *a4. 利用可能なデータで分析を続行、またはユースケース終了

### 例外2: 異常値の検出
- 8a. 異常値が複数検出された場合
  - 8a1. システムが異常値をハイライト表示する
  - 8a2. システムが「異常値を含めて分析」または「異常値を除外して分析」の選択肢を提示する
  - 8a3. 財務マネージャーが選択を行う
  - 8a4. 選択に応じた分析を実行し、基本フロー9に進む

### 例外3: トレンド不明確
- 7a. トレンドが統計的に有意でない場合
  - 7a1. システムが「トレンド不明確」の判定を表示する
  - 7a2. システムがより長期データでの再分析を推奨する
  - 7a3. 財務マネージャーが再分析または結果受入を選択する

## 特別要件
- **性能**: 12ヶ月データの分析は10秒以内に完了する
- **可用性**: 営業時間中は99.5%以上の可用性を維持する
- **セキュリティ**: 財務データへのアクセスはロール権限で制御される

## 関連ユースケース
- **包含**: プロジェクト別収益性トレンドを比較する
- **拡張**: 将来の収益性トレンドを予測する
