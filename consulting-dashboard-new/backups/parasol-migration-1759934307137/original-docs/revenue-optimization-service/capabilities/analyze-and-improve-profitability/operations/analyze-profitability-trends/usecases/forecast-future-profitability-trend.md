# ユースケース: 将来の収益性トレンドを予測する

## 基本情報
- **ユースケースID**: UC-RPO-004
- **アクター**: 財務マネージャー、エグゼクティブ
- **概要**: 過去のトレンドデータに基づき、将来（3〜12ヶ月先）の収益性を予測する

## 事前条件
- 最低12ヶ月分の過去トレンドデータが存在する
- トレンド分析が完了している
- 財務マネージャーとしてログインしている

## 事後条件
### 成功時
- 3つのシナリオ（楽観/現実/悲観）での予測が生成される
- 各予測の信頼区間が算出される
- 予測グラフが実績と並べて表示される
- 予測レポートが作成される

### 失敗時
- 予測モデルの精度が低い場合、警告メッセージが表示される
- データ不足の場合、必要データ期間が提示される

## 基本フロー
1. 財務マネージャーが予測対象（プロジェクトまたは部門）を選択する
2. システムが予測期間（デフォルト：6ヶ月）を設定する
3. システムが過去データ（12〜24ヶ月）を収集する
4. システムが予測モデルを選択する
   - 移動平均法（安定トレンド用）
   - 指数平滑化法（最近の変化を重視）
   - 線形回帰（明確なトレンドあり）
   - ARIMAモデル（季節性・トレンドあり）
5. システムが3つのシナリオパラメータを設定する
   - 楽観シナリオ：過去ベストパフォーマンス基準
   - 現実シナリオ：過去平均基準
   - 悲観シナリオ：過去ワーストパフォーマンス基準
6. システムが各シナリオで予測を実行する
7. システムが予測の信頼区間（95%信頼区間）を算出する
8. システムが予測精度指標（MAPE：平均絶対パーセント誤差）を計算する
9. システムが実績と予測を並べたグラフを生成する
10. システムが予測レポートを表示する
11. 財務マネージャーがレポートを確認し、保存または共有する

## 代替フロー
### 代替フロー1: 予測期間のカスタマイズ
- 2a. 財務マネージャーがカスタム期間（3〜12ヶ月）を指定する
  - 2a1. システムが指定期間での予測を実行する
  - 2a2. 基本フロー3に戻る

### 代替フロー2: モデルの手動選択
- 4a. 財務マネージャーが予測モデルを手動選択する
  - 4a1. システムが利用可能なモデル一覧を表示する
  - 4a2. 財務マネージャーがモデルを選択する
  - 4a3. 基本フロー5に進む

### 代替フロー3: 外部要因の反映
- 5a. 財務マネージャーが外部要因（新規契約、市場変化等）を入力する
  - 5a1. システムが外部要因入力フォームを表示する
  - 5a2. 財務マネージャーが要因とその影響度を入力する
  - 5a3. システムが予測モデルに外部要因を反映する
  - 5a4. 基本フロー6に進む

### 代替フロー4: 複数モデルの比較
- 10a. 財務マネージャーが複数モデルの予測を比較する
  - 10a1. システムが各モデルの予測を並列表示する
  - 10a2. システムが各モデルの精度指標を比較表示する
  - 10a3. 財務マネージャーが最適モデルを選択する
  - 10a4. 基本フロー11に進む

## 例外フロー
### 例外1: 予測精度が低い
- 8a. MAPE（平均絶対パーセント誤差）が20%を超える場合
  - 8a1. システムが警告メッセージを表示する
  - 8a2. システムが「より長期データで再予測」または「予測結果を参考値として受入」の選択肢を提示する
  - 8a3. 財務マネージャーが選択を行う
  - 8a4. 選択に応じて処理を続行、または基本フロー3に戻る

### 例外2: データに大きな変動点がある
- 3a. データに構造的変化（トレンドの急変）が検出された場合
  - 3a1. システムが変動点を表示する
  - 3a2. システムが「変動点以降のデータのみ使用」または「全データ使用」の選択肢を提示する
  - 3a3. 財務マネージャーが選択を行う
  - 3a4. 基本フロー4に進む

### 例外3: 季節性の検出
- 4a. データに顕著な季節性が検出された場合
  - 4a1. システムが季節性パターンを表示する
  - 4a2. システムが季節調整を自動適用する
  - 4a3. システムが季節調整後のモデル選択を行う
  - 4a4. 基本フロー5に進む

## 特別要件
- **性能**: 6ヶ月予測は20秒以内に完了する
- **精度**: MAPE（平均絶対パーセント誤差）が15%以内を目標とする
- **可視化**: 信頼区間を含む予測グラフを生成する

## 関連ユースケース
- **包含**: 月次収益性トレンドを分析する
- **拡張**: 収益性改善施策を立案する（propose-improvement-actions）
