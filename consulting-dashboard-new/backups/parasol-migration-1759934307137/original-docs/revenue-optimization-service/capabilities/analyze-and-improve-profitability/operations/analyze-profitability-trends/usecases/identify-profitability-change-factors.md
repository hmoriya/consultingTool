# ユースケース: 収益性変動要因を特定する

## 基本情報
- **ユースケースID**: UC-RPO-003
- **アクター**: 財務マネージャー、PM
- **概要**: 収益性の変動（改善または悪化）の根本原因を特定し、説明資料を作成する

## 事前条件
- 収益性トレンド分析が完了している
- 顕著な変動（前月比±10%以上）が検出されている
- 財務マネージャーとしてログインしている

## 事後条件
### 成功時
- 変動要因が特定される（収益増減、コスト増減、効率変化等）
- 要因の寄与度（インパクト）が定量化される
- 要因分析レポートが作成される
- PMまたは関係者への説明資料が準備される

### 失敗時
- 要因が特定できない場合、追加調査が必要な旨が記録される
- データ不足の場合、必要データのリストが提示される

## 基本フロー
1. 財務マネージャーが変動が大きい期間（月または四半期）を選択する
2. システムが該当期間の収益性データを表示する
3. システムが前期間との差異を計算する（収益、コスト、利益率）
4. システムが変動要因を自動分析する
   - 収益増減（新規契約、既存契約の変化、単価変動）
   - コスト増減（人件費、外注費、経費）
   - 効率性変化（工数効率、リソース稼働率）
5. システムが各要因の寄与度（インパクト）を計算する
6. システムがウォーターフォールチャートで要因を可視化する
7. システムが要因ランキング（影響度順）を作成する
8. 財務マネージャーが各要因の詳細を確認する
9. 財務マネージャーが要因に対するコメントを追加する
10. システムが要因分析レポートを生成する
11. 財務マネージャーがレポートを承認し、関係者に共有する

## 代替フロー
### 代替フロー1: PMへの説明要求
- 8a. 特定要因についてPMの説明が必要な場合
  - 8a1. 財務マネージャーがPMに説明要求を送信する
  - 8a2. PMが説明コメントを追加する
  - 8a3. システムが説明を要因分析レポートに反映する
  - 8a4. 基本フロー11に進む

### 代替フロー2: 外部要因の追加
- 9a. 財務マネージャーが外部要因（市場環境、為替変動等）を追加する
  - 9a1. システムが外部要因入力フォームを表示する
  - 9a2. 財務マネージャーが要因名、説明、推定インパクトを入力する
  - 9a3. システムが要因リストに追加する
  - 9a4. 基本フロー10に進む

### 代替フロー3: 複数期間の比較
- 1a. 財務マネージャーが複数期間を選択する
  - 1a1. システムが各期間の要因分析を並列実行する
  - 1a2. システムが期間別要因比較表を生成する
  - 1a3. 基本フロー10に進む

## 例外フロー
### 例外1: 要因特定不可
- 4a. 自動分析で要因が特定できない場合
  - 4a1. システムが「要因不明」のステータスを表示する
  - 4a2. システムが手動要因入力を促す
  - 4a3. 財務マネージャーが手動で要因を入力する
  - 4a4. 基本フロー10に進む

### 例外2: データ不整合
- 3a. データに不整合が検出された場合
  - 3a1. システムがエラー詳細を表示する
  - 3a2. システムがデータ修正画面を提示する
  - 3a3. 財務マネージャーがデータを修正する
  - 3a4. 基本フロー3に戻る

### 例外3: 複数要因の複合
- 5a. 複数要因が複雑に絡み合っている場合
  - 5a1. システムが多変量解析を実行する
  - 5a2. システムが要因間の相関関係を表示する
  - 5a3. システムが主要因と副要因を分離する
  - 5a4. 基本フロー7に進む

## 特別要件
- **性能**: 要因分析は30秒以内に完了する
- **精度**: 要因の合計インパクトが実際の変動と±5%以内で一致する
- **可視化**: ウォーターフォールチャートで要因を直感的に理解できる

## 関連ユースケース
- **包含**: 月次収益性トレンドを分析する
- **拡張**: 収益性改善施策を立案する（propose-improvement-actions）
