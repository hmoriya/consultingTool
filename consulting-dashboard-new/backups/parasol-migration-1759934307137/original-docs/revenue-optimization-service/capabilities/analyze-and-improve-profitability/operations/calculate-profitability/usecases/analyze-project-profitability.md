# ユースケース: プロジェクト別収益性を分析する

## 基本情報
- **ユースケースID**: UC-RPO-005
- **アクター**: 財務マネージャー、PM、エグゼクティブ
- **概要**: 個別プロジェクトの収益性（粗利率、営業利益率、ROI）を詳細に分析する

## 事前条件
- プロジェクトの収益・コストデータが存在する
- 財務マネージャーとしてログインしている
- 分析対象プロジェクトが選択されている

## 事後条件
### 成功時
- プロジェクトの収益性指標（粗利率、営業利益率、ROI）が算出される
- 収益・コストの詳細内訳が表示される
- 収益性分析レポートが作成される

### 失敗時
- データ不足の場合、エラーメッセージが表示される

## 基本フロー
1. 財務マネージャーが分析対象プロジェクトを選択する
2. システムがプロジェクトの収益データを収集する
3. システムがプロジェクトのコストデータ（直接コスト・間接コスト）を収集する
4. システムが粗利率を計算する: (収益 - 直接コスト) / 収益 × 100
5. システムが営業利益率を計算する: (収益 - 総コスト) / 収益 × 100
6. システムがROIを計算する: (純利益 / 投資額) × 100
7. システムが収益・コスト構造を可視化する（円グラフ、ウォーターフォールチャート）
8. システムが業界ベンチマークとの比較を実施する
9. システムが収益性評価（優良/標準/要改善）を判定する
10. システムが分析レポートを生成する
11. 財務マネージャーがレポートを確認し、保存または共有する

## 代替フロー
### 代替フロー1: 複数プロジェクトの一括分析
- 1a. 財務マネージャーが複数プロジェクトを一括選択する
  - 1a1. システムが各プロジェクトの収益性を並列分析する
  - 1a2. システムがランキング一覧を生成する
  - 1a3. 基本フロー10に進む

### 代替フロー2: 時系列分析
- 2a. 財務マネージャーが時系列分析を要求する
  - 2a1. システムが月次または四半期ごとの収益性推移を分析する
  - 2a2. システムがトレンドグラフを生成する
  - 2a3. 基本フロー10に進む

## 例外フロー
### 例外1: データ不完全
- 2a. 収益またはコストデータが不完全な場合
  - 2a1. システムが不足データを明示する
  - 2a2. システムが「暫定値で計算」または「データ修正」の選択肢を提示する
  - 2a3. 財務マネージャーが選択を行う

### 例外2: 異常値検出
- 4a. 計算結果に異常値が検出された場合
  - 4a1. システムが警告を表示する
  - 4a2. システムがデータ検証を促す
  - 4a3. 財務マネージャーがデータを確認・修正する

## 特別要件
- **性能**: 1プロジェクトの分析は5秒以内に完了する
- **精度**: 計算精度は小数点以下2桁まで保証する

## 関連ユースケース
- **拡張**: クライアント別収益性を分析する
