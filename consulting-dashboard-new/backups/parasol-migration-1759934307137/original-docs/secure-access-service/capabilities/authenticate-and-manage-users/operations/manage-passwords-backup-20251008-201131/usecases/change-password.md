# ユースケース: パスワードを変更する

## 基本情報
- **ユースケースID**: UC-SEC-005
- **アクター**: ユーザー, システム
- **概要**: ユーザーが既存のパスワードを安全で強固な新しいパスワードに変更してアカウントセキュリティを向上させる

## 事前条件
- ユーザーがシステムにログインしている
- ユーザーアカウントが有効で認証済みである
- 現在のパスワードが有効である
- パスワード変更機能が有効になっている

## 事後条件
### 成功時
- ユーザーのパスワードが新しいパスワードに更新される
- パスワード履歴に新しいパスワードハッシュが記録される
- パスワード最終更新日時が記録される
- パスワード変更完了通知がユーザーに送信される
- セキュリティログにパスワード変更が記録される

### 失敗時
- 既存のパスワードが維持される
- エラーメッセージが表示される
- 失敗ログが記録される
- 連続失敗時は一時的なアカウント保護が実行される

## 基本フロー
1. ユーザーがアカウント設定またはセキュリティ設定画面でパスワード変更を選択する
2. システムがパスワード変更画面を表示する
3. システムが現在のパスワード入力を要求する
4. ユーザーが現在のパスワードを入力する
5. システムが現在のパスワードの正当性を検証する
6. システムが新しいパスワード入力フィールドを有効化する
7. ユーザーが新しいパスワードを入力する
8. システムがパスワード強度をリアルタイムで評価・表示する
9. ユーザーが確認用に新しいパスワードを再入力する
10. システムがパスワードポリシー適合性を検証する
11. システムがパスワード履歴との重複を確認する
12. システムが新しいパスワードを暗号化して保存する
13. システムがパスワード変更完了通知を送信する

## 代替フロー
### 代替フロー1: 現在のパスワード間違い
- 5a. 現在のパスワードが間違っている場合
  - 5a1. システムがエラーメッセージを表示する
  - 5a2. システムが失敗回数をカウントする
  - 5a3. 失敗回数が3回未満の場合、基本フロー4に戻る
  - 5a4. 失敗回数が3回の場合、代替フロー4に進む

### 代替フロー2: パスワード確認不一致
- 9a. 新しいパスワードと確認用パスワードが一致しない場合
  - 9a1. システムが不一致エラーメッセージを表示する
  - 9a2. システムが確認用パスワードフィールドをクリアする
  - 9a3. 基本フロー9に戻る

### 代替フロー3: ポリシー違反
- 10a. 新しいパスワードがポリシーに適合しない場合
  - 10a1. システムが具体的な違反理由を表示する
  - 10a2. システムがパスワード要件ガイドを表示する
  - 10a3. 基本フロー7に戻る

### 代替フロー4: 連続失敗によるロック
- 5b. 現在のパスワード入力が3回連続で失敗した場合
  - 5b1. システムがアカウント一時ロックを実行する
  - 5b2. システムがロック通知メッセージを表示する
  - 5b3. システムが15分間のロック時間を設定する
  - 5b4. システムが管理者とユーザーにロック通知を送信する

## 例外フロー
### 例外1: パスワード履歴重複
- 11a. 新しいパスワードが過去のパスワードと重複する場合
  - 11a1. システムが履歴重複エラーメッセージを表示する
  - 11a2. システムが過去何代前のパスワードか表示する
  - 11a3. ユーザーに異なるパスワードの入力を促す
  - 11a4. 基本フロー7に戻る

### 例外2: システムエラー
- *a. パスワード更新処理中にシステムエラーが発生した場合
  - *a1. システムがトランザクションをロールバックする
  - *a2. システムがエラーログを記録する
  - *a3. システムが管理者にエラー通知を送信する
  - *a4. ユーザーに後で再試行するよう案内する

### 例外3: 強制パスワード変更
- *b. パスワードが期限切れの場合
  - *b1. システムが強制変更モードを有効化する
  - *b2. ユーザーによる変更キャンセルを無効化する
  - *b3. 変更完了まで他機能アクセスを制限する

## 特別要件
- **セキュリティ**: パスワードは入力時に即座にハッシュ化し、平文では保存しない
- **可用性**: パスワード強度評価は1秒以内でリアルタイム表示
- **ユーザビリティ**: パスワード要件を明確に表示し、リアルタイムで適合状況を可視化
- **監査性**: パスワード変更は詳細ログと共に記録し、監査追跡を可能にする

## 関連ユースケース
- **包含**: なし
- **拡張**: 「パスワードをリセットする」（パスワード忘れ時）
- **汎化**: なし