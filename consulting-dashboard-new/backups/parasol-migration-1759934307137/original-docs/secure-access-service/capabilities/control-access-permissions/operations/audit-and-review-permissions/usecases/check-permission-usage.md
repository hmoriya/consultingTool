# ユースケース: 権限利用状況を確認する

## 基本情報

- **ユースケースID**: UC-SEC-028
- **ユースケース名**: 権限利用状況を確認する
- **アクター**: 監査担当者, システム管理者, 監査システム, データベース
- **概要**: 付与されている権限の利用状況を分析し、使用頻度や最終利用日時を確認する

## 事前条件

- ユーザーが監査権限を持っている
- 権限データが正常に蓄積されている
- アクセスログが適切に記録されている
- 監査対象期間が定義されている

## 事後条件

### 成功時
- 権限利用状況が可視化される
- 使用頻度レポートが作成される
- 未使用権限リストが抽出される
- 監査証跡が記録される

### 失敗時
- エラーメッセージが表示される
- 監査ログにエラーが記録される
- 運用担当者に通知される

## 基本フロー

1. 監査担当者が権限利用状況確認を開始する
2. システムが監査対象範囲を設定する（ユーザー、期間、権限タイプ）
3. システムが権限データベースから付与権限情報を取得する
4. システムがアクセスログから利用履歴データを取得する
5. システムが権限と利用履歴を照合・分析する
6. システムが利用統計を計算する（使用頻度、最終利用日、未使用期間）
7. システムが利用状況サマリーを生成する
8. システムが詳細な利用状況レポートを作成する
9. 監査担当者が利用状況を確認し評価する
10. システムが監査実行履歴を記録する

## 代替フロー

### 代替フロー1: 部分的なデータ不備
- 5a. 一部のログデータが欠損している場合
  - 5a1. システムが利用可能なデータのみで分析を実行する
  - 5a2. システムがデータ不備の警告を表示する
  - 5a3. システムがデータ品質レポートを生成する
  - 5a4. 基本フロー6に進む

### 代替フロー2: 大量データ処理
- 3a. 対象データが大量の場合
  - 3a1. システムがバッチ処理でデータを分割取得する
  - 3a2. システムが進捗状況を表示する
  - 3a3. 基本フロー4に進む

### 代替フロー3: 特定権限のフィルタリング
- 2a. 特定の権限タイプのみを確認する場合
  - 2a1. 監査担当者が権限タイプを選択する
  - 2a2. システムが選択された権限タイプのみを対象とする
  - 2a3. 基本フロー3に進む

## 例外フロー

### 例外1: システムエラー
- *a. データベース接続エラーまたはシステム障害が発生した場合
  - *a1. システムがエラーメッセージを表示する
  - *a2. システムが技術者にアラートを送信する
  - *a3. システムがエラー詳細をログに記録する
  - *a4. ユースケース中断

### 例外2: 権限不足
- 1a. 監査担当者が必要な権限を持たない場合
  - 1a1. システムがアクセス拒否メッセージを表示する
  - 1a2. システムが不正アクセス試行をログに記録する
  - 1a3. ユースケース中断

### 例外3: データ整合性エラー
- 5a. 権限データとログデータに整合性がない場合
  - 5a1. システムが整合性エラーを検知する
  - 5a2. システムがエラー詳細を管理者に通知する
  - 5a3. システムが可能な範囲で分析を継続する

## 特別要件

### 性能要件
- 権限確認処理: 5秒以内
- レポート生成: 30秒以内（1000ユーザーまで）
- 大量データ処理: 10万件のログを10分以内

### セキュリティ要件
- 監査ログの暗号化保存
- アクセス制御の厳格な適用
- 個人情報の適切なマスキング

### 可用性要件
- 24時間365日の監査機能提供
- 99.9%以上のシステム稼働率

## 非機能要件

### ユーザビリティ
- 直感的なフィルタリング機能
- 視覚的に分かりやすいレポート形式
- エクスポート機能（Excel、PDF）

### 拡張性
- 新しい権限タイプへの対応
- 大規模組織での利用に対応
- 外部監査ツールとの連携

## 関連ユースケース

- **前提**: UC-SEC-001 (ユーザーを認証する)
- **包含**: UC-SEC-029 (不要権限を特定する) - このユースケースの結果を利用
- **拡張**: UC-SEC-030 (異常アクセスを検知する) - 同様の分析手法を使用
- **関連**: UC-SEC-031 (権限を是正する) - このユースケースの結果に基づいて実行

## 実装ノート

### データ要件
- 権限付与履歴（付与日、付与者、対象リソース）
- アクセスログ（アクセス日時、リソース、操作内容）
- ユーザー情報（所属、役職、状態）

### 技術的考慮事項
- 大量データの効率的な処理
- リアルタイム分析と定期バッチ処理の使い分け
- プライバシー保護とデータマスキング

### 監査要件
- すべての監査活動の完全な記録
- 監査証跡の改竄防止
- コンプライアンス要件への準拠