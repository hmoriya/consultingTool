# ユースケース: 権限を是正する

## 基本情報

- **ユースケースID**: UC-SEC-031
- **ユースケース名**: 権限を是正する
- **アクター**: システム管理者, 監査担当者, 承認者, 自動化システム
- **概要**: 監査で特定された不要権限や異常権限を是正し、適切な権限状態を回復する

## 事前条件

- 不要権限が特定されている
- 是正計画が承認されている
- バックアップとロールバック手順が準備されている
- 影響を受けるユーザーへの通知準備が完了している

## 事後条件

### 成功時
- 不要権限が削除される
- 適切な権限が付与される
- 是正履歴が記録される
- 関係者に完了通知が送信される

### 失敗時
- ロールバックが実行される
- エラー内容が記録される
- 管理者に障害通知が送信される

## 基本フロー

1. システム管理者が是正作業を開始する
2. システムが是正対象権限リストを確認する
3. システムが是正前の権限状態をバックアップする
4. システムが影響範囲を最終確認する
5. システムが段階的是正計画を実行する
6. システムが権限削除を実行する
7. システムが必要に応じて新規権限を付与する
8. システムが是正結果を検証する
9. システムが影響を受けるユーザーに通知する
10. システム管理者が是正完了を確認する
11. システムが是正履歴を記録する
12. システムが後続監査スケジュールを更新する

## 代替フロー

### 代替フロー1: 段階的是正
- 5a. 大量の権限是正が必要な場合
  - 5a1. システムが是正を複数フェーズに分割する
  - 5a2. システムが各フェーズの実行計画を作成する
  - 5a3. システムが第1フェーズから順次実行する
  - 5a4. システムが各フェーズ完了後に影響を評価する
  - 5a5. 基本フロー6に進む

### 代替フロー2: 緊急是正
- 2a. 緊急性の高い是正が必要な場合
  - 2a1. システムが緊急是正プロセスを開始する
  - 2a2. システムが最小限の承認で即座実行する
  - 2a3. システムが実行後に事後承認を取得する
  - 2a4. 基本フロー3に進む

### 代替フロー3: 権限移譲による是正
- 6a. 権限削除に加えて適切な権限付与が必要な場合
  - 6a1. システムが新しい適切な権限を特定する
  - 6a2. システムが権限移譲計画を作成する
  - 6a3. システムが新規権限を付与してから旧権限を削除する
  - 6a4. 基本フロー7に進む

## 例外フロー

### 例外1: 是正実行エラー
- 6a. 権限削除処理でエラーが発生した場合
  - 6a1. システムが処理を即座に停止する
  - 6a2. システムが部分的な変更をロールバックする
  - 6a3. システムがエラー詳細を記録する
  - 6a4. システムが管理者に緊急通知する
  - 6a5. ユースケース中断

### 例外2: 依存関係エラー
- 4a. 削除対象権限に依存関係がある場合
  - 4a1. システムが依存関係を検出する
  - 4a2. システムが依存関係解決案を提示する
  - 4a3. 管理者が依存関係処理を判断する
  - 4a4. システムが依存関係を考慮して是正計画を修正する
  - 4a5. 基本フロー5に進む

### 例外3: 承認取り消し
- 5a. 是正実行前に承認が取り消された場合
  - 5a1. システムが承認状態を確認する
  - 5a2. システムが是正作業を一時停止する
  - 5a3. システムが再承認プロセスを開始する
  - 5a4. ユースケース中断（再承認後に再開）

## 特別要件

### 性能要件
- 単一権限是正: 5秒以内
- 大量是正（100件）: 30分以内
- 緊急是正: 1分以内
- ロールバック: 10秒以内

### セキュリティ要件
- 是正操作の完全な監査証跡
- 権限是正の承認制御
- 不正な権限変更の防止

### 信頼性要件
- トランザクション整合性の保証
- 部分的失敗時の自動復旧
- ロールバック成功率: 99.9%以上

## 非機能要件

### 可用性
- 是正作業中のサービス継続
- 最小限のシステム影響
- 計画的なメンテナンス時間の活用

### 監査可能性
- 是正前後の状態記録
- 実行者と承認者の記録
- 業務への影響度の記録

## 是正パターン

### 権限削除パターン
- **単純削除**: 不要権限の単純な削除
- **段階削除**: 影響を考慮した段階的削除
- **条件削除**: 特定条件下での削除

### 権限調整パターン
- **権限縮小**: より制限的な権限への変更
- **権限移譲**: 適切な権限への置き換え
- **一時的制限**: 調査期間中の一時的な制限

### 緊急対応パターン
- **即座停止**: 高リスク権限の即座停止
- **隔離**: 疑わしいアカウントの隔離
- **監視強化**: 権限使用の監視強化

## ビジネスルール

### 是正実行条件
- 承認済みの是正計画が存在すること
- 影響範囲が許容レベル内であること
- バックアップと復旧手順が準備済みであること

### 承認要件
- 一般権限: 部門長承認
- 管理権限: セキュリティ責任者承認
- システム権限: IT責任者承認
- 緊急是正: 事後承認可（24時間以内）

### 通知要件
- 影響ユーザーへの事前通知（24時間前）
- 緊急是正の場合は事後通知（1時間以内）
- 是正完了の確認通知

## 関連ユースケース

- **前提**: UC-SEC-029 (不要権限を特定する) - 是正対象の特定
- **前提**: UC-SEC-030 (異常アクセスを検知する) - 緊急是正の判断
- **包含**: UC-SEC-001 (ユーザーを認証する) - 管理者権限の確認
- **後続**: UC-SEC-028 (権限利用状況を確認する) - 是正結果の検証

## 実装ノート

### 技術的要件
- 原子性を保証するトランザクション処理
- 分散システムでの整合性保証
- 非同期処理による性能最適化

### データ要件
- 是正前後の詳細な状態情報
- 実行ログの完全な記録
- 復旧用のバックアップデータ

### 運用要件
- 24時間365日の是正対応体制
- エスカレーション手順の明確化
- 定期的な是正手順の訓練実施

### 品質保証
- 是正処理の自動テスト
- 本番環境での影響度検証
- ロールバック手順の定期検証