# ユースケース: 権限を定義する

## 基本情報

- **ユースケースID**: UC-SEC-033
- **ユースケース名**: 権限を定義する
- **アクター**: セキュリティ管理者, システム管理者, アプリケーション管理者, コンプライアンス担当者
- **概要**: システムリソースへのアクセス権限を詳細に定義し、適切なセキュリティポリシーを実装する

## 事前条件

- ユーザーが権限管理権限を持っている
- システムリソースとアプリケーション機能が明確化されている
- セキュリティポリシーと規程が策定されている
- 既存の権限体系が分析済みである

## 事後条件

### 成功時
- 新しい権限が定義される
- 権限仕様書が作成される
- アクセス制御マトリックスが更新される
- 承認ワークフローが開始される

### 失敗時
- エラーメッセージが表示される
- 入力データが保持される
- 失敗理由が記録される

## 基本フロー

1. セキュリティ管理者が権限定義プロセスを開始する
2. システムがリソース一覧画面を表示する
3. 管理者が対象リソースとアクセス対象を特定する
4. システムが既存権限との重複・競合確認を実行する
5. 管理者が権限の基本情報を入力する（名前、説明、レベル）
6. システムが権限カテゴリと優先度を設定する
7. 管理者がアクセス可能な操作と条件を定義する
8. システムが権限間の依存関係を検証する
9. 管理者が権限の制約と例外条件を設定する
10. システムが最小権限の原則への適合性を検証する
11. システムが承認ワークフローに送信する
12. システムが権限定義履歴を記録する

## 代替フロー

### 代替フロー1: 既存権限との競合
- 4a. 定義しようとする権限が既存権限と競合する場合
  - 4a1. システムが競合権限を特定し表示する
  - 4a2. 管理者が競合内容と影響範囲を確認する
  - 4a3. 管理者が統合・調整・分離のいずれかを選択する
  - 4a4. 基本フロー5に進む

### 代替フロー2: 継承権限の設定
- 6a. 既存権限を継承する新しい権限を作成する場合
  - 6a1. 管理者が基底権限を選択する
  - 6a2. システムが継承される操作権限を表示する
  - 6a3. 管理者が追加・制限する操作を設定する
  - 6a4. 基本フロー7に進む

### 代替フロー3: 条件付き権限
- 7a. 特定条件下でのみ有効な権限を設定する場合
  - 7a1. 管理者が条件付き権限として設定する
  - 7a2. システムが条件定義フォームを表示する
  - 7a3. 管理者が時間・場所・状況の条件を設定する
  - 7a4. システムが条件評価ルールを作成する
  - 7a5. 基本フロー8に進む

## 例外フロー

### 例外1: 権限依存関係の循環
- 8a. 権限間に循環依存が発生する場合
  - 8a1. システムが循環依存を検出し表示する
  - 8a2. システムが依存関係の修正案を提示する
  - 8a3. 管理者が依存関係を再設計する
  - 8a4. 基本フロー8を再実行する

### 例外2: 過剰権限の警告
- 10a. 定義する権限が過剰と判定される場合
  - 10a1. システムが過剰権限の警告を表示する
  - 10a2. システムが最小権限原則に基づく推奨案を提示する
  - 10a3. 管理者が権限スコープの見直しを実行する
  - 10a4. 基本フロー10を再実行する

### 例外3: 承認拒否
- 11a. 承認者が権限定義を拒否した場合
  - 11a1. システムが拒否理由を管理者に通知する
  - 11a2. 管理者が指摘事項に基づき権限定義を修正する
  - 11a3. システムが修正版を再承認に送信する

## 特別要件

### 性能要件
- 権限定義作成: 15分以内
- 競合確認: 5秒以内
- 依存関係検証: 10秒以内
- 承認送信: 3秒以内

### セキュリティ要件
- 権限定義の暗号化保存
- 操作者の認証と権限確認
- 全操作の監査ログ記録
- 権限変更の完全な履歴追跡

### 可用性要件
- 24時間365日の権限定義機能提供
- 99.9%以上のシステム稼働率

## 非機能要件

### 使いやすさ
- 直感的な権限定義インターフェース
- テンプレートベースの迅速な定義
- リアルタイムバリデーション
- 権限プレビュー機能

### 拡張性
- 新しいリソースタイプへの対応
- カスタム権限属性の追加
- 大規模組織での権限管理

## ビジネスルール

### 権限命名規則
- 機能と操作を表す明確な名前（英数字、日本語対応）
- 一意性の保証
- 命名規約の統一（例：リソース_操作_レベル）

### 権限レベル定義
- 読取り (Read): データの参照のみ
- 更新 (Update): データの変更
- 作成 (Create): 新規データの作成
- 削除 (Delete): データの削除
- 管理 (Admin): 完全な制御権限

### 権限スコープルール
- システム全体 (Global): 全リソースへのアクセス
- ドメイン (Domain): 特定ドメイン内のリソース
- リソース (Resource): 特定リソースのみ
- オブジェクト (Object): 特定オブジェクトのみ

### 権限制約ルール
- 最小権限の原則の厳格な適用
- 職務分離の原則の遵守
- 特権権限の特別管理
- 時限権限の自動失効

## 関連ユースケース

- **前提**: UC-SEC-001 (ユーザーを認証する) - 管理者権限の確認
- **関連**: UC-SEC-032 (ロールを定義する) - 権限を割り当てるロールの定義
- **後続**: UC-SEC-034 (ロールに権限を割り当てる) - 定義された権限の割り当て
- **包含**: UC-SEC-035 (権限を見直す) - 定期的な権限見直し

## 実装ノート

### データ要件
- 権限基本情報（ID、名前、説明、レベル、スコープ）
- アクセス対象（リソース、操作、条件）
- 制約情報（時間制限、場所制限、状況制限）
- メタデータ（作成者、作成日、更新履歴）

### 技術的考慮事項
- 権限評価エンジンの効率的な実装
- 複雑な条件式の解析と実行
- 大量権限での性能最適化
- リアルタイム権限検証

### UI/UX要件
- 権限マトリックスの視覚的表現
- ドラッグ&ドロップでの権限設定
- 権限プレビューと影響範囲表示
- 権限テンプレートライブラリ

### データ整合性
- 権限削除時の依存関係チェック
- ロール変更時の影響範囲確認
- 権限継承の整合性維持
- バックアップとロールバック機能

### 承認ワークフロー
- 権限レベル別の承認ルート
- 段階的な承認プロセス
- 緊急時の特別承認手順
- 承認期限の自動管理

### 監査要件
- 権限定義の完全な変更履歴
- 承認プロセスの詳細記録
- コンプライアンス要件への対応
- 定期的な権限レビューの実施

### 国際化対応
- 多言語での権限名・説明
- 地域別の規制要件への対応
- タイムゾーンを考慮した時限権限管理