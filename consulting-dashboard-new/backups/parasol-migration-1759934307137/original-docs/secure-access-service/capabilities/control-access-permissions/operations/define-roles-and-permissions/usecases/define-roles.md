# ユースケース: ロールを定義する

## 基本情報

- **ユースケースID**: UC-SEC-032
- **ユースケース名**: ロールを定義する
- **アクター**: セキュリティ管理者, 部門長, HR担当者, システム管理者
- **概要**: 組織の職務と責任に基づいてロールを定義し、適切な権限体系の基盤を構築する

## 事前条件

- ユーザーがロール管理権限を持っている
- 組織構造と職務定義が明確化されている
- 既存のロール体系が分析済みである
- セキュリティポリシーが策定されている

## 事後条件

### 成功時
- 新しいロールが定義される
- ロール定義書が作成される
- ロール階層が更新される
- 承認ワークフローが開始される

### 失敗時
- エラーメッセージが表示される
- 入力データが保持される
- 失敗理由が記録される

## 基本フロー

1. セキュリティ管理者がロール定義プロセスを開始する
2. システムが業務要件分析画面を表示する
3. 管理者が組織の職務と責任範囲を分析する
4. システムが既存ロール体系との重複確認を実行する
5. 管理者がロールの基本情報を入力する（名前、説明、カテゴリ）
6. システムがロール階層における位置を設定する
7. 管理者がロールの責任範囲と制約を定義する
8. システムが職務分離の原則への適合性を検証する
9. 管理者がロールの有効期間と見直し頻度を設定する
10. システムがロール定義の妥当性を検証する
11. システムが承認ワークフローに送信する
12. システムがロール定義履歴を記録する

## 代替フロー

### 代替フロー1: 既存ロールとの重複
- 4a. 定義しようとするロールが既存ロールと重複する場合
  - 4a1. システムが重複ロールを特定し表示する
  - 4a2. 管理者が重複内容を確認する
  - 4a3. 管理者が統合・分割・名前変更のいずれかを選択する
  - 4a4. 基本フロー5に進む

### 代替フロー2: 階層ロールの設定
- 6a. 既存ロールを継承する階層ロールを作成する場合
  - 6a1. 管理者が親ロールを選択する
  - 6a2. システムが継承される権限を表示する
  - 6a3. 管理者が追加・除外する権限を設定する
  - 6a4. 基本フロー7に進む

### 代替フロー3: 一時的・期間限定ロール
- 5a. 一時的なプロジェクトや期間限定の職務ロールの場合
  - 5a1. 管理者が一時ロールとして設定する
  - 5a2. システムが有効期間の設定を要求する
  - 5a3. 管理者が開始日と終了日を設定する
  - 5a4. システムが自動無効化スケジュールを作成する
  - 5a5. 基本フロー6に進む

## 例外フロー

### 例外1: 職務分離違反
- 8a. 定義しようとするロールが職務分離原則に違反する場合
  - 8a1. システムが違反内容を特定し表示する
  - 8a2. システムが代替案を提示する
  - 8a3. 管理者がロール定義を修正する
  - 8a4. 基本フロー8を再実行する

### 例外2: 権限過多の警告
- 10a. ロールに過剰な権限が含まれる可能性がある場合
  - 10a1. システムが権限過多の警告を表示する
  - 10a2. システムが最小権限の原則に基づく推奨案を提示する
  - 10a3. 管理者が権限の見直しを実行する
  - 10a4. 基本フロー10を再実行する

### 例外3: 承認拒否
- 11a. 承認者がロール定義を拒否した場合
  - 11a1. システムが拒否理由を管理者に通知する
  - 11a2. 管理者が指摘事項に基づきロール定義を修正する
  - 11a3. システムが修正版を再承認に送信する

## 特別要件

### 性能要件
- ロール定義作成: 10分以内
- 重複確認: 3秒以内
- 妥当性検証: 5秒以内
- 承認送信: 2秒以内

### セキュリティ要件
- ロール定義の暗号化保存
- 操作者の認証と権限確認
- 全操作の監査ログ記録

### 可用性要件
- 24時間365日のロール定義機能提供
- 99.9%以上のシステム稼働率

## 非機能要件

### 使いやすさ
- 直感的なロール定義インターフェース
- テンプレートベースの迅速な定義
- 段階的なガイド機能

### 拡張性
- 新しい権限カテゴリへの対応
- 大規模組織でのロール管理
- カスタム属性の追加

## ビジネスルール

### ロール命名規則
- 職務を表す明確な名前（英数字、日本語対応）
- 一意性の保証
- 命名規約の統一（例：部署_職務_レベル）

### ロール階層ルール
- 最大5階層まで
- 循環参照の禁止
- 上位ロールからの権限継承

### 権限制約ルール
- 最小権限の原則の適用
- 職務分離の原則の遵守
- 管理者権限の特別管理

### 有効期間ルール
- デフォルト有効期間：無期限
- 一時ロール：最大1年
- 定期見直し：年1回必須

## 関連ユースケース

- **前提**: UC-SEC-001 (ユーザーを認証する) - 管理者権限の確認
- **関連**: UC-SEC-033 (権限を定義する) - ロールに割り当てる権限の定義
- **後続**: UC-SEC-034 (ロールに権限を割り当てる) - 定義されたロールへの権限付与
- **包含**: UC-SEC-035 (ロールを見直す) - 定期的なロール見直し

## 実装ノート

### データ要件
- ロール基本情報（ID、名前、説明、カテゴリ）
- 階層情報（親子関係、継承設定）
- 有効期間（開始日、終了日、見直し日）
- メタデータ（作成者、作成日、更新履歴）

### 技術的考慮事項
- ロール継承の効率的な実装
- 循環参照の検出アルゴリズム
- 大量ロールでの性能最適化

### UI/UX要件
- ロール階層の視覚的表現
- ドラッグ&ドロップでの階層編集
- リアルタイムバリデーション

### データ整合性
- ロール削除時の依存関係チェック
- 権限変更時の影響範囲確認
- バックアップとロールバック機能

### 承認ワークフロー
- ロールタイプ別の承認ルート
- 段階的な承認プロセス
- 緊急時の特別承認手順

### 監査要件
- ロール定義の完全な変更履歴
- 承認プロセスの記録
- コンプライアンス要件への対応

### 国際化対応
- 多言語でのロール名・説明
- 地域別の職務体系への対応
- タイムゾーンを考慮した有効期間管理