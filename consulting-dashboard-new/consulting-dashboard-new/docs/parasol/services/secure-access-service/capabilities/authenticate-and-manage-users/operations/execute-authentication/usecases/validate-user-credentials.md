# ユースケース: ユーザー認証情報を検証する

## 基本情報

- **ユースケースID**: UC-SEC-024
- **アクター**: ユーザー, 認証システム, セキュリティ監視システム, 監査システム, 外部認証プロバイダー
- **前提条件**:
  - 認証システムが正常に稼働している
  - ユーザーアカウントが存在し、有効である
  - 認証ポリシーが設定されている
- **事後条件**:
  - 認証結果が確定される（成功または失敗）
  - 認証ログが記録される
  - 必要に応じてセキュリティ措置が実行される

## 詳細フロー

### 基本フロー
1. **認証要求受付**
   - ユーザーが認証情報（ID・パスワード）を入力する
   - システムが認証要求を受け付ける
   - 入力データの基本的な形式チェックを実行する

2. **ユーザー存在確認**
   - 入力されたユーザーIDでユーザー情報を検索する
   - ユーザーアカウントの存在を確認する
   - アカウントの有効性（アクティブ状態）をチェックする

3. **認証情報照合**
   - 入力されたパスワードをハッシュ化する
   - 保存されているパスワードハッシュと照合する
   - パスワードポリシー準拠状況を確認する

4. **アカウント状態検証**
   - アカウントのロック状態を確認する
   - パスワード有効期限をチェックする
   - 最終ログイン日時から休眠アカウント判定を行う

5. **セキュリティ制約確認**
   - ログイン試行回数制限をチェックする
   - IP アドレス制限を確認する
   - 時間帯制限・地域制限を適用する

6. **認証結果確定**
   - 全ての検証が成功した場合、認証成功とする
   - いずれかの検証が失敗した場合、認証失敗とする
   - 認証結果を呼び出し元に返却する

### 代替フロー
- **A1: 多要素認証が必要な場合**
  - パスワード認証成功後、追加認証要求を送信する
  - SMSコード、認証アプリ、生体認証等を実行する
  - 全ての認証要素が成功した場合のみ認証完了とする

- **A2: パスワード期限切れの場合**
  - パスワード有効期限切れを検知した場合
  - 一時的な制限付きアクセスを許可する
  - パスワード変更画面への強制リダイレクトを実行する

- **A3: 外部認証連携の場合**
  - LDAP、SAML、OAuth等の外部認証システムに転送する
  - 外部システムでの認証結果を受信・検証する
  - 内部アカウントとの紐付けを確認する

### 例外フロー
- **E1: アカウントロック検出時**
  - 連続ログイン失敗によるアカウントロックを検知した場合
  - 認証を即座に拒否し、ロック理由を通知する
  - セキュリティ管理者にアラートを送信する

- **E2: 不正アクセス疑いの場合**
  - 異常なアクセスパターンを検知した場合
  - 認証を拒否し、追加認証を要求する
  - セキュリティ監視システムにインシデント報告を行う

- **E3: システム障害時**
  - 認証システムに障害が発生した場合
  - 緊急時認証手順に切り替える
  - 管理者に障害通知を送信し、復旧手順を開始する

## ビジネスルール

### 認証ポリシー
- **BR-AUTH-001**: パスワードは最低8文字、英数字記号混合必須
- **BR-AUTH-002**: 連続ログイン失敗5回でアカウントを30分間ロック
- **BR-AUTH-003**: 90日間パスワード未変更でパスワード期限切れ警告
- **BR-AUTH-004**: 管理者権限アカウントは多要素認証必須

### セキュリティ制約
- **BR-AUTH-005**: 同一IPアドレスからの同時ログイン数は5セッションまで
- **BR-AUTH-006**: 営業時間外（22:00-06:00）は特権アカウントのみログイン可能
- **BR-AUTH-007**: 海外IPアドレスからのアクセスは追加認証必須
- **BR-AUTH-008**: 180日間未使用アカウントは自動無効化

## 非機能要件

### パフォーマンス
- 認証処理は3秒以内に完了する
- 同時認証要求1000件まで処理可能
- パスワードハッシュ化は100ms以内で完了

### セキュリティ
- パスワードはbcryptアルゴリズムでハッシュ化保存
- 認証通信は全てTLS 1.3で暗号化
- 機密情報はメモリから即座にクリア

### 可用性
- 認証システムの稼働率99.9%以上を維持
- 冗長化により単一障害点を排除
- 障害時の平均復旧時間（MTTR）30分以内

## UI/UX要件

### ユーザビリティ
- ログインフォームは直感的で分かりやすいデザイン
- エラーメッセージは具体的で建設的な内容
- パスワード表示/非表示切り替え機能

### セキュリティ配慮
- パスワード入力フィールドの自動補完無効化
- ログイン成功/失敗時の情報漏洩防止
- ブルートフォース攻撃対策のための遅延機能

### アクセシビリティ
- スクリーンリーダー対応
- キーボードのみでの操作可能
- 多言語対応（日本語、英語）

## 測定指標

### セキュリティ指標
- 認証成功率（目標：95%以上）
- 不正ログイン試行検知率（目標：99%以上）
- アカウント侵害防止率（目標：100%）

### パフォーマンス指標
- 平均認証処理時間（目標：1秒以内）
- 認証システム稼働率（目標：99.9%以上）
- 同時認証処理能力（目標：1000req/sec以上）

### ユーザビリティ指標
- ログイン完了率（目標：98%以上）
- パスワードリセット要求率（目標：5%以下）
- ユーザーサポート問い合わせ率（目標：2%以下）

## セキュリティ考慮事項

### 脅威への対策
- **ブルートフォース攻撃**: 試行回数制限、IP制限、遅延機能
- **辞書攻撃**: 強力なパスワードポリシー、複雑性要件
- **レインボーテーブル攻撃**: ソルト付きハッシュ化
- **セッション固定攻撃**: セッションID再生成
- **中間者攻撃**: TLS通信の強制

### 監査・コンプライアンス
- 全認証試行の詳細ログ記録
- 定期的なセキュリティ監査の実施
- SOX法、個人情報保護法等の法的要件遵守
- ペネトレーションテストの定期実行

## 関連ドキュメント

- [認証ポリシー](../../../policies/authentication-policy.md)
- [パスワード管理規則](../../../security/password-management.md)
- [セキュリティ基準](../../../security/security-standards.md)
- [多要素認証ガイド](../../../security/mfa-guide.md)
- [インシデント対応手順](../../../security/incident-response.md)