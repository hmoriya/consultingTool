# ページ定義: 階層関係設定ページ

## 基本情報

- **ページID**: PG-SEC-041
- **ページ名**: 階層関係設定ページ
- **URL**: `/admin/organization/hierarchy/setup`
- **対応ユースケース**: UC-SEC-041 (階層関係を確立する)
- **アクセス権限**: 組織管理者, HR担当者, 部門長, システム管理者

## 画面の目的

組織内の部門・チーム・個人間の階層関係と報告ラインを視覚的かつ効率的に設定する管理者向け画面。ドラッグ＆ドロップ操作による直感的な階層構築と、複雑な組織構造の体系的管理を実現する。

## 利用者

- **組織管理者**: 組織全体の階層設計と最適化
- **HR担当者**: 人事制度に基づく報告ライン設定
- **部門長**: 担当部門内の詳細階層管理
- **システム管理者**: システム権限と階層の連携設定

## 画面構成

### ヘッダー部
- **ページタイトル**: 「階層関係設定」
- **パンくずナビ**: ホーム > 組織管理 > 階層関係設定
- **階層サマリー**: 現在の階層深度、部門数、設定進捗
- **操作モード切替**: 表示モード・編集モード・検証モード

### メインコンテンツ部

#### 階層構築エリア
- **組織ツリー表示**:
  - ドラッグ＆ドロップによる階層編集
  - 折りたたみ可能な階層ツリー
  - 各ノードの詳細情報ポップアップ
- **階層操作パネル**:
  - 部門・チームの追加・削除・移動
  - 階層レベルの調整機能
  - 一括操作（複数選択・移動）
- **視覚化オプション**:
  - 組織図スタイル（縦型・横型・円形）
  - 表示詳細レベルの切り替え
  - カラーコーディング（部門別・職能別）

#### 報告関係設定エリア
- **報告ライン管理**:
  - 上司・部下関係の設定と確認
  - 複数報告関係（マトリックス組織）の設定
  - 報告関係の有効期間設定
- **権限継承設定**:
  - 階層による権限の自動継承ルール
  - 権限の例外設定と特別権限
  - 継承ルールのプレビューと検証
- **承認フロー連携**:
  - 階層に基づく自動承認フロー
  - 承認ルートのカスタマイズ
  - エスカレーション設定

#### 階層検証エリア
- **整合性チェック**:
  - 循環参照の検出と修正提案
  - 階層の論理的整合性確認
  - 権限競合の検出と調整
- **影響分析**:
  - 階層変更による既存データへの影響
  - 業務プロセスへの影響予測
  - 関連システムへの波及効果

### サイドバー部

#### 設定支援ツール
- **階層設計ガイド**:
  - 効果的な階層設計の原則
  - 業界別のベストプラクティス
  - 階層深度の最適化アドバイス
- **テンプレート活用**:
  - 標準的な階層パターン
  - 業界特化型のテンプレート
  - 過去の成功事例からのテンプレート

#### リアルタイム分析
- **階層効率性分析**:
  - 意思決定速度の予測
  - コミュニケーション効率の評価
  - 管理スパンの適切性チェック
- **組織健全性指標**:
  - 階層バランススコア
  - 権限分散度の評価
  - 組織フラット度の測定

### フッター部
- **アクションボタン**:
  - 階層保存、検証実行、リセット
  - プレビュー生成、エクスポート
- **操作履歴**:
  - 最近の変更履歴
  - 操作の取り消し・やり直し
- **ヘルプ機能**:
  - 操作ガイド、チュートリアル
  - 階層設計のベストプラクティス

## データ表示

### 表示データ一覧

| データ項目 | 表示形式 | 必須 | 説明 |
|-----------|---------|------|------|
| 組織階層ツリー | ツリー表示 | ○ | 部門・チームの階層構造 |
| 報告関係 | 関係線表示 | ○ | 上司・部下の報告ライン |
| 権限継承マップ | フロー図 | ○ | 権限の継承関係 |
| 階層深度 | 数値表示 | ○ | 各ブランチの階層レベル |
| 管理スパン | 統計表示 | × | 各管理職の管理下人数 |
| 設定履歴 | 時系列表示 | × | 階層変更の履歴 |

### データの更新頻度
- **階層構造**: リアルタイム更新
- **権限継承**: 設定変更時に即座更新
- **分析指標**: 5分間隔更新

## 入力項目

### フォーム一覧

| 入力項目 | 入力形式 | 必須 | バリデーション | 説明 |
|---------|---------|------|---------------|------|
| 部門配置 | ドラッグ&ドロップ | ○ | 階層論理チェック | 部門の階層位置 |
| 報告関係 | 関係線描画 | ○ | 循環参照チェック | 上司・部下関係 |
| 階層レベル | 数値選択 | ○ | 1-10範囲 | 組織内の階層深度 |
| 権限継承ルール | チェックボックス | × | 権限整合性 | 自動継承の設定 |
| 有効期間 | 日付範囲 | × | 論理的整合性 | 階層関係の期間 |
| 例外設定 | テキストエリア | × | 0-200文字 | 特別な階層ルール |

## アクション・操作

### 主要アクション
- **階層構築**: ドラッグ&ドロップによる階層編成
- **報告関係設定**: 上司・部下関係の定義
- **権限継承設定**: 階層による権限自動設定
- **整合性検証**: 階層の論理チェック
- **階層最適化**: 効率性に基づく構造改善
- **一括操作**: 複数部門の同時移動・設定

### 副次アクション
- **階層分析**: 組織効率性の評価
- **テンプレート適用**: 標準パターンの活用
- **履歴確認**: 過去の階層変更確認
- **プレビュー生成**: 設定結果の事前確認
- **エクスポート**: 階層図の外部出力

## 画面の振る舞い

### ユーザー操作への反応
- **部門ドラッグ時**: リアルタイムでの階層更新と影響範囲表示
- **報告関係設定時**: 権限継承の自動計算と表示
- **階層変更時**: 整合性チェックと警告の即座表示
- **検証実行時**: プログレスバーと詳細結果の段階表示

### 条件による表示変更
- **大規模組織時**: 段階的表示とズーム機能の提供
- **マトリックス組織時**: 複数報告関係の視覚的強調
- **権限競合検出時**: 競合箇所のハイライトと修正ガイド

## 画面遷移

### 遷移元画面
- 組織構造定義ページ: 基本構造設定完了後
- 組織管理ダッシュボード: 階層管理メニューから
- 組織図表示ページ: 編集モード切り替えから

### 遷移先画面
- 組織ロール割り当てページ: 階層確定後のメンバー配置
- 権限管理ページ: 階層連動権限の詳細設定
- 組織図確認ページ: 設定完了後の最終確認

## エラーハンドリング

- **循環参照エラー**: 循環箇所の可視化と修正パスの提案
- **階層深度エラー**: 制限値の表示と構造見直しの提案
- **権限競合エラー**: 競合する権限の詳細表示と調整方法
- **データ整合性エラー**: 不整合箇所の特定と修正ガイダンス
- **保存失敗エラー**: エラー原因の分析と復旧手順の提示

## アクセシビリティ要件

- **キーボード操作**: Tab/矢印キーでの階層ナビゲーション
- **スクリーンリーダー対応**: 階層構造の論理的な読み上げ順序
- **高コントラスト対応**: 階層線と背景の明確な区別
- **ズーム機能**: 複雑な階層図の拡大表示

## レスポンシブ対応

- **デスクトップ（1200px以上）**:
  - 3ペインレイアウト（階層図、設定、分析）
  - 大画面での詳細な階層表示
- **タブレット（768px-1199px）**:
  - 2ペインレイアウト（タブ切り替え）
  - 簡略化された階層操作
- **モバイル（767px以下）**:
  - 1ペインレイアウト（縦スクロール）
  - 基本的な階層確認・簡易編集のみ

## パフォーマンス要件

- **階層表示**: 1000部門まで3秒以内で描画
- **ドラッグ操作**: 遅延なしのリアルタイム更新
- **整合性チェック**: 500部門規模で5秒以内
- **階層保存**: 10秒以内で完了

## セキュリティ要件

- **階層変更権限**: 変更範囲に応じた権限チェック
- **操作監査**: 全ての階層変更の詳細ログ
- **データ保護**: 階層情報の暗号化保存
- **変更承認**: 重要な階層変更の承認フロー

## 特殊機能

### AI支援機能
- **最適階層提案**: 組織規模・業界に基づく階層構造提案
- **効率性分析**: 現在の階層構造の問題点特定
- **改善提案**: ベストプラクティスに基づく構造改善案

### 大規模組織対応
- **分割表示**: 大規模組織の部分的階層表示
- **段階構築**: 段階的な階層構築支援
- **パフォーマンス最適化**: 大量データの高速表示

### 高度な階層機能
- **時間軸管理**: 階層変更のスケジューリング
- **シミュレーション**: 階層変更の事前シミュレーション
- **多角的分析**: 複数視点での階層効果分析