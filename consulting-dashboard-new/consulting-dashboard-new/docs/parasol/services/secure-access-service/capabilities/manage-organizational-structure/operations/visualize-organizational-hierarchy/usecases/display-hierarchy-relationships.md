# ユースケース: 階層関係を表示する

## 基本情報

- **ユースケースID**: UC-SEC-045
- **ユースケース名**: 階層関係を表示する
- **アクター**: 一般ユーザー, 部門長, HR担当者, 組織管理者, 新入社員
- **概要**: 組織内の階層関係と報告ラインを動的かつインタラクティブに表示し、組織構造の理解と業務遂行を支援する

## 事前条件

- 組織図が作成されている
- 表示対象となる階層データが最新の状態である
- ユーザーが組織情報へのアクセス権限を保有している
- 表示デバイスが組織図表示に対応している

## 事後条件

### 成功時
- 階層関係が視覚的に理解しやすい形で表示されている
- 報告ライン（上司・部下関係）が明確に確認できる
- ユーザーが必要な組織情報を効率的に取得できる
- 組織内での自分の位置づけが把握できる
- 業務上の連絡先・相談先が特定できる

### 失敗時
- 階層関係が正しく表示されない
- 組織構造の理解に混乱が生じる
- 業務効率に支障が発生する
- 誤った報告・連絡が行われる

## 基本フロー

1. ユーザーが組織図表示機能にアクセスする
2. システムがユーザーの権限に基づき表示可能な組織範囲を確認する
3. ユーザーが表示したい組織範囲（全体・所属部門・特定部署）を選択する
4. システムが選択された範囲の最新階層データを取得する
5. ユーザーが表示スタイル（詳細・簡略・一覧）を選択する
6. システムが選択されたスタイルで階層関係を描画する
7. ユーザーが表示された組織図上で特定の人・部門をクリック選択する
8. システムが選択された要素の詳細情報を表示する
9. ユーザーが階層をナビゲート（展開・折りたたみ・ズーム）する
10. システムがナビゲーション操作に応じて表示を動的更新する
11. ユーザーが必要な情報を確認し、業務に活用する
12. システムが表示履歴とユーザー操作を記録する

## 代替フロー

### 代替フロー1: 検索による特定表示
- 7a. 特定の人・部門を検索して表示する場合
  - 7a1. ユーザーが組織図内の検索機能を利用する
  - 7a2. システムが検索候補をリアルタイムで表示する
  - 7a3. ユーザーが検索結果から対象を選択する
  - 7a4. システムが選択された要素を中心とした階層表示に切り替える
  - 7a5. 基本フロー8に戻る

### 代替フロー2: モバイル向け表示
- 6a. モバイルデバイスでアクセスする場合
  - 6a1. システムがデバイス特性を判定する
  - 6a2. システムがモバイル向けの簡略表示モードを適用する
  - 6a3. ユーザーがタッチ操作で階層をナビゲートする
  - 6a4. システムがタッチジェスチャーに対応した操作を提供する
  - 6a5. 基本フロー8に戻る

### 代替フロー3: 印刷・共有用表示
- 11a. 組織図を印刷・共有する場合
  - 11a1. ユーザーが印刷・共有モードを選択する
  - 11a2. システムが印刷に適したレイアウトを生成する
  - 11a3. ユーザーが印刷範囲と詳細レベルを調整する
  - 11a4. システムが設定に基づき最終的な印刷用フォーマットを作成する

## 例外フロー

### 例外1: アクセス権限不足
- 3a. 表示権限が不足している場合
  - 3a1. システムがアクセス制限の理由を説明する
  - 3a2. システムが表示可能な代替範囲を提示する
  - 3a3. ユーザーが代替範囲を選択するか、権限申請を行う
  - 3a4. 権限が確認できた場合、基本フロー4から再開する

### 例外2: データ取得エラー
- 4a. 階層データの取得に失敗した場合
  - 4a1. システムがエラー原因とキャッシュデータの有無を確認する
  - 4a2. キャッシュが利用可能な場合、古いデータでの表示を選択肢として提示する
  - 4a3. ユーザーがキャッシュ表示を選択するか、再試行を選択する
  - 4a4. 成功した場合、基本フロー6から再開する

### 例外3: 表示パフォーマンス問題
- 6a. 大規模組織で表示が困難な場合
  - 6a1. システムが組織規模と推奨表示方法を提示する
  - 6a2. ユーザーが表示範囲を限定するか、簡略表示を選択する
  - 6a3. システムが調整された設定で階層表示を最適化する
  - 6a4. 基本フロー7から再開する

## 特別要件

- **応答性**: 階層展開・折りたたみは1秒以内で完了する
- **可用性**: オフライン時もキャッシュデータで基本表示が可能である
- **アクセシビリティ**: スクリーンリーダーで階層構造が理解できる
- **互換性**: 主要ブラウザ・モバイルデバイスで一貫した表示を提供する

## 関連ユースケース

- **前提**: 「組織図を作成する」
- **包含**: 「組織情報を検索する」
- **拡張**: 「可視化オプションをカスタマイズする」
- **汎化**: 「組織情報にアクセスする」