# ページ定義: プロジェクトコスト配分画面

## 画面の目的
プロジェクトに発生したコストを適切な配分ルールに基づいて各工程・リソースに振り分け、正確なプロジェクト収益性を把握することで、コスト管理の精度向上と意思決定支援を実現する。

## 利用者
- **主要利用者**: 財務マネージャー - コスト配分の実行と承認を担当
- **副次利用者**: 経理担当者 - コストデータの入力と検証を行う
- **副次利用者**: プロジェクトマネージャー - 配分結果の確認と妥当性評価を実施

## 画面構成

### ヘッダー部
- ページタイトル「プロジェクトコスト配分」
- 対象期間選択ドロップダウン（月次・四半期・年次）
- 配分ステータス表示（未配分・配分中・配分完了・承認済み）
- 一括処理ボタン（自動配分・一括承認・エクスポート）

### メインコンテンツ部
- **プロジェクト選択セクション**:
  - プロジェクト一覧テーブル（プロジェクト名、期間、ステータス、未配分コスト金額）
  - 検索・フィルター機能（プロジェクト名、PM、ステータス）
  - 選択チェックボックス（複数選択可能）

- **コスト項目セクション**:
  - 未配分コスト一覧テーブル（コスト種別、金額、発生日、仕入先、配分ルール適用可否）
  - コスト詳細表示エリア（選択したコストの詳細情報）
  - 配分ルール設定パネル（工数比・売上比・均等配分・カスタム）

- **配分結果プレビューセクション**:
  - 配分結果サマリー（配分前後の各プロジェクトコスト比較）
  - 配分詳細テーブル（プロジェクト別・コスト項目別の配分金額）
  - 配分精度指標（配分率100%達成、未配分残高、配分ルール適用率）

### サイドバー部
- 配分ルールライブラリ（よく使用するルールのテンプレート）
- 配分履歴（過去の配分実行履歴と結果参照）
- 承認待ちリスト（承認が必要な配分案件の一覧）

### フッター部
- 実行ボタン（配分実行・下書き保存・承認申請）
- キャンセルボタン（変更を破棄して前画面に戻る）
- ヘルプリンク（コスト配分ガイド・よくある質問）

## データ表示

### 表示データ一覧
| データ項目 | 表示形式 | 必須 | 説明 |
|-----------|---------|------|------|
| プロジェクト名 | テキスト | ○ | 配分対象プロジェクトの名称 |
| 未配分コスト金額 | 金額（千円区切り） | ○ | 配分待ちのコスト総額 |
| コスト種別 | カテゴリラベル | ○ | 人件費・外注費・経費等の分類 |
| 配分ルール | セレクトボックス | ○ | 適用する配分方法 |
| 配分比率 | パーセンテージ | ○ | 各プロジェクトへの配分割合 |
| 配分後金額 | 金額（千円区切り） | ○ | 配分実行後の各プロジェクトコスト |
| 配分精度 | 進捗バー | ○ | 配分ルール適用の完全性 |
| 最終更新日時 | 日時 | ○ | データの最終更新タイムスタンプ |

### データの更新頻度
- **未配分コスト**: リアルタイム（経理システムからの自動連携）
- **配分ルール**: 手動更新（財務マネージャーによる設定変更時）
- **配分結果**: 即座（配分実行ボタン押下時）

## 入力項目

### フォーム一覧
| 入力項目 | 入力形式 | 必須 | バリデーション | 説明 |
|---------|---------|------|---------------|------|
| 対象期間 | 日付選択 | ○ | 現在日以前、3年以内 | 配分処理の対象となる期間 |
| 配分ルール選択 | ラジオボタン | ○ | いずれか選択必須 | 工数比・売上比・均等・カスタム |
| カスタム配分比率 | 数値入力 | × | 合計100%、0-100の範囲 | カスタムルール選択時の手動比率 |
| 配分理由・備考 | テキストエリア | × | 500文字以内 | 配分根拠の説明や特記事項 |
| 承認者選択 | セレクトボックス | ○ | 財務マネージャー以上 | 配分承認を行う責任者 |

## アクション・操作

### 主要アクション
- **配分実行**: 設定したルールに基づきコストを各プロジェクトに配分
- **プレビュー表示**: 実行前に配分結果を事前確認
- **承認申請**: 配分結果を上位者に承認依頼

### 副次アクション
- **下書き保存**: 配分設定を保存して後で続行
- **ルールテンプレート保存**: よく使用する配分ルールをライブラリに保存
- **配分履歴参照**: 過去の配分実行結果を確認
- **エクスポート**: 配分結果をExcel/CSVで出力

## 画面の振る舞い

### ユーザー操作への反応
- **プロジェクト選択**時: 選択プロジェクトの未配分コスト詳細を下部に表示
- **配分ルール変更**時: リアルタイムで配分結果プレビューを更新
- **配分実行ボタン押下**時: 処理進捗インジケーターを表示し、完了後に結果画面に遷移

### 条件による表示変更
- **未配分コストが0円**の場合: 「配分対象なし」メッセージを表示し、実行ボタンを無効化
- **承認済み配分**の場合: データを読み取り専用で表示、編集ボタンを非表示
- **エラー発生**時: エラー詳細をアラートで表示し、修正箇所をハイライト

## 画面遷移

### 遷移元画面
- コスト管理ダッシュボード: 「コスト配分」メニューから遷移
- プロジェクト詳細画面: 「コスト配分実行」リンクから遷移
- 承認画面: 「修正して再配分」ボタンから遷移

### 遷移先画面
- 配分結果確認画面: 配分実行完了後に自動遷移
- 承認申請画面: 「承認申請」ボタン押下時に遷移
- コスト分析画面: 「配分後分析」リンクから遷移

## エラーハンドリング
- **配分比率合計エラー**: 「配分比率の合計が100%になっていません」警告とハイライト表示
- **データ整合性エラー**: 「コストデータに不整合があります。経理部門にご確認ください」
- **権限エラー**: 「この操作には財務マネージャー権限が必要です」
- **システムエラー**: 「システムエラーが発生しました。しばらく待ってから再度お試しください」

## アクセシビリティ要件
- キーボードナビゲーション対応（Tabキーでフォーカス移動、Enterで実行）
- スクリーンリーダー対応（aria-labelによる要素説明、見出し構造の明確化）
- 色覚障害への配慮（ステータス表示にアイコンとテキストを併用）

## レスポンシブ対応
- **デスクトップ**: 4カラムレイアウトでサイドバーとメインコンテンツを並列表示
- **タブレット**: 2カラムレイアウトでサイドバーを折りたたみ式に変更
- **モバイル**: 1カラムレイアウトでテーブルを横スクロール対応、重要項目のみ表示