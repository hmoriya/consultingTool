# ページ定義: コスト配分最適化画面

## 画面の目的
既存のコスト配分を分析し、より精度の高い配分ルールを発見・適用することで、プロジェクト収益性の可視化精度を向上させ、戦略的意思決定を支援する。

## 利用者
- **主要利用者**: 財務マネージャー - 配分最適化の戦略立案と実行責任を担当
- **副次利用者**: エグゼクティブ - 最適化結果の承認と戦略的判断を実施
- **副次利用者**: データアナリスト - 最適化アルゴリズムの調整と効果検証を行う

## 画面構成

### ヘッダー部
- ページタイトル「コスト配分最適化」
- 最適化対象期間選択（過去3ヶ月・6ヶ月・1年）
- 最適化手法選択タブ（統計的分析・機械学習・シミュレーション）
- 実行ステータス表示（分析中・最適化中・完了・エラー）

### メインコンテンツ部
- **現在の配分状況セクション**:
  - 配分精度指標ダッシュボード（配分率・誤差率・一致度）
  - プロジェクト別配分結果テーブル（配分前後比較、誤差、改善ポテンシャル）
  - 配分ルール使用状況（各ルールの使用頻度・精度・適用場面）

- **最適化候補セクション**:
  - 改善提案一覧（提案内容、期待効果、実装難易度、推奨度）
  - 最適配分ルール推奨リスト（ルール名、適用条件、精度向上率）
  - Before/After比較チャート（現在配分 vs 最適化後配分）

- **シミュレーション結果セクション**:
  - 最適化効果予測（精度向上率・コスト削減効果・ROI）
  - リスク分析（実装リスク・精度悪化リスク・運用負荷）
  - 実装プラン（段階的導入・一括実装・テスト実装）

### サイドバー部
- 最適化パラメータ設定（許容誤差率・最小改善率・制約条件）
- 過去の最適化履歴（実行日・効果・採用状況）
- 業界ベンチマーク（同業他社比較・ベストプラクティス）

### フッター部
- 実行ボタン（最適化実行・シミュレーション・テスト適用）
- 保存ボタン（最適化ルールを保存・テンプレート化）
- エクスポートボタン（分析結果・改善提案レポート出力）

## データ表示

### 表示データ一覧
| データ項目 | 表示形式 | 必須 | 説明 |
|-----------|---------|------|------|
| 現在の配分精度 | パーセンテージ（色分け） | ○ | 現在の配分ルールの正確性 |
| 最適化後予測精度 | パーセンテージ（色分け） | ○ | 最適化実施後の期待精度 |
| 改善ポテンシャル | パーセンテージ（上昇矢印） | ○ | 精度向上の可能性 |
| 対象プロジェクト数 | 数値 | ○ | 最適化対象のプロジェクト件数 |
| 分析対象コスト総額 | 金額（千円区切り） | ○ | 最適化対象となるコスト金額 |
| 推奨配分ルール | テキスト（強調表示） | ○ | 最も効果的な配分方法 |
| 実装予想工数 | 時間（人日換算） | ○ | 最適化実装に必要な作業量 |
| ROI予測値 | 倍率（小数点1桁） | ○ | 最適化投資に対する収益率 |

### データの更新頻度
- **配分精度指標**: 日次（夜間バッチ処理で自動計算）
- **最適化候補**: 週次（新しいデータ蓄積による再分析）
- **業界ベンチマーク**: 月次（外部データ更新に合わせて）

## 入力項目

### フォーム一覧
| 入力項目 | 入力形式 | 必須 | バリデーション | 説明 |
|---------|---------|------|---------------|------|
| 最適化目標設定 | セレクトボックス | ○ | 事前定義選択肢から選択 | 精度重視・効率重視・バランス型 |
| 許容誤差率 | 数値入力（%） | ○ | 0.1-10%の範囲 | 配分誤差の許容範囲 |
| 最小改善しきい値 | 数値入力（%） | ○ | 1-50%の範囲 | 実装価値がある最小改善率 |
| 制約条件 | チェックボックス | × | 複数選択可 | 法的制約・業務制約・技術制約 |
| 実装優先度 | ラジオボタン | ○ | 高・中・低から選択 | 実装の緊急度・重要度 |
| テスト期間 | 日付選択 | × | 1週間-3ヶ月の範囲 | テスト実装の実施期間 |

## アクション・操作

### 主要アクション
- **最適化分析実行**: 現在のデータを基に最適な配分ルールを分析・提案
- **シミュレーション実行**: 提案ルールを仮想環境で検証
- **テスト実装**: 限定範囲で最適化ルールを試験適用

### 副次アクション
- **詳細分析**: 特定プロジェクト・コスト項目のドリルダウン分析
- **ベンチマーク比較**: 業界標準・競合他社との配分精度比較
- **履歴分析**: 過去の最適化実施結果と効果の時系列分析
- **レポート生成**: 分析結果と改善提案の包括的レポート作成

## 画面の振る舞い

### ユーザー操作への反応
- **最適化手法選択**時: 対応する分析結果とパラメータ設定エリアを表示
- **パラメータ変更**時: リアルタイムでシミュレーション結果を更新
- **分析実行中**: 進捗バーと処理状況を表示、他の操作を制限

### 条件による表示変更
- **十分なデータがない**場合: 「データ不足」警告と必要データ量を表示
- **改善余地がない**場合: 「最適化済み」メッセージと現状維持推奨を表示
- **高リスク提案**の場合: 警告アイコンとリスク詳細を強調表示

## 画面遷移

### 遷移元画面
- コスト配分画面: 「配分最適化」ボタンから遷移
- ダッシュボード: 「配分精度改善」ウィジェットから遷移
- 分析レポート画面: 「最適化実行」リンクから遷移

### 遷移先画面
- 最適化実装画面: 「実装実行」ボタン押下時に遷移
- テスト結果画面: テスト実装完了後に自動遷移
- 配分ルール管理画面: 「ルール編集」リンクから遷移

## エラーハンドリング
- **データ不足エラー**: 「分析に必要なデータが不足しています。最低3ヶ月分のデータが必要です」
- **計算エラー**: 「最適化計算でエラーが発生しました。パラメータを見直してください」
- **リソース不足エラー**: 「システムリソースが不足しています。しばらく待ってから再実行してください」
- **権限エラー**: 「最適化実行には財務マネージャー以上の権限が必要です」

## アクセシビリティ要件
- キーボードナビゲーション対応（Tab移動、Enter実行、Escape取消）
- スクリーンリーダー対応（チャート要素の音声説明、テーブルヘッダー読み上げ）
- 色覚障害への配慮（改善度合いを色とパターンで併用表示）

## レスポンシブ対応
- **デスクトップ**: 3ペインレイアウトで分析結果・詳細・設定を同時表示
- **タブレット**: 2ペインレイアウトでタブ切り替えによる表示制御
- **モバイル**: 1ペインレイアウトでスワイプナビゲーション、重要指標を優先表示