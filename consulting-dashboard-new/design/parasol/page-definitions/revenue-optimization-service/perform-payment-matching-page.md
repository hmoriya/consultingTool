# ページ定義: 消込処理画面

## 画面の目的
確認済みの入金と対応する請求書を正確に照合・消込することで、売掛金残高の適切な管理と正確な財務報告を実現し、債権管理の精度向上と監査対応の効率化を支援する。

## 利用者
- **主要利用者**: 経理担当者 - 日常的な消込処理の実行と結果確認を担当
- **副次利用者**: 財務マネージャー - 複雑な消込案件の承認と例外処理の判断を実施
- **副次利用者**: システム管理者 - 消込処理の技術的監視とエラー対応を担当
- **副次利用者**: 監査担当者 - 消込処理の適切性確認と監査証跡の検証を実施

## 画面構成

### ヘッダー部
- ページタイトル「消込処理」
- 処理モード選択（自動消込・手動消込・一括処理・例外処理）
- 処理対象期間選択（今日・今週・今月・カスタム期間）
- 処理ステータス表示（処理中・完了・要確認・エラー）

### メインコンテンツ部
- **消込対象データセクション**:
  - 未消込入金一覧（入金日・金額・入金者・口座・照合候補数・処理優先度）
  - 未消込請求書一覧（請求書番号・クライアント・金額・支払期限・消込可能性）
  - 自動照合結果（完全一致・部分一致・候補なし・要確認の分類表示）

- **照合・消込エリア**:
  - ドラッグ&ドロップ照合（入金と請求書のマッチング操作）
  - 消込金額調整（部分消込・複数請求書振分・差額調整）
  - 消込理由入力（消込根拠・調整理由・特記事項の記録）

- **処理結果確認セクション**:
  - 消込処理プレビュー（処理前後の残高比較・影響分析）
  - 仕訳データ生成（借方・貸方・勘定科目・摘要の自動生成）
  - エラー・警告表示（データ不整合・金額相違・重複処理等）

### サイドバー部
- 消込ルールライブラリ（自動照合の条件設定・例外ルール）
- 処理履歴（過去の消込実績・修正履歴・承認状況）
- 統計情報（消込率・処理時間・エラー率・品質指標）

### フッター部
- 実行ボタン（消込実行・一括処理・承認申請・仕訳出力）
- 確認ボタン（データ検証・残高確認・整合性チェック）
- 管理ボタン（ルール設定・履歴管理・レポート生成）

## データ表示

### 表示データ一覧
| データ項目 | 表示形式 | 必須 | 説明 |
|-----------|---------|------|------|
| 入金ID | テキスト（リンク） | ○ | 入金データの一意識別子 |
| 入金額 | 金額（千円区切り） | ○ | 消込対象となる入金金額 |
| 入金日 | 日付 | ○ | 銀行で確認された入金日 |
| 入金者名 | テキスト | ○ | 振込者として記録された名称 |
| 請求書番号 | テキスト（リンク） | ○ | 照合対象の請求書番号 |
| 請求金額 | 金額（千円区切り） | ○ | 請求書の金額 |
| 照合精度 | パーセンテージ | ○ | 自動照合の信頼度 |
| 消込状況 | ステータス（アイコン） | ○ | 未処理・処理済み・要確認 |

### データの更新頻度
- **入金データ**: リアルタイム（銀行システムから自動連携）
- **請求書データ**: 日次（請求管理システムから自動同期）
- **消込ルール**: 手動更新（経理業務変更・システム改善時）

## 入力項目

### フォーム一覧
| 入力項目 | 入力形式 | 必須 | バリデーション | 説明 |
|---------|---------|------|---------------|------|
| 消込金額 | 数値入力 | ○ | 正数、入金額以下 | 実際に消込する金額 |
| 消込日 | 日付選択 | ○ | 入金日以降 | 消込処理を行う基準日 |
| 差額理由 | セレクトボックス | × | 事前定義から選択 | 金額差異の理由分類 |
| 調整勘定 | セレクトボックス | × | 会計勘定から選択 | 差額処理に使用する勘定 |
| 消込備考 | テキストエリア | × | 500文字以内 | 消込処理の詳細説明 |
| 承認者選択 | セレクトボックス | × | 権限保有者 | 例外処理の承認者 |

## アクション・操作

### 主要アクション
- **自動消込実行**: システムによる条件一致案件の自動照合・消込
- **手動消込実行**: ユーザー指定による個別照合・消込処理
- **一括消込実行**: 複数案件の同時消込処理

### 副次アクション
- **照合候補検索**: 条件を緩和した照合候補の再検索
- **部分消込処理**: 入金額が請求額より少ない場合の部分処理
- **消込取消**: 誤って実行した消込の取消・修正処理
- **データ出力**: 消込結果の会計システム向けデータ出力

## 画面の振る舞い

### ユーザー操作への反応
- **入金選択**時: 照合候補となる請求書を自動検索・表示
- **消込金額変更**時: リアルタイムで差額と調整仕訳を計算・表示
- **ドラッグ&ドロップ**時: 照合精度と処理可能性を即座に判定・表示

### 条件による表示変更
- **完全一致**の場合: 緑色ハイライトと「自動処理推奨」マークを表示
- **金額相違**の場合: 黄色警告と差額調整オプションを表示
- **照合困難**の場合: 赤色アラートと手動確認要求を表示

## 画面遷移

### 遷移元画面
- 入金状況確認画面: 「消込処理」ボタンから遷移
- 収益管理ダッシュボード: 「消込管理」メニューから遷移
- 売掛金管理画面: 「消込実行」リンクから遷移

### 遷移先画面
- 消込完了確認画面: 消込処理完了後に自動遷移
- 売掛金残高画面: 「残高確認」ボタンから遷移
- 仕訳確認画面: 「仕訳詳細」リンクから遷移

## エラーハンドリング
- **金額不一致エラー**: 「入金額と請求額が一致しません。差額処理が必要です」
- **重複消込エラー**: 「この請求書は既に消込済みです」
- **データ整合性エラー**: 「入金データに不整合があります。データを確認してください」
- **システムエラー**: 「会計システム連携でエラーが発生しました」

## アクセシビリティ要件
- キーボードナビゲーション対応（Tab移動、Enter確定、方向キーで項目選択）
- スクリーンリーダー対応（金額の読み上げ、照合結果の音声説明）
- 色覚障害への配慮（照合状況を色・アイコン・テキストで複合表示）
- 大きな文字サイズ対応（重要な金額・差額情報の視認性確保）

## レスポンシブ対応
- **デスクトップ**: 4ペインレイアウトで入金・請求書・照合・結果を効率的に表示
- **タブレット**: 3ペインレイアウトでタッチ操作によるドラッグ&ドロップに最適化
- **モバイル**: 2ペインレイアウトでスワイプによる照合操作とステップ形式の処理