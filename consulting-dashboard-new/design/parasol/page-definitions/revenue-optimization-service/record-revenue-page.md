# ページ定義: 収益記録画面

## 画面の目的
プロジェクトの進捗に応じた収益認識を正確かつタイムリーに記録し、会計基準と社内ルールに準拠した適切な収益管理を実現することで、財務報告の信頼性と経営判断の精度を向上させる。

## 利用者
- **主要利用者**: 経理担当者 - 日常的な収益記録と仕訳処理を担当
- **副次利用者**: 財務マネージャー - 収益記録の承認と例外処理の判断を実施
- **副次利用者**: プロジェクトマネージャー - プロジェクト進捗と収益認識タイミングの連携を担当
- **副次利用者**: 監査担当者 - 収益認識の適切性確認と監査証跡の検証を行う

## 画面構成

### ヘッダー部
- ページタイトル「収益記録」
- 記録対象期間選択（月次・週次・日次・カスタム期間）
- 収益認識基準選択（進行基準・完成基準・部分完成基準）
- バッチ処理ステータス（自動認識・手動入力・承認待ち・完了）

### メインコンテンツ部
- **プロジェクト選択セクション**:
  - 対象プロジェクト一覧テーブル（プロジェクト名・進捗率・認識可能額・最終記録日）
  - 検索・フィルター機能（プロジェクト名・PM・ステータス・金額範囲）
  - 自動抽出条件設定（進捗率しきい値・マイルストーン達成・検収完了）

- **収益記録エントリセクション**:
  - 収益明細入力フォーム（収益区分・金額・認識基準・対象期間・摘要）
  - 進捗連動計算機能（進捗率×契約金額の自動計算）
  - 税務処理設定（課税区分・消費税処理・源泉徴収）

- **検証・確認セクション**:
  - 記録前チェック結果（会計基準適合性・社内ルール準拠・データ整合性）
  - 仕訳プレビュー（借方・貸方・勘定科目・金額・摘要）
  - 影響分析（月次売上・利益率・予算達成率への影響）

### サイドバー部
- 収益認識ルールライブラリ（プロジェクト種別別の標準ルール）
- 進捗確認ツール（プロジェクト進捗率・マイルストーン状況）
- 過去記録履歴（同一プロジェクトの過去の収益記録）

### フッター部
- 実行ボタン（記録実行・下書き保存・承認申請・一括処理）
- 検証ボタン（データ検証・ルール確認・監査準備）
- エクスポートボタン（収益レポート・仕訳データ・監査資料）

## データ表示

### 表示データ一覧
| データ項目 | 表示形式 | 必須 | 説明 |
|-----------|---------|------|------|
| プロジェクト名 | テキスト（リンク） | ○ | 収益記録対象のプロジェクト |
| 契約金額 | 金額（千円区切り） | ○ | プロジェクトの総契約額 |
| 進捗率 | パーセンテージ（バー） | ○ | 現在のプロジェクト進捗 |
| 認識可能額 | 金額（計算式表示） | ○ | 現時点で認識可能な収益額 |
| 既認識額 | 金額（累計） | ○ | 過去に認識済みの収益額 |
| 未認識残高 | 金額（残額） | ○ | まだ認識していない収益額 |
| 認識基準 | セレクトボックス | ○ | 適用する収益認識基準 |
| 最終記録日 | 日付 | ○ | 前回の収益記録実行日 |

### データの更新頻度
- **プロジェクト進捗**: リアルタイム（プロジェクト管理システムから自動連携）
- **契約情報**: 手動更新（契約変更時に経理担当者が更新）
- **認識ルール**: 月次更新（会計基準変更・社内規定見直し時）

## 入力項目

### フォーム一覧
| 入力項目 | 入力形式 | 必須 | バリデーション | 説明 |
|---------|---------|------|---------------|------|
| 記録対象日 | 日付選択 | ○ | 当月内、未来日不可 | 収益を記録する基準日 |
| 収益区分 | セレクトボックス | ○ | 事前定義から選択 | コンサル・開発・運用等の区分 |
| 認識金額 | 数値入力 | ○ | 正数、上限は未認識残高 | 今回記録する収益金額 |
| 認識根拠 | ラジオボタン | ○ | 進捗・検収・完成から選択 | 収益認識の根拠となる事実 |
| 摘要・備考 | テキストエリア | × | 200文字以内 | 収益記録の詳細説明 |
| 承認者指定 | セレクトボックス | ○ | 財務マネージャー以上 | 記録承認を行う責任者 |

## アクション・操作

### 主要アクション
- **収益記録実行**: 入力内容に基づく収益の正式記録と仕訳生成
- **自動算定**: プロジェクト進捗に基づく認識可能額の自動計算
- **承認申請**: 記録内容を上位者に承認依頼

### 副次アクション
- **進捗同期**: プロジェクト管理システムから最新進捗を取得
- **ルール適用**: 標準的な収益認識ルールの自動適用
- **履歴参照**: 同一プロジェクトの過去記録パターンを参照
- **データ検証**: 記録内容の会計基準適合性チェック

## 画面の振る舞い

### ユーザー操作への反応
- **プロジェクト選択**時: 選択プロジェクトの詳細情報と認識可能額を自動表示
- **認識基準変更**時: 対応する計算ロジックで認識可能額を再計算
- **金額入力**時: リアルタイムで仕訳プレビューと影響分析を更新

### 条件による表示変更
- **進捗率100%**の場合: 「完成基準適用可能」メッセージと推奨設定を表示
- **大幅な金額変更**時: 「要注意」アラートと上位承認必須フラグを表示
- **期末近接**時: 「期末処理」警告と監査対応チェックリストを表示

## 画面遷移

### 遷移元画面
- 収益管理ダッシュボード: 「収益記録」メニューから遷移
- プロジェクト詳細画面: 「収益記録実行」ボタンから遷移
- 承認画面: 「修正して再記録」リンクから遷移

### 遷移先画面
- 記録完了確認画面: 収益記録実行後に自動遷移
- 仕訳確認画面: 「仕訳詳細確認」ボタンから遷移
- 収益レポート画面: 「影響確認」リンクから遷移

## エラーハンドリング
- **金額超過エラー**: 「認識金額が未認識残高を超過しています」
- **期間エラー**: 「指定された日付は記録対象期間外です」
- **権限エラー**: 「この金額の記録には上位承認が必要です」
- **システムエラー**: 「会計システム連携でエラーが発生しました」

## アクセシビリティ要件
- キーボードナビゲーション対応（Tab移動、Enter確定、Escape取消）
- スクリーンリーダー対応（金額の読み上げ、計算式の音声説明）
- 色覚障害への配慮（エラー表示にアイコンとテキストを併用）
- 大きな文字サイズ対応（重要な金額情報の視認性確保）

## レスポンシブ対応
- **デスクトップ**: 3カラムレイアウトで選択・入力・確認を同時表示
- **タブレット**: 2カラムレイアウトでタブ切り替えによる効率的入力
- **モバイル**: 1カラムレイアウトでステップ形式の入力ウィザード