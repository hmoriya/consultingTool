# ページ定義: 請求書送付画面

## 画面の目的
プロジェクトの進捗と成果物に基づく適切な請求書を作成し、クライアントに確実に送付することで、タイムリーな代金回収と良好な顧客関係の維持を両立させる。

## 利用者
- **主要利用者**: 経理担当者 - 日常的な請求書作成と送付業務を担当
- **副次利用者**: プロジェクトマネージャー - 請求根拠となる進捗・成果物の確認を実施
- **副次利用者**: 財務マネージャー - 高額請求や特別条件の承認を担当
- **副次利用者**: クライアント担当者 - 請求内容の事前確認と調整を実施

## 画面構成

### ヘッダー部
- ページタイトル「請求書送付」
- 送付方法選択タブ（メール・郵送・システム連携・一括送付）
- 処理ステータス表示（下書き・確認待ち・送付準備・送付完了）
- 緊急度設定（通常・優先・緊急・期末処理）

### メインコンテンツ部
- **請求対象選択セクション**:
  - 請求可能プロジェクト一覧（プロジェクト名・進捗率・請求可能額・前回請求日）
  - 検索・フィルター機能（クライアント・担当PM・金額範囲・期間）
  - 一括選択機能（条件指定・全選択・チェックボックス）

- **請求書作成エリア**:
  - 請求明細フォーム（項目・数量・単価・金額・税区分・摘要）
  - 自動計算機能（小計・消費税・合計金額・振込手数料）
  - テンプレート選択（クライアント別・サービス別・標準フォーマット）

- **送付設定セクション**:
  - 送付先情報（宛先・担当者・送付方法・配達指定・確認要求）
  - 添付資料管理（成果物・契約書・その他資料の添付設定）
  - 送付スケジュール（即時送付・予約送付・定期送付設定）

### サイドバー部
- 請求テンプレートライブラリ（よく使用する請求パターン）
- 送付履歴（過去の送付実績・配達状況・支払状況）
- クライアント情報（請求条件・支払条件・特記事項）

### フッター部
- 実行ボタン（請求書作成・プレビュー・送付実行・下書き保存）
- 確認ボタン（内容確認・承認申請・配達確認・支払確認）
- 管理ボタン（送付状況管理・リマインド設定・フォローアップ）

## データ表示

### 表示データ一覧
| データ項目 | 表示形式 | 必須 | 説明 |
|-----------|---------|------|------|
| プロジェクト名 | テキスト（リンク） | ○ | 請求対象のプロジェクト名称 |
| クライアント名 | テキスト | ○ | 請求先クライアント企業名 |
| 請求可能額 | 金額（千円区切り） | ○ | 現時点で請求可能な金額 |
| 進捗率 | パーセンテージ（バー） | ○ | プロジェクトの完了進捗 |
| 支払条件 | テキスト | ○ | 契約で定められた支払条件 |
| 前回請求日 | 日付 | × | 最後に請求書を送付した日 |
| 送付方法 | ラベル | ○ | メール・郵送・システム等 |
| 配達状況 | ステータス | ○ | 送付・配達・確認済み等 |

### データの更新頻度
- **プロジェクト進捗**: リアルタイム（プロジェクト管理システムから自動連携）
- **請求可能額**: 日次（収益認識システムから自動計算）
- **クライアント情報**: 手動更新（契約変更・条件変更時）

## 入力項目

### フォーム一覧
| 入力項目 | 入力形式 | 必須 | バリデーション | 説明 |
|---------|---------|------|---------------|------|
| 請求書番号 | テキスト入力 | ○ | 自動採番・重複不可 | 請求書の一意識別番号 |
| 請求日 | 日付選択 | ○ | 当日以降、月末まで | 請求書の発行日 |
| 支払期限 | 日付選択 | ○ | 請求日より後 | 代金の支払期限 |
| 請求金額 | 数値入力 | ○ | 正数、上限チェック | 請求する金額 |
| 請求項目 | テキスト入力 | ○ | 50文字以内 | 請求内容の説明 |
| 送付先選択 | セレクトボックス | ○ | 登録済み送付先 | 請求書の送付先 |
| 特記事項 | テキストエリア | × | 500文字以内 | 特別な条件や注意事項 |

## アクション・操作

### 主要アクション
- **請求書作成**: 入力内容に基づく正式な請求書の生成
- **送付実行**: 指定した方法・送付先への請求書送付
- **配達確認**: 請求書の配達状況と受領確認

### 副次アクション
- **内容プレビュー**: 送付前の請求書レイアウト・内容確認
- **テンプレート保存**: よく使用する請求パターンの保存
- **一括処理**: 複数プロジェクトの同時請求書作成・送付
- **リマインド設定**: 未払い時の自動催促機能設定

## 画面の振る舞い

### ユーザー操作への反応
- **プロジェクト選択**時: 選択プロジェクトの詳細情報と請求履歴を表示
- **金額入力**時: 自動で税額計算と合計金額を更新
- **送付方法変更**時: 対応する設定オプションと所要時間を表示

### 条件による表示変更
- **高額請求**の場合: 「要承認」マークと上位承認必須フラグを表示
- **期末期間**中: 「期末処理」モードと特別な注意事項を表示
- **送付エラー**時: エラー詳細と代替送付方法を提案

## 画面遷移

### 遷移元画面
- 収益管理ダッシュボード: 「請求書作成」メニューから遷移
- プロジェクト詳細画面: 「請求実行」ボタンから遷移
- 請求管理画面: 「新規請求」リンクから遷移

### 遷移先画面
- 請求書プレビュー画面: 「プレビュー」ボタンから遷移
- 送付完了確認画面: 送付実行後に自動遷移
- 支払管理画面: 「支払状況確認」リンクから遷移

## エラーハンドリング
- **データ不整合エラー**: 「プロジェクトデータと請求可能額に不整合があります」
- **送付エラー**: 「指定された送付先への配信に失敗しました」
- **権限エラー**: 「この金額の請求には上位承認が必要です」
- **システムエラー**: 「請求書生成システムでエラーが発生しました」

## アクセシビリティ要件
- キーボードナビゲーション対応（Tab移動、Enter確定、数値入力の矢印キー対応）
- スクリーンリーダー対応（金額の読み上げ、計算結果の音声フィードバック）
- 色覚障害への配慮（ステータス表示にアイコンとテキストを併用）
- 大きな文字サイズ対応（重要な金額・期日情報の視認性確保）

## レスポンシブ対応
- **デスクトップ**: 3カラムレイアウトで選択・作成・確認を効率的に実行
- **タブレット**: 2カラムレイアウトでタッチ操作に最適化されたフォーム入力
- **モバイル**: 1カラムレイアウトでステップバイステップの入力ウィザード