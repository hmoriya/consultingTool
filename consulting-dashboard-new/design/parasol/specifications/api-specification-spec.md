# API仕様書

**作成日**: 2025-01-26  
**更新日**: 2025-01-26  
**バージョン**: 1.0.0

## 1. 概要

API仕様は、システム間の情報連携をビジネス視点で定義します。パラソル設計では実装技術（REST、GraphQL、SOAP等）に依存せず、「どんな情報を」「どんな目的で」やり取りするかを自然言語で記述します。

### 1.1 位置づけ

```
ユースケース（システム利用シナリオ）
    ↓
【API仕様】← ここ（情報連携の定義）
    ↓
API実装（具体的なエンドポイント）
```

### 1.2 目的
- ビジネス機能の外部提供
- システム間の情報連携定義
- 統合ポイントの明確化
- 実装非依存のインターフェース仕様

### 1.3 パラソル設計原則
- **ビジネス機能中心**: 技術的な通信ではなくビジネス機能
- **情報の意味重視**: データ形式より情報の意味
- **利用目的明確化**: なぜその情報が必要かを記述
- **実装中立**: 特定のプロトコルに依存しない

## 2. 3要素記法の適用

API仕様も3要素記法を使用します：

```
日本語名 [英語名] [SYSTEM_NAME]
```

例：
```
プロジェクト情報取得 [GetProjectInfo] [GET_PROJECT_INFO]
進捗状況更新 [UpdateProgress] [UPDATE_PROGRESS]
レポート生成要求 [RequestReport] [REQUEST_REPORT]
```

## 3. 文書構造

### 3.1 必須セクション

```markdown
# API仕様: [API名]

## APIの目的
### ビジネス機能
### 利用シーン
### 提供価値

## 利用者
### 呼び出し元
### 認可要件

## 機能仕様
### 処理概要
### ビジネスルール

## 情報定義
### 要求情報
### 応答情報

## 処理フロー
### 正常フロー
### エラーフロー

## エラー定義
### ビジネスエラー
### システムエラー

## 利用制限
### 利用条件
### 制限事項

## 関連API
```

## 4. 記述規則

### 4.1 禁止事項
- ❌ HTTPメソッド（GET、POST等）
- ❌ URLパス
- ❌ ヘッダー情報
- ❌ ステータスコード
- ❌ JSON/XMLスキーマ

### 4.2 推奨表現
- ✅ ビジネス機能名
- ✅ 情報の意味と用途
- ✅ 業務上の制約
- ✅ 利用目的

## 5. APIの目的

### 5.1 目的の記述
```markdown
## APIの目的
### ビジネス機能
[このAPIが提供するビジネス上の機能を明確に記述]

### 利用シーン
- [シーン1]: [どんな業務で使われるか]
- [シーン2]: [どんな課題を解決するか]

### 提供価値
- [価値1]: [利用者にとっての利点]
- [価値2]: [ビジネス上のメリット]
```

## 6. 利用者の定義

### 6.1 利用者と権限
```markdown
### 呼び出し元
- **[システム/ロール名]** [[System/Role]] [[SYSTEM_ROLE]]
  - 利用目的: [なぜこのAPIを使うか]
  - 利用頻度: [どのくらいの頻度か]

### 認可要件
- 必要な権限: [どんな権限が必要か]
- 認証方式: [利用者をどう確認するか]
- アクセス制御: [どんな制限があるか]
```

## 7. 機能仕様

### 7.1 処理の定義
```markdown
### 処理概要
1. [主要な処理ステップ1]
2. [主要な処理ステップ2]
3. [主要な処理ステップ3]

### ビジネスルール
- **[ルール1]**: [適用されるビジネスルール]
  - 条件: [いつ適用されるか]
  - 影響: [どう処理が変わるか]
```

## 8. 情報定義

### 8.1 要求情報
```markdown
### 要求情報
#### 必須情報
- [情報項目1] [[InfoItem1]] [[INFO_ITEM_1]]
  - 意味: [この情報が表すもの]
  - 用途: [何のために必要か]
  - 制約: [値の制限や条件]

#### 任意情報
- [情報項目2] [[InfoItem2]] [[INFO_ITEM_2]]
  - 意味: [この情報が表すもの]
  - 初期値: [省略時の扱い]
  - 影響: [指定時の動作変化]
```

### 8.2 応答情報
```markdown
### 応答情報
#### 基本応答
- [結果情報1] [[Result1]] [[RESULT_1]]
  - 意味: [この情報が表すもの]
  - 形式: [どのような構造か]
  - 用途: [受信側でどう使うか]

#### 付加情報
- [メタ情報] [[MetaInfo]] [[META_INFO]]
  - 含まれる内容: [どんな補足情報か]
  - 利用方法: [どう活用するか]
```

## 9. 処理フロー

### 9.1 正常フロー
```markdown
### 正常フロー
1. **要求の受付**
   - 確認内容: [何をチェックするか]
   - 前提条件: [必要な状態]

2. **情報の検証**
   - 検証項目: [何を確認するか]
   - ルール適用: [どんなルールか]

3. **処理の実行**
   - 実行内容: [主要な処理]
   - 更新対象: [何が変更されるか]

4. **結果の生成**
   - 生成内容: [どんな結果か]
   - 通知: [誰に何を通知するか]
```

### 9.2 エラーフロー
```markdown
### エラーフロー
- **検証エラー時**
  1. エラー内容の特定
  2. 利用者への通知内容生成
  3. 処理の中止

- **処理エラー時**
  1. 実行済み処理の取り消し
  2. エラー情報の記録
  3. 回復可能性の通知
```

## 10. エラー定義

### 10.1 エラーの分類
```markdown
### ビジネスエラー
- **[権限不足]**: 実行権限がない
  - 発生条件: [どんな時に起こるか]
  - 対処方法: [どうすれば解決するか]

- **[ルール違反]**: ビジネスルールに反する
  - 発生条件: [どんなルール違反か]
  - 対処方法: [正しい利用方法]

### システムエラー
- **[リソース不足]**: 処理に必要なリソースが不足
  - 発生条件: [どんな状況か]
  - 復旧方法: [時間を置いて再試行等]
```

## 11. 利用制限

### 11.1 制限事項
```markdown
### 利用条件
- 利用可能時間: [いつ利用できるか]
- 同時実行数: [並行処理の制限]
- データ量: [一度に扱える量]

### 制限事項
- **頻度制限**: [単位時間あたりの回数]
  - 理由: [なぜ制限するか]
  - 超過時: [どうなるか]

- **データサイズ**: [最大サイズ]
  - 理由: [なぜ制限するか]
  - 対処: [大きい場合の代替手段]
```

## 12. 関連API

### 12.1 関連性の定義
```markdown
## 関連API
### 前提API
- [API名] [[API]] [[API_NAME]]
  - 関係: このAPIの実行前に必要
  - 理由: [なぜ必要か]

### 後続API
- [API名] [[API]] [[API_NAME]]
  - 関係: このAPIの結果を使用
  - 用途: [どう連携するか]

### 代替API
- [API名] [[API]] [[API_NAME]]
  - 用途: 類似機能を提供
  - 違い: [使い分けの基準]
```

## 13. 品質基準

### 13.1 完全性
- ビジネス機能が明確
- 情報の意味が定義されている
- エラーケースが網羅されている

### 13.2 一貫性
- 用語の統一
- 情報構造の整合性
- 他APIとの一貫性

### 13.3 利用可能性
- 利用シーンが具体的
- 制限事項が明確
- エラー時の対処が分かる

## 14. アンチパターン

### 14.1 避けるべき記述例
```markdown
❌ 悪い例：
「GETメソッドでJSONを返す」
「HTTPステータス200で成功」
「Authorizationヘッダーにトークン」

✅ 良い例：
「プロジェクト情報を取得する」
「正常に処理が完了する」
「利用者の権限を確認する」
```

### 14.2 よくある間違い
- 実装技術の詳細記述
- プロトコル依存の仕様
- データ形式の詳細定義
- パフォーマンス要件

## 15. 段階的詳細化

### 15.1 初期段階（Phase 1）
- API名と目的
- 基本的な入出力
- 主要な利用シーン

### 15.2 詳細化段階（Phase 2）
- 詳細な情報定義
- ビジネスルール
- エラーケース

### 15.3 完成段階（Phase 3）
- 関連API定義
- 利用制限
- 運用考慮事項

## 16. API種別ガイドライン

### 16.1 参照系API
- 情報の鮮度要件
- フィルタリング条件
- 結果の形式

### 16.2 更新系API
- 更新対象の範囲
- 排他制御の考慮
- 更新結果の通知

### 16.3 バッチ系API
- 処理時間の考慮
- 進捗確認方法
- 結果取得方法