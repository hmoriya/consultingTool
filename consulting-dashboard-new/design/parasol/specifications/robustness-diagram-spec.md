# ロバストネス図仕様書

**作成日**: 2025-01-26  
**更新日**: 2025-01-26  
**バージョン**: 1.0.0

## 1. 概要

ロバストネス図は、ユースケースの実現構造をビジネス視点で可視化します。パラソル設計では実装技術に依存せず、「誰が」「何を使って」「どう連携するか」を自然言語とシンプルな記法で表現します。

### 1.1 位置づけ

```
ユースケース（利用シナリオ）
    ↓
【ロバストネス図】← ここ（実現構造の可視化）
    ↓
実装設計（クラス図等）
```

### 1.2 目的
- ユースケース実現の構造化
- 責務の明確化
- 協調関係の可視化
- 実装非依存の設計表現

### 1.3 パラソル設計原則
- **ビジネス要素のみ**: 技術的な要素を含めない
- **シンプルな記法**: 3種類の要素のみ使用
- **自然言語中心**: 図の要素名は日本語
- **関係の明確化**: 誰が何をどう使うか

## 2. 3要素記法の適用

ロバストネス図の要素も3要素記法を使用します：

```
日本語名 [英語名] [SYSTEM_NAME]
```

例：
```
プロジェクト管理者 [ProjectManager] [PROJECT_MANAGER]
進捗確認画面 [ProgressView] [PROGRESS_VIEW]
プロジェクト情報 [ProjectInfo] [PROJECT_INFO]
```

## 3. 図の要素

### 3.1 3つの基本要素

#### アクター（Actor）
```
定義: システムの利用者や外部システム
表記: 人型アイコンまたは <<actor>>
例: 
- プロジェクト管理者 [ProjectManager] [PROJECT_MANAGER]
- 外部認証システム [ExternalAuth] [EXTERNAL_AUTH]
```

#### 境界（Boundary）
```
定義: 利用者とのインターフェース
表記: 縦線付き円または <<boundary>>
例:
- 登録画面 [RegistrationScreen] [REGISTRATION_SCREEN]
- 確認画面 [ConfirmationScreen] [CONFIRMATION_SCREEN]
```

#### 制御（Control）
```
定義: 処理やビジネスロジック
表記: 円または <<control>>
例:
- 入力検証 [InputValidation] [INPUT_VALIDATION]
- 承認処理 [ApprovalProcess] [APPROVAL_PROCESS]
```

#### エンティティ（Entity）
```
定義: ビジネス情報や永続データ
表記: 円に下線または <<entity>>
例:
- プロジェクト [Project] [PROJECT]
- タスク [Task] [TASK]
```

## 4. 記法規則

### 4.1 要素間の関係

#### 許可される関係
```
アクター → 境界 : 利用者の操作
境界 → 制御 : 処理の呼び出し
制御 → エンティティ : 情報の参照・更新
制御 → 境界 : 結果の表示
制御 → 制御 : 処理の連携
```

#### 禁止される関係
```
アクター → 制御 : 直接の処理実行
アクター → エンティティ : 直接のデータアクセス
境界 → エンティティ : 直接のデータ操作
エンティティ → * : エンティティからの能動的な動作
```

### 4.2 関係線の意味
```
→ : 情報や制御の流れ
実線 : 主要な流れ
破線 : 補助的な流れ
ラベル : 流れる情報や操作の内容
```

## 5. 文書構造

### 5.1 必須セクション

```markdown
# ロバストネス図: [ユースケース名]

## 図の概要
### 対象ユースケース
### 主要な流れ
### 図の範囲

## アクター
### [アクター名]

## 境界要素
### [境界要素名]

## 制御要素
### [制御要素名]

## エンティティ要素
### [エンティティ名]

## 処理の流れ
### 基本フロー
### 代替フロー
### エラーフロー

## ロバストネス図
[図をテキストまたは画像で表現]

## 設計上の注意点
```

## 6. 要素の詳細定義

### 6.1 アクターの定義
```markdown
### [アクター名] [[ActorName]] [[ACTOR_NAME]]
- **役割**: [このアクターの責任]
- **目的**: [何を達成したいか]
- **権限**: [どんな権限を持つか]
- **関与**: [どの処理に関わるか]
```

### 6.2 境界要素の定義
```markdown
### [境界要素名] [[BoundaryName]] [[BOUNDARY_NAME]]
- **目的**: [この境界の役割]
- **提供機能**: [利用者に何を提供するか]
- **表示情報**: [どんな情報を表示するか]
- **受付操作**: [どんな操作を受け付けるか]
```

### 6.3 制御要素の定義
```markdown
### [制御要素名] [[ControlName]] [[CONTROL_NAME]]
- **責務**: [この制御の責任]
- **処理内容**: [何を処理するか]
- **ビジネスルール**: [適用するルール]
- **判断基準**: [どう判断するか]
```

### 6.4 エンティティの定義
```markdown
### [エンティティ名] [[EntityName]] [[ENTITY_NAME]]
- **情報内容**: [保持する情報]
- **責務**: [情報の管理責任]
- **永続性**: [どう保存されるか]
- **整合性**: [保つべき整合性]
```

## 7. 処理の流れ

### 7.1 基本フローの記述
```markdown
### 基本フロー
1. アクター「[名前]」が境界「[名前]」にアクセス
2. 境界「[名前]」が制御「[名前]」に処理を要求
3. 制御「[名前]」がエンティティ「[名前]」から情報取得
4. 制御「[名前]」が処理を実行
5. 制御「[名前]」が境界「[名前]」に結果を返す
6. 境界「[名前]」がアクター「[名前]」に結果を表示
```

## 8. 図の表現方法

### 8.1 テキスト表現
```
[アクター] → [境界1] : 操作
           [境界1] → [制御1] : 処理要求
                    [制御1] → [エンティティ1] : 参照
                    [制御1] → [制御2] : 連携
                    [制御2] → [エンティティ2] : 更新
                    [制御2] → [境界2] : 結果
           [境界2] → [アクター] : 表示
```

### 8.2 構造化表現
```markdown
## ロバストネス図

### レイヤー構造
- **プレゼンテーション層**: [境界要素群]
- **ビジネスロジック層**: [制御要素群]
- **データ層**: [エンティティ群]

### 主要な流れ
1. [アクター] → [境界A] → [制御A] → [エンティティX]
2. [制御A] → [制御B] → [エンティティY]
3. [制御B] → [境界B] → [アクター]
```

## 9. 品質基準

### 9.1 完全性
- ユースケースのすべてのステップが表現されている
- すべてのアクターが含まれている
- 必要なエンティティが定義されている

### 9.2 一貫性
- 要素名が3要素記法に従っている
- 関係の方向が正しい
- 責務が明確に分離されている

### 9.3 シンプルさ
- 1つの図に要素が多すぎない（15個以内）
- 関係線が交差しすぎない
- 各要素の責務が単一

## 10. アンチパターン

### 10.1 避けるべき設計
- ❌ 境界から直接エンティティを操作
- ❌ エンティティ間の直接通信
- ❌ 1つの制御要素に多数の責務
- ❌ アクターから制御への直接アクセス

### 10.2 よくある間違い
- 技術的な要素（データベース、API等）を含める
- UIの詳細を境界要素に記述
- 実装クラスをそのまま要素にする
- 処理の詳細を制御要素に書きすぎる

## 11. 段階的詳細化

### 11.1 初期段階（Phase 1）
- 主要なアクターと境界
- 基本的な制御要素
- 主要エンティティ
- 基本フローのみ

### 11.2 詳細化段階（Phase 2）
- すべてのフローを網羅
- 詳細な制御要素
- エラー処理の追加

### 11.3 完成段階（Phase 3）
- 非機能要件の考慮
- 性能を考慮した設計
- 例外処理の完備

## 12. 図の分割指針

### 12.1 分割基準
- 1つのユースケース = 1つの図
- 要素数が15を超える場合は分割
- サブシステム単位で分割

### 12.2 分割方法
- フロー単位（基本/代替/例外）
- 機能単位（登録/参照/更新）
- アクター単位（利用者別）

## 13. レビューポイント

### 13.1 構造面
- 責務の分離は適切か
- 循環参照はないか
- 結合度は低いか

### 13.2 ビジネス面
- ビジネスルールは制御要素にあるか
- エンティティは適切か
- アクターの操作は自然か

### 13.3 実装可能性
- 技術的に実現可能か
- パフォーマンスは問題ないか
- 保守性は確保されているか