# ユースケース: 予測と実績の乖離を分析する [Analyze Forecast Variance] [ANALYZE_FORECAST_VARIANCE]

## ユースケース概要

### 目的
作成した収益予測と実際の収益実績を詳細に比較分析し、乖離の要因を特定・分析することで、今後の予測精度向上と戦略修正のためのインサイトを得る。

### アクター
- **主アクター**: 財務マネージャー [Finance Manager] [FINANCE_MANAGER]
  - 説明: 予測精度の分析と改善策の立案を担当する
- **副アクター**: エグゼクティブ [Executive] [EXECUTIVE]
  - 説明: 乖離分析結果に基づく戦略見直しの意思決定を行う
- **副アクター**: 事業企画担当者 [Business Planning Staff] [BUSINESS_PLANNING_STAFF]
  - 説明: 市場環境変化と乖離要因の関連性分析を行う
- **副アクター**: プロジェクトマネージャー [Project Manager] [PROJECT_MANAGER]
  - 説明: 現場レベルでの乖離要因の情報提供を行う

### 事前条件
1. 収益予測が作成され、実績データが蓄積されている
2. 比較可能な期間の予測と実績データが存在する
3. 市場環境や業績に影響した外的要因の記録がある
4. 財務マネージャーが分析実行権限を持っている

### 事後条件
1. 予測と実績の乖離が定量的に分析されている
2. 乖離要因が特定され、分類・整理されている
3. 予測精度向上のための改善策が提案されている
4. 分析結果がナレッジとして蓄積・共有されている

### トリガー
- **種別**: 時間駆動 + 要求駆動
- **詳細**: 月次・四半期の実績確定後の定期分析、または大幅な乖離発生時の緊急分析

## 基本フロー

1. 財務マネージャーが乖離分析プロセスを開始し、分析対象期間を設定する
2. システムが指定期間の予測データと実績データを取得・照合する
3. システムが予測と実績の乖離を計算し、可視化する
4. 財務マネージャーが乖離の大きい項目・期間を特定・優先順位付けする
5. システムが乖離要因の候補を分析・提示する（市場要因、内部要因等）
6. 事業企画担当者とプロジェクトマネージャーが乖離要因の詳細分析を実施する
7. 財務マネージャーが分析結果をまとめ、改善策を立案する
8. システムが分析結果をレポート化し、関係者に配布・ナレッジ登録する

## 代替フロー

### 代替フロー1: 緊急乖離分析の実施
- **分岐点**: 基本フロー ステップ1
- **条件**: 予定外の大幅な乖離が発生し、緊急分析が必要な場合
1. 財務マネージャーが緊急分析モードを設定する
2. システムが直近の予測・実績データを即座に取得・分析する
3. エグゼクティブに緊急分析開始の通知を送信する
4. 乖離要因の特定を優先し、詳細分析は後回しにする
5. 基本フロー ステップ7に進む

### 代替フロー2: 予測モデルの精度検証
- **分岐点**: 基本フロー ステップ5
- **条件**: 予測モデル自体の妥当性を検証する場合
1. システムが過去複数期間の予測精度を統計分析する
2. 財務マネージャーが予測モデルのパラメータと精度の相関を分析する
3. 必要に応じて予測モデルの調整・改善を実施する
4. 改善されたモデルでの再予測を実行して効果を検証する
5. 基本フロー ステップ7に進む

## 例外フロー

### 例外フロー1: 実績データの不整合
- **発生点**: 基本フロー ステップ2
- **条件**: 実績データに欠損や不整合がある場合
1. システムがデータ不整合の内容と範囲を検出・報告する
2. 財務マネージャーがデータ修正の必要性と影響範囲を評価する
3. 経理担当者にデータ修正を依頼し、修正完了を確認する
4. 修正後、基本フロー ステップ2から再実行する

### 例外フロー2: 乖離要因の特定困難
- **発生点**: 基本フロー ステップ6
- **条件**: 明確な乖離要因が特定できない場合
1. システムが類似過去事例と乖離パターンを検索・表示する
2. 外部専門家やコンサルタントの意見を収集する
3. より詳細な市場調査や顧客ヒアリングを実施する
4. 部分的な要因でも改善策立案を継続する

### 例外フロー3: 予測精度の継続的悪化
- **発生点**: 基本フロー ステップ3
- **条件**: 複数期間にわたって予測精度が低下し続けている場合
1. システムが予測精度悪化のトレンドを分析・可視化する
2. 財務マネージャーが予測プロセス全体の見直しを決定する
3. エグゼクティブに予測システム改革の提案を行う
4. 抜本的な予測手法の変更を検討・実行する

## ビジネスルール

1. **乖離許容範囲ルール**: 予測と実績の乖離が一定範囲を超えた場合は詳細分析を必須とする
   - 適用タイミング: 基本フロー ステップ4
   - 例: 月次乖離15%超、四半期乖離10%超は必須分析対象

2. **要因分類ルール**: 乖離要因を内部要因と外部要因に分類し、対策の性質を明確化する
   - 適用タイミング: 基本フロー ステップ6
   - 例: 内部要因は改善可能、外部要因は予測モデルに反映

3. **改善効果測定ルール**: 立案した改善策の効果を次期以降で継続測定する
   - 適用タイミング: 基本フロー ステップ7-8
   - 例: 改善策実施後3ヶ月で効果検証を実施

## 入出力情報

### 入力情報
- 収益予測データ [Revenue Forecast Data] [REVENUE_FORECAST_DATA]
  - 内容: 期間別予測額、前提条件、信頼度、予測作成日
  - 形式: 構造化データ（JSON）
  - 必須/任意: 必須
  - 検証ルール: 実績と比較可能な期間、承認済み予測

- 収益実績データ [Revenue Actual Data] [REVENUE_ACTUAL_DATA]
  - 内容: 期間別実績額、収益区分、確定日、調整項目
  - 形式: 財務システムから取得
  - 必須/任意: 必須
  - 検証ルール: 会計監査済み、最終確定値

### 出力情報
- 乖離分析レポート [Variance Analysis Report] [VARIANCE_ANALYSIS_REPORT]
  - 内容: 乖離率、要因分析、改善提案、次期予測への反映事項
  - 用途: 予測精度向上と戦略修正の判断
  - 保存期間: 5年間（予測改善の長期トレンド分析用）

- 予測精度改善策 [Forecast Accuracy Improvement Plan] [FORECAST_ACCURACY_IMPROVEMENT_PLAN]
  - 内容: 改善アクション、実施スケジュール、効果測定方法、責任者
  - 用途: 予測プロセスの継続的改善
  - 形式: アクションプランテンプレート

## 非機能要件

- **応答性**:
  - 基本乖離分析: 15分以内
  - 緊急乖離分析: 5分以内

- **利用可能性**:
  - 利用時間: 平日8:00-20:00（必須）、実績確定時は24時間対応
  - 計画停止: 年次監査期間以外は停止回避

- **精度**:
  - 乖離計算精度: 小数点以下2桁まで正確
  - 要因分析精度: 統計的有意性を確保

- **使いやすさ**:
  - 視覚化: 乖離トレンドと要因のインタラクティブなグラフ表示
  - ドリルダウン: 月次→週次→日次での詳細分析機能

## 関連ユースケース

- <<include>> 乖離要因を分類する [Classify Variance Factors] [CLASSIFY_VARIANCE_FACTORS]
  - 説明: 乖離分析時に必ず実行される

- <<extend>> 予測モデルを調整する [Adjust Forecast Model] [ADJUST_FORECAST_MODEL]
  - 説明: 継続的な乖離が発生した場合のみ実行される

- 先行: 収益予測を作成する [Create Revenue Forecast] [CREATE_REVENUE_FORECAST]
  - 説明: このユースケースの前に完了している必要がある

- 後続: 予測精度を改善する [Improve Forecast Accuracy] [IMPROVE_FORECAST_ACCURACY]
  - 説明: 分析結果を受けて実行される改善アクション

## ページ遷移概要

```
[乖離分析ダッシュボード] → [期間設定ページ] → [乖離計算ページ] → [要因分析ページ] → [改善策立案ページ] → [レポート生成ページ]
        ↓                   ↓                ↓                ↓
   [実績データ確認ページ]  [乖離可視化ページ] [過去事例検索ページ] [効果測定ページ]
```

## テストシナリオ概要

1. **正常系テスト**:
   - 標準的な月次・四半期乖離分析を最初から最後まで完全実行
   - 大幅乖離と軽微乖離の両方で分析精度を確認
   - 改善策の立案から効果測定までの一連プロセスを確認

2. **代替系テスト**:
   - 緊急乖離分析と予測モデル精度検証を個別に実行
   - 各代替フローの正常動作を確認

3. **例外系テスト**:
   - データ不整合、要因特定困難、継続的精度悪化を意図的に発生
   - エラーハンドリングと修正プロセスを確認

4. **精度テスト**:
   - 乖離計算の数値精度と要因分析の統計的妥当性を確認
   - 過去データを使用した分析精度の検証

5. **統合テスト**:
   - 予測作成→実績確定→乖離分析→改善実施の完全サイクルを確認
   - 複数期間の継続的改善効果を測定