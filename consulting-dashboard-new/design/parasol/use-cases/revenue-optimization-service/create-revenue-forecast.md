# ユースケース: 収益予測を作成する [Create Revenue Forecast] [CREATE_REVENUE_FORECAST]

## ユースケース概要

### 目的
過去の収益実績と現在進行中のプロジェクト情報を基に、将来の収益を精度高く予測することで、戦略的な経営判断と資源配分の最適化を支援する。

### アクター
- **主アクター**: 財務マネージャー [Finance Manager] [FINANCE_MANAGER]
  - 説明: 収益予測の作成と精度管理を担当する
- **副アクター**: エグゼクティブ [Executive] [EXECUTIVE]
  - 説明: 予測結果の確認と戦略的意思決定を行う
- **副アクター**: プロジェクトマネージャー [Project Manager] [PROJECT_MANAGER]
  - 説明: プロジェクト見込み情報と進捗データの提供を行う

### 事前条件
1. 過去12ヶ月以上の収益実績データが蓄積されている
2. 進行中プロジェクトの契約情報と進捗データが最新に更新されている
3. 営業パイプライン情報がアクセス可能である
4. 財務マネージャーが予測作成権限を持っている

### 事後条件
1. 精度の高い収益予測が作成され、承認されている
2. 予測の前提条件と信頼度が明確に記録されている
3. 予測結果がダッシュボードで可視化されている
4. 関係者に予測結果が共有され、戦略検討に活用されている

### トリガー
- **種別**: 時間駆動 + 要求駆動
- **詳細**: 月次の定期予測作成、または四半期・年度計画策定時の特別予測要求

## 基本フロー

1. 財務マネージャーが収益予測作成プロセスを開始し、予測期間を指定する
2. システムが過去の収益実績データを収集・分析し、トレンドを算出する
3. システムが進行中プロジェクトの契約情報と進捗状況を取得する
4. 財務マネージャーが営業パイプライン情報を確認・入力する
5. システムが予測モデルを実行し、ベースラインの収益予測を生成する
6. 財務マネージャーが予測結果を確認し、必要に応じて調整を行う
7. システムが予測の信頼度と前提条件を算出・表示する
8. 財務マネージャーが最終的な予測を承認し、関係者に公開する

## 代替フロー

### 代替フロー1: 複数シナリオ予測の作成
- **分岐点**: 基本フロー ステップ5
- **条件**: 楽観的・現実的・悲観的な複数シナリオでの予測が必要な場合
1. 財務マネージャーが各シナリオのパラメータ（成長率、受注確率等）を設定する
2. システムが各シナリオに基づく予測を並行実行する
3. 財務マネージャーが各シナリオの予測結果を比較・検討する
4. 最も適切なシナリオを選択、または複数シナリオの平均値を採用する
5. 基本フロー ステップ7に進む

### 代替フロー2: 外部要因の反映
- **分岐点**: 基本フロー ステップ6
- **条件**: 市場環境変化や競合状況等の外部要因を考慮する場合
1. 財務マネージャーが外部要因の影響度を評価・入力する
2. システムが外部要因を調整係数として予測に反映する
3. エグゼクティブが外部要因の妥当性を確認・承認する
4. 基本フロー ステップ7に進む

## 例外フロー

### 例外フロー1: データ不足による予測困難
- **発生点**: 基本フロー ステップ2
- **条件**: 過去データや進行中プロジェクトのデータが不足している場合
1. システムが不足データの種類と影響度を分析・報告する
2. 財務マネージャーが代替データの収集方法を検討する
3. プロジェクトマネージャーに追加データの提供を依頼する
4. データ補完完了後、基本フロー ステップ2から再開する

### 例外フロー2: 予測精度の異常低下
- **発生点**: 基本フロー ステップ7
- **条件**: 算出された予測の信頼度が基準値を下回った場合
1. システムが精度低下の原因を分析（データ品質、モデル適合度等）
2. 財務マネージャーが予測モデルのパラメータ調整を実施する
3. 必要に応じて予測期間の短縮や前提条件の見直しを行う
4. 調整後、基本フロー ステップ5から再実行する

### 例外フロー3: 承認却下
- **発生点**: 基本フロー ステップ8
- **条件**: エグゼクティブが予測内容を却下した場合
1. システムが却下理由と修正要求をエグゼクティブから受領する
2. 財務マネージャーが修正要求に基づき前提条件や計算方法を見直す
3. プロジェクトマネージャーに追加情報の確認を依頼する
4. 修正完了後、基本フロー ステップ5から再実行する

## ビジネスルール

1. **予測期間ルール**: 収益予測は最大12ヶ月先まで、四半期単位で作成する
   - 適用タイミング: 基本フロー ステップ1
   - 例: 4月作成時は翌年3月まで、Q1/Q2/Q3/Q4の4区分で予測

2. **信頼度基準ルール**: 予測の信頼度は過去実績との乖離率で評価し、80%以上を基準とする
   - 適用タイミング: 基本フロー ステップ7
   - 例: 過去6ヶ月の予測と実績の乖離率が20%以内なら信頼度80%

3. **定期更新ルール**: 収益予測は毎月更新し、大幅な変動時は随時見直しを実施する
   - 適用タイミング: 基本フロー ステップ1
   - 例: 前月比20%以上の変動は臨時見直し実施

## 入出力情報

### 入力情報
- 過去収益実績データ [Historical Revenue Data] [HISTORICAL_REVENUE_DATA]
  - 内容: 月次収益額、契約タイプ別内訳、クライアント別実績、季節変動
  - 形式: 時系列データ（CSV/JSON）
  - 必須/任意: 必須
  - 検証ルール: 最低12ヶ月分、欠損月は3ヶ月以内

- 営業パイプライン情報 [Sales Pipeline Information] [SALES_PIPELINE_INFO]
  - 内容: 見込み案件、受注確率、契約予定額、予定時期
  - 形式: 営業システムから取得
  - 必須/任意: 必須
  - 検証ルール: 受注確率は0-100%、契約額は正数

### 出力情報
- 収益予測レポート [Revenue Forecast Report] [REVENUE_FORECAST_REPORT]
  - 内容: 期間別予測額、信頼度、前提条件、リスク要因
  - 用途: 経営会議での戦略検討と予算策定
  - 保存期間: 3年間（実績比較のため）

- 予測精度分析 [Forecast Accuracy Analysis] [FORECAST_ACCURACY_ANALYSIS]
  - 内容: 過去予測の的中率、乖離要因分析、改善提案
  - 用途: 予測モデルの継続的改善
  - 形式: 統計分析レポート（PDF）

## 非機能要件

- **応答性**:
  - 通常予測: 5分以内
  - 複雑な多シナリオ予測: 15分以内

- **利用可能性**:
  - 利用時間: 平日8:00-20:00（必須）、その他（ベストエフォート）
  - 計画停止: 月末締め処理完了後のメンテナンス時のみ

- **精度**:
  - 予測精度目標: 実績との乖離15%以内
  - 信頼度算出: 統計的手法による客観的評価

- **使いやすさ**:
  - 視覚化: グラフとチャートによる直感的な予測表示
  - シミュレーション: パラメータ変更による即座の再計算

## 関連ユースケース

- <<include>> 過去実績データを分析する [Analyze Historical Data] [ANALYZE_HISTORICAL_DATA]
  - 説明: 予測作成前に必ず実行される

- <<extend>> シナリオ分析を実施する [Execute Scenario Analysis] [EXECUTE_SCENARIO_ANALYSIS]
  - 説明: より詳細な分析が必要な場合のみ実行される

- 先行: 収益を認識する [Recognize Revenue] [RECOGNIZE_REVENUE]
  - 説明: 過去実績データの蓄積が前提

- 後続: 予測と実績の乖離を分析する [Analyze Forecast Variance] [ANALYZE_FORECAST_VARIANCE]
  - 説明: 実績確定後に実行される

## ページ遷移概要

```
[予測管理ダッシュボード] → [予測条件設定ページ] → [データ確認ページ] → [予測実行ページ] → [結果確認ページ] → [承認ページ]
        ↓                   ↓                    ↓                ↓
   [過去実績分析ページ]   [パイプライン入力ページ] [シナリオ設定ページ] [精度分析ページ]
```

## テストシナリオ概要

1. **正常系テスト**:
   - 標準的な12ヶ月予測を最初から最後まで完全実行
   - 過去実績とパイプライン情報に基づく正確な予測生成を確認
   - 予測レポートの内容と精度を確認

2. **代替系テスト**:
   - 複数シナリオ予測と外部要因反映を個別に実行
   - 各代替フローの正常動作を確認

3. **例外系テスト**:
   - データ不足、精度低下、承認却下を意図的に発生
   - エラーハンドリングと修正プロセスを確認

4. **精度テスト**:
   - 過去データを使用した予測精度の検証
   - 異なる期間・シナリオでの予測精度を測定

5. **パフォーマンステスト**:
   - 大量データ（5年分実績）での予測生成性能を確認
   - 複数シナリオ同時実行時の応答性能を確認