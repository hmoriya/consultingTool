# ユースケース: シナリオ分析を実施する [Execute Scenario Analysis] [EXECUTE_SCENARIO_ANALYSIS]

## ユースケース概要

### 目的
複数の仮定条件に基づく収益シナリオを比較分析することで、不確実性の高いビジネス環境における戦略的意思決定とリスク管理を支援する。

### アクター
- **主アクター**: 財務マネージャー [Finance Manager] [FINANCE_MANAGER]
  - 説明: シナリオ設定と分析結果の解釈を担当する
- **副アクター**: エグゼクティブ [Executive] [EXECUTIVE]
  - 説明: シナリオ分析結果に基づく戦略的判断を行う
- **副アクター**: 事業企画担当者 [Business Planning Staff] [BUSINESS_PLANNING_STAFF]
  - 説明: 市場環境と事業戦略の前提条件を提供する

### 事前条件
1. ベースラインの収益予測が作成済みである
2. 分析対象となる変動要因が特定されている
3. 各シナリオの前提条件が明確に定義されている
4. 財務マネージャーがシナリオ分析権限を持っている

### 事後条件
1. 複数シナリオの収益分析結果が作成されている
2. シナリオ間の比較分析と感度分析が完了している
3. リスク評価と対応策が提案されている
4. 分析結果が戦略検討資料として活用可能な状態になっている

### トリガー
- **種別**: 要求駆動
- **詳細**: エグゼクティブからの戦略検討要求、または不確実性の高い事業環境での判断支援要求

## 基本フロー

1. 財務マネージャーがシナリオ分析を開始し、分析対象期間を設定する
2. システムがベースライン予測を取得し、分析基準として設定する
3. 財務マネージャーが分析したい変動要因（市場成長率、競合状況等）を選択する
4. システムが各変動要因のシナリオ設定画面を表示する
5. 財務マネージャーが楽観・現実・悲観シナリオの条件を入力する
6. システムが各シナリオに基づく収益計算を並行実行する
7. 財務マネージャーがシナリオ間の比較分析を確認・検討する
8. システムが感度分析とリスク評価を実行し、レポートを生成する

## 代替フロー

### 代替フロー1: カスタムシナリオの追加
- **分岐点**: 基本フロー ステップ5
- **条件**: 標準的な3シナリオ以外に特定の条件でのシナリオが必要な場合
1. 財務マネージャーがカスタムシナリオの名称と条件を定義する
2. システムがカスタム条件を既存の予測モデルに適用する
3. 事業企画担当者がカスタム条件の妥当性を確認・承認する
4. システムがカスタムシナリオを含めた比較分析を実行する
5. 基本フロー ステップ7に進む

### 代替フロー2: 感度分析の詳細実行
- **分岐点**: 基本フロー ステップ8
- **条件**: 特定の変動要因の影響度をより詳細に分析したい場合
1. 財務マネージャーが詳細分析対象の変動要因を選択する
2. システムが選択要因の変動幅を段階的に設定する
3. システムが各変動段階での収益への影響度を計算する
4. 財務マネージャーが臨界点と許容範囲を特定する
5. 基本フロー ステップ8の完了とする

## 例外フロー

### 例外フロー1: シナリオ条件の論理矛盾
- **発生点**: 基本フロー ステップ5
- **条件**: 設定されたシナリオ条件に論理的な矛盾がある場合
1. システムが矛盾する条件の組み合わせを検出・警告する
2. 財務マネージャーが矛盾内容を確認し、修正方針を決定する
3. 事業企画担当者に市場環境の整合性について相談する
4. 条件修正完了後、基本フロー ステップ5から再実行する

### 例外フロー2: 計算結果の異常値
- **発生点**: 基本フロー ステップ6
- **条件**: シナリオ計算で現実的でない極端な結果が出力された場合
1. システムが異常値の内容と発生原因を分析する
2. 財務マネージャーが入力条件と計算ロジックを再確認する
3. 必要に応じて変動要因の範囲や前提条件を調整する
4. 調整完了後、基本フロー ステップ6から再実行する

### 例外フロー3: 処理性能の限界
- **発生点**: 基本フロー ステップ6
- **条件**: 複雑な多重シナリオで計算時間が制限を超過した場合
1. システムが処理時間超過を検出し、現在の進捗を表示する
2. 財務マネージャーがシナリオ数の削減または分割実行を選択する
3. 重要度の高いシナリオを優先して計算を継続する
4. 結果が得られたシナリオで部分的な分析を実行する

## ビジネスルール

1. **シナリオ数制限ルール**: 同時分析できるシナリオ数は最大10個まで
   - 適用タイミング: 基本フロー ステップ5
   - 例: 楽観・現実・悲観の3基本 + カスタム7個まで

2. **変動要因組合せルール**: 独立性のない変動要因の組み合わせは制限する
   - 適用タイミング: 基本フロー ステップ3-5
   - 例: 市場成長率と競合強度は相関関係があるため独立変動不可

3. **感度分析範囲ルール**: 変動要因の分析範囲は現実的な幅に制限する
   - 適用タイミング: 代替フロー2
   - 例: 市場成長率の変動は±50%以内、価格変動は±30%以内

## 入出力情報

### 入力情報
- ベースライン予測データ [Baseline Forecast Data] [BASELINE_FORECAST_DATA]
  - 内容: 基準となる収益予測、前提条件、信頼度
  - 形式: 構造化データ（JSON）
  - 必須/任意: 必須
  - 検証ルール: 承認済み予測、信頼度80%以上

- シナリオ変動要因 [Scenario Variables] [SCENARIO_VARIABLES]
  - 内容: 市場成長率、競合状況、価格水準、為替レート等
  - 形式: パラメータ設定（数値範囲指定）
  - 必須/任意: 必須
  - 検証ルール: 変動範囲は現実的な数値、相互独立性を確保

### 出力情報
- シナリオ分析レポート [Scenario Analysis Report] [SCENARIO_ANALYSIS_REPORT]
  - 内容: 各シナリオの収益予測、比較分析、確率分布
  - 用途: 戦略的意思決定と事業計画策定
  - 保存期間: 3年間（戦略見直し時の参照用）

- 感度分析結果 [Sensitivity Analysis Results] [SENSITIVITY_ANALYSIS_RESULTS]
  - 内容: 変動要因の影響度、臨界点、許容範囲
  - 用途: リスク管理と対応策の優先順位決定
  - 形式: 統計分析レポート（PDF + Excel）

## 非機能要件

- **応答性**:
  - 3シナリオ分析: 10分以内
  - 詳細感度分析: 30分以内

- **利用可能性**:
  - 利用時間: 平日8:00-20:00（必須）、土日（ベストエフォート）
  - 計画停止: 年次メンテナンス時のみ

- **精度**:
  - 計算精度: 小数点以下2桁まで正確
  - 感度分析: 1%刻みでの影響度測定

- **使いやすさ**:
  - 視覚化: 各シナリオの結果をグラフで比較表示
  - インタラクティブ: パラメータ変更による即座の再計算

## 関連ユースケース

- <<include>> 変動要因を設定する [Configure Variables] [CONFIGURE_VARIABLES]
  - 説明: シナリオ分析前に必ず実行される

- <<extend>> モンテカルロ分析を実行する [Execute Monte Carlo Analysis] [EXECUTE_MONTE_CARLO_ANALYSIS]
  - 説明: より高度な確率分析が必要な場合のみ実行される

- 先行: 収益予測を作成する [Create Revenue Forecast] [CREATE_REVENUE_FORECAST]
  - 説明: このユースケースの前に完了している必要がある

- 後続: 収益機会を特定する [Identify Revenue Opportunities] [IDENTIFY_REVENUE_OPPORTUNITIES]
  - 説明: シナリオ分析結果を活用して実行される

## ページ遷移概要

```
[シナリオ分析ダッシュボード] → [変動要因選択ページ] → [シナリオ条件設定ページ] → [分析実行ページ] → [結果比較ページ] → [レポート生成ページ]
        ↓                     ↓                      ↓                    ↓
   [ベースライン確認ページ]  [カスタムシナリオページ]  [進捗監視ページ]     [感度分析ページ]
```

## テストシナリオ概要

1. **正常系テスト**:
   - 標準的な3シナリオ分析を最初から最後まで完全実行
   - 各シナリオの計算結果と比較分析の正確性を確認
   - 感度分析の結果とレポート生成を確認

2. **代替系テスト**:
   - カスタムシナリオ追加と詳細感度分析を個別に実行
   - 各代替フローの正常動作を確認

3. **例外系テスト**:
   - 論理矛盾、異常値、処理性能限界を意図的に発生
   - エラーハンドリングと修正プロセスを確認

4. **精度テスト**:
   - 既知の条件でのシナリオ分析結果を検証
   - 感度分析の数値精度を確認

5. **パフォーマンステスト**:
   - 最大10シナリオでの同時分析性能を確認
   - 複雑な感度分析での応答時間を確認