# ロバストネス図 - 0リリース ログイン機能

**更新日: 2025-01-09**

## UC001: ユーザーログイン

### ロバストネス図

```
[Actor: ユーザー] 
    |
    | 1. メールアドレス入力
    | 2. パスワード入力
    | 3. ログインボタンクリック
    v
[Boundary: ログインページ]
    |
    | 4. 入力値検証
    v
[Control: 入力検証コントローラー]
    |
    | 5. バリデーション実行
    v
[Entity: バリデーションルール]
    |
    | 6. 検証結果
    v
[Control: 認証コントローラー]
    |
    | 7. 認証処理実行
    v
[Entity: ユーザー]
[Entity: セッション]
    |
    | 8. 認証結果
    v
[Control: セッション管理コントローラー]
    |
    | 9. セッション作成
    v
[Boundary: トップページ]
```

### オブジェクトタイプ

#### Boundary（境界オブジェクト）
- **ログインページ**: ユーザーインターフェース
  - メールアドレス入力フィールド
  - パスワード入力フィールド
  - ログインボタン
  - エラーメッセージ表示エリア
- **トップページ**: ログイン成功後の画面

#### Control（制御オブジェクト）
- **入力検証コントローラー**: クライアントサイドバリデーション
  - メールアドレス形式チェック
  - 必須入力チェック
- **認証コントローラー**: サーバーサイド認証処理
  - パスワード検証
  - ユーザー存在確認
- **セッション管理コントローラー**: セッション制御
  - セッション作成
  - Cookie設定

#### Entity（エンティティオブジェクト）
- **バリデーションルール**: Zodスキーマ
- **ユーザー**: データベース内のユーザー情報
- **セッション**: 認証済みセッション情報

### エラー処理フロー

```
[Control: 入力検証コントローラー]
    |
    | バリデーションエラー
    v
[Boundary: ログインページ]
    |
    | エラーメッセージ表示
```

```
[Control: 認証コントローラー]
    |
    | 認証失敗
    v
[Boundary: ログインページ]
    |
    | 認証エラーメッセージ表示
```

### 技術的実装詳細

#### 入力検証（Zod）
```typescript
const LoginSchema = z.object({
  email: z.string().email("有効なメールアドレスを入力してください"),
  password: z.string().min(1, "パスワードを入力してください")
})
```

#### 認証処理（Server Action）
```typescript
async function authenticate(email: string, password: string) {
  // 1. ユーザー検索
  // 2. パスワード検証（bcrypt）
  // 3. セッション作成
  // 4. Cookie設定
}
```

### セキュリティ考慮事項
- パスワードはbcryptでハッシュ化
- セッショントークンはhttpOnly Cookie
- CSRF対策（Next.jsの組み込み機能）
- レート制限（将来実装）