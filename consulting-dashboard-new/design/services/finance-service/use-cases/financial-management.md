# 財務管理 ユースケース

**更新日: 2025-01-13**

## UC-FIN-001: 収益記録登録

### 概要
プロジェクトの収益（請求予定額）を記録する

### アクター
- プロジェクトマネージャー
- エグゼクティブ
- 経理担当者（将来実装）

### 事前条件
- ユーザーがログイン済みである
- ユーザーがPMまたはエグゼクティブ権限を持つ
- 対象プロジェクトが存在する

### 基本フロー
1. ユーザーがプロジェクト詳細画面から「財務」タブを選択する
2. システムが現在の収益・コスト情報を表示する
3. ユーザーが「収益記録追加」ボタンをクリックする
4. システムが収益記録フォームを表示する
5. ユーザーが収益情報を入力する
   - 日付
   - 金額
   - タイプ（月次フィー、マイルストーン達成、変更依頼、その他）
   - 説明
   - 請求書番号（オプション）
6. ユーザーが「保存」ボタンをクリックする
7. システムがバリデーションを実行する
   - 金額が正の数値であること
   - 日付が妥当であること
8. システムが収益記録を保存する
9. システムがプロジェクト収支サマリーを更新する

### 代替フロー
- 5a. マイルストーン達成による収益の場合
  1. ユーザーがタイプで「マイルストーン達成」を選択
  2. システムが完了済みマイルストーン一覧を表示
  3. ユーザーが対象マイルストーンを選択
  4. システムが契約上の金額を自動入力

### 事後条件
- 収益記録が登録される
- プロジェクトの収益合計が更新される

---

## UC-FIN-002: コスト記録登録

### 概要
プロジェクトのコスト（支出）を記録する

### アクター
- プロジェクトマネージャー
- エグゼクティブ

### 事前条件
- ユーザーがログイン済みである
- 対象プロジェクトが存在する

### 基本フロー
1. ユーザーがプロジェクト財務画面で「コスト記録追加」をクリックする
2. システムがコスト記録フォームを表示する
3. ユーザーがコスト情報を入力する
   - 日付
   - 金額
   - カテゴリ（人件費、外注費、経費、その他）
   - 説明
   - 関連ユーザー（人件費の場合）
4. ユーザーが「保存」ボタンをクリックする
5. システムがバリデーションを実行する
6. システムがコスト記録を保存する
7. システムがプロジェクト収支サマリーを更新する

### 代替フロー
- 3a. 人件費カテゴリの場合
  1. システムがユーザー選択ドロップダウンを表示
  2. ユーザーが対象のチームメンバーを選択
  3. システムが標準単価を参考表示

### 事後条件
- コスト記録が登録される
- プロジェクトのコスト合計が更新される
- 利益率が再計算される

---

## UC-FIN-003: 月次収支レポート表示

### 概要
プロジェクトの月次収支レポートを表示する

### アクター
- プロジェクトマネージャー
- エグゼクティブ
- クライアント（限定情報のみ）

### 事前条件
- ユーザーがログイン済みである
- 対象プロジェクトへのアクセス権を持つ

### 基本フロー
1. ユーザーがプロジェクト財務画面を開く
2. システムが月次収支サマリーを表示する
   - 当月収益（確定/予定別）
   - 当月コスト（承認済み/未承認別）
   - 利益額・利益率
   - 前月比
3. ユーザーが期間を選択する（デフォルト：当月）
4. システムが選択期間の詳細データを表示する
   - 収益明細
   - コスト明細（カテゴリ別）
   - 日別推移グラフ
5. ユーザーが「エクスポート」ボタンをクリックする
6. システムがExcel形式でレポートをダウンロードする

### 事後条件
- 月次収支情報が表示される
- 必要に応じてレポートがエクスポートされる

---

## UC-FIN-004: 請求書発行

### 概要
月次または成果物完了時の請求書を発行する

### アクター
- プロジェクトマネージャー
- 経理担当者（将来実装）

### 事前条件
- 収益記録が存在する
- 請求対象期間が確定している

### 基本フロー
1. ユーザーが収益記録一覧から請求対象を選択する
2. ユーザーが「請求書発行」ボタンをクリックする
3. システムが請求書プレビューを表示する
   - 請求先情報
   - 請求明細
   - 金額（税込/税抜）
   - 支払期限
4. ユーザーが請求書情報を確認・修正する
5. ユーザーが「発行」ボタンをクリックする
6. システムが請求書番号を採番する
7. システムが請求書PDFを生成する
8. システムが収益記録のステータスを「請求済み」に更新する
9. システムが請求書をダウンロード可能にする

### 代替フロー
- 複数収益の一括請求
  1. ユーザーが複数の収益記録を選択
  2. システムが合算した請求書を作成

### 事後条件
- 請求書が発行される
- 収益記録のステータスが更新される
- 請求履歴が記録される

---

## UC-FIN-005: 入金確認・消込

### 概要
請求に対する入金を確認し、売掛金を消し込む

### アクター
- 経理担当者（将来実装）
- プロジェクトマネージャー
- エグゼクティブ

### 事前条件
- 請求済みの収益記録が存在する
- 入金情報が確認されている

### 基本フロー
1. ユーザーが「入金管理」画面を開く
2. システムが未入金の請求一覧を表示する
   - 請求書番号
   - 請求金額
   - 請求日
   - 支払期限
   - クライアント名
3. ユーザーが入金確認済みの請求を選択する
4. ユーザーが入金情報を入力する
   - 入金日
   - 入金額
   - 振込名義（差異がある場合）
5. システムが請求額と入金額を照合する
6. ユーザーが「消込実行」ボタンをクリックする
7. システムが収益記録のステータスを「入金済み」に更新する
8. システムが売掛金残高を更新する

### 代替フロー
- 5a. 入金額に差異がある場合
  1. システムが差額を表示
  2. ユーザーが差異理由を選択（振込手数料、一部入金等）
  3. ユーザーが処理方法を選択

### 事後条件
- 入金が記録される
- 売掛金が消し込まれる
- 収益が確定する

---

## UC-FIN-006: 予実管理

### 概要
プロジェクトの予算と実績を比較し、進捗を管理する

### アクター
- プロジェクトマネージャー
- エグゼクティブ

### 事前条件
- プロジェクトに予算が設定されている
- 収益・コストの実績データが存在する

### 基本フロー
1. ユーザーがプロジェクト詳細から「予実管理」を選択する
2. システムが予実比較画面を表示する
   - 予算（総額・月別）
   - 実績（収益・コスト）
   - 予算消化率
   - 利益率（予定vs実績）
3. システムが予算消化グラフを表示する
   - 時系列での予算消化推移
   - 予測線（現在のペースでの着地見込み）
4. システムがアラートを表示する（該当する場合）
   - 予算超過リスク
   - 利益率低下
   - 収益遅延
5. ユーザーが詳細分析を確認する
   - カテゴリ別実績
   - 要因分析
   - 改善提案

### 事後条件
- 予実差異が可視化される
- 必要に応じてアクションが取られる

---

## UC-FIN-007: 全社財務ダッシュボード

### 概要
全プロジェクトの財務状況を俯瞰的に確認する

### アクター
- エグゼクティブ
- 財務責任者

### 事前条件
- ユーザーがエグゼクティブ権限を持つ
- 複数のプロジェクトが存在する

### 基本フロー
1. ユーザーがエグゼクティブダッシュボードを開く
2. システムが全社財務KPIを表示する
   - 総収益（月次・累計）
   - 総コスト（月次・累計）
   - 全社利益率
   - 前月比・前年同期比
3. システムがプロジェクト別収益性を表示する
   - 収益上位プロジェクト
   - 利益率ランキング
   - 赤字プロジェクト一覧
4. システムが収益トレンドグラフを表示する
   - 過去12ヶ月の推移
   - 今後3ヶ月の予測
5. ユーザーが期間やフィルタを変更する
6. システムが表示を更新する

### 事後条件
- 全社の財務状況が把握される
- 経営判断に必要な情報が提供される

---

## UC-FIN-008: キャッシュフロー予測

### 概要
将来のキャッシュフローを予測し、資金計画を支援する

### アクター
- エグゼクティブ
- 財務責任者

### 事前条件
- 収益・コストの実績データが存在する
- 将来の契約情報が登録されている

### 基本フロー
1. ユーザーが「キャッシュフロー予測」を選択する
2. システムが予測期間の選択画面を表示する（1-6ヶ月）
3. システムがキャッシュフロー予測を計算する
   - 確定収入（契約済み）
   - 見込み収入（商談中案件）
   - 確定支出（人件費等）
   - 見込み支出
4. システムが月別キャッシュフロー表を表示する
   - 収入予定
   - 支出予定
   - 月末残高予測
5. システムがキャッシュ不足リスクを警告する（該当する場合）
6. ユーザーがシナリオを調整する
   - 案件の受注確率変更
   - 支払いタイミング調整

### 事後条件
- キャッシュフロー予測が表示される
- 資金ショートリスクが事前に把握される