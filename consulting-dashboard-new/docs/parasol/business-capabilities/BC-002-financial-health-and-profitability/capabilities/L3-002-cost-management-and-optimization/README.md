# L3-002: Cost Management & Optimization

**ä½œæˆæ—¥**: 2025-10-31
**æ‰€å±BC**: BC-002: Financial Health & Profitability
**V2ç§»è¡Œå…ƒ**: control-and-optimize-costs

---

## ğŸ“‹ What: ã“ã®èƒ½åŠ›ã®å®šç¾©

### èƒ½åŠ›ã®æ¦‚è¦
ã‚³ã‚¹ãƒˆã‚’è¨˜éŒ²ãƒ»åˆ†æã—ã€æœ€é©åŒ–ã™ã‚‹èƒ½åŠ›ã€‚ã‚³ã‚¹ãƒˆã®å¯è¦–åŒ–ã€ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æã€æœ€é©åŒ–æ–½ç­–ã®å®Ÿæ–½ã‚’é€šã˜ã¦ã€åç›Šæ€§ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚

### å®Ÿç¾ã§ãã‚‹ã“ã¨
- å…¨ã‚³ã‚¹ãƒˆã®æ­£ç¢ºãªè¨˜éŒ²ã¨åˆ†é¡
- ã‚³ã‚¹ãƒˆãƒˆãƒ¬ãƒ³ãƒ‰ã®åˆ†æ
- ã‚³ã‚¹ãƒˆè¶…éã®æ—©æœŸç™ºè¦‹
- ã‚³ã‚¹ãƒˆæœ€é©åŒ–æ©Ÿä¼šã®ç‰¹å®š
- ã‚³ã‚¹ãƒˆå‰Šæ¸›æ–½ç­–ã®å®Ÿæ–½ã¨åŠ¹æœæ¸¬å®š

### å¿…è¦ãªçŸ¥è­˜
- ã‚³ã‚¹ãƒˆä¼šè¨ˆ
- ABCï¼ˆæ´»å‹•åŸºæº–åŸä¾¡è¨ˆç®—ï¼‰
- ã‚³ã‚¹ãƒˆå‰Šæ¸›æ‰‹æ³•
- ãƒ™ãƒ³ãƒãƒãƒ¼ã‚­ãƒ³ã‚°
- ã‚³ã‚¹ãƒˆåˆ†ææŠ€æ³•

---

## ğŸ”— BCè¨­è¨ˆã®å‚ç…§ï¼ˆHowï¼‰

### ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«
- **Aggregates**: CostManagementAggregate ([../../domain/README.md](../../domain/README.md#cost-management-aggregate))
- **Entities**: Cost, CostCategory, CostAllocation, CostTrend
- **Value Objects**: CostAmount, CostType, Period, CostVariance

### API
- **APIä»•æ§˜**: [../../api/api-specification.md](../../api/api-specification.md)
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
  - POST /api/costs - ã‚³ã‚¹ãƒˆè¨˜éŒ²
  - POST /api/costs/categorize - ã‚³ã‚¹ãƒˆåˆ†é¡
  - GET /api/costs/trends - ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
  - POST /api/costs/optimize - æœ€é©åŒ–æ–½ç­–

è©³ç´°: [../../api/README.md](../../api/README.md)

### ãƒ‡ãƒ¼ã‚¿
- **Tables**: costs, cost_categories, cost_allocations, cost_trends, optimization_actions

è©³ç´°: [../../data/README.md](../../data/README.md)

---

## ğŸ› ï¸ å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

### æŠ€è¡“çš„å®Ÿç¾æ–¹æ³•

#### ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³
- **ABCï¼ˆæ´»å‹•åŸºæº–åŸä¾¡è¨ˆç®—ï¼‰**: ã‚³ã‚¹ãƒˆé…åˆ†ã®ç²¾ç·»åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- **ã‚³ã‚¹ãƒˆæœ€é©åŒ–**: éºä¼çš„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆGAï¼‰ã«ã‚ˆã‚‹ã‚³ã‚¹ãƒˆå‰Šæ¸›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- **ç•°å¸¸å€¤æ¤œå‡º**: Z-scoreæ³•ï¼ˆæ¨™æº–åå·®Â±2Ïƒï¼‰ã«ã‚ˆã‚‹ã‚³ã‚¹ãƒˆç•°å¸¸æ¤œçŸ¥
- **ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ**: ç§»å‹•å¹³å‡ã€å­£ç¯€èª¿æ•´ã«ã‚ˆã‚‹å°†æ¥ã‚³ã‚¹ãƒˆäºˆæ¸¬
- **ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³**:
  - Strategy Patternï¼ˆç•°ãªã‚‹ã‚³ã‚¹ãƒˆé…åˆ†æ–¹å¼: ç›´æ¥è²»/é–“æ¥è²»/ABCï¼‰
  - Observer Patternï¼ˆã‚³ã‚¹ãƒˆè¶…éã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥ï¼‰
  - Factory Patternï¼ˆã‚³ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒªåˆ¥å‡¦ç†ã®ç”Ÿæˆï¼‰

#### æ¨å¥¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **è²¡å‹™è¨ˆç®—**: Decimal.js - é«˜ç²¾åº¦ã‚³ã‚¹ãƒˆè¨ˆç®—
- **æœ€é©åŒ–è¨ˆç®—**: Optimize.js - ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- **çµ±è¨ˆåˆ†æ**: Simple-statistics.js - ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æã€ç•°å¸¸æ¤œå‡º
- **ã‚³ã‚¹ãƒˆå¯è¦–åŒ–**: Recharts - ã‚³ã‚¹ãƒˆãƒˆãƒ¬ãƒ³ãƒ‰ã‚°ãƒ©ãƒ•ã€ã‚«ãƒ†ã‚´ãƒªåˆ¥å†…è¨³å††ã‚°ãƒ©ãƒ•
- **ãƒ‡ãƒ¼ã‚¿åˆ†æ**: D3.js - ã‚³ã‚¹ãƒˆé…åˆ†ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …

#### ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£
- **ã‚³ã‚¹ãƒˆè¨˜éŒ²æ•°ä¸Šé™**: 1ä¼šè¨ˆå¹´åº¦ã‚ãŸã‚Šæœ€å¤§100ä¸‡ãƒ¬ã‚³ãƒ¼ãƒ‰
- **ã‚«ãƒ†ã‚´ãƒªéšå±¤**: æœ€å¤§5éšå±¤ï¼ˆå¤§åˆ†é¡â†’ä¸­åˆ†é¡â†’å°åˆ†é¡â†’è©³ç´°â†’æ˜ç´°ï¼‰
- **ã‚³ã‚¹ãƒˆé…åˆ†ãƒ«ãƒ¼ãƒ«**: æœ€å¤§500ãƒ«ãƒ¼ãƒ«/ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

#### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥
- **ã‚³ã‚¹ãƒˆã‚µãƒãƒªãƒ¼**: Redis cacheï¼ˆTTL: 10åˆ†ã€ã‚³ã‚¹ãƒˆè¨˜éŒ²æ™‚ã«ç„¡åŠ¹åŒ–ï¼‰
- **ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æçµæœ**: æ—¥æ¬¡è¨ˆç®—ã€ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆ24æ™‚é–“ä¿æŒï¼‰
- **ã‚«ãƒ†ã‚´ãƒªåˆ¥é›†è¨ˆ**: 5åˆ†é–“éš”ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°

#### æœ€é©åŒ–ãƒã‚¤ãƒ³ãƒˆ
- **é›†è¨ˆã‚¯ã‚¨ãƒªæœ€é©åŒ–**: Materialized Viewï¼ˆæœˆæ¬¡ã‚³ã‚¹ãƒˆé›†è¨ˆï¼‰
- **ãƒãƒƒãƒå‡¦ç†**: ã‚³ã‚¹ãƒˆè¨˜éŒ²ã®ä¸€æ‹¬ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆCSV/Excelï¼‰
- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ´»ç”¨**: `costs(occurred_date, category)`, `cost_allocations(project_id, cost_category)`

---

## âš ï¸ å‰ææ¡ä»¶ã¨åˆ¶ç´„

### BCé–“é€£æº

#### ä¾å­˜BC
- **BC-001: Project Delivery & Quality** - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ã‚¹ãƒˆã®é€£æº
  - ä½¿ç”¨API: `GET /api/bc-001/projects/{projectId}/tasks` - ã‚¿ã‚¹ã‚¯åˆ¥ã‚³ã‚¹ãƒˆé…åˆ†
  - ä½¿ç”¨API: `POST /api/bc-001/projects/{projectId}/costs` - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ã‚¹ãƒˆè¨˜éŒ²
- **BC-005: Team & Resource Optimization** - ãƒªã‚½ãƒ¼ã‚¹ã‚³ã‚¹ãƒˆã®è¨ˆç®—
  - ä½¿ç”¨API: `GET /api/bc-005/resources/{resourceId}/cost-rate` - ãƒªã‚½ãƒ¼ã‚¹å˜ä¾¡å–å¾—
  - ä½¿ç”¨API: `POST /api/bc-005/resources/{resourceId}/cost-allocation` - ãƒªã‚½ãƒ¼ã‚¹ã‚³ã‚¹ãƒˆé…åˆ†
- **BC-007: Team Communication & Collaboration** - ã‚³ã‚¹ãƒˆè¶…éã‚¢ãƒ©ãƒ¼ãƒˆ
  - ä½¿ç”¨API: `POST /api/bc-007/notifications` - ã‚³ã‚¹ãƒˆè¶…éé€šçŸ¥
  - ä½¿ç”¨API: `POST /api/bc-007/alerts` - é«˜é¡ã‚³ã‚¹ãƒˆç™ºç”Ÿã‚¢ãƒ©ãƒ¼ãƒˆ

#### æä¾›APIï¼ˆä»–BCã‹ã‚‰åˆ©ç”¨ï¼‰
- **BC-001, BC-004**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ¥ã‚³ã‚¹ãƒˆå‚ç…§ã€åç›Šæ€§åˆ†æç”¨ã‚³ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æä¾›

### ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§è¦ä»¶

#### ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œ
- **ã‚³ã‚¹ãƒˆè¨˜éŒ²**: ã‚³ã‚¹ãƒˆä½œæˆ + ã‚«ãƒ†ã‚´ãƒªé…åˆ† + ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç´ä»˜ã‘ + äºˆç®—æ®‹é«˜æ›´æ–°ï¼ˆBC-002 L3-001ï¼‰
- **ã‚³ã‚¹ãƒˆé…åˆ†**: ã‚³ã‚¹ãƒˆåˆ†é… + é…åˆ†å±¥æ­´è¨˜éŒ² + é›†è¨ˆå†è¨ˆç®—
- **æ•´åˆæ€§ãƒ¬ãƒ™ãƒ«**: å¼·æ•´åˆæ€§ï¼ˆã‚³ã‚¹ãƒˆé‡‘é¡ï¼‰ã€çµæœæ•´åˆæ€§ï¼ˆãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æï¼‰

#### ãƒ‡ãƒ¼ã‚¿åˆ¶ç´„
- ã‚³ã‚¹ãƒˆé‡‘é¡ > 0ï¼ˆè² ã®é‡‘é¡ã¯è¿”é‡‘ã¨ã—ã¦åˆ¥é€”ç®¡ç†ï¼‰
- ç™ºç”Ÿæ—¥ã¯ä¼šè¨ˆå¹´åº¦å†…
- ã‚«ãƒ†ã‚´ãƒªæ•´åˆæ€§: ã‚³ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒªã¯äºˆç®—é …ç›®ã‚«ãƒ†ã‚´ãƒªã¨ä¸€è‡´
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‚ç…§æ•´åˆæ€§: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã¯BC-001ã®æœ‰åŠ¹ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚ç…§

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

#### èªè¨¼ãƒ»èªå¯
- **èªè¨¼**: JWT Bearer Tokenï¼ˆBC-003ç™ºè¡Œï¼‰
- **å¿…è¦æ¨©é™**:
  - ã‚³ã‚¹ãƒˆè¨˜éŒ²: `cost:create` + ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼æ¨©é™
  - ã‚³ã‚¹ãƒˆæ‰¿èª: `cost:approve` + ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼æ¨©é™ï¼ˆé‡‘é¡é–¾å€¤ã«ã‚ˆã‚Šå½¹å“¡æ‰¿èªå¿…é ˆï¼‰
  - ã‚³ã‚¹ãƒˆåˆ†æ: `cost:analyze` + è²¡å‹™æ‹…å½“è€…æ¨©é™

#### ãƒ‡ãƒ¼ã‚¿ä¿è­·
- **æ©Ÿå¯†åº¦**: ã‚³ã‚¹ãƒˆæƒ…å ±ã¯Confidentialï¼ˆè²¡å‹™æ‹…å½“ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ã®ã¿ï¼‰
- **ç›£æŸ»ãƒ­ã‚°**: ã‚³ã‚¹ãƒˆè¨˜éŒ²ãƒ»å¤‰æ›´ãƒ»å‰Šé™¤ã¯å…¨ã¦è¨˜éŒ²
- **æš—å·åŒ–**: é«˜é¡ã‚³ã‚¹ãƒˆï¼ˆ100ä¸‡å††ä»¥ä¸Šï¼‰ã¯ä¿å­˜æ™‚æš—å·åŒ–

### ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£åˆ¶ç´„

#### æœ€å¤§åŒæ™‚å‡¦ç†
- **ã‚³ã‚¹ãƒˆè¨˜éŒ²**: åŒæ™‚100è¨˜éŒ²/ç§’
- **ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ**: åŒæ™‚20åˆ†æ/ç§’
- **ã‚³ã‚¹ãƒˆé…åˆ†**: åŒæ™‚50é…åˆ†/ç§’

#### ãƒ‡ãƒ¼ã‚¿é‡ä¸Šé™
- **ã‚³ã‚¹ãƒˆå±¥æ­´**: 10å¹´é–“ä¿æŒï¼ˆä¼šè¨ˆæ³•æº–æ‹ ï¼‰
- **é…åˆ†å±¥æ­´**: ã‚³ã‚¹ãƒˆã‚ãŸã‚Šæœ€å¤§50é…åˆ†
- **ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ‡ãƒ¼ã‚¿**: æ—¥æ¬¡ä¿å­˜ï¼ˆ5å¹´é–“ä¿æŒï¼‰

---

## ğŸ”— BCè¨­è¨ˆã¨ã®çµ±åˆ

### ä½¿ç”¨ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

#### Aggregates
- **Cost Aggregate** ([../../domain/README.md#cost-aggregate](../../domain/README.md#cost-aggregate))
  - Costï¼ˆé›†ç´„ãƒ«ãƒ¼ãƒˆï¼‰: ã‚³ã‚¹ãƒˆè¨˜éŒ²ã¨åˆ†é¡ç®¡ç†
  - CostItem: ã‚³ã‚¹ãƒˆã®æ˜ç´°
  - CostAllocation: ã‚³ã‚¹ãƒˆé…åˆ†è¨˜éŒ²
  - CostTrend: ã‚³ã‚¹ãƒˆãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æçµæœ

#### Value Objects
- **CostAmount**: ã‚³ã‚¹ãƒˆé‡‘é¡ï¼ˆé€šè²¨å˜ä½ä»˜ãï¼‰
- **CostType**: ã‚³ã‚¹ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆdirect, indirect, overheadï¼‰
- **CostCategory**: ã‚³ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒªï¼ˆlabor, outsource, equipment, otherï¼‰
- **Period**: ä¼šè¨ˆæœŸé–“
- **CostVariance**: ã‚³ã‚¹ãƒˆå·®ç•°ï¼ˆäºˆç®—æ¯”ã€å‰æœŸæ¯”ï¼‰

#### Domain Events
- **CostRecorded**: ã‚³ã‚¹ãƒˆè¨˜éŒ²ã‚¤ãƒ™ãƒ³ãƒˆ â†’ BC-001ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ã‚¹ãƒˆæ›´æ–°
- **CostAllocated**: ã‚³ã‚¹ãƒˆé…åˆ†ã‚¤ãƒ™ãƒ³ãƒˆ â†’ äºˆç®—æ®‹é«˜æ›´æ–°
- **CostCategoryChanged**: ã‚³ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒªå¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆ â†’ é›†è¨ˆå†è¨ˆç®—
- **HighCostDetected**: é«˜é¡ã‚³ã‚¹ãƒˆæ¤œå‡ºã‚¤ãƒ™ãƒ³ãƒˆ â†’ BC-007è²¡å‹™æ‹…å½“è€…é€šçŸ¥
- **CostTrendAnomalyDetected**: ã‚³ã‚¹ãƒˆãƒˆãƒ¬ãƒ³ãƒ‰ç•°å¸¸æ¤œå‡ºã‚¤ãƒ™ãƒ³ãƒˆ â†’ BC-007çµŒå–¶å±¤ã‚¢ãƒ©ãƒ¼ãƒˆ

### å‘¼ã³å‡ºã™APIä¾‹

#### ã‚³ã‚¹ãƒˆè¨˜éŒ²
```http
POST /api/v1/bc-002/costs
Content-Type: application/json
Authorization: Bearer {token}

{
  "name": "å¤–éƒ¨ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆè²»ç”¨",
  "category": "outsource",
  "amount": 2500000,
  "currency": "JPY",
  "occurredDate": "2025-11-05",
  "projectId": "project-uuid-123",
  "budgetItemId": "budget-item-uuid-456",
  "description": "ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°ï¼ˆ10æ—¥é–“ï¼‰",
  "vendor": "ABC Consulting Inc."
}
```

#### ã‚³ã‚¹ãƒˆãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
```http
GET /api/v1/bc-002/costs/trends?category=outsource&period=2025-Q1&analysisType=moving-average
```

#### ã‚³ã‚¹ãƒˆæœ€é©åŒ–ææ¡ˆ
```http
POST /api/v1/bc-002/costs/optimize
Content-Type: application/json

{
  "projectId": "project-uuid-123",
  "targetReduction": 0.15,
  "categories": ["outsource", "equipment"],
  "constraints": {
    "maintainQuality": true,
    "criticalTasks": ["task-uuid-1", "task-uuid-2"]
  }
}
```

#### BCé€£æº: é«˜é¡ã‚³ã‚¹ãƒˆé€šçŸ¥ï¼ˆBC-007ï¼‰
```http
POST /api/v1/bc-007/notifications
Content-Type: application/json

{
  "type": "high_cost_detected",
  "recipientId": "finance-manager-uuid",
  "priority": "high",
  "content": {
    "costId": "cost-uuid",
    "amount": 2500000,
    "threshold": 1000000,
    "category": "outsource",
    "projectName": "æ–°ã‚·ã‚¹ãƒ†ãƒ é–‹ç™º",
    "approvalRequired": true
  }
}
```

### ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³

#### èª­ã¿å–ã‚Š
- **costs ãƒ†ãƒ¼ãƒ–ãƒ«**:
  - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: `idx_costs_occurred_date`ï¼ˆæœŸé–“åˆ¥ã‚³ã‚¹ãƒˆå–å¾—ï¼‰
  - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: `idx_costs_category`ï¼ˆã‚«ãƒ†ã‚´ãƒªåˆ¥é›†è¨ˆï¼‰
  - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: `idx_costs_project_id`ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ¥ã‚³ã‚¹ãƒˆï¼‰
  - é›†è¨ˆã‚¯ã‚¨ãƒª: ã‚«ãƒ†ã‚´ãƒªåˆ¥æœˆæ¬¡ã‚³ã‚¹ãƒˆé›†è¨ˆï¼ˆGROUP BY category, MONTH(occurred_date)ï¼‰
- **cost_allocations ãƒ†ãƒ¼ãƒ–ãƒ«**:
  - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: `idx_cost_alloc_project`ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé…åˆ†å±¥æ­´ï¼‰
  - ã‚¯ã‚¨ãƒª: ABCé…åˆ†ã®è¤‡é›‘ãªé…åˆ†ãƒ«ãƒ¼ãƒ«é©ç”¨
- **cost_trends ãƒ†ãƒ¼ãƒ–ãƒ«**:
  - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: `idx_cost_trends_period`ï¼ˆãƒˆãƒ¬ãƒ³ãƒ‰ãƒ‡ãƒ¼ã‚¿æ™‚ç³»åˆ—å–å¾—ï¼‰

#### æ›¸ãè¾¼ã¿
- **ã‚³ã‚¹ãƒˆè¨˜éŒ²ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³**:
  ```sql
  BEGIN;
  INSERT INTO costs (name, category, amount, occurred_date, project_id, budget_item_id)
  VALUES (?, ?, ?, ?, ?, ?);

  -- äºˆç®—æ®‹é«˜æ›´æ–°ï¼ˆBC-002 L3-001é€£æºï¼‰
  UPDATE budget_lines SET consumed_amount = consumed_amount + ? WHERE id = ?;

  -- é«˜é¡ã‚³ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆ100ä¸‡å††ä»¥ä¸Šï¼‰
  -- ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ: CostRecorded, HighCostDetectedï¼ˆæ¡ä»¶æº€ãŸã™å ´åˆï¼‰
  COMMIT;
  ```
- **ã‚³ã‚¹ãƒˆé…åˆ†**:
  ```sql
  INSERT INTO cost_allocations (cost_id, allocation_rule, allocation_percentage, allocated_to_project)
  VALUES (?, ?, ?, ?);

  -- é…åˆ†å…ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ã‚¹ãƒˆé›†è¨ˆæ›´æ–°
  UPDATE project_cost_summary SET allocated_cost = allocated_cost + (? * ?)
  WHERE project_id = ?;
  ```

#### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ã‚¯ã‚»ã‚¹
- **ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚³ã‚¹ãƒˆé›†è¨ˆ**:
  ```
  Key: `cost:summary:category:{category}:period:{period}`
  Value: { totalCost: 15000000, recordCount: 245, avgCost: 61224 }
  TTL: 600ç§’ï¼ˆ10åˆ†ï¼‰
  Invalidation: ã‚³ã‚¹ãƒˆè¨˜éŒ²æ™‚
  ```
- **ã‚³ã‚¹ãƒˆãƒˆãƒ¬ãƒ³ãƒ‰**:
  ```
  Key: `cost:trend:{category}:period:{period}`
  Value: { trend: [week1: 3500000, week2: 3800000, week3: 3200000, week4: 3900000], forecast: 4100000 }
  TTL: 86400ç§’ï¼ˆ24æ™‚é–“ï¼‰
  Invalidation: æ—¥æ¬¡ãƒãƒƒãƒå†è¨ˆç®—æ™‚
  ```

---

## âš™ï¸ Operations: ã“ã®èƒ½åŠ›ã‚’å®Ÿç¾ã™ã‚‹æ“ä½œ

| Operation | èª¬æ˜ | UseCases | V2ç§»è¡Œå…ƒ |
|-----------|------|----------|---------|
| **OP-001**: ã‚³ã‚¹ãƒˆã‚’è¨˜éŒ²ãƒ»åˆ†é¡ã™ã‚‹ | å…¨ã‚³ã‚¹ãƒˆã®æ•æ‰ã¨åˆ†é¡ | 2-3å€‹ | record-and-categorize-costs |
| **OP-002**: ã‚³ã‚¹ãƒˆãƒˆãƒ¬ãƒ³ãƒ‰ã‚’åˆ†æã™ã‚‹ | ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æã¨äºˆæ¸¬ | 2-3å€‹ | analyze-cost-trends |
| **OP-003**: ã‚³ã‚¹ãƒˆã‚’é…åˆ†ãƒ»æœ€é©åŒ–ã™ã‚‹ | åŠ¹ç‡çš„ãªã‚³ã‚¹ãƒˆç®¡ç† | 3-4å€‹ | allocate-and-optimize-costs |

è©³ç´°: [operations/](operations/)

---

## ğŸ“Š çµ±è¨ˆæƒ…å ±

- **Operationsæ•°**: 3å€‹
- **æ¨å®šUseCaseæ•°**: 7-10å€‹
- **V2ã‹ã‚‰ã®ç§»è¡Œ**: ãã®ã¾ã¾ç§»è¡Œ

---

## ğŸ”— V2æ§‹é€ ã¸ã®å‚ç…§

> âš ï¸ **ç§»è¡Œã®ãŠçŸ¥ã‚‰ã›**: ã“ã®L3ã¯V2æ§‹é€ ã‹ã‚‰ç§»è¡Œä¸­ã§ã™ã€‚
>
> **V2å‚ç…§å…ˆï¼ˆå‚ç…§ã®ã¿ï¼‰**:
> - [services/revenue-optimization-service/capabilities/control-and-optimize-costs/](../../../../services/revenue-optimization-service/capabilities/control-and-optimize-costs/)

---

## ğŸ“ æ›´æ–°å±¥æ­´

| æ—¥ä»˜ | æ›´æ–°å†…å®¹ | æ›´æ–°è€… |
|------|---------|--------|
| 2025-10-31 | L3-002 READMEåˆç‰ˆä½œæˆï¼ˆPhase 2ï¼‰ | Claude |

---

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Phase 2 - ã‚¯ãƒ­ã‚¹ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹æ§‹ç¯‰ä¸­
**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: Operationãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆã¨V2ã‹ã‚‰ã®ç§»è¡Œ
