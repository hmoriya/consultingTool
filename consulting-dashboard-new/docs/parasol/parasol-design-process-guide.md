# パラソル開発統合設計プロセスガイド

**作成日**: 2025-10-10
**バージョン**: 1.0.0
**目的**: パラソル開発の真髄である体系的設計手順の確立

---

## 🎯 パラソル開発の核心原則

> **パラソル開発の真髄**: ビジネス価値を起点とした段階的詳細化による、実装非依存の高品質設計

### 基本思想
1. **ビジネス価値駆動**: 技術ありきではなく、ビジネス価値を起点とした設計
2. **段階的詳細化**: 大きな概念から具体的な実装へと段階的に詳細化
3. **実装非依存**: 特定の技術に依存しない中間言語による設計
4. **品質内在**: 各段階で品質を作り込み、後戻りを最小化

---

## 📐 パラソル設計の階層構造

```
🏢 サービス層
  └── 🎯 ビジネスケーパビリティ層
      └── ⚙️ ビジネスオペレーション層
          └── 🎬 ユースケース層
              └── 📄 ページ・API層
                  └── 💾 実装層
```

### 各層の責務と成果物

| 層 | 責務 | 主な成果物 | 品質基準 |
|---|-----|-----------|----------|
| **サービス** | ビジネス価値の定義 | サービス定義書 | 価値の明確性 |
| **ケーパビリティ** | 組織能力の体系化 | ケーパビリティマップ | 能力の完全性 |
| **オペレーション** | 業務プロセスの設計 | オペレーション設計書（v2.0） | プロセスの最適性 |
| **ユースケース** | システム機能の定義 | ユースケース仕様書 | 機能の完全性 |
| **ページ・API** | インターフェース設計 | ページ定義・API仕様 | インターフェースの使いやすさ |
| **実装** | 技術的実現 | ソースコード・DB | 実装品質 |

---

## 🚀 Phase 1: 基本設計（ビジネス価値の体系化）

### Step 1.1: サービス定義
**目的**: ビジネス価値を中心としたサービス境界の確立

#### 作業手順
1. **価値発見ワークショップ**
   ```
   質問フレームワーク:
   - このサービスはステークホルダーにどんな価値を提供するか？
   - 競合優位性はどこにあるか？
   - 成功指標は何か？
   ```

2. **サービス命名（価値重視の原則）**
   ```markdown
   ❌ 避けるべき名前: 「〜管理サービス」「〜システム」
   ✅ 推奨される名前:
   - プロジェクト成功支援サービス（価値：成功支援）
   - タレント最適化サービス（価値：最適化）
   - セキュアアクセスサービス（価値：安全性保証）
   ```

3. **使用テンプレート**: `templates/dx-service-definition.md`

#### 品質チェックポイント
- [ ] ビジネス価値が明確に表現されている
- [ ] ステークホルダーが理解できる名称である
- [ ] 他サービスとの境界が明確である
- [ ] 成功指標が測定可能である

---

### Step 1.2: ビジネスケーパビリティ特定
**目的**: サービスが提供する組織能力の体系化

#### 作業手順
1. **ケーパビリティマッピング**
   ```
   サービス価値
     ↓
   ケーパビリティ1（〜する能力）
   ケーパビリティ2（〜する能力）
   ケーパビリティ3（〜する能力）
   ```

2. **ケーパビリティ命名規則**
   ```markdown
   形式: 「XXXする能力」
   例:
   - プロジェクトを成功に導く能力
   - チームの生産性を最大化する能力
   - 知識を組織資産化する能力
   ```

3. **使用テンプレート**: `templates/dx-business-capability.md`

#### 品質チェックポイント
- [ ] 各ケーパビリティが独立している
- [ ] サービス価値を包括的にカバーしている
- [ ] 「〜する能力」の形式で命名されている
- [ ] 3-5個の適切な粒度である

---

### Step 1.3: ビジネスオペレーション設計（v2.0仕様）
**目的**: ケーパビリティを実現する具体的な業務プロセスの設計

#### 🔥 重要：v2.0仕様の必須適用

##### v2.0仕様の3つの柱
1. **パラソルドメイン連携セクション**
2. **ユースケース・ページ分解マトリックス**
3. **マイクロサービス設計原則（ユースケース利用型）**

#### 作業手順

##### Step 1.3.1: 基本設計
1. **オペレーション命名（ビジネス価値重視）**
   ```markdown
   ❌ 悪い例: 「プロジェクトデータを管理する」
   ✅ 良い例: 「プロジェクト成果物を実現可能なタスクに分解し成功を確実にする」

   命名原則:
   - アクション指向（動詞 + 目的語）
   - ビジネス価値を表現
   - 顧客視点での命名
   ```

2. **使用テンプレート**: `templates/business-operation-enhanced-template.md`

##### Step 1.3.2: パラソルドメイン連携の設計
```markdown
## 🏗️ パラソルドメイン連携

### サービス境界とユースケース連携

#### 📦 自サービス管理（[service-name]）
**責務**: ✅ エンティティ管理 ✅ ユースケース実装 ✅ ビジネスロジック

Entity: [EntityName] - Aggregate Root
├── id: UUID - 一意識別子
├── [field1]: [TYPE] - [説明]
├── [field2]: [TYPE] - [説明]
└── [field3]: [TYPE] - [説明]

#### 🔗 他サービスユースケース利用（ユースケース呼び出し型）
**責務**: ❌ エンティティ知識不要 ✅ ユースケース利用のみ

[other-service-1] ユースケース利用:
├── UC-XXX-01: [ユースケース名] → POST /api/[service]/usecases/[usecase-id]
└── UC-XXX-02: [ユースケース名] → GET /api/[service]/usecases/[usecase-id]
```

##### Step 1.3.3: マイクロサービス連携型ドメインサービス
```markdown
#### 🎯 ビジネス価値重視のドメインサービス

DomainService: [ServiceName]（[サービス説明]）
├── enhance[BusinessValue]() - [価値向上の説明]
├── coordinate[CrossService]() - [サービス間調整]（→ 他サービス連携）
├── strengthen[Capability]() - [能力強化]
└── amplify[Impact]() - [影響拡大]
```

#### 品質チェックポイント
- [ ] パラソルドメイン連携セクションが存在する
- [ ] 自サービス管理の責務が明確である
- [ ] 他サービスユースケース利用が適切に設計されている
- [ ] ドメインサービスがビジネス価値を表現している
- [ ] エンティティの直接参照を避けている

---

## 🎬 Phase 2: 詳細設計（システム機能の具体化）

### Step 2.1: パラソルドメイン言語定義
**目的**: 実装非依存の中間言語による厳密なドメインモデル定義

#### 作業手順
1. **ドメインエキスパートとの対話**
   ```
   重要な概念の抽出:
   - 何が重要なエンティティか？
   - どんな状態変化があるか？
   - どんなビジネスルールがあるか？
   ```

2. **3要素記法の適用**
   ```markdown
   日本語名 [英語名] [SYSTEM_NAME]

   例:
   プロジェクト [Project] [PROJECT]
   タスク分解依頼 [TaskDecompositionRequest] [TASK_DECOMPOSITION_REQUEST]
   ```

3. **使用テンプレート**: `templates/parasol-domain-language-v2.md`

#### パラソルドメイン言語の構成要素
```markdown
## エンティティ定義
プロジェクト [Project] [PROJECT]
├── プロジェクトID [ProjectID] [PROJECT_ID]: UUID
├── プロジェクト名 [ProjectName] [PROJECT_NAME]: STRING_100
├── 状態 [Status] [STATUS]: ENUM（計画中/実行中/完了/中止）
└── 作成日時 [CreatedAt] [CREATED_AT]: TIMESTAMP

## 値オブジェクト定義
プロジェクト期間 [ProjectDuration] [PROJECT_DURATION]
├── 開始日 [startDate] [START_DATE]: DATE
├── 終了日 [endDate] [END_DATE]: DATE
└── 期間日数 [durationDays] [DURATION_DAYS]: INTEGER

## 集約定義
プロジェクト集約 [ProjectAggregate] [PROJECT_AGGREGATE]
├── 集約ルート: プロジェクト [Project]
├── 包含エンティティ: タスク [Task]（1..*）
└── 不変条件: 全タスク完了時のみプロジェクト完了可能
```

#### 品質チェックポイント
- [ ] 3要素記法が一貫して使用されている
- [ ] エンティティの責務が明確である
- [ ] 集約境界が適切に設計されている
- [ ] ビジネスルールが網羅されている
- [ ] 実装技術に依存していない

---

### Step 2.2: ユースケース分解（1対1関係強制）
**目的**: ビジネスオペレーションからユースケースへの適切な分解と1対1関係の確立

#### 🔥 重要：1対1関係強制ディレクトリ構造

##### 新標準構造（v2.0）
```
operations/[operation-name]/
├── operation.md
└── usecases/
    ├── [usecase-1-name]/
    │   ├── usecase.md     # ユースケース定義
    │   └── page.md        # 対応ページ定義（1対1強制）
    ├── [usecase-2-name]/
    │   ├── usecase.md
    │   └── page.md
    └── [usecase-3-name]/
        ├── usecase.md
        └── page.md
```

#### 作業手順

##### Step 2.2.1: ユースケース分解マトリックス設計
```markdown
## 📄 ユースケース・ページ設計マトリックス

| UC# | ユースケース名 | 対応ページ | エンティティ | アクター | 設計方針 |
|-----|---------------|-----------|-------------|----------|----------|
| UC1 | [ユースケース1] | [ページ1] | [エンティティ（操作種別）] | [アクター] | [設計方針] |
| UC2 | [ユースケース2] | [ページ2] | [エンティティ（操作種別）] | [アクター] | [設計方針] |
| UC3 | [ユースケース3] | [ページ3] | [エンティティ（操作種別）] | [アクター] | [設計方針] |
```

##### Step 2.2.2: ユースケース分解原則
```markdown
分解原則:
- **ユーザー操作ステップ** → ユースケース + ページ
- **システム内部処理** → ドメインサービス（ページなし）
- **1ユースケース = 1つの明確な目的 = 1つのページ**
```

##### Step 2.2.3: ディレクトリ作成とファイル配置
```bash
# 1対1構造の作成
mkdir -p operations/[operation-name]/usecases/[usecase-name]
touch operations/[operation-name]/usecases/[usecase-name]/usecase.md
touch operations/[operation-name]/usecases/[usecase-name]/page.md
```

#### 品質チェックポイント
- [ ] ユースケース・ページが完全に1対1対応している
- [ ] ディレクトリ構造がv2.0標準に準拠している
- [ ] ユースケース分解マトリックスが存在する
- [ ] アクター視点でのユースケース分解である
- [ ] 各ユースケースが明確な目的を持っている

---

### Step 2.3: ページ定義・API仕様設計
**目的**: ユーザーインターフェースとシステムインターフェースの実装非依存設計

#### 作業手順

##### Step 2.3.1: ページ定義（実装非依存）
```markdown
# ページ定義: [ページの目的を表す名前]

## 画面の目的
[この画面で達成したいビジネス目的を記述]

## 利用者
- **[主要利用者]**: [役割と利用目的]
- **[副次利用者]**: [役割と利用目的]

## 画面構成
### [エリア名1]
- [表示項目や機能の説明]

### [エリア名2]
- [表示項目や機能の説明]

## 画面の振る舞い
- [ユーザー操作に対する画面の反応]
- [ビジネスルールに基づく制御]
```

##### Step 2.3.2: API仕様設計
```markdown
## API仕様: [ユースケース対応API]

### エンドポイント
- **POST** `/api/[service]/operations/[operation]/usecases/[usecase]`
- **GET** `/api/[service]/operations/[operation]/usecases/[usecase]/status`
- **GET** `/api/[service]/operations/[operation]/usecases/[usecase]/result`

### リクエスト仕様
[パラソルドメイン言語に基づく入力情報]

### レスポンス仕様
[パラソルドメイン言語に基づく出力情報]
```

#### 使用テンプレート
- **ページ定義**: `templates/dx-page-definition.md`
- **API仕様**: `templates/api-spec-template.md`

#### 品質チェックポイント
- [ ] ページ定義が実装技術に依存していない
- [ ] API仕様がパラソルドメイン言語と整合している
- [ ] ユーザビリティが考慮されている
- [ ] セキュリティ要件が明記されている

---

## 💾 Phase 3: 実装設計（技術的実現の設計）

### Step 3.1: データベース設計
**目的**: パラソルドメイン言語から物理データベースへの変換

#### 作業手順
1. **エンティティ → テーブル変換**
   ```markdown
   パラソルエンティティ: プロジェクト [Project] [PROJECT]
   ↓
   物理テーブル: projects
   ```

2. **値オブジェクト → カラム変換**
   ```markdown
   値オブジェクト: プロジェクト期間 [ProjectDuration]
   ↓
   カラム: start_date, end_date, duration_days
   ```

3. **使用テンプレート**: `templates/dx-database-design.md`

---

### Step 3.2: ロバストネス図設計
**目的**: ユースケースからオブジェクト設計への橋渡し

#### 作業手順
1. **3要素の特定**
   - **Boundary**: ユーザーインターフェース要素
   - **Control**: ビジネスロジック・処理
   - **Entity**: データ・概念オブジェクト

2. **使用テンプレート**: `templates/dx-robustness-diagram.md`

---

### Step 3.3: テスト仕様設計
**目的**: 品質保証のための包括的テスト戦略

#### 作業手順
1. **テストレベル定義**
   - 単体テスト（ドメインロジック）
   - 統合テスト（サービス間連携）
   - E2Eテスト（ユースケース検証）

2. **使用テンプレート**: `templates/dx-test-definition.md`

---

## 🔍 Phase 4: 品質保証と統合

### Step 4.1: 段階別品質チェック

#### Level 1: 設計時品質チェック
```bash
# v2.0仕様適用確認
grep -q "## パラソルドメイン連携" operation.md
grep -q "ユースケース・ページ分解マトリックス" operation.md

# 1対1関係確認
usecase_count=$(find usecases -name "usecase.md" | wc -l)
page_count=$(find usecases -name "page.md" | wc -l)
# usecase_count == page_count の確認
```

#### Level 2: 実装時品質チェック
```bash
# パラソルドメイン連携APIの実装確認
find app/api -name "*.ts" | xargs grep -l "parasol"

# 他サービスユースケース利用の実装確認
find app/api -name "*.ts" | xargs grep -l "POST /api/.*usecases"
```

#### Level 3: 統合品質チェック
```bash
# エンドツーエンドテスト
npm run test:e2e -- --grep "v2.0"

# パフォーマンステスト
npm run test:performance -- --grep "parasol"
```

### Step 4.2: 自動品質チェック

#### pre-commit フック
```bash
#!/bin/bash
# パラソル設計品質チェック
echo "🔍 パラソル設計v2.0品質チェック実行中..."

# 必須セクション確認
required_sections=("パラソルドメイン連携" "ユースケース・ページ分解マトリックス")
for section in "${required_sections[@]}"; do
  if ! grep -q "$section" operation.md; then
    echo "❌ 必須セクション不足: $section"
    exit 1
  fi
done

echo "✅ 品質チェック完了"
```

#### CI/CD パイプライン
```yaml
# .github/workflows/parasol-quality-check.yml
- name: パラソル設計v2.0仕様チェック
  run: |
    total=$(find docs/parasol -name "operation.md" | wc -l)
    v2_compliant=$(grep -l "パラソルドメイン連携" docs/parasol/services/*/capabilities/*/operations/*/operation.md | wc -l)
    score=$((v2_compliant * 100 / total))

    echo "パラソル設計v2.0適用率: $score%"

    if [ $score -lt 80 ]; then
      echo "❌ 品質スコアが基準(80%)を下回りました"
      exit 1
    fi
```

---

## 📈 継続的改善プロセス

### イテレーション計画
```markdown
## イテレーション1: 基本設計（2週間）
- サービス定義 → ケーパビリティ → オペレーション（v2.0）

## イテレーション2: 詳細設計（2週間）
- パラソルドメイン言語 → ユースケース分解 → ページ定義

## イテレーション3: 実装設計（1週間）
- データベース設計 → ロバストネス図 → テスト仕様

## イテレーション4: 品質保証（1週間）
- 品質チェック → 統合テスト → リリース準備
```

### レトロスペクティブ
```markdown
## 振り返り観点
1. **Keep**: うまくいった設計手順
2. **Problem**: 改善すべき設計手順
3. **Try**: 次回試す設計手順
```

---

## 🎓 設計者育成プログラム

### Level 1: 基礎設計者
- パラソル設計原則の理解
- v2.0仕様の基本適用
- 基本的なビジネスオペレーション設計

### Level 2: 中級設計者
- パラソルドメイン言語の活用
- マイクロサービス設計原則の適用
- 品質チェックプロセスの実行

### Level 3: 上級設計者
- 統合設計プロセスの指導
- 新しい設計パターンの創出
- 設計手順の継続的改善

---

## 📚 参考資料とツール

### 必須仕様書
- `design/parasol/specifications/business-operation-spec.md`
- `design/parasol/specifications/domain-language-spec.md`
- `design/parasol/specifications/use-case-spec.md`

### 必須テンプレート
- `templates/business-operation-enhanced-template.md` (v2.0)
- `templates/parasol-domain-language-v2.md` (v2.0)
- `templates/dx-business-operation.md`

### 品質チェックツール
- パラソル設計v2.0仕様チェッカー
- 1対1関係検証ツール
- 自動品質スコア算出

---

## 🚀 まとめ：パラソル開発の成功要因

### 成功の条件
1. **ビジネス価値を起点とした設計思考**
2. **段階的詳細化による品質作り込み**
3. **v2.0仕様の厳格な適用**
4. **継続的な品質チェック**
5. **チーム全体での設計手順の共有**

### パラソル開発の真髄
> **「設計手順こそがパラソル開発の真髄」**
>
> 優れた設計手順により、ビジネス価値を確実に技術実装へと変換し、
> 継続的に価値を創出し続けるシステムを構築する。

---

**次のアクション**: この統合設計プロセスガイドを基に、実際のプロジェクトでの設計実践を開始し、継続的な改善を通じてパラソル開発手順の完成度を高めていく。