# ユースケース: 会議録画を管理する

## 基本情報
- **ユースケースID**: UC-MEET-04
- **アクター**: システム管理者、会議ホスト、権限を持つ参加者
- **概要**: 会議録画の保存、アクセス権限管理、検索・視聴機能を提供し、録画を有効活用できる環境を整備する

## 事前条件
- 会議が録画設定有効で実施され、録画ファイルが生成されている
- 録画ファイルが適切なストレージに保存されている
- アクセス権限管理システムが稼働している
- 録画の保存期間・削除ポリシーが設定されている

## 事後条件
### 成功時
- 録画ファイルが適切に分類・管理されている
- 権限を持つユーザーが録画にアクセス可能な状態である
- 録画の検索・視聴・ダウンロード機能が正常に動作している
- 自動削除・アーカイブのスケジュールが設定されている
- アクセスログが記録され、監査可能な状態である

### 失敗時
- 録画管理の失敗原因と対処法が記録されている
- 録画ファイルの破損・紛失が検知され、復旧手順が実行されている
- ユーザーに代替アクセス方法が提供されている

## 基本フロー
1. システム管理者が録画管理画面にアクセスする
2. システムが最新の録画一覧と保存状況を表示する
3. システム管理者が録画ファイルの基本情報（タイトル、説明、タグ）を確認・編集する
4. システム管理者が録画のアクセス権限（参加者、承認者、公開範囲）を設定する
5. システム管理者が録画の保存期間と自動削除スケジュールを設定する
6. システム管理者が録画ファイルの品質確認と必要に応じた変換処理を実行する
7. システムが録画を検索可能な状態でインデックス化する
8. システムが権限を持つユーザーに録画利用可能通知を送信する
9. システム管理者が定期的な録画ストレージ使用状況を確認する
10. システムがポリシーに基づく自動アーカイブ・削除を実行する

## 代替フロー
### 代替フロー1: 録画品質に問題がある場合
- 6a. 録画ファイルの音声・映像品質に問題が発見された場合
  - 6a1. システムが品質問題の詳細（音量、解像度、欠損部分）を分析する
  - 6a2. システム管理者が自動品質改善処理または手動編集を選択する
  - 6a3. システムが改善処理を実行し、元ファイルとの差分を記録する
  - 6a4. 基本フロー7に戻る

### 代替フロー2: 大容量録画の効率的管理
- 3a. 録画ファイルが非常に大容量（2GB以上）の場合
  - 3a1. システムが自動でチャプター分割と要約作成を提案する
  - 3a2. システム管理者が分割ポイントと圧縮設定を確認・調整する
  - 3a3. システムが分割・圧縮処理を実行し、インデックスを作成する
  - 3a4. 基本フロー4に戻る

## 例外フロー
### 例外1: 録画ファイル破損・紛失エラー
- *a. 録画ファイルの破損または紛失が検知された場合
  - *a1. システムが破損・紛失の詳細とバックアップ状況を確認する
  - *a2. システムがバックアップからの復旧または代替措置を試行する
  - *a3. 復旧不可能な場合は関係者に状況説明と謝罪を送信する
  - *a4. システム管理者が再発防止策を検討・実装する

### 例外2: ストレージ容量不足エラー
- *b. 録画保存用ストレージの容量が不足した場合
  - *b1. システムが容量不足アラートと使用状況詳細を表示する
  - *b2. システム管理者が古い録画の緊急アーカイブまたは削除を実行する
  - *b3. システムが追加ストレージの自動プロビジョニングを試行する
  - *b4. 容量確保後は録画保存を再開する

## パラソルドメイン連携
**操作エンティティ**: Meeting（録画URL管理、アクセス権限設定）、MeetingRecording
**集約**: MeetingRecordingAggregate - 録画ライフサイクル管理
**他サービス連携**:
- UC-AUTH-02: 権限を検証する → POST /api/auth/validate-permission
- UC-STORAGE-01: ファイルを保存する → POST /api/storage/upload
- UC-KNOWLEDGE-02: 録画を知識として分類する → POST /api/knowledge/categorize

## 特別要件
- **ストレージ効率**: 適切な圧縮により容量を30%削減
- **アクセス性能**: 録画再生開始まで5秒以内
- **セキュリティ**: 録画内容の暗号化とアクセス制御の徹底
- **可用性**: 録画管理システムの99.5%以上の稼働率
- **拡張性**: 同時視聴者数100名以上への対応

## 関連ユースケース
- **前提**: UC-MEET-02: 会議を実施する（録画有効設定）
- **関連**: UC-MEET-03: 会議フォローアップを実行する
- **統合**: ストレージ管理システム、ナレッジ管理システムとの連携
- **運用**: 定期的な容量監視と自動化されたライフサイクル管理