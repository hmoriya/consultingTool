# ユースケース: 通知コンテンツを作成する

**ユースケースID**: UC-NOTIFY-01
**バージョン**: 2.0.0
**更新日**: 2025-10-10
**設計方針**: パラソルv2.0仕様 + 包括的コンテンツ管理 + 多様性対応

## 📋 基本情報
- **主アクター**: システム管理者、通知作成者
- **副アクター**: システム（自動化支援）、承認者（重要通知の場合）
- **概要**: 効果的な通知メッセージとコンテンツを作成し、配信準備を完了する

## 🎯 事前条件
- 通知送信の目的と対象者が明確である
- 必要なコンテンツ情報（文章、画像、リンク等）が準備されている
- システムにログインし、通知作成権限を持っている
- 通知テンプレートまたはフォーマットが利用可能である

## ✅ 事後条件

### 成功時
- NotificationContent エンティティが作成され、status="draft"
- 通知コンテンツが保存され、プレビュー可能な状態になっている
- 配信対象者・タイミング・チャネルが設定されている
- 次フェーズ（配信実行）への移行準備が完了している

### 失敗時
- 通知コンテンツは未作成状態を維持
- エラー内容が特定され、修正方針が明確になっている
- 作成途中のデータが適切に保存または破棄されている

## 🔄 基本フロー

1. **通知作成者が通知作成を開始する**
   - 通知の目的・対象・緊急度を明確にする
   - 通知カテゴリ（お知らせ、緊急、システム、個別）を選択

2. **システムが作成支援情報を提供する**
   - 内部処理: NotificationContentService.prepareCreation()
   - 利用可能なテンプレート・過去事例の提示
   - 対象者セグメント・配信チャネルの推奨

3. **通知作成者がコンテンツを作成する**
   - メッセージ本文・タイトルの作成
   - 添付ファイル・画像・リンクの追加
   - 表示形式・レイアウトの調整

4. **システムがコンテンツ品質を検証する**
   - 内部処理: NotificationContentService.validateContent()
   - 文字数・形式・必須項目のチェック
   - 不適切な内容・セキュリティリスクの検出

5. **通知作成者が配信設定を行う**
   - 配信対象者の指定（個別・グループ・全体）
   - 配信タイミング（即時・予約・条件）
   - 配信チャネル（メール・アプリ・SMS・Web）

6. **システムが作成内容を保存・確認する**
   - 内部処理: NotificationContentService.saveContent()
   - NotificationContent エンティティの作成
   - プレビュー生成・表示確認の提供

7. **通知作成者が作成完了を確定する**
   - 最終確認・承認要求の実行
   - 配信準備完了状態への移行
   - 次ステップ（配信実行）への引き継ぎ

## 🔀 代替フロー

### 代替フロー1: テンプレート利用による効率作成
- **分岐点**: 基本フロー ステップ3
- **条件**: 既存テンプレートの活用が適切
- **代替処理**:
  1. 通知作成者が適切なテンプレートを選択
  2. テンプレートベースのコンテンツ作成・カスタマイズ
  3. 効率的な配信設定・確認の実行

### 代替フロー2: 承認フロー付き重要通知作成
- **分岐点**: 基本フロー ステップ6
- **条件**: 重要度・影響度が高い通知の場合
- **代替処理**:
  1. システムが承認プロセスの必要性を判定
  2. 承認者への承認要求・レビュー実行
  3. 承認完了後の配信準備状態への移行

## ⚠️ 例外フロー

### 例外1: コンテンツ検証エラー・修正要求
- **発生点**: 基本フロー ステップ4
- **条件**: 不適切な内容・形式エラーが検出された場合
- **処理**:
  1. システムが具体的なエラー内容・修正要求を提示
  2. 通知作成者による内容修正・再検証の実行
  3. 検証通過後の作成フロー続行

### 例外2: 配信設定不備・対象者エラー
- **発生点**: 基本フロー ステップ5
- **条件**: 配信対象・設定に不整合がある場合
- **処理**:
  1. システムが設定問題・推奨修正案を提示
  2. 配信設定の見直し・修正の実行
  3. 設定確認後の作成プロセス完了

## 🏗️ パラソルドメイン連携

### 操作エンティティ
- **NotificationContent**: コンテンツ作成（status="draft", title, body, attachments, settings）
- **NotificationTarget**: 配信対象設定（targetType, targetList, segmentation）
- **NotificationTemplate**: テンプレート利用（templateId, customization, variations）

### 集約操作
- **NotificationAggregate**: 通知コンテンツ統合管理
- **不変条件確認**: コンテンツ必須項目、配信設定整合性、権限妥当性

### ドメインサービス利用
- **NotificationContentService**:
  - `prepareCreation()`: 作成支援情報提供
  - `validateContent()`: コンテンツ品質検証
  - `saveContent()`: コンテンツ保存・管理
- **NotificationSecurityService**:
  - `checkContentSecurity()`: セキュリティ検証

## 🔗 他サービス連携（ユースケース利用型）

### 必須連携
- **[secure-access-service]**:
  - `UC-AUTH-01: ユーザー認証を実行する` → 作成権限確認
  - `UC-AUTH-02: 権限を検証する` → 通知作成権限チェック

### オプション連携
- **[knowledge-co-creation-service]**:
  - `UC-TEMPLATE-01: テンプレートを提供する` → 過去事例・ベストプラクティス
- **[secure-access-service]**:
  - `UC-APPROVAL-01: 承認フローを実行する` → 重要通知の承認処理

## 📊 成功指標・KPI
- **コンテンツ作成完了率**: 95%以上（作成開始から完了まで）
- **品質検証通過率**: 90%以上（一発通過率）
- **テンプレート活用率**: 60%以上（効率化指標）
- **作成時間**: 平均15分以内（簡易通知）、30分以内（複雑通知）

## 📝 特別要件

### パフォーマンス要件
- コンテンツ保存: 3秒以内
- プレビュー生成: 5秒以内
- 品質検証: 10秒以内

### セキュリティ要件
- 機密情報・個人情報の適切な保護
- 不適切コンテンツの自動検出・防止
- 通知作成・配信履歴の完全な記録

### 品質要件
- 多言語対応（日本語・英語・中国語）
- アクセシビリティ配慮（スクリーンリーダー対応）
- レスポンシブデザイン（デスクトップ・モバイル対応）

## 🔄 関連ユースケース
- **前提**: 通知システムの初期設定完了
- **後続**: UC-NOTIFY-02（通知を配信する）、UC-NOTIFY-03（配信状況を確認する）
- **代替**: テンプレート活用フロー、承認フロー付き作成
- **例外**: コンテンツ修正・配信設定見直し

---
*このユースケースは、効果的な組織コミュニケーションを実現するパラソルv2.0設計指針に基づいています*
