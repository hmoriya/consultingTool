# ユースケース: 活用文脈を特定する

**バージョン**: 2.0.0
**更新日**: 2025-10-21
**設計方針**: 文脈理解・需要分析・知識マッチング精度向上

## 基本情報
- **ユースケースID**: UC-APPLY-01
- **アクター**: コンサルタント（主アクター）、システム（副アクター）
- **概要**: 業務課題やプロジェクト状況を分析し、適切な知識活用のための文脈情報を特定・構造化する

## 🏗️ パラソルドメイン連携

### 操作エンティティ
- **ApplicationContextEntity**（自サービス管理・状態更新: analyzing → structured → validated）: 活用文脈情報の管理
- **ContextAnalysisRequestEntity**（自サービス管理・CRUD）: 文脈分析要求の管理
- **BusinessSituationEntity**（自サービス管理・CRUD）: 業務状況の詳細記録
- **UserEntity**（参照のみ）: 活用者プロファイル情報の参照
- **ProjectEntity**（参照のみ）: プロジェクト文脈情報の参照

### 他サービスユースケース利用
- **secure-access-service**: UC-AUTH-01: ユーザー認証を実行する
- **secure-access-service**: UC-AUTH-02: 権限を検証する
- **project-success-service**: UC-PROJECT-01: プロジェクト情報を取得する
- **project-success-service**: UC-TASK-01: タスク詳細を取得する

## 事前条件
- ユーザーがシステムにログインしている
- 知識活用が必要な業務課題またはプロジェクト状況が存在する
- ユーザーが知識活用権限を有している
- 基本的な文脈情報（プロジェクト、タスク、目標など）が利用可能である

## 事後条件
### 成功時
- ApplicationContextEntityが「validated」状態で保存されている
- 文脈分析結果が構造化データとして記録されている
- 知識推奨に必要な文脈情報が準備されている
- 次のユースケース（適切な知識を推奨する）の実行準備が完了している

### 失敗時
- 文脈分析が「analyzing」状態で停止している
- 不足している文脈情報が明確化されている
- エラー内容とリカバリ手順がユーザーに提示されている

## 基本フロー
1. **コンサルタント**が知識活用システムにアクセスする
2. **システム**がユーザー認証と権限確認を実行する（他サービス連携）
3. **コンサルタント**が業務課題またはプロジェクト状況の基本情報を入力する
4. **システム**が関連プロジェクト・タスク情報を取得する（他サービス連携）
5. **システム**が文脈分析テンプレートを表示する
6. **コンサルタント**が詳細な文脈情報を入力する（目標、制約、期限、成功指標）
7. **システム**が文脈情報の妥当性を検証する
8. **システム**が文脈分析結果を構造化し、保存する
9. **システム**が知識推奨プロセスへの準備完了を通知する

## 代替フロー

### 代替フロー1: プロジェクト文脈自動取得
- **分岐点**: ステップ4（関連情報取得）
- **条件**: ユーザーが既存プロジェクトメンバーの場合
- **処理**:
  - 4a1. システムがユーザーの所属プロジェクト一覧を表示
  - 4a2. コンサルタントが該当プロジェクトを選択
  - 4a3. システムがプロジェクト文脈を自動取得・表示
  - 4a4. ステップ6に続行

### 代替フロー2: 類似文脈の再利用
- **分岐点**: ステップ6（詳細入力）
- **条件**: 過去に類似の文脈分析履歴がある場合
- **処理**:
  - 6a1. システムが類似文脈の候補を表示
  - 6a2. コンサルタントが参考にする文脈を選択
  - 6a3. システムが既存文脈をテンプレートとして読み込む
  - 6a4. コンサルタントが必要な修正を加える
  - 6a5. ステップ7に続行

### 代替フロー3: 段階的文脈構築
- **分岐点**: ステップ6（詳細入力）
- **条件**: 大規模・複雑な文脈の場合
- **処理**:
  - 6b1. システムが文脈を複数フェーズに分割
  - 6b2. コンサルタントが第1フェーズの文脈を詳細化
  - 6b3. システムが部分的な文脈分析を実行
  - 6b4. 後続フェーズの必要性を判定
  - 6b5. 必要に応じて6b2-6b4を繰り返し

## 例外フロー

### 例外1: 文脈情報不足
- **発生点**: ステップ7（妥当性検証）
- **処理**:
  - 7e1. システムが不足情報の具体的リストを表示
  - 7e2. 必須項目と推奨項目を明確に分類
  - 7e3. 不足情報の取得方法を案内
  - 7e4. ステップ6に戻り、追加入力を促進

### 例外2: プロジェクト情報取得失敗
- **発生点**: ステップ4（関連情報取得）
- **処理**:
  - 4e1. システムが接続エラーを検知
  - 4e2. 手動での文脈入力モードに切り替え
  - 4e3. 利用可能な情報範囲での分析実行を提案
  - 4e4. プロジェクト情報は後日連携での補完を計画

### 例外3: 文脈分析処理エラー
- **発生点**: ステップ8（文脈分析・構造化）
- **処理**:
  - 8e1. システムがエラー詳細をログに記録
  - 8e2. 簡易版文脈分析への切り替えを提案
  - 8e3. 手動での知識検索オプションを提示
  - 8e4. ナレッジマネージャーに技術支援を要請

## 特別要件

### ユーザビリティ要件
- **直感的入力**: 専門知識不要の分かりやすい文脈入力フォーム
- **スマート補完**: 入力途中での候補提示とオートコンプリート
- **視覚的ガイド**: 文脈分析プロセスの進捗表示
- **エラー回避**: リアルタイムでの入力検証とガイダンス

### パフォーマンス要件
- **分析速度**: 文脈妥当性検証3秒以内
- **応答性**: ユーザー入力への即座フィードバック（1秒以内）
- **同時処理**: 50ユーザーの同時文脈分析対応
- **データ保存**: 文脈情報の自動保存（30秒間隔）

### セキュリティ要件
- **情報保護**: 機密プロジェクト情報の適切な暗号化
- **アクセス制御**: プロジェクト参加者のみの文脈情報アクセス
- **監査ログ**: 文脈分析実行の詳細記録
- **データ保持**: 文脈情報の適切な保持期間管理

## 入出力仕様

### 入力（フロントエンド → API）
```json
{
  "contextAnalysisRequest": {
    "userId": "UUID",
    "projectId": "UUID (optional)",
    "taskId": "UUID (optional)",
    "businessSituation": {
      "challengeDescription": "業務課題の詳細",
      "currentState": "現状説明",
      "desiredOutcome": "期待する成果",
      "constraints": ["制約条件1", "制約条件2"],
      "timeline": "実施期限",
      "stakeholders": ["関係者1", "関係者2"]
    },
    "knowledgeRequirements": {
      "preferredTypes": ["procedure", "template", "case_study"],
      "complexityLevel": "beginner|intermediate|advanced",
      "applicationScope": "個人|チーム|組織"
    }
  }
}
```

### 出力（API → フロントエンド）
```json
{
  "result": "success|validation_error|analysis_error",
  "contextData": {
    "contextId": "UUID",
    "status": "validated",
    "structuredContext": {
      "problemStatement": "構造化された課題定義",
      "goalClarification": "明確化された目標",
      "constraintAnalysis": "制約分析結果",
      "knowledgeGaps": ["特定された知識ギャップ"],
      "recommendationCriteria": "推奨基準"
    },
    "readinessScore": 85,
    "confidence": "high|medium|low"
  },
  "nextSteps": {
    "readyForRecommendation": true,
    "recommendationProcess": "UC-APPLY-02",
    "estimatedKnowledgeCount": 5
  }
}
```

### エラーレスポンス例
```json
{
  "result": "validation_error",
  "error": {
    "code": "INSUFFICIENT_CONTEXT",
    "message": "文脈情報が不足しています",
    "missingFields": ["desiredOutcome", "timeline"],
    "suggestions": [
      "期待する成果を具体的に記述してください",
      "実施期限の設定をお願いします"
    ]
  },
  "partialContext": {
    "validatedFields": ["challengeDescription", "currentState"],
    "completionRate": 60
  }
}
```

## 関連ユースケース
- **UC-APPLY-02**: 適切な知識を推奨する（次のステップ）
- **UC-CAPTURE-01**: 知識を記録する（文脈テンプレートとして活用）
- **UC-SHARE-01**: 知識を共有する（文脈共有による横展開）

---
*このユースケースは、効果的な知識活用の基盤となる文脈理解を実現し、パラソル設計v2.0仕様に基づく価値創造を目指しています*