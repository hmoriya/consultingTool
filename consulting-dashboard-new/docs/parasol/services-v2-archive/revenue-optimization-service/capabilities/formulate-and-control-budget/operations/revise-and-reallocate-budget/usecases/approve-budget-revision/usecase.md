# ユースケース: 予算改訂を承認する

## 基本情報
- **ユースケースID**: UC-BUDGET-02
- **アクター**: エグゼクティブ、役員、CEO（承認権限階層に応じて）
- **概要**: 提出された予算改訂案を審査し、組織ガバナンスと投資効率確保に基づく適切な承認判断を実行する

## 事前条件
- UC-BUDGET-01（予算改訂案作成）が完了している
- BudgetRevisionEntity（under_review状態）が存在する
- 承認者が適切な承認権限を有している（金額別階層対応）
- RevisionImpactEntity（影響分析結果）が確認可能である

## 事後条件
### 成功時
- 予算改訂の承認判断が完了している
- BudgetRevisionEntity（状態変更: under_review → approved）
- 承認記録（デジタル署名付き）が保存されている
- 関係者への承認結果通知が配信されている

### 失敗時
- 承認プロセスのエラーが記録されている
- BudgetRevisionEntity（状態: under_review または rejected）が維持されている
- エラー内容が関係者に通知されている

## 基本フロー
1. **エグゼクティブが承認プロセスを開始する**
   - → UC-AUTH-01: ユーザー認証を実行する
   - → UC-AUTH-02: 承認権限を検証する（金額別階層確認）
   - BudgetRevisionEntity（状態確認: under_review）

2. **システムが改訂案詳細を表示・審査支援する**
   - RevisionImpactEntity（影響分析結果）の詳細表示
   - ReallocationPlanEntity（配分計画）の妥当性確認
   - BudgetOptimizationService による品質評価表示

3. **エグゼクティブが改訂案を審査・判断する**
   - 改訂根拠・理由の妥当性評価
   - 組織戦略との整合性確認
   - 投資効率・ROI予測の評価

4. **承認判断を記録・確定する**
   - BudgetRevisionEntity（状態変更: under_review → approved/rejected）
   - デジタル署名付き承認記録の生成
   - → UC-AUTH-03: 承認操作ログを記録する

5. **承認結果を通知・次ステップ準備する**
   - → UC-COMM-01: 承認結果通知を配信する
   - 承認時: 改訂実行準備、却下時: 修正指示準備
   - 承認履歴・監査データの保存

## 代替フロー
### 代替フロー1: 段階的承認プロセス
- 1a. 高額改訂（50%以上増減）の場合
  - 1a1. 部門長 → 役員 → CEO の順次承認実行
  - 1a2. 各段階での詳細審査・記録・理由明記
  - 1a3. 最終段階（CEO）完了で基本フロー4へ
  - 1a4. 途中却下時は却下理由記録・修正指示

### 代替フロー2: 緊急承認プロセス
- 1b. 緊急改訂（48時間以内）の場合
  - 1b1. → UC-COMM-03: 緊急承認会議を調整する
  - 1b2. 短縮承認フロー適用（24時間以内）
  - 1b3. 条件付き承認の実施・事後監視強化
  - 1b4. 基本フロー4（記録確定）に戻る

## 例外フロー
### 例外1: 承認権限不足・権限競合
- *a. 承認権限が不足または競合している場合
  - *a1. → UC-AUTH-02: 上位承認権限者を特定する
  - *a2. 権限昇格または権限調整プロセス
  - *a3. 権限確定後、基本フロー1から再開

### 例外2: 改訂案重大問題検出
- *b. 審査で重大な問題が発見された場合
  - *b1. → UC-COMM-03: 緊急対策会議を調整する
  - *b2. 即座却下・問題分析・緊急修正指示
  - *b3. BudgetRevisionEntity（状態変更: under_review → rejected）
  - *b4. UC-BUDGET-01（改訂案作成）への差し戻し

### 例外3: 承認期限超過・タイムアウト
- *c. 承認期限を超過した場合
  - *c1. 自動エスカレーション・上位承認者への通知
  - *c2. → UC-COMM-01: 期限超過アラートを配信する
  - *c3. 緊急承認プロセスへの自動移行
  - *c4. 期限延長または暫定承認の検討

## 特別要件
- **性能**: 承認判断プロセス完了時間1週間以内（通常）、48時間以内（緊急）
- **可用性**: 承認システム稼働率99.9%以上
- **セキュリティ**: 承認操作の完全監査ログ、デジタル署名対応
- **精度**: 承認判断の適切性95%以上（事後評価）
- **透明性**: 承認理由・プロセスの完全可視化

## 関連ユースケース
- **包含**: UC-AUTH-01〜03, UC-COMM-01, UC-COMM-03
- **前提**: UC-BUDGET-01（予算改訂案作成）完了必須
- **連携**: 改訂実行プロセス（承認後の実行ステップ）

---
*このユースケースは パラソル設計v2.0仕様 に基づいて作成されました*
