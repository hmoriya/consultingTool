# ユースケース: セキュアログインを実行する

## 基本情報
- **ユースケースID**: UC-AUTH-03
- **アクター**: 申請者（新規ユーザー）、既存ユーザー
- **概要**: 承認済みのユーザーがセキュアな認証プロセスを実行し、多要素認証・異常検知・セッション管理を通じてセキュアアクセス環境への安全なログインを実現する

## 事前条件
- アカウントが承認済みである（User.status = "active"）
- ユーザーが有効な認証情報を保有している
- ログインシステムが利用可能である
- 必要に応じてMFAデバイスが利用可能である
- ネットワーク接続が安定している

## 事後条件
### 成功時
- セキュアログインが完了している（Session.isActive = true）
- 有効なセッションが確立されている
- 最終ログイン日時が更新されている（User.lastLoginAt = now()）
- セキュリティログが記録されている
- 適切なアクセス権限が付与されている

### 失敗時
- ログインエラーが記録されている
- 失敗回数が記録されている（必要に応じてアカウントロック）
- エラーメッセージが適切に表示されている
- セキュリティイベントが記録されている

## 基本フロー
1. **ユーザーがログインページにアクセスする**
   - システムがログインフォームを表示
   - セキュリティポリシーと注意事項を表示
   - 最新のセキュリティ通知を表示

2. **ユーザーが認証情報を入力する**
   - メールアドレス・パスワードの入力
   - デバイス情報の自動収集
   - 入力内容のリアルタイム検証

3. **システムが第一段階認証を実行する**
   - → UC-AUTH-03: 認証ログを記録する
   - パスワード照合・アカウント状態確認
   - 異常アクセス・セキュリティリスク検知
   - 必要に応じてMFA要求判定

4. **ユーザーがMFA（多要素認証）を実行する**
   - MFA方式に応じた認証情報入力
   - 認証コード検証・デバイス認証
   - MFA成功確認

5. **システムがセッション確立とアクセス許可を実行する**
   - セキュアセッション生成（Session.isActive = true）
   - アクセス権限確認・付与
   - → UC-AUTH-03: ログイン成功ログを記録する
   - ダッシュボードまたは要求されたページへリダイレクト

## 代替フロー
### 代替フロー1: MFA未設定アカウント
- 4a. ユーザーのMFAが未設定の場合
  - 4a1. 初回ログイン案内を表示
  - 4a2. セキュリティ設定ページへの案内
  - 4a3. 一時的セッション生成
  - 4a4. UC-AUTH-04（セキュリティ設定完了）への誘導

### 代替フロー2: デバイス認証
- 3a. 新しいデバイスからのアクセスの場合
  - 3a1. デバイス認証要求を表示
  - 3a2. メール認証・SMS認証の実行
  - 3a3. デバイス信頼性確認
  - 3a4. 基本フロー4（MFA実行）に戻る

## 例外フロー
### 例外1: 認証失敗とアカウントロック
- *a. パスワード認証に失敗した場合
  - *a1. → UC-AUTH-03: 認証失敗イベントを記録する
  - *a2. 失敗回数カウンタの更新
  - *a3. 残り試行回数の表示・警告
  - *a4. 5回失敗時のアカウントロック実行
  - *a5. 管理者への自動通知・パスワードリセット案内

### 例外2: 異常アクセス検知
- *b. 異常なログインパターンを検知した場合
  - *b1. → UC-AUTH-03: セキュリティ異常イベントを記録する
  - *b2. 追加認証要求（詳細本人確認）
  - *b3. セキュリティ管理者への即座通知
  - *b4. 厳格な本人確認プロセスの実行

### 例外3: システム障害・ネットワーク障害
- *c. ログイン処理中にシステム障害が発生した場合
  - *c1. ユーザーに障害状況の説明
  - *c2. 復旧予定時刻・代替手段の案内
  - *c3. 障害復旧後の自動リトライ機能
  - *c4. 緊急時連絡先の提供

## 特別要件
- **性能**: ログイン処理完了5秒以内、MFA処理3秒以内
- **可用性**: システム稼働率99.9%以上
- **セキュリティ**: 全認証試行ログ記録、異常検知、セッション暗号化
- **精度**: 認証成功率98%、不正ログイン検知率100%
- **ユーザビリティ**: 直感的ログインフロー、明確なエラーメッセージ

## 関連ユースケース
- **包含**: UC-AUTH-03（ログ記録）、UC-NOTIFY-01（通知配信）
- **前提**: UC-AUTH-02（アカウント承認完了）必須
- **後続**: UC-AUTH-04（セキュリティ設定）、システム利用開始

---
*このユースケースは パラソル設計v2.0仕様 に基づいて作成されました*
