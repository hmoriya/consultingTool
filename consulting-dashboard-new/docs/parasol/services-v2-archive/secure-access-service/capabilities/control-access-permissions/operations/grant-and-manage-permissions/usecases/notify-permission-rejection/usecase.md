# ユースケース: 権限申請の却下を通知する

## 基本情報
- **ユースケースID**: UC-PERM-06
- **アクター**: 権限管理システム、申請者
- **概要**: 権限申請が却下された際に、申請者に詳細な却下理由と改善案を提供し、適切な再申請へのガイダンスを実現する

## 事前条件
- 権限申請が却下されている（PermissionRequest.status = "rejected"）
- 却下理由とコメントが記録されている
- 申請者の連絡先情報が利用可能である
- 通知システムが利用可能である
- 再申請手順が定義されている

## 事後条件
### 成功時
- 却下通知が申請者に配信されている
- 却下理由と改善案が明確に伝達されている
- 再申請のガイダンスが提供されている
- 通知配信ログが記録されている（NotificationLog.status = "sent"）
- 申請者が改善アクションを実行可能な状態になっている

### 失敗時
- 通知配信エラーが記録されている
- 代替通知手段が実行されている
- 管理者に配信失敗が通知されている
- 申請者への別途連絡手段が準備されている

## 基本フロー
1. **システムが却下情報を整理する**
   - 却下理由・承認者コメントの整理
   - 申請内容と却下ポイントの分析
   - 改善提案・修正ガイダンスの生成

2. **システムが通知内容を生成する**
   - → UC-NOTIFY-01: 却下通知を配信する
   - 却下理由の分かりやすい説明作成
   - 具体的改善案・修正ポイントの明示

3. **システムが申請者に通知を配信する**
   - 優先通知手段（メール・チャット）での配信
   - 却下理由・改善案の詳細提供
   - 再申請手順・必要書類の案内

4. **システムが再申請支援を提供する**
   - 再申請フォームへの直接リンク提供
   - 修正が必要な項目のハイライト表示
   - 相談窓口・支援担当者の連絡先提供

5. **システムが通知完了を確認する**
   - → UC-PERM-06: 却下通知ログを記録する
   - 申請者の通知受信確認
   - 再申請準備状況の追跡開始

## 代替フロー
### 代替フロー1: 改善支援付き却下通知
- 3a. 改善可能性が高い申請の場合
  - 3a1. 詳細な改善ガイダンス・手順書の提供
  - 3a2. 専門サポート担当者との面談予約案内
  - 3a3. 類似成功事例・参考資料の提供
  - 3a4. 基本フロー4（再申請支援）に進む

### 代替フロー2: 一時的却下・条件変更時の通知
- 1a. 一時的な理由での却下の場合
  - 1a1. 却下の一時性・将来承認可能性の明示
  - 1a2. 条件変更・状況改善時の再申請推奨時期提示
  - 1a3. 自動リマインダー・再申請促進通知の設定
  - 1a4. 基本フロー2（通知内容生成）に戻る

## 例外フロー
### 例外1: 通知配信失敗
- *a. メール・チャット通知が失敗した場合
  - *a1. → UC-NOTIFY-01: 通知配信エラーを記録する
  - *a2. 代替通知手段（SMS・電話・郵送）の実行
  - *a3. 申請者の上司・関係者への間接通知
  - *a4. 管理者への配信失敗エスカレーション

### 例外2: 却下理由不明・情報不足
- *b. 却下理由が不明確・不十分な場合
  - *b1. 承認者への却下理由詳細化要求
  - *b2. 標準的な却下理由テンプレートの適用
  - *b3. 申請者への一般的改善ガイダンス提供
  - *b4. 個別相談窓口への誘導・サポート提供

### 例外3: システム障害・ネットワーク障害
- *c. 通知システム障害が発生した場合
  - *c1. 障害検知・ログ記録・監視アラート送信
  - *c2. オフライン通知キューへの保存
  - *c3. 復旧後の自動通知配信・遅延説明
  - *c4. 緊急時手動通知手続きの実行

## 特別要件
- **性能**: 却下通知配信3秒以内、改善案生成2秒以内
- **可用性**: 通知システム稼働率99.8%以上
- **セキュリティ**: 却下理由の適切な情報管理、プライバシー保護
- **精度**: 却下理由の正確な伝達、改善案の実用性100%
- **ユーザビリティ**: 理解しやすい却下説明、具体的改善ガイダンス

## 関連ユースケース
- **包含**: UC-NOTIFY-01（通知配信）、UC-PERM-06（ログ記録）
- **前提**: UC-PERM-04（承認処理）での却下判断必須
- **後続**: UC-PERM-01（再申請）、UC-PERM-07（改善支援）

---
*このユースケースは パラソル設計v2.0仕様 に基づいて作成されました*
