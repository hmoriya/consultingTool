# ページ定義: メッセージ表示ページ

## 画面の目的
チャネル内のメッセージを時系列で表示し、スレッド会話やリアクション機能を通じてチームメンバー間の円滑なコミュニケーションを促進する

## 利用者
- **チャネルメンバー**: メッセージを閲覧・リアクションする主要な利用者
- **チャネル管理者**: チャネル内のコミュニケーション状況を監視
- **新規メンバー**: 過去の会話履歴を確認して文脈を理解

## 画面構成

### ヘッダー部
- チャネル情報表示（チャネル名、説明、メンバー数）
- オンラインメンバー一覧（アバター表示）
- 検索ボックス（メッセージ検索機能）
- チャネル設定メニュー（設定・通知・招待）

### メインコンテンツ部
- **メッセージフィードエリア**: メッセージの時系列表示
  - 個別メッセージカード（送信者・内容・タイムスタンプ）
  - 日付区切り線（「今日」「昨日」「MM月DD日」）
  - 未読メッセージの区切り線（「ここから未読」）
  - 新着メッセージの自動スクロール表示
- **スレッド展開エリア**: 返信メッセージの階層表示
  - 親メッセージの引用表示
  - 返信メッセージのインデント表示
  - スレッド折りたたみ・展開ボタン
- **リアクションエリア**: 各メッセージ下部
  - 既存リアクションの表示（絵文字 + 数）
  - リアクション追加ボタン（+アイコン）
  - リアクション詳細表示（ホバー時）

### サイドバー部（デスクトップ）
- **メンバー一覧**: チャネル参加者の状態表示
  - オンライン・オフライン状態
  - 最終ログイン時刻
  - ロール表示（管理者・メンバー）
- **ピン留めメッセージ**: 重要メッセージの固定表示
- **共有ファイル**: 添付されたファイルの一覧

### フッター部
- **メッセージ入力エリア**: 新規メッセージ作成
  - テキスト入力フィールド
  - ファイル添付ボタン
  - 絵文字選択ボタン
  - 送信ボタン

## データ表示

### 表示データ一覧
| データ項目 | 表示形式 | 必須 | 説明 |
|-----------|---------|------|------|
| メッセージ内容 | テキスト/リッチテキスト | ○ | メッセージ本文、リンク展開 |
| 送信者情報 | アバター+名前 | ○ | 送信者のプロフィール情報 |
| 送信時刻 | 相対時間/絶対時間 | ○ | 「3分前」「14:30」形式 |
| 既読状況 | 既読者数/未読マーク | ○ | 「5人が既読」「NEW」表示 |
| リアクション | 絵文字+数値 | × | 「👍 5」「❤️ 2」形式 |
| スレッド返信数 | 数値+最終返信者 | × | 「3件の返信 最新: @user」 |
| 添付ファイル | プレビュー/アイコン | × | 画像プレビュー、ファイル名 |
| 編集履歴 | 編集マーク | × | 「(編集済み)」表示 |

### データの更新頻度
- **新着メッセージ**: リアルタイム（WebSocket）
- **既読状況**: 5秒間隔
- **オンライン状態**: 30秒間隔
- **リアクション**: リアルタイム

## 表示機能

### メッセージ表示機能
| 機能項目 | 操作形式 | 説明 |
|---------|---------|------|
| 時系列表示 | 自動スクロール | 最新メッセージを下部に表示 |
| 無限スクロール | スクロール検知 | 上方向スクロールで過去メッセージ読み込み |
| 検索ハイライト | キーワード強調 | 検索結果のキーワードをハイライト |
| メンション強調 | 背景色変更 | 自分宛メンションを特別表示 |
| 未読区切り | 視覚的区切り | 未読メッセージの開始点を表示 |

## アクション・操作

### 主要アクション
- **メッセージ閲覧**: 自動既読更新、スクロール位置記憶
- **リアクション追加**: 絵文字選択でメッセージにリアクション
- **スレッド返信**: 特定メッセージへの返信作成
- **メッセージ検索**: キーワードでメッセージ検索

### 副次アクション
- **メッセージ共有**: 社内・社外共有リンク生成
- **メッセージ引用**: 他チャネルでの引用投稿
- **既読者確認**: メッセージ既読者の詳細表示
- **ピン留め**: 重要メッセージの固定表示

### 長押し・右クリックメニュー
- **返信**: スレッド返信の作成
- **リアクション**: 素早いリアクション追加
- **共有**: メッセージの共有
- **コピー**: メッセージテキストのコピー
- **引用**: 引用付き返信
- **ピン留め**: メッセージの固定（管理者のみ）

## 画面の振る舞い

### スクロール動作
- **下方向スクロール**: 新着メッセージへの自動移動
- **上方向スクロール**: 過去メッセージの段階的読み込み
- **中間位置**: スクロール位置の記憶・復元
- **新着到着時**: 最下部にいる場合は自動スクロール

### リアルタイム更新
- **新着メッセージ**: 即座に表示（音・バイブレーション通知）
- **リアクション更新**: アニメーション付きで即時反映
- **既読状況更新**: 定期的な状況更新
- **タイピング表示**: 「○○が入力中...」表示

### レスポンシブ動作
- **画面サイズ変更**: 自動レイアウト調整
- **モバイル最適化**: タッチ操作に最適化
- **キーボードショートカット**: デスクトップでの効率的操作

## 画面遷移

### 遷移元画面
- チャネル一覧ページ: チャネル選択時
- 通知一覧ページ: メッセージ通知クリック時
- 検索結果ページ: 検索結果メッセージクリック時
- ダイレクトメッセージ一覧: DM選択時

### 遷移先画面
- メッセージ作成ページ: 新規メッセージ作成時
- スレッド詳細ページ: スレッド専用表示時
- ユーザープロフィールページ: 送信者名クリック時
- ファイルプレビューページ: 添付ファイルクリック時

## エラーハンドリング
- **接続エラー**: オフライン表示とキャッシュメッセージ表示
- **権限エラー**: アクセス可能範囲のメッセージのみ表示
- **読み込みエラー**: 再読み込みボタンとエラー詳細表示
- **送信エラー**: メッセージ作成画面での詳細エラー表示

## アクセシビリティ要件
- スクリーンリーダーでのメッセージ読み上げ対応
- キーボードナビゲーション（Tab移動、矢印キー）
- 高コントラストモード対応
- 既読・未読の音声アナウンス

## レスポンシブ対応
- **デスクトップ**: 3カラムレイアウト（サイドバー・メイン・詳細）
- **タブレット**: 2カラムレイアウト（メイン・折りたたみサイドバー）
- **モバイル**: 1カラムレイアウト（フルスクリーン表示）

## パフォーマンス要件
- **初期表示**: 100ms以内
- **スクロール**: 60FPS維持
- **新着メッセージ**: 50ms以内の表示
- **検索**: 200ms以内の結果表示

## オフライン対応
- 最新100件のメッセージをローカルキャッシュ
- オフライン時は「オフラインモード」表示
- 接続復旧時の自動同期
- 作成中メッセージの一時保存

---
*このページ定義は新仕様v2.0のユースケース・ページ分解指向設計に基づいています*