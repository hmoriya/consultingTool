# ユースケース: 通知を受信し確認する

## 基本情報
- **ユースケースID**: UC-NOTIFY-02
- **アクター**: 通知受信者（全ユーザー）
- **概要**: ユーザーが自分宛の通知を効率的に受信・表示し、未読管理と優先度判断を行う

## パラソルドメイン連携
**操作エンティティ**: Notification（状態更新: pending → sent → read）
**パラソル集約**: NotificationAggregate - 受信者視点での通知ライフサイクル管理

## 事前条件
- ユーザーがシステムにログインしている
- ユーザー宛の通知が生成・配信されている
- 通知設定が有効になっている

## 事後条件
### 成功時
- 未読通知が一覧表示される
- ユーザーが選択した通知が既読状態に更新される
- 通知の優先度と種類が視覚的に区別されて表示される

### 失敗時
- エラーメッセージが表示される
- 利用可能な通知のみが表示される（部分的成功）
- オフライン時は最後に取得した通知がキャッシュ表示される

## 基本フロー
1. ユーザーが通知一覧画面にアクセスする
2. システムがユーザー権限を確認し、アクセス可能な通知を取得する
3. システムが通知を優先度・日時順でソートして表示する
4. ユーザーが未読通知の一覧を確認する
5. ユーザーが特定の通知を選択する
6. システムが選択された通知を既読状態に更新する
7. システムが通知詳細表示への遷移を準備する

## 代替フロー
### 代替フロー1: 通知フィルタリング
- 4a. ユーザーが通知種別でフィルタリングを実行する場合
  - 4a1. システムが選択された種別の通知のみを表示
  - 4a2. フィルター状態をセッションに保存
  - 4a3. 基本フロー5に戻る

### 代替フロー2: 一括既読操作
- 5a. ユーザーが複数通知の一括既読を実行する場合
  - 5a1. ユーザーが一括選択または「全て既読にする」を選択
  - 5a2. システムが選択された通知群を既読状態に更新
  - 5a3. 画面表示を更新してユースケース完了

### 代替フロー3: 通知設定変更
- 3a. ユーザーが通知設定を変更したい場合
  - 3a1. 通知設定画面への遷移オプションを表示
  - 3a2. ユーザーが設定変更を選択
  - 3a3. 別ユースケース（通知設定管理）に移行

## 例外フロー
### 例外1: 通知取得エラー
- 2a. サーバーエラーや権限エラーで通知取得に失敗した場合
  - 2a1. システムがエラーメッセージを表示
  - 2a2. キャッシュされた通知があれば表示（オフライン表示）
  - 2a3. 再試行ボタンを提供

### 例外2: ネットワーク接続エラー
- *a. ネットワーク切断により通信ができない場合
  - *a1. システムがオフラインモードに移行
  - *a2. ローカルキャッシュから最新100件の通知を表示
  - *a3. 接続復旧時の自動同期設定

## 特別要件
- **性能**: 通知一覧の初期表示は200ms以内
- **可用性**: オフライン時もキャッシュ表示で基本機能を維持
- **セキュリティ**: ユーザー権限に基づく通知の表示制限

## 関連ユースケース
- **包含**: ユーザー認証確認（secure-access-service連携）
- **拡張**: UC-NOTIFY-03（通知詳細を表示し行動する）
- **汎化**: なし

## 入出力仕様

### 入力
- **ユーザー情報**: `{ userId: UUID, sessionToken: string, preferences: JSON }`
- **フィルター条件**: `{ category?: string[], priority?: string[], dateRange?: DateRange }`
- **ページング**: `{ page: number, limit: number, sortBy: string, sortOrder: string }`

### 出力
- **通知一覧**: `{ notifications: Notification[], totalCount: number, unreadCount: number }`
- **表示状態**: `{ filterActive: boolean, loadingState: string, errorState?: string }`
- **ナビゲーション**: `{ hasNext: boolean, hasPrev: boolean, nextPageToken?: string }`

## ビジネスルール
- 未読通知は既読通知より上位に表示する
- 高優先度通知は特別な視覚スタイルで強調表示する
- 30日以上経過した通知は自動的にアーカイブ対象とする
- 同種の通知が5件以上ある場合は自動グループ化して表示する
- ユーザーの通知設定に応じて表示する通知種別を制限する

## パフォーマンス最適化
- **仮想スクロール**: 大量通知の効率的表示
- **増分読み込み**: 初期表示は最新20件、スクロールで追加読み込み
- **キャッシュ戦略**: 既読通知はローカルキャッシュを優先利用
- **バックグラウンド更新**: 新着通知のリアルタイム追加表示

## アクセシビリティ考慮
- **スクリーンリーダー**: 未読数と優先度の音声アナウンス
- **キーボード操作**: 矢印キーでの通知選択、Enterで詳細表示
- **視覚表現**: 色覚障害に配慮した優先度表現（色+アイコン）

---
*このユースケース定義は新仕様v2.0に基づき、ユーザー体験重視とパラソルドメイン言語連携を適用しています*