# ユースケース: 適切な知識を推奨する

**バージョン**: 2.0.0
**更新日**: 2025-10-21
**設計方針**: 文脈マッチング・精度向上・多様性確保

## 基本情報
- **ユースケースID**: UC-APPLY-02
- **アクター**: システム（主アクター）、コンサルタント（副アクター）
- **概要**: 特定された活用文脈に基づき、AIと知識ベース分析により最適な知識セットを推奨し、活用者の選択を支援する

## 🏗️ パラソルドメイン連携

### 操作エンティティ
- **KnowledgeRecommendationEntity**（自サービス管理・状態更新: analyzing → ranked → selected）: 知識推奨結果の管理
- **RecommendationAlgorithmEntity**（自サービス管理・CRUD）: 推奨アルゴリズムの設定・調整
- **MatchingScoreEntity**（自サービス管理・CRUD）: 文脈-知識マッチングスコアの記録
- **KnowledgeEntity**（参照のみ）: 推奨対象知識の詳細情報参照
- **ApplicationContextEntity**（参照のみ）: 前ステップで特定された文脈情報

### 他サービスユースケース利用
- **secure-access-service**: UC-AUTH-02: 権限を検証する（機密知識アクセス制御）
- **knowledge-co-creation-service**: UC-CAPTURE-01: 知識を取得する（知識ベース検索）
- **project-success-service**: UC-PROJECT-06: プロジェクト知識履歴を参照する
- **collaboration-facilitation-service**: UC-COMM-02: 専門家推奨を送信する

## 事前条件
- UC-APPLY-01で活用文脈が正常に特定・構造化されている
- 知識ベースに検索対象となる知識が存在している
- ユーザーが知識アクセス権限を有している
- 推奨アルゴリズムが正常に動作可能な状態である

## 事後条件
### 成功時
- KnowledgeRecommendationEntityが「ranked」状態で保存されている
- 推奨知識リストが文脈適合度スコア付きで生成されている
- ユーザーが知識選択のための十分な情報を取得している
- 次のユースケース（知識を実際に適用する）の準備が完了している

### 失敗時
- 推奨処理が「analyzing」状態で停止している
- 推奨失敗の具体的理由が記録されている
- 代替推奨手段がユーザーに提示されている

## 基本フロー
1. **システム**が前ステップの文脈分析結果を取得する
2. **システム**が知識ベース検索クエリを生成する
3. **システム**が知識ベースから候補知識を抽出する（他サービス連携）
4. **システム**が文脈-知識マッチング分析を実行する
5. **システム**が推奨アルゴリズムにより知識をランキングする
6. **システム**が推奨結果の多様性と品質を検証する
7. **システム**が推奨知識リストを生成・表示する
8. **コンサルタント**が推奨結果を評価・フィードバックする
9. **システム**が推奨精度向上のためフィードバックを学習記録する

## 代替フロー

### 代替フロー1: 機密知識へのアクセス制御
- **分岐点**: ステップ3（候補知識抽出）
- **条件**: 機密レベルの高い知識が候補に含まれる場合
- **処理**:
  - 3a1. システムが機密知識アクセス権限を確認（他サービス連携）
  - 3a2. 権限レベルに応じて知識候補をフィルタリング
  - 3a3. アクセス可能な知識のみでランキング処理
  - 3a4. 権限不足の知識は「要申請」として別途表示

### 代替フロー2: 推奨結果不足時の拡張検索
- **分岐点**: ステップ6（品質検証）
- **条件**: 適合度の高い知識が不足している場合
- **処理**:
  - 6a1. システムが検索条件を緩和して再検索
  - 6a2. 関連分野・類似文脈の知識を追加検索
  - 6a3. 外部専門家の推奨を提案（他サービス連携）
  - 6a4. 知識作成の必要性を判定・提案

### 代替フロー3: 個人化推奨の適用
- **分岐点**: ステップ5（ランキング処理）
- **条件**: ユーザーの過去利用履歴が豊富な場合
- **処理**:
  - 5a1. システムがユーザーの知識活用履歴を分析
  - 5a2. 個人の学習スタイル・好みを推奨に反映
  - 5a3. 過去の成功パターンを優先的にランキング
  - 5a4. 新規学習機会とのバランスを調整

## 例外フロー

### 例外1: 知識ベース検索失敗
- **発生点**: ステップ3（候補知識抽出）
- **処理**:
  - 3e1. システムが知識ベースサービスとの接続障害を検知
  - 3e2. ローカルキャッシュからの候補知識検索を試行
  - 3e3. 手動知識検索オプションをユーザーに提示
  - 3e4. ナレッジマネージャーに手動推奨を依頼

### 例外2: マッチング分析処理エラー
- **発生点**: ステップ4（マッチング分析）
- **処理**:
  - 4e1. AIマッチングエンジンの処理エラーを検知
  - 4e2. 簡易版マッチング（キーワードベース）に切り替え
  - 4e3. 推奨精度低下の警告をユーザーに表示
  - 4e4. 技術者に分析エンジン復旧を要請

### 例外3: 推奨結果ゼロ
- **発生点**: ステップ6（品質検証）
- **処理**:
  - 6e1. 適合する知識が一件も見つからない状況を検知
  - 6e2. 文脈情報の見直し・修正を提案
  - 6e3. 類似文脈での成功事例を参考として提示
  - 6e4. 新規知識作成の必要性をナレッジマネージャーに通知

## 特別要件

### 推奨品質要件
- **適合精度**: 文脈適合度80%以上の知識を上位3位内に表示
- **多様性確保**: 異なるアプローチの知識を含む推奨リスト
- **新鮮性**: 更新日から90日以内の知識を優先的に推奨
- **実績考慮**: 過去の活用成功率を推奨スコアに反映

### パフォーマンス要件
- **検索速度**: 知識ベース検索5秒以内
- **分析処理**: マッチング分析10秒以内
- **表示応答**: 推奨結果画面表示3秒以内
- **同時処理**: 20ユーザーの同時推奨処理対応

### セキュリティ要件
- **アクセス制御**: 機密レベル別の知識アクセス管理
- **利用履歴**: 知識アクセス・推奨履歴の詳細記録
- **データ保護**: 推奨アルゴリズムの機密性保護
- **監査ログ**: 推奨プロセスの完全な追跡可能性

## 入出力仕様

### 入力（前ステップからの引継ぎ）
```json
{
  "contextData": {
    "contextId": "UUID",
    "structuredContext": {
      "problemStatement": "構造化された課題定義",
      "goalClarification": "明確化された目標",
      "constraintAnalysis": "制約分析結果",
      "knowledgeRequirements": {
        "preferredTypes": ["procedure", "template"],
        "complexityLevel": "intermediate",
        "applicationScope": "team"
      }
    }
  },
  "userProfile": {
    "userId": "UUID",
    "skillLevel": "intermediate",
    "domain": "consulting",
    "previousSuccesses": ["knowledge_id_1", "knowledge_id_2"]
  }
}
```

### 出力（API → フロントエンド）
```json
{
  "result": "success|insufficient_matches|search_failed",
  "recommendationData": {
    "recommendationId": "UUID",
    "status": "ranked",
    "totalMatches": 15,
    "displayedMatches": 8,
    "recommendations": [
      {
        "knowledgeId": "UUID",
        "title": "プロジェクト課題解決手法",
        "matchingScore": 0.92,
        "confidenceLevel": "high",
        "knowledgeType": "procedure",
        "complexity": "intermediate",
        "estimatedTimeToApply": "2-3 hours",
        "successRate": 0.85,
        "lastUpdated": "2024-09-15",
        "accessLevel": "public",
        "summary": "類似プロジェクトでの課題解決実績",
        "keyTags": ["問題解決", "チーム協働", "デッドライン管理"]
      }
    ]
  },
  "alternativeOptions": {
    "expertConsultation": true,
    "knowledgeCreationSuggestion": false,
    "relatedTraining": ["project_management_basics"]
  },
  "feedback": {
    "requestId": "UUID",
    "feedbackUrl": "/api/knowledge/recommendations/feedback"
  }
}
```

### 推奨品質メトリクス
```json
{
  "qualityMetrics": {
    "averageMatchingScore": 0.78,
    "diversityIndex": 0.65,
    "freshnessScore": 0.82,
    "personalizedRelevance": 0.89,
    "algorithmConfidence": "high"
  },
  "improvementSuggestions": [
    "より具体的な文脈情報の入力で精度向上可能",
    "過去の活用履歴蓄積により個人化推奨が向上"
  ]
}
```

## 推奨アルゴリズム仕様

### マッチングスコア算出
```
総合スコア =
  (文脈適合度 × 0.4) +
  (実績信頼度 × 0.25) +
  (新鮮性 × 0.15) +
  (個人化適合度 × 0.20)

文脈適合度: 課題・目標・制約との意味的類似度
実績信頼度: 過去の活用成功率と評価
新鮮性: 知識の更新日からの経過時間逆算
個人化適合度: ユーザー履歴との適合性
```

### 多様性確保ロジック
- **知識タイプ多様性**: 手順・事例・原則を組み合わせ
- **アプローチ多様性**: 異なる解決手法を含める
- **難易度多様性**: 簡単・標準・高度を混在
- **時間軸多様性**: 短期・中期・長期解決策を含める

## 関連ユースケース
- **UC-APPLY-01**: 活用文脈を特定する（前のステップ）
- **UC-APPLY-03**: 知識を実際に適用する（次のステップ）
- **UC-CAPTURE-02**: 知識を評価する（推奨精度向上のため）
- **UC-SHARE-02**: 推奨結果を共有する（チーム学習のため）

---
*このユースケースは、高精度な知識マッチングにより効果的な学習と課題解決を支援し、パラソル設計v2.0仕様に基づく知識活用の中核機能を実現しています*