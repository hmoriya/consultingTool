# ユースケース: プロジェクト別収益性トレンドを比較する

## 基本情報
- **ユースケースID**: UC-RPO-002
- **アクター**: 財務マネージャー、エグゼクティブ、PM
- **概要**: 複数プロジェクトの収益性トレンドを並列表示し、相対的なパフォーマンスを比較する

## 事前条件
- 比較対象の複数プロジェクトが存在する
- 各プロジェクトに最低6ヶ月分の収益性データが存在する
- 財務マネージャーまたはエグゼクティブとしてログインしている

## 事後条件
### 成功時
- 複数プロジェクトのトレンドが並列表示される
- 相対ランキング（高収益→低収益）が明確になる
- 各プロジェクトの特徴（安定性、成長性）が分析される
- 比較レポートが生成される

### 失敗時
- データ不整合の場合、エラーメッセージが表示される
- プロジェクト選択が不適切な場合、警告が表示される

## 基本フロー
1. 財務マネージャーが比較対象プロジェクト（2〜10件）を選択する
2. システムが共通比較期間を判定する
3. システムが各プロジェクトの収益性データを収集する
4. システムが統一スケールでトレンドグラフを生成する
5. システムが各プロジェクトの平均収益率を計算する
6. システムが収益率ランキングを作成する
7. システムが各プロジェクトの変動率（標準偏差）を算出する
8. システムが安定性スコア（変動率の逆数）を計算する
9. システムが成長性（直近3ヶ月の傾き）を算出する
10. システムが4象限マトリクス（高収益×安定 vs 低収益×不安定）を生成する
11. システムが比較レポートを表示する
12. 財務マネージャーがレポートを確認し、エクスポートまたは共有する

## 代替フロー
### 代替フロー1: カテゴリ別フィルタリング
- 1a. 財務マネージャーがプロジェクトカテゴリ（クライアント種別、業種、規模）でフィルタリングする
  - 1a1. システムが該当プロジェクトを抽出する
  - 1a2. 基本フロー2に戻る

### 代替フロー2: 時系列アニメーション
- 11a. 財務マネージャーが時系列アニメーションを要求する
  - 11a1. システムが月次推移をアニメーションで再生する
  - 11a2. システムがランキング変動を可視化する
  - 11a3. 基本フロー12に進む

### 代替フロー3: 詳細ドリルダウン
- 11a. 財務マネージャーが特定プロジェクトの詳細を確認する
  - 11a1. システムがそのプロジェクトの詳細トレンド分析画面を表示する
  - 11a2. 財務マネージャーが詳細を確認後、比較画面に戻る
  - 11a3. 基本フロー12に進む

## 例外フロー
### 例外1: データ期間の不一致
- 2a. プロジェクト間でデータ期間が大きく異なる場合
  - 2a1. システムが共通期間を表示する
  - 2a2. システムが「共通期間のみで比較」または「プロジェクト選択変更」の選択肢を提示する
  - 2a3. 財務マネージャーが選択を行う
  - 2a4. 選択に応じて処理を続行、または基本フロー1に戻る

### 例外2: プロジェクト数が多すぎる
- 1a. 11件以上のプロジェクトが選択された場合
  - 1a1. システムが警告メッセージを表示する
  - 1a2. システムが「上位10件のみ表示」または「プロジェクト再選択」を提案する
  - 1a3. 財務マネージャーが選択を行う

### 例外3: データ品質の問題
- 3a. 一部プロジェクトのデータが不完全な場合
  - 3a1. システムが該当プロジェクトをリスト表示する
  - 3a2. システムが「不完全データを除外」または「警告付きで継続」の選択肢を提示する
  - 3a3. 財務マネージャーが選択を行う

## 特別要件
- **性能**: 10プロジェクトの比較分析は15秒以内に完了する
- **可視化**: グラフはインタラクティブに操作可能である
- **エクスポート**: CSV、PDF形式でレポートをエクスポートできる

## 関連ユースケース
- **包含**: 月次収益性トレンドを分析する
- **拡張**: 収益性変動要因を特定する
