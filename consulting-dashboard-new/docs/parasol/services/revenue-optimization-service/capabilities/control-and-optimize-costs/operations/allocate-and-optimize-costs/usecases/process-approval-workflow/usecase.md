# ユースケース: 承認ワークフローを処理する

## 基本情報
- **ユースケースID**: UC-COST-03
- **アクター**: 承認者、財務マネージャー、部門長
- **概要**: 実行されたコスト配分に対する段階的承認プロセスを実施し、組織ガバナンスと品質保証を確保する

## 事前条件
- UC-COST-02（インテリジェント配分実行）が完了している
- CostAllocationEntity（allocated状態）が存在する
- 承認者が適切な承認権限を有している
- ApprovalWorkflowEntity（承認フロー定義）が設定されている

## 事後条件
### 成功時
- コスト配分の承認判断が完了している
- CostAllocationEntity（状態変更: allocated → optimized）
- 承認記録が完全に保存されている
- 関係者への承認結果通知が配信されている

### 失敗時
- 承認プロセスのエラーが記録されている
- CostAllocationEntity（状態: allocated）が維持されている
- エラー内容が関係者に通知されている

## 基本フロー
1. **システムが承認ワークフローを開始する**
   - CostAllocationEntity（状態確認: allocated）
   - ApprovalWorkflowEntity（承認フロー設定）
   - 承認者への通知配信準備

2. **承認依頼を配信・承認者を招集する**
   - → UC-COMM-02: 承認依頼を送信する
   - 段階的承認フローの開始（金額別承認権限適用）
   - 承認期限設定・管理開始

3. **承認者が配分内容を審査・判断する**
   - 配分結果の詳細確認・妥当性評価
   - 戦略整合性・精度基準の再確認
   - リスク評価・組織影響度分析

4. **承認判断を記録・次ステップ準備する**
   - ApprovalWorkflowEntity（承認記録・理由記載）
   - CostAllocationEntity（状態変更: allocated → optimized）
   - → UC-AUTH-03: 承認操作ログを記録する

5. **承認完了を通知・監視ステップ準備する**
   - → UC-COMM-01: 承認完了通知を配信する
   - 次ステップ（最適化結果監視）への準備
   - 承認履歴・監査データの保存

## 代替フロー
### 代替フロー1: 段階的承認プロセス
- 3a. 高額配分案（閾値超過）の場合
  - 3a1. 部門長 → 役員 → 取締役会の順次承認
  - 3a2. 各段階での詳細記録・理由明記
  - 3a3. 最終段階完了で基本フロー4へ

### 代替フロー2: 緊急承認プロセス
- 1a. 緊急性が高いコスト配分の場合
  - 1a1. → UC-COMM-03: 緊急承認会議を調整する
  - 1a2. 短縮承認フロー適用（24時間以内）
  - 1a3. 条件付き承認の実施
  - 1a4. 事後詳細監視の強化

## 例外フロー
### 例外1: 承認権限不足・権限競合
- *a. 承認権限が不足または競合している場合
  - *a1. → UC-AUTH-02: 上位承認権限者を特定する
  - *a2. 権限昇格または権限調整プロセス
  - *a3. 権限確定後、基本フロー1から再開

### 例外2: 承認却下・差し戻し処理
- *b. 承認が却下された場合
  - *b1. 却下理由の詳細記録・分析・改善提案
  - *b2. → UC-COMM-02: 修正指示を送信する
  - *b3. CostAllocationEntity（状態変更: allocated → draft）へ差し戻し
  - *b4. UC-COST-01（配分戦略見直し）への復帰

### 例外3: 承認プロセス期限超過
- *c. 承認期限を超過した場合
  - *c1. 自動エスカレーション・上位承認者への通知
  - *c2. → UC-COMM-01: 期限超過アラートを配信する
  - *c3. 緊急承認プロセスへの自動移行
  - *c4. 期限延長または暫定承認の検討

## 特別要件
- **性能**: 承認判断プロセス完了時間48時間以内（通常）、24時間以内（緊急）
- **可用性**: 承認システム稼働率99.9%以上
- **セキュリティ**: 承認操作の完全監査ログ、デジタル署名対応
- **精度**: 承認判断の適切性95%以上（事後評価）
- **透明性**: 承認理由・プロセスの完全可視化

## 関連ユースケース
- **包含**: UC-AUTH-01〜03, UC-COMM-01〜03
- **拡張**: UC-COST-04（最適化結果監視）
- **前提**: UC-COST-02（インテリジェント配分実行）完了必須

---
*このユースケースは パラソル設計v2.0仕様 に基づいて作成されました*