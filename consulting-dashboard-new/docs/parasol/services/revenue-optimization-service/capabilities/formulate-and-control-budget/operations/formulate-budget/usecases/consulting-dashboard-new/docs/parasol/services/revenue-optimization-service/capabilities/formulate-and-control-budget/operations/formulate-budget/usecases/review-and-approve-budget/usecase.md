# ユースケース: 予算を審査し承認する

## 基本情報
- **ユースケースID**: UC-BUDGET-02
- **アクター**: エグゼクティブ、財務マネージャー、部門長、承認委員会
- **概要**: 提出された予算案を多角的に審査し、組織価値最大化の観点から適切な承認判断を実施する

## 事前条件
- 予算案が正式に提出されている（BudgetEntity: submitted状態）
- 審査者が適切な承認権限を有している
- 予算精度が基準（95%）を満たしている
- 戦略整合性評価が完了している

## 事後条件
### 成功時
- 予算案の承認/却下が確定している
- BudgetEntity（状態: submitted → approved/rejected）に変更
- 承認記録が完全に記録されている
- 関係者への結果通知が配信されている
- 承認時: 予算執行準備が開始されている

### 失敗時
- 審査プロセスのエラーが記録されている
- BudgetEntity（状態: submitted）が維持されている
- エラー内容が関係者に通知されている

## 基本フロー
1. **承認者が予算審査プロセスを開始する**
   - → UC-AUTH-01: ユーザー認証を実行する
   - → UC-AUTH-02: 承認権限レベルを検証する
   - ApprovalWorkflowEntity（審査開始記録）

2. **システムが予算案の総合評価を実行する**
   - BudgetOptimizationService による精度再検証
   - StrategicAlignmentService による戦略整合度確認
   - 前年度実績・類似案件との比較分析
   - リスク評価・財務影響度分析

3. **承認者が多角的審査を実施する**
   - 戦略整合性の詳細確認（目標4.5/5.0以上）
   - 予算精度・実現可能性の評価
   - リソース配分の妥当性確認
   - ROI・価値創造ポテンシャルの検証

4. **必要に応じて協議・調整を実施する**
   - → UC-COMM-03: 承認委員会会議を調整する
   - 複数承認者間での意見調整
   - 専門家意見の収集・反映

5. **最終承認判断を実行する**
   - BudgetEntity（状態変更: submitted → approved/rejected）
   - ApprovalWorkflowEntity（承認記録・理由記載）
   - → UC-AUTH-03: 承認操作ログを記録する
   - → UC-COMM-01: 承認結果通知を配信する

## 代替フロー
### 代替フロー1: 条件付き承認プロセス
- 3a. 軽微な修正が必要な場合
  - 3a1. 条件付き承認の判断・条件明記
  - 3a2. BudgetEntity（状態: conditional_approved）
  - 3a3. → UC-COMM-02: 修正依頼を送信する
  - 3a4. 修正完了後、基本フロー5（最終承認）に戻る

### 代替フロー2: 緊急承認プロセス
- 1a. 緊急性が高い予算案の場合
  - 1a1. 短縮審査フロー適用（24時間以内）
  - 1a2. → UC-COMM-03: 緊急承認会議を調整する
  - 1a3. 必須審査項目のみ実施
  - 1a4. 事後詳細審査の設定

### 代替フロー3: 複数段階承認プロセス
- 4a. 高額予算案（閾値超過）の場合
  - 4a1. 段階的承認フローの自動適用
  - 4a2. 部門長 → 役員 → 取締役会の順次承認
  - 4a3. 各段階での詳細記録・理由明記
  - 4a4. 最終段階完了で基本フロー5へ

## 例外フロー
### 例外1: 承認権限不足・権限競合
- *a. 承認権限が不足または競合している場合
  - *a1. → UC-AUTH-02: 上位承認権限者を特定する
  - *a2. 権限昇格または権限調整プロセス
  - *a3. 権限確定後、基本フロー1から再開

### 例外2: 予算案重大欠陥発見
- *b. 審査中に重大な問題が発見された場合
  - *b1. 審査プロセス即座中断・問題記録
  - *b2. → UC-COMM-02: 緊急修正要求を送信する
  - *b3. BudgetEntity（状態: submitted → revision_required）
  - *b4. 問題解決後、基本フロー1から再開

### 例外3: 戦略変更による審査基準変更
- *c. 審査中に組織戦略が変更された場合
  - *c1. 新戦略に基づく審査基準の再設定
  - *c2. StrategicAlignmentService による再評価
  - *c3. → UC-COMM-03: 戦略変更対応会議を調整する
  - *c4. 新基準での審査再開

### 例外4: 承認プロセス期限超過
- *d. 承認期限を超過した場合
  - *d1. 自動エスカレーション・上位承認者への通知
  - *d2. → UC-COMM-01: 期限超過アラートを配信する
  - *d3. 緊急承認プロセスへの自動移行
  - *d4. 期限延長または暫定承認の検討

## 特別要件
- **性能**: 承認判断プロセス完了時間48時間以内（通常）、24時間以内（緊急）
- **可用性**: 承認システム稼働率99.9%以上
- **セキュリティ**: 承認操作の完全監査ログ、デジタル署名対応
- **精度**: 承認判断の適切性95%以上（事後評価）
- **透明性**: 承認理由・プロセスの完全可視化

## 関連ユースケース
- **包含**: UC-AUTH-01〜03, UC-COMM-01〜03
- **拡張**: UC-BUDGET-01（予算案作成）からの継続
- **汎化**: 承認プロセス全般のパターン
- **前提**: UC-BUDGET-01完了が必須

---
*このユースケースは パラソル設計v2.0仕様 に基づいて作成されました*