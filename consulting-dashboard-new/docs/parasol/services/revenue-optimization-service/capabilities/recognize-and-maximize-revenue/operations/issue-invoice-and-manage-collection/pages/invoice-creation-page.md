# ページ定義: 請求書作成ページ

## 画面の目的
収益データと契約情報を基に正確な請求書を作成し、承認プロセスを経て確実な請求処理を実現する。

## 利用者
- **財務マネージャー**: 請求書作成・承認・品質管理・発行処理
- **PM**: 請求根拠資料提供・内容確認・承認申請
- **経理担当**: 請求データ入力・計算確認・書類準備

## 画面構成

### ヘッダー部
- **ページタイトル**: 「請求書作成」
- **請求対象期間**: 請求対象の期間選択・月次・プロジェクト単位
- **テンプレート選択**: 標準・工数精算・マイルストーン・カスタム
- **一括作成**: 複数クライアント・プロジェクトの一括処理

### メインコンテンツ部

#### 1. 請求情報入力（上部）
- **基本情報**: 請求書番号・請求日・支払期限・担当者
- **請求先**: クライアント・部署・住所・担当者・支払条件
- **請求内容**: プロジェクト・サービス・期間・単価・数量
- **金額計算**: 小計・税額・割引・合計・支払方法

#### 2. 根拠データパネル（左サイド）
- **収益データ**: 認識済み収益・請求対象額・未請求残高
- **契約情報**: 契約条件・支払条件・特記事項・変更履歴
- **作業実績**: 工数・成果物・進捗・品質・承認状況
- **前回請求**: 前回請求額・入金状況・残高・調整事項

#### 3. 計算・検証パネル（右サイド）
- **自動計算**: 税込・税抜・消費税・源泉税・手数料の自動計算
- **整合性チェック**: 契約額・累計請求・残額・上限の整合性確認
- **承認状況**: PM承認・財務承認・クライアント確認の状況
- **警告・注意**: 金額乖離・期限・条件・リスクの警告表示

### 詳細設定エリア（下部）

#### 4. 明細管理
- **明細行**: 項目・説明・数量・単価・金額・税区分
- **集計・分類**: カテゴリ別・期間別・担当者別の集計・分析
- **調整項目**: 割引・追加費用・前受金・調整・備考
- **添付資料**: 作業報告書・納品書・証憑・承認書類

#### 5. 承認・品質管理
- **承認フロー**: PM→財務→エグゼクティブの段階承認
- **品質チェック**: 金額・税額・条件・形式・整合性の確認
- **承認履歴**: 承認・差戻し・修正・再承認の完全履歴
- **コメント**: 承認者コメント・修正指示・確認事項

## データ表示

### 表示データ一覧
| データ項目 | 表示形式 | 計算方法 | 説明 |
|-----------|---------|---------|------|
| 請求金額 | 通貨表示 | 明細合計+税 | 最終的な請求総額 |
| 税額 | 通貨表示 | 税率×課税対象額 | 消費税・源泉税等 |
| 支払期限 | 日付 | 請求日+支払条件 | 入金予定日 |
| 承認状況 | ステータス | ワークフロー | 承認プロセスの進捗 |

### 請求データ管理
- **請求履歴**: 過去の請求・金額・期限・入金・調整の完全履歴
- **テンプレート**: クライアント・契約別の標準テンプレート・書式
- **承認設定**: 金額・重要度による承認ルート・権限設定
- **品質基準**: 請求書品質・精度・完成度の評価基準

## アクション・操作

### 主要作成アクション
- **新規作成**: テンプレート・前回請求を基にした新規請求書作成
- **自動生成**: 収益データ・契約情報からの自動請求書生成
- **複製作成**: 既存請求書を基にした類似請求書の複製・修正
- **一括作成**: 複数クライアント・期間の請求書一括作成

### 編集・修正アクション
- **明細編集**: 項目追加・削除・修正・並び替え・計算確認
- **金額調整**: 割引・追加・調整・四捨五入・税額調整
- **書式設定**: レイアウト・ロゴ・文言・言語・通貨の設定
- **添付管理**: 証憑・資料・説明書の添付・削除・更新

### 承認・提出アクション
- **承認申請**: 完成した請求書の承認申請・コメント・期限設定
- **差戻し対応**: 承認差戻し時の修正・再申請・履歴管理
- **最終確認**: 承認完了後の最終確認・品質チェック・提出準備
- **発行準備**: 承認済み請求書の発行準備・送付準備・システム連携

## 画面の振る舞い

### 動的作成支援
- **リアルタイム計算**: 金額・税額・合計の即座自動計算・更新
- **自動補完**: クライアント・契約・項目情報の自動補完・候補表示
- **整合性チェック**: 入力内容の整合性・妥当性・完全性の自動確認
- **テンプレート適用**: 選択テンプレートの自動適用・カスタマイズ

### 品質保証機能
- **入力検証**: 必須項目・形式・範囲・整合性の自動検証・警告
- **重複チェック**: 同一期間・同一内容の重複請求防止・警告
- **承認制御**: 承認状況に応じた編集権限・表示内容の動的制御
- **監査証跡**: 作成・編集・承認・発行の完全な履歴記録・管理

## 画面遷移

### 遷移元画面
- **収益管理**: 認識済み収益から請求書作成への展開
- **プロジェクト管理**: プロジェクト完了・マイルストーンから請求
- **契約管理**: 契約条件・支払条件から請求書作成

### 遷移先画面
- **請求書送付**: 作成済み請求書の送付・配信・確認
- **承認管理**: 承認待ち・承認済み請求書の管理・追跡
- **請求履歴**: 作成した請求書の履歴・状況・分析
- **入金管理**: 請求書発行後の入金予定・確認・管理

## エラーハンドリング
- **データ不整合**: 収益・契約・金額データの不整合・修正要求・確認
- **計算エラー**: 税額・合計・端数処理エラーの検知・修正・再計算
- **承認エラー**: 承認権限・期限・条件エラーの処理・代替承認
- **システムエラー**: 保存・計算・連携エラーの復旧・データ保護

## アクセシビリティ要件
- **データ入力支援**: 金額・日付入力の音声認識・キーボード・自動補完
- **計算結果確認**: 税額・合計の音声読み上げ・拡大表示・確認
- **承認操作**: 承認・差戻し・コメントの簡易操作・代替手段
- **書式確認**: 請求書レイアウト・内容の音声説明・構造化表示

## レスポンシブ対応
- **デスクトップ**: 全機能・詳細入力・複雑計算・高精度編集
- **タブレット**: 主要機能・基本入力・計算確認・タッチ最適化
- **モバイル**: 簡易作成・確認・承認・外出先対応専用