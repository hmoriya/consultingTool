# ページ定義: MFA設定開始ページ

**バージョン**: 2.0.0
**更新日**: 2025-10-21
**設計方針**: セキュリティ強化・段階的導入・利便性両立

## 画面の目的
ユーザーが多要素認証（MFA）を安全かつ直感的に設定できる環境を提供し、セキュリティ教育と実践的な設定手順を統合して、確実なMFA導入を実現する。

## 利用者
- **主要利用者**: MFAを初めて設定するユーザー（全ユーザー対象）
- **副次利用者**: MFA再設定が必要なユーザー、セキュリティ意識向上を目指すユーザー

## 画面構成

### 🔐 セキュリティ教育セクション（ページ上部）

#### MFAの重要性説明
- **セキュリティ強化効果**:
  - 📊 「MFA有効化で99.9%のアカウント侵害を防止」
  - 🛡️ 「パスワード流出時も安全を確保」
  - 💼 「企業データ保護の必須要件」

- **具体的メリット表示**:
  - ✅ 不正ログイン防止
  - ✅ 個人情報保護強化
  - ✅ 組織セキュリティ貢献
  - ✅ コンプライアンス要件対応

#### 設定所要時間と手順概要
- **設定時間**: 「約5-10分で完了」
- **必要なもの**: 「スマートフォンまたは認証アプリ」
- **手順概要**: 「QRコード → 認証コード → バックアップコード → 完了」

---

### 📱 ステップ1: 認証アプリ準備セクション

#### 推奨認証アプリ表示
- **Google Authenticator**:
  - iOS: App Store リンク
  - Android: Google Play リンク
  - 説明: 「最も一般的で信頼性の高いアプリ」

- **Microsoft Authenticator**:
  - iOS: App Store リンク
  - Android: Google Play リンク
  - 説明: 「Microsoft製品との統合に優れる」

- **Authy**:
  - iOS: App Store リンク
  - Android: Google Play リンク
  - 説明: 「マルチデバイス同期対応」

#### アプリインストール確認
- **確認チェックボックス**: 「認証アプリをインストールしました」
- **ヘルプリンク**: 「認証アプリの使い方ガイド」

---

### 🔄 ステップ2: QRコード設定セクション

#### QRコード表示エリア
- **メインQRコード**:
  - サイズ: 250px × 250px
  - 説明: 「認証アプリでこのQRコードをスキャンしてください」
  - 更新ボタン: 「QRコードを再生成」

#### 代替設定方法
- **テキスト入力オプション**:
  - 展開ボタン: 「QRコードが読み取れない場合」
  - 秘密鍵表示: モノスペースフォント、コピーボタン付き
  - 手順説明: 「認証アプリに手動で入力してください」

#### 設定手順ガイド
- **ステップバイステップ**:
  1. 「認証アプリを開く」
  2. 「+ または『アカウントを追加』をタップ」
  3. 「QRコードをスキャンする」
  4. 「スキャン完了後、次へ進む」

---

### 🔢 ステップ3: 認証コード入力セクション

#### コード入力フィールド
- **6桁コード入力**:
  - フィールド形式: 6個の個別入力ボックス
  - 自動フォーカス移動
  - 数字のみ入力許可
  - プレースホルダー: 「123456」

#### リアルタイム検証
- **入力時フィードバック**:
  - 入力完了時: 自動検証開始
  - 検証中: ローディングインジケーター
  - 成功時: ✅ 緑色確認マーク
  - 失敗時: ❌ 赤色エラー表示

#### コード更新ガイド
- **新しいコード取得**:
  - 説明: 「認証アプリで新しいコードが表示されるまで30秒お待ちください」
  - カウントダウン表示: 「新しいコード生成まで残り: 23秒」

---

### 🔐 ステップ4: バックアップコード保存セクション

#### バックアップコード表示
- **10個のコード表示**:
  - 2列5行レイアウト
  - 各コード: 16文字のランダム文字列
  - フォント: モノスペース

#### 保存方法ガイド
- **推奨保存方法**:
  - 📝 「手書きでメモに記録」
  - 💾 「パスワードマネージャーに保存」
  - 📄 「印刷して金庫に保管」
  - ❌ 「スクリーンショットやデジタルファイルは避ける」

#### 一括操作ボタン
- **コピーボタン**: 「全バックアップコードをコピー」
- **印刷ボタン**: 「バックアップコード印刷」
- **ダウンロードボタン**: 「テキストファイルとしてダウンロード」

---

### ✅ ステップ5: 設定完了確認セクション

#### 完了確認チェックリスト
- **必須確認項目**:
  - ☑️ 「認証アプリでコードが正常に生成されることを確認しました」
  - ☑️ 「バックアップコードを安全な場所に保存しました」
  - ☑️ 「次回ログイン時からMFAが必要になることを理解しました」

#### 設定完了ボタン
- **メインアクション**: 「MFA設定を完了する」
- **色**: 成功時の緑色
- **有効化条件**: 全チェックボックスが選択済み

## データ表示

### 表示データ一覧
| データ項目 | 表示形式 | 更新頻度 | 説明 |
|-----------|---------|---------|------|
| QRコード | 画像 | 一回限り | TOTP秘密鍵のQRコード表現 |
| 秘密鍵文字列 | テキスト | 一回限り | 手動入力用の秘密鍵 |
| バックアップコード | リスト | 一回限り | 10個の緊急時コード |
| 認証コード検証結果 | ステータス | リアルタイム | 入力コードの検証状況 |

## 入力項目

### フォーム一覧
| 入力項目 | 入力形式 | 必須 | バリデーション | 説明 |
|---------|---------|------|---------------|------|
| 認証コード | 6桁数字 | ○ | 数字のみ、6桁固定 | TOTPコード入力 |
| アプリインストール確認 | チェックボックス | ○ | 選択必須 | 事前準備確認 |
| バックアップコード保存確認 | チェックボックス | ○ | 選択必須 | 保存完了確認 |
| 設定理解確認 | チェックボックス | ○ | 選択必須 | MFA理解確認 |

## アクション・操作

### 主要アクション
- **QRコード再生成**:
  - トリガー: 再生成ボタンクリック
  - 処理: 新しい秘密鍵とQRコード生成
  - 結果: 画面更新、古い秘密鍵の無効化

- **認証コード検証**:
  - トリガー: 6桁入力完了
  - 処理: TOTP検証、結果表示
  - 成功時: 次ステップ有効化
  - 失敗時: エラーメッセージ、再入力促進

- **MFA設定完了**:
  - トリガー: 完了ボタンクリック
  - 処理: MFA有効化、通知送信
  - 結果: 完了画面遷移

### 副次アクション
- **バックアップコードコピー**: クリップボードにコピー
- **印刷**: バックアップコードの印刷ダイアログ
- **ヘルプ表示**: 各ステップのヘルプコンテンツ

## 画面の振る舞い

### ユーザー操作への反応
- **ステップ進行**: 各ステップ完了時に次のステップが有効化
- **リアルタイム検証**: 認証コード入力時の即座検証
- **プログレス表示**: 設定進行状況の視覚的更新
- **エラーハンドリング**: 分かりやすいエラーメッセージと復旧ガイド

### 条件による表示変更
- **認証アプリ未インストール**: アプリストアリンクの強調表示
- **QRコード読み取り失敗**: 手動入力オプションの自動展開
- **コード検証失敗**: 再試行案内と残り試行回数表示
- **設定完了**: 成功アニメーションと次の手順案内

## 画面遷移

### 遷移元画面
- **セキュリティ設定ページ**: MFA有効化メニュー
- **ダッシュボード**: セキュリティ強化推奨バナー
- **初回ログイン**: セキュリティ設定推奨フロー

### 遷移先画面
- **設定完了ページ**: MFA設定成功時
- **ダッシュボード**: 設定完了後の通常画面
- **ログイン画面**: 設定完了後の再認証（オプション）

## エラーハンドリング

### エラー表示方法
- **認証コード不正**: 「コードが正しくありません。認証アプリで新しいコードを確認してください」
- **QRコード生成失敗**: 「QRコード生成に失敗しました。ページを更新して再試行してください」
- **バックアップコード生成失敗**: 「一時的な問題が発生しました。しばらく後に再試行してください」
- **ネットワークエラー**: 「接続に問題があります。インターネット接続を確認してください」

### 復旧・対処機能
- **自動リトライ**: 一時的なエラーの自動再試行
- **代替手段**: QRコード読み取り不可時の手動入力
- **サポート連絡**: 解決困難時の管理者連絡手段

## アクセシビリティ要件

### キーボードナビゲーション
- タブ順序: ステップ順の論理的ナビゲーション
- ショートカット: Enter キーでの次ステップ進行

### スクリーンリーダー対応
- QRコード代替テキスト: 「MFA設定用QRコード、手動入力オプションも利用可能」
- ステップ進行の音声案内: 「ステップ2/5、認証コード入力に進みました」
- エラー内容の明確な読み上げ

### 色覚障害への配慮
- 成功・エラー表示: 色だけでなくアイコンと文字で表現
- 高コントラスト表示オプション
- カスタマイズ可能な色設定

## レスポンシブ対応

### デスクトップ（1024px以上）
- 2カラムレイアウト: 手順説明（左）+ 実行エリア（右）
- QRコード: 大サイズ表示（250px）

### タブレット（768px-1023px）
- 1カラム縦積み: ステップ順の縦配置
- QRコード: 中サイズ表示（200px）

### モバイル（767px以下）
- フルスクリーン活用: 余白最小化
- QRコード: 小サイズ表示（150px）
- ステップ切り替え: タブ形式の横スワイプ

## セキュリティ配慮

### データ保護
- 秘密鍵の一時表示: 設定完了後の自動クリア
- バックアップコードの暗号化保存
- ページ離脱時の確認ダイアログ

### ユーザー教育
- セキュリティベストプラクティスの表示
- バックアップコード保管方法の詳細ガイド
- MFAの重要性とリスクの明確な説明

---
*このページ定義は、UC-MFA-01「MFAを有効化する」と1対1対応し、セキュリティと利便性を両立した直感的なMFA設定体験を実現しています*