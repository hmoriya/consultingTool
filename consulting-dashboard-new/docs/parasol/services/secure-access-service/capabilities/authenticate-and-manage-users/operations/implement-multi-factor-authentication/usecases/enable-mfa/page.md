# ページ定義: MFA設定・有効化ページ

**バージョン**: 2.0.0
**更新日**: 2025-10-20
**対応ユースケース**: UC-MFA-01（MFAを有効化する）

## 画面の目的
ユーザーが多要素認証（MFA）を安全かつ簡単に設定し、アカウントセキュリティを強化できる包括的なMFA有効化環境を提供する。

## 利用者
- **一般ユーザー**: 自発的なセキュリティ強化を希望するユーザー
- **重要ロールユーザー**: 管理者・財務担当等のMFA必須ユーザー
- **セキュリティ管理者**: 組織全体のMFA導入を推進する管理者
- **システム管理者**: ユーザーのMFA設定支援を行う管理者

## 画面構成

### ヘッダー部
- 画面タイトル: 「多要素認証（MFA）設定」
- 設定進捗インジケーター: 準備→登録→検証→完了の4段階表示
- セキュリティレベル表示: 現在（低）→ 設定後（高）の視覚的比較
- ヘルプボタン: MFAに関する詳細説明・FAQ

### MFA概要・説明セクション
- **MFAとは**: 多要素認証の仕組みと効果の分かりやすい説明
- **セキュリティ効果**: 不正アクセス防止効果（99%以上リスク削減）の表示
- **必要なもの**: スマートフォン・認証アプリ等の準備物リスト
- **設定時間**: 約5分で完了することの案内

### デバイス準備セクション
- **対応デバイス確認**: スマートフォン・タブレットの対応状況確認
- **認証アプリ案内**: Google Authenticator、Microsoft Authenticator等の推奨アプリ
- **アプリインストール**: アプリストアへの直接リンク提供
- **準備完了確認**: 必要な準備が整ったことの確認チェックボックス

### MFA登録セクション
- **秘密鍵生成**: 「秘密鍵を生成」ボタンと生成状況表示
- **QRコード表示エリア**: 大きく見やすいQRコード表示
- **手動入力オプション**: QRコードスキャンできない場合の英数字コード表示
- **スキャン手順**: ステップバイステップのスキャン手順ガイド

### 動作確認セクション
- **テストコード入力**: 認証アプリからの6桁コード入力フィールド
- **検証実行**: 「動作確認」ボタンと結果表示
- **成功・失敗表示**: 検証結果の明確な視覚的フィードバック
- **再試行機能**: 失敗時の再入力・再設定オプション

### バックアップコード生成セクション
- **重要性説明**: バックアップコードの重要性と用途の説明
- **コード生成**: 10個のバックアップコード自動生成・表示
- **安全保存案内**: 印刷・安全な場所への保管手順
- **保存確認**: バックアップコードを安全に保存したことの確認

### 設定完了セクション
- **完了メッセージ**: MFA有効化成功の明確な通知
- **次回ログイン案内**: 次回ログイン時のMFA認証フローの説明
- **設定内容確認**: 有効化されたMFA設定の詳細表示
- **追加セキュリティ案内**: その他のセキュリティ強化オプション提案

## データ表示

### 表示データ一覧
| データ項目 | 表示形式 | 更新頻度 | 説明 |
|-----------|---------|---------|------|
| 現在のセキュリティレベル | ビジュアルゲージ | リアルタイム | パスワードのみ→MFA有効の変化 |
| 設定進捗状況 | プログレスバー | ステップ毎 | 4段階の設定進捗表示 |
| QRコード | 画像 | 生成時 | 認証アプリ設定用QRコード |
| 秘密鍵（手動用） | 英数字文字列 | 生成時 | QRコード代替の手動入力用 |
| バックアップコード | 10個の文字列 | 生成時 | 緊急時用バックアップコード |

### データの更新頻度
- **リアルタイム更新**: 設定進捗・検証結果・エラーメッセージ
- **生成時更新**: QRコード・秘密鍵・バックアップコード
- **ステップ完了時**: 進捗インジケーター・完了状況
- **セキュリティイベント**: 有効化完了・設定変更の記録

## 入力項目

### 基本設定項目
| 入力項目 | 入力形式 | 必須 | バリデーション | 説明 |
|---------|---------|------|---------------|------|
| 準備完了確認 | チェックボックス | ○ | チェック必須 | デバイス・アプリ準備完了確認 |
| テスト認証コード | テキスト（6桁） | ○ | 数字6桁、30秒以内 | 認証アプリからの確認コード |
| バックアップコード保存確認 | チェックボックス | ○ | チェック必須 | 安全保存完了確認 |

### 設定オプション項目
| 入力項目 | 入力形式 | 必須 | バリデーション | 説明 |
|---------|---------|------|---------------|------|
| 認証アプリ選択 | 選択 | × | 対応アプリ一覧 | 使用する認証アプリの選択 |
| 手動入力モード | 選択 | × | QRコード/手動 | 設定方法の選択 |
| 通知設定 | チェックボックス | × | - | MFA有効化通知の受信設定 |

## アクション・操作

### 主要アクション
- **MFA設定開始**: 設定ウィザードの開始・秘密鍵生成
- **QRコード生成**: 認証アプリ設定用QRコードの生成・表示
- **動作確認実行**: テスト認証コードによる動作検証
- **バックアップコード生成**: 緊急時用バックアップコードの作成

### 支援アクション
- **手動入力切替**: QRコードから手動入力モードへの切替
- **認証アプリ案内**: 推奨認証アプリの紹介・インストール支援
- **設定手順表示**: ステップバイステップの詳細手順表示
- **ヘルプ・FAQ**: よくある質問・トラブルシューティング

### 完了・管理アクション
- **設定完了確定**: MFA有効化の最終確定・システム反映
- **設定内容確認**: 有効化済みMFA設定の詳細確認
- **バックアップコード再表示**: 設定完了後のバックアップコード再確認
- **追加セキュリティ設定**: 他のセキュリティ機能の設定案内

## 画面の振る舞い

### インテリジェント設定支援
- **デバイス検出**時: 対応状況の自動判定・最適な認証アプリ推奨
- **QRコード生成**時: デバイスカメラ起動・スキャン手順の自動表示
- **コード入力**時: リアルタイム検証・入力フォーマット自動調整

### リアルタイム検証・フィードバック
- **認証コード入力**時: 入力形式の即座チェック・残り時間表示
- **動作確認**時: 検証結果の即座表示・成功/失敗の明確な視覚的フィードバック
- **エラー発生**時: 具体的な解決手順・代替方法の提示

### セキュリティ保護機能
- **QRコード表示**時: スクリーンショット検出・セキュリティ注意喚起
- **秘密鍵表示**時: 表示時間制限・自動非表示機能
- **設定中断**時: 自動状態保存・セキュアな再開機能

## 画面遷移

### 遷移元画面
- セキュリティ設定画面: ユーザーの自発的MFA設定
- アカウント設定画面: セキュリティ強化オプションから
- 強制設定通知: 管理者による強制有効化要求から

### 遷移先画面
- セキュリティ設定画面: MFA有効化完了後の設定確認
- ログイン画面: 次回ログイン時のMFA認証体験
- アカウントダッシュボード: セキュリティ状況の総合確認

## MFA設定の専門機能
- **進捗保存**: 設定途中での中断・安全な再開機能
- **複数デバイス対応**: 複数の認証アプリ・デバイスでの設定
- **アクセシビリティ**: 音声案内・大文字表示・コントラスト調整
- **多言語対応**: 設定手順・エラーメッセージの多言語表示

## エラーハンドリング
- **認証コードエラー**: 入力形式・有効期限エラー時の明確な修正指示
- **QRコードエラー**: スキャン失敗時の手動入力・再生成オプション
- **ネットワークエラー**: 通信障害時の自動リトライ・オフライン対応
- **デバイス非対応エラー**: 代替認証方法・サポート連絡先の案内

## パフォーマンス最適化
- **高速QRコード生成**: 秘密鍵生成・QRコード表示の高速化
- **レスポンシブ表示**: デバイスサイズに最適化されたレイアウト
- **プログレッシブローディング**: 段階的コンテンツ読み込み
- **キャッシュ最適化**: 認証アプリ情報・手順画像の効率的キャッシュ

この包括的なMFA設定環境により、ユーザーの技術レベルに関わらず安全で簡単なMFA有効化を実現し、組織全体のセキュリティレベル向上を促進する。