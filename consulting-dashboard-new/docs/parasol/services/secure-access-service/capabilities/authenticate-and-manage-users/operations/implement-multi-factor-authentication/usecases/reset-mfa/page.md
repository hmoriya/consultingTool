# ページ定義: MFAリセット管理ページ

**バージョン**: 2.0.0
**更新日**: 2025-10-21
**設計方針**: 管理者専用・厳格セキュリティ・緊急時対応

## 画面の目的
管理者がユーザーのMFA設定を安全かつ確実にリセットできる管理機能を提供し、緊急時のアクセス復旧と適切な監査ログ記録を通じて、セキュリティと利便性を両立した運用を実現する。

## 利用者
- **主要利用者**: セキュリティ管理者（MFAリセット権限保有者）
- **副次利用者**: 上級管理者（重要アカウント承認者）、IT管理者（技術サポート）

## 画面構成

### 🔐 管理者認証セクション（ページ上部）

#### 権限確認・再認証
- **管理者情報表示**:
  - アイコン: 🛡️「セキュリティ管理者」
  - 表示: 「こんにちは、[管理者名] さん（ID: [管理者ID]）」
  - 権限: 「MFAリセット権限: 有効」
  - 最終ログイン: 「2024-10-21 09:30 JST」

#### セキュリティ警告
- **重要な注意事項**:
  - 🚨 「MFAリセットは重要なセキュリティ操作です」
  - 🔍 「全ての操作は詳細に記録・監査されます」
  - ⚠️ 「不正利用は重大なセキュリティ違反となります」

#### 再認証要求
- **追加認証**:
  - 説明: 「MFAリセット実行には管理者の再認証が必要です」
  - 入力: 管理者パスワード再入力フィールド
  - ボタン: 「管理者権限を確認」
  - セッション: 「認証から30分間有効」

---

### 🔍 対象ユーザー検索・選択セクション（メイン上部）

#### ユーザー検索機能
- **検索フィールド**:
  - 検索方法: メールアドレス、ユーザーID、ユーザー名で検索
  - プレースホルダー: 「user@example.com または ユーザー名を入力」
  - 検索ボタン: 「ユーザーを検索」
  - 検索履歴: 最近検索した5ユーザーを表示

#### 検索結果表示
- **候補ユーザー一覧**:
  - 表示形式: 表形式（ユーザー名、メール、MFA状態、最終ログイン）
  - MFA状態: 「有効」「無効」「部分設定」「エラー状態」
  - 重要度表示: 重要アカウントには 👑 アイコン
  - 選択方法: 「このユーザーを選択」ボタンでユーザー確定

#### 対象ユーザー詳細
- **選択済みユーザー情報**:
  - 基本情報: ユーザー名、メールアドレス、ユーザーID
  - アカウント状態: アクティブ/非アクティブ、ロール情報
  - MFA設定状況: 設定日、最終使用、バックアップコード残数
  - セキュリティ履歴: 最近の認証試行、失敗回数

---

### ⚙️ MFAリセット設定セクション（メイン中部）

#### リセット種別選択
- **リセット方式**:
  - 🔄 「完全リセット」: 全MFA設定の削除（推奨）
  - ⏸️ 「一時的無効化」: 7日間の一時停止
  - 🆕 「即座再設定」: リセット後に新しいMFA設定を生成

#### リセット理由・緊急度
- **リセット理由（必須）**:
  - 選択肢: 「デバイス紛失」「アプリ削除」「バックアップコード全消費」「その他」
  - その他の場合: 詳細説明テキストエリア（必須、最大500文字）
  - 緊急度: 「低」「中」「高」「緊急」の4段階選択

#### 重要アカウント追加承認
- **二次承認（重要アカウントのみ表示）**:
  - 警告: 🚨 「このアカウントは重要アカウントです」
  - 要求: 「上級管理者の承認が必要です」
  - 承認者選択: 上級管理者リストから選択
  - 承認依頼: 「承認依頼を送信」ボタン
  - 状況表示: 「承認待ち」「承認済み」「却下」

---

### 📋 リセット実行確認セクション（メイン下部）

#### 最終確認画面
- **実行内容の確認**:
  - 対象ユーザー: [ユーザー名] ([メールアドレス])
  - リセット方式: [選択された方式]
  - リセット理由: [入力された理由]
  - 実行予定時刻: [即座実行時刻]
  - 影響範囲: 削除されるMFA設定の詳細

#### セキュリティチェックリスト
- **必須確認項目**:
  - ☐ 対象ユーザーの本人確認が完了している
  - ☐ リセット理由が正当かつ詳細に記録されている
  - ☐ 重要アカウントの場合、上級管理者の承認が完了している
  - ☐ 関係者への事前通知が完了している
  - ☐ リセット後の再設定計画が準備されている

#### 最終実行ボタン
- **リセット実行**:
  - ボタン: 「🚨 MFAリセットを実行」（大きな赤色ボタン）
  - 安全装置: 3秒間のカウントダウン後に実行可能
  - 最終警告: 「この操作は取り消せません。実行しますか？」

---

### 📊 リセット実行・結果表示セクション（実行時表示）

#### 実行進行状況
- **プロセス表示**:
  - 進行バー: リセット処理の進行状況（5段階）
  - 現在のステップ: 「MFA設定データを削除中...」
  - 推定残り時間: 「約30秒で完了予定」
  - 警告: 「処理中はページを閉じないでください」

#### 実行結果
- **成功時表示**:
  - ✅ 「MFAリセットが正常に完了しました」
  - 詳細結果: 削除されたMFA設定の項目一覧
  - 通知状況: 「対象ユーザーに通知を送信済み」
  - 監査ログ: 「実行ログをセキュリティ監査に記録済み」

#### 次のアクション
- **リセット後の案内**:
  - 🔄 「新しいMFA設定を今すぐ開始」ボタン
  - 📧 「ユーザーに再設定手順を送信」ボタン
  - 📝 「リセット報告書を作成」ボタン
  - 🏠 「管理ダッシュボードに戻る」ボタン

---

### 🚨 エラー・例外処理セクション（エラー時表示）

#### 部分的失敗時
- **警告表示**:
  - ⚠️ 「MFAリセットが部分的に失敗しました」
  - 成功項目: 「正常に削除された設定」一覧
  - 失敗項目: 「削除に失敗した設定」一覧
  - 手動対応: 「技術者による手動修復が必要」

#### システムエラー時
- **エラー対応**:
  - ❌ 「システムエラーが発生しました」
  - エラーコード: 表示されたエラーコード
  - 自動リトライ: 「30秒後に自動で再試行」
  - 手動対応: 「今すぐ再試行」「技術者に連絡」ボタン

---

## データ表示

### 表示データ一覧
| データ項目 | 表示形式 | 更新頻度 | 説明 |
|-----------|---------|---------|------|
| 管理者情報 | 静的表示 | ページ読み込み時 | 実行者の権限確認 |
| 対象ユーザー情報 | 詳細表示 | 検索時 | リセット対象の詳細情報 |
| MFA設定状況 | リアルタイム | 検索時 | 現在のMFA設定詳細 |
| リセット進行状況 | プログレスバー | 実行中リアルタイム | 処理の進行状況 |
| 実行結果 | 詳細レポート | 実行完了時 | 成功・失敗の詳細 |

## 入力項目

### フォーム一覧
| 入力項目 | 入力形式 | 必須 | バリデーション | 説明 |
|---------|---------|------|---------------|------|
| 管理者パスワード | パスワード入力 | ○ | 現在のパスワードと一致 | 再認証用 |
| ユーザー検索 | テキスト入力 | ○ | メール形式またはユーザー名 | 対象ユーザー特定 |
| リセット理由 | 選択+テキスト | ○ | 理由選択必須、その他は詳細入力 | 監査記録用 |
| 緊急度 | 選択肢 | ○ | 4段階から選択 | 処理優先度決定 |
| 確認チェックリスト | チェックボックス群 | ○ | 全項目チェック必須 | 実行前最終確認 |

### 入力制御
- **セキュリティ入力**: パスワードは暗号化送信、セッション管理
- **ユーザー検索**: インクリメンタル検索、候補表示
- **理由入力**: 文字数制限、禁止文字の自動除去
- **確認制御**: 全チェックボックス選択まで実行ボタン無効

## アクション・操作

### 主要アクション
- **管理者再認証**:
  - トリガー: パスワード入力 + 「権限確認」ボタン
  - 処理: 認証確認、セッション延長、管理権限検証
  - 成功時: MFAリセット機能の利用可能化

- **ユーザー検索・選択**:
  - トリガー: 検索文字列入力 + 「検索」ボタン
  - 処理: ユーザーDB検索、MFA状況取得、候補表示
  - 成功時: 対象ユーザー詳細情報の表示

- **MFAリセット実行**:
  - トリガー: 確認完了 + 「リセット実行」ボタン
  - 処理: MFA設定削除、監査ログ記録、通知送信
  - 成功時: 完了画面表示、次アクション案内

### 副次アクション
- **二次承認依頼**: 重要アカウント対応の上級管理者承認要求
- **実行履歴確認**: 過去のMFAリセット実行履歴の表示
- **ユーザー通知送信**: リセット完了の即座ユーザー通知
- **報告書作成**: リセット実行報告書の自動生成

### 緊急時アクション
- **緊急リセット**: システム障害時の手動リセット手順
- **ロールバック**: 部分的失敗時の安全な状態復旧
- **エスカレーション**: 解決困難時の上級管理者・技術者連絡

## 画面の振る舞い

### ユーザー操作への反応
- **管理者認証時**:
  - パスワード入力中: セキュアな入力マスク表示
  - 認証成功: 緑色確認マーク + 30分セッション開始
  - 認証失敗: 赤色エラー表示 + 再入力促進

- **ユーザー検索時**:
  - 入力中: インクリメンタル検索候補表示
  - 検索完了: 検索結果一覧 + MFA状況表示
  - ユーザー選択: 詳細情報パネル展開

- **リセット実行時**:
  - 実行中: プログレスバー + 現在ステップ表示
  - 完了時: 成功・失敗アニメーション + 詳細結果
  - エラー時: 明確なエラーメッセージ + 対処方法案内

### 条件による表示変更
- **重要アカウント時**: 追加の承認セクション表示、警告の強調
- **部分的失敗時**: 成功・失敗項目の分離表示、手動対応案内
- **権限不足時**: 全機能無効化、権限昇格手順の案内
- **システムエラー時**: 自動リトライ機能、技術者連絡手段の提供

## 画面遷移

### 遷移元画面
- **管理ダッシュボード**: 「MFAリセット」メニューから
- **ユーザー管理画面**: ユーザー詳細から「MFAリセット」選択
- **セキュリティ管理画面**: セキュリティ操作メニューから
- **緊急対応画面**: セキュリティインシデント対応時

### 遷移先画面
- **MFA設定画面**: 新しいMFA設定の即座開始選択時
- **管理ダッシュボード**: 処理完了後の通常復帰
- **ユーザー管理画面**: 対象ユーザーの詳細確認時
- **監査ログ画面**: 実行ログの詳細確認時

## エラーハンドリング

### エラー表示方法
- **権限不足**: 「MFAリセット権限がありません。管理者にお問い合わせください。」
- **ユーザー不存在**: 「指定されたユーザーが見つかりません。検索条件を確認してください。」
- **MFA未設定**: 「このユーザーはMFAが設定されていません。リセットの必要はありません。」
- **部分的失敗**: 「一部のMFA設定の削除に失敗しました。技術者による手動対応が必要です。」
- **システムエラー**: 「システムに一時的な問題が発生しています。しばらく後に再試行してください。」

### 復旧・対処機能
- **自動リトライ**: システムエラー時の30秒後自動再試行
- **手動対応支援**: 部分的失敗時の技術者向け詳細情報提供
- **エスカレーション**: 自動的な上級管理者・技術者通知
- **ロールバック**: 安全な状態への復旧機能

## アクセシビリティ要件

### キーボードナビゲーション
- タブ順序: 認証 → 検索 → 選択 → 設定 → 確認 → 実行
- ショートカット: Enter キーでの段階的進行、Escape キーでの安全な中断

### スクリーンリーダー対応
- 重要警告: 「重要なセキュリティ操作です。慎重に実行してください」
- 進行状況: 「MFAリセット処理中、ステップ3/5実行中」
- 結果通知: 「MFAリセットが正常に完了しました。対象ユーザーに通知済み」

### 色覚障害への配慮
- 成功・エラー表示: 色だけでなくアイコンと文字で明確に表現
- 重要度表示: 色以外の視覚的手がかり（アイコン、太字、枠線）
- 高コントラスト表示: セキュリティ操作に適した明確な視認性

## レスポンシブ対応

### デスクトップ（1024px以上）
- フルレイアウト: 左右分割でユーザー情報とリセット設定を並列表示
- 大きなボタン: 重要なアクションボタンは十分なサイズで安全性確保

### タブレット（768px-1023px）
- 縦積みレイアウト: セクションごとの縦配置、スクロール対応
- アコーディオン: 詳細情報の開閉式表示

### モバイル（767px以下）
- シングルカラム: 必須情報のみの最小限表示
- ステップウィザード: 段階的な操作フローで誤操作防止

## セキュリティ配慮

### データ保護
- 管理者認証情報: セッション管理、自動ログアウト
- 対象ユーザー情報: 最小限必要情報のみ表示、詳細はマスク
- リセット理由: 暗号化保存、監査ログとして永続記録

### 操作ログ記録
- 全操作の詳細記録: アクセス、検索、実行、結果の完全ログ
- 改ざん防止: ハッシュ値による整合性確保
- リアルタイム監視: 異常操作パターンの自動検知・アラート

### 権限制御
- 多段階認証: 管理者権限 + 再認証 + 重要アカウント承認
- セッション管理: 30分タイムアウト、操作停止時の自動ログアウト
- 権限分離: 通常管理者と上級管理者の明確な役割分離

### 緊急時対応
- インシデント通知: リアルタイム関係者通知システム
- 証跡保全: 法的要求に対応可能な完全な操作履歴
- 復旧支援: 緊急時の迅速な問題解決手順

---
*このページ定義は、UC-MFA-04「MFAをリセットする」と1対1対応し、管理者の厳格なセキュリティ管理と緊急時の迅速対応を両立した信頼性の高い管理体験を実現しています*