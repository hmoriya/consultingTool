# ページ定義: バックアップコード認証ページ

**バージョン**: 2.0.0
**更新日**: 2025-10-20
**対応ユースケース**: UC-MFA-03（バックアップコードを使用する）

## 画面の目的
認証アプリが利用できない緊急時に、ユーザーが事前保存されたバックアップコードを安全かつ迅速に入力し、多要素認証を完了してシステムへの継続的なアクセスを実現する。

## 利用者
- **緊急アクセスユーザー**: デバイス紛失・故障時にアクセス復旧が必要なユーザー
- **出張中ユーザー**: 認証アプリが利用できない環境のユーザー
- **技術的問題ユーザー**: 時刻同期エラー等で認証アプリが機能しないユーザー
- **バックアップ利用ユーザー**: 計画的にバックアップコードを使用するユーザー

## 画面構成

### ヘッダー部
- 画面タイトル: 「バックアップコード認証」
- 緊急アクセス表示: 「緊急時アクセス復旧」バッジ
- セキュリティレベル表示: 高セキュリティ認証中の状態表示
- 戻るボタン: 通常MFA認証への復帰オプション

### 状況説明セクション
- **利用理由確認**: バックアップコード利用の一般的理由（デバイス紛失・故障・時刻同期エラー）
- **一時的利用案内**: バックアップコードは緊急時の一時的手段であることの説明
- **認証アプリ復旧案内**: 可能な限り認証アプリの復旧・再設定を推奨
- **セキュリティ注意**: バックアップコード使用がログに記録されることの案内

### バックアップコード入力セクション
- **コード入力フィールド**: 10桁英数字専用入力フィールド
- **フォーマット表示**: AB12-CD34-EF形式での入力支援表示
- **自動フォーカス**: ページ読み込み時の自動フォーカス設定
- **大文字変換**: 小文字入力の自動大文字変換機能

### バックアップコード案内セクション
- **保存場所確認**: バックアップコードの一般的保存場所案内
- **コード形式説明**: 10桁英数字形式の説明・例示
- **有効性確認**: 有効期限内のコードの利用案内
- **使用後無効化**: 一度使用したコードは再利用不可の説明

### 代替アクセス手段
- **認証アプリ復帰**: 「認証アプリを使用」への切り替えリンク
- **管理者連絡**: 「サポートに連絡」緊急時連絡先
- **新しいコード生成**: 残数少ない場合の新規生成案内
- **アカウント復旧**: 管理者によるMFAリセット手順案内

### 使用状況・警告表示エリア
- **残り有効コード数**: 残りバックアップコード数の表示
- **使用履歴**: 最近のバックアップコード使用履歴
- **セキュリティ警告**: 連続失敗時の警告表示
- **補充推奨**: 残数3個以下時の新規生成推奨表示

## データ表示

### 表示データ一覧
| データ項目 | 表示形式 | 更新頻度 | 説明 |
|-----------|---------|---------|------|
| ユーザー識別情報 | テキスト | 静的 | 認証中ユーザーの名前・ID |
| 残りバックアップコード数 | 数値バッジ | リアルタイム | 有効な未使用コード数（例：残り7個） |
| 最終使用日時 | 日時 | 静的 | 前回バックアップコード使用日時 |
| 認証試行回数 | 数値 | 試行毎 | 現セッションでの試行回数 |
| セキュリティ状況 | ステータス | リアルタイム | 認証進行状況・警告レベル |

### データの更新頻度
- **リアルタイム更新**: 認証結果・エラーメッセージ・残りコード数
- **使用毎更新**: 認証失敗回数・セキュリティアラート状況
- **認証完了時**: ログイン成功・ダッシュボード遷移準備
- **補充検出時**: 新規バックアップコード生成推奨

## 入力項目

### 基本入力項目
| 入力項目 | 入力形式 | 必須 | バリデーション | 説明 |
|---------|---------|------|---------------|------|
| バックアップコード | テキスト（10桁） | ○ | 英数字10桁、使用済み除外 | 事前生成された緊急時認証コード |

### 入力制御・バリデーション
| バリデーション項目 | ルール | エラーメッセージ | 対応アクション |
|-------------------|--------|-----------------|---------------|
| 文字数 | 10桁必須 | 「10桁のコードを入力してください」 | 入力継続促進 |
| 文字種別 | 英数字のみ | 「英数字のみ入力可能です」 | 自動フィルタリング |
| 使用済み確認 | 未使用コードのみ | 「このコードは既に使用済みです」 | 別コード使用案内 |
| 有効性確認 | 有効期限内 | 「このコードは有効期限切れです」 | 新規生成案内 |
| 試行回数 | 5回まで | 「認証に失敗しました（残り X 回）」 | 注意喚起・管理者連絡案内 |

## アクション・操作

### 主要アクション
- **バックアップコード認証**: 10桁コード入力による認証実行
- **認証アプリ復帰**: 通常MFA認証画面への切り替え
- **新しいコード生成**: 残数少ない場合の追加生成
- **認証完了**: 成功時のダッシュボード画面への自動遷移

### 復旧・支援アクション
- **管理者連絡**: 緊急時サポート連絡・MFAリセット依頼
- **使用履歴確認**: バックアップコード使用状況の詳細表示
- **セキュリティ確認**: 不正利用疑いの確認・報告
- **ヘルプ表示**: バックアップコード関連のトラブルシューティング

### セキュリティアクション
- **使用ログ記録**: 全バックアップコード使用の詳細記録
- **異常検出通知**: 不正利用試行の管理者通知
- **アカウント保護**: 連続失敗時の一時的アカウント保護
- **コード無効化**: 使用済みコードの即座無効化

## 画面の振る舞い

### 自動化・支援機能
- **自動フォーカス**時: ページ読み込み完了時のコード入力フィールド自動選択
- **フォーマット支援**時: 入力時の自動区切り表示（AB12-CD34-EF）
- **大文字変換**時: 小文字入力の自動大文字変換
- **10桁完了検出**時: 10桁入力完了の自動検出・認証実行準備

### リアルタイム監視・フィードバック
- **入力リアルタイム**時: 各文字入力時の即座フォーマット・プログレス表示
- **認証結果即座表示**時: 成功/失敗の瞬時判定・明確な視覚的フィードバック
- **残数監視**時: バックアップコード残数のリアルタイム確認・警告表示
- **セキュリティ監視**時: 異常な使用パターン検出・即座アラート表示

### 継続性保護機能
- **補充推奨表示**時: 残り3個以下での新規生成強力推奨
- **使用履歴保護**時: 過去使用コードの表示・再利用防止
- **アクセス継続**時: 認証成功後の通常サービス利用への滑らかな移行
- **復旧支援**時: 認証アプリ復旧のための具体的手順案内

## 画面遷移

### 遷移元画面
- MFA認証コード入力画面: 「バックアップコードを使用」選択時
- ログイン画面: バックアップコード直接選択時
- アカウント復旧画面: 管理者による復旧支援時

### 遷移先画面
- ダッシュボード画面: バックアップコード認証成功時の標準遷移先
- MFA認証画面: 「認証アプリを使用」選択時の復帰
- 新規バックアップコード生成画面: 補充・更新選択時
- アカウントロック画面: 連続認証失敗時の一時保護画面
- サポート連絡画面: 管理者サポート依頼時

## バックアップコード認証の専門機能

### コード管理システム
- **残数監視**: リアルタイム残数確認・自動補充推奨・枯渇防止
- **使用履歴管理**: 詳細使用ログ・異常検出・フォレンジック支援
- **有効期限管理**: 期限監視・更新推奨・自動無効化
- **重複防止**: 既存コード確認・重複排除・安全生成

### セキュリティ強化
- **レート制限**: 厳格な使用頻度制限・IP-based制限・異常検出
- **使用追跡**: 全使用の詳細記録・地理的分析・デバイス確認
- **不正検出**: 異常使用パターン・多重アクセス・総当たり攻撃検出
- **即座対応**: セキュリティインシデント自動対応・管理者即座通知

### ユーザビリティ最適化
- **入力最適化**: 自動フォーマット・エラー予防・使いやすいUI
- **視覚的支援**: 明確な状況表示・進捗インジケーター・色分け表示
- **音声支援**: スクリーンリーダー完全対応・音声ガイダンス
- **エラー回復**: 明確なエラー説明・具体的解決手順・代替手段案内

### 継続性保証
- **自動補充**: 残数自動監視・適切なタイミングでの補充案内
- **復旧支援**: 認証アプリ復旧の段階的支援・設定再建手順
- **管理者連携**: スムーズな管理者エスカレーション・迅速対応
- **業務継続**: 最小限の中断・迅速な復旧・通常業務への復帰

## エラーハンドリング

### バックアップコードエラー対応
- **無効コードエラー**: 存在しないコード入力時の明確なエラー表示・正しいコード確認案内
- **使用済みエラー**: 既使用コード入力時の説明・未使用コード利用案内
- **期限切れエラー**: 有効期限切れコード使用時の新規生成案内・管理者連絡案内
- **連続失敗エラー**: 複数回失敗時の警告・管理者連絡・アカウント保護案内

### システムエラー対応
- **ネットワークエラー**: 通信障害時の自動再試行・オフライン対応・状況説明
- **データベースエラー**: バックアップコード確認エラー時の管理者連絡・一時的代替手段
- **セッションエラー**: セッション切れ時の安全な再認証・データ保護
- **権限エラー**: アクセス権限問題時の適切なエラー表示・管理者連絡

## パフォーマンス最適化

### 高速認証
- **瞬時検証**: バックアップコード検証の1秒以内応答・即座フィードバック
- **軽量表示**: 最小限のリソース使用・高速ページ読み込み
- **効率通信**: 最適化されたAPI通信・圧縮データ転送
- **キャッシュ活用**: 認証パターンの効率的キャッシュ・高速化

### レスポンシブ対応
- **デバイス最適化**: スマートフォン・タブレット・デスクトップの完全対応
- **緊急時対応**: 各デバイスでの緊急時使いやすさ最優先
- **タッチ操作**: モバイルデバイスでの快適な操作・大きなタップエリア
- **アクセシビリティ**: 緊急時でもアクセシブル・多様なニーズへの配慮

この包括的なバックアップコード認証環境により、緊急時における確実なアクセス復旧を実現し、ユーザーの業務継続性とセキュリティレベルを最高水準で両立する。