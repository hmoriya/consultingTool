# ユースケース: パスワードポリシーを設定する

## 基本情報
- **ユースケースID**: UC-SEC-007
- **アクター**: システム管理者, セキュリティ管理者
- **概要**: 組織のセキュリティ要件に応じて包括的なパスワードポリシーを設定・管理し、全ユーザーのパスワード強度と安全性を統一的に確保する

## 事前条件
- 管理者がシステムにログインし、適切な権限を保持している
- 管理者権限（セキュリティポリシー設定権限）が有効である
- 組織のセキュリティポリシーが定義されている
- パスワードポリシー設定機能が有効になっている

## 事後条件
### 成功時
- 新しいパスワードポリシーがシステム全体に適用される
- 既存ユーザーに対して次回パスワード変更時から新ポリシーが適用される
- ポリシー変更通知が管理者とユーザーに送信される
- ポリシー変更ログが監査ログに記録される
- ポリシー設定の完了確認が表示される

### 失敗時
- 既存のパスワードポリシーが維持される
- エラーメッセージが表示される
- 設定失敗ログが記録される
- ロールバック処理が実行される

## 基本フロー
1. 管理者がセキュリティ設定画面でパスワードポリシー設定を選択する
2. システムが現在のポリシー設定を表示する
3. 管理者がパスワード長の最小・最大値を設定する
4. 管理者が文字種類要件（大文字、小文字、数字、記号）を設定する
5. 管理者がパスワード有効期限を設定する
6. 管理者がパスワード履歴保持数を設定する
7. 管理者が辞書攻撃対策設定を構成する
8. 管理者が既知の漏洩パスワード検証機能を設定する
9. 管理者がアカウントロックアウト設定を構成する
10. システムがポリシー設定の妥当性を検証する
11. 管理者がポリシー適用対象（全ユーザー、特定ロール等）を選択する
12. 管理者がポリシー適用開始日時を設定する
13. 管理者が設定内容を最終確認する
14. システムが新しいポリシーを保存・適用する
15. システムがポリシー変更通知を送信する

## 代替フロー
### 代替フロー1: ポリシー設定検証エラー
- 10a. ポリシー設定が矛盾または無効な場合
  - 10a1. システムが具体的な検証エラーメッセージを表示する
  - 10a2. システムが問題のある設定項目をハイライト表示する
  - 10a3. システムが推奨設定値を提案する
  - 10a4. 基本フロー3に戻る

### 代替フロー2: 段階的適用
- 12a. 管理者が段階的適用を選択する場合
  - 12a1. 管理者が適用対象グループを複数段階で設定する
  - 12a2. 管理者が各段階の適用日時を設定する
  - 12a3. システムが段階適用スケジュールを確認表示する
  - 12a4. 基本フロー13に進む

### 代替フロー3: テスト適用
- 11a. 管理者がテスト適用を選択する場合
  - 11a1. 管理者がテスト対象ユーザーグループを選択する
  - 11a2. システムがテスト期間を設定する
  - 11a3. システムがテスト適用を実行する
  - 11a4. テスト期間経過後、結果を評価して本適用を判断する

### 代替フロー4: 緊急ポリシー適用
- 1a. セキュリティ事件によりポリシー緊急変更が必要な場合
  - 1a1. 管理者が緊急ポリシー変更モードを選択する
  - 1a2. システムが緊急変更の理由入力を要求する
  - 1a3. システムが簡素化された設定プロセスを表示する
  - 1a4. システムが即座に全ユーザーに適用する

## 例外フロー
### 例外1: 権限不足
- 1a. アクセスしたユーザーにポリシー設定権限がない場合
  - 1a1. システムが権限不足エラーを表示する
  - 1a2. システムが不正アクセス試行ログを記録する
  - 1a3. システムがセキュリティ管理者に通知する
  - 1a4. ユーザーに適切な権限者への相談を案内する

### 例外2: システムエラー
- 14a. ポリシー保存・適用中にシステムエラーが発生した場合
  - 14a1. システムがトランザクションをロールバックする
  - 14a2. システムが既存ポリシーの整合性を確認する
  - 14a3. システムがエラーログを記録する
  - 14a4. システムが管理者にエラー通知を送信する

### 例外3: 既存パスワード非適合
- 14b. 新ポリシーで既存パスワードの大部分が非適合になる場合
  - 14b1. システムが影響度分析結果を表示する
  - 14b2. システムが猶予期間設定を推奨する
  - 14b3. 管理者が猶予期間と通知計画を設定する
  - 14b4. システムが段階的移行計画を作成する

## 特別要件
- **セキュリティ**: ポリシー変更は必ず管理者の二段階認証後に実行
- **監査性**: 全てのポリシー変更を詳細ログと共に記録し、変更前後の比較を保存
- **影響分析**: ポリシー適用前に既存ユーザーへの影響度を自動計算・表示
- **段階適用**: 大規模組織での段階的ポリシー適用機能を提供

## 関連ユースケース
- **包含**: なし
- **拡張**: 「パスワードを変更する」（新ポリシー適用後の変更）
- **汎化**: なし