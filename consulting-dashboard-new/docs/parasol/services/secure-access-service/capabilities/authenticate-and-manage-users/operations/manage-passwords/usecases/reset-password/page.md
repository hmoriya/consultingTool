# ページ定義: パスワードリセットページ

**バージョン**: 2.0.0
**更新日**: 2025-10-21
**設計方針**: ワークフロー重視・セキュリティ強化

## 画面の目的
パスワードを忘れたユーザーが安全で直感的なプロセスを通じてアカウントアクセスを復旧し、管理者も必要に応じて代行リセットを実行できる包括的なパスワードリセット環境を提供する。

## 利用者
- **主要利用者**: パスワードを忘れたユーザー（全ユーザー対象）
- **副次利用者**: システム管理者（代行リセット実行）、セキュリティ管理者（異常検知・対応）

## 画面構成

### 🔄 マルチステップワークフロー構成

この画面は、セキュリティレベルに応じて3つのメインフローで構成されます：

#### フロー1: ユーザー主導リセット（一般的なケース）
#### フロー2: 管理者代行リセット（緊急時・問題解決）
#### フロー3: セキュリティ強化リセット（異常検知時）

---

### 📱 ステップ1: リセット要求ページ

#### ヘッダー部
- **ページタイトル**: 「パスワードをリセット」
- **セキュリティバッジ**: 🔒「安全なリセットプロセス」
- **ヘルプリンク**: 「リセットできない場合」→ 管理者連絡先

#### メインコンテンツ部

##### セクション1: リセット手順説明
- **プロセス概要表示**:
  - ステップ表示: 「1.メール入力 → 2.メール確認 → 3.新パスワード設定」
  - 所要時間: 「約15分で完了」
  - セキュリティ通知: 「このプロセスは暗号化されており安全です」

##### セクション2: メールアドレス入力
- **メールアドレス入力フィールド**:
  - プレースホルダー: 「登録済みのメールアドレスを入力」
  - タイプ: email（自動バリデーション）
  - リアルタイム検証: 形式チェック
  - 説明テキスト: 「アカウント登録時のメールアドレスを入力してください」

##### セクション3: セキュリティ強化（条件付き表示）
- **CAPTCHA認証**（異常検知時のみ表示）:
  - reCAPTCHA v3 による自動判定
  - 疑わしい場合のみ画像認証追加
  - 説明: 「セキュリティ確保のため認証が必要です」

#### アクションエリア
- **リセット要求ボタン**:
  - ラベル: 「リセット手順をメールで送信」
  - 色: プライマリブルー
  - 無効化条件: メール形式不正時

- **ログイン画面に戻るリンク**:
  - ラベル: 「パスワードを思い出した場合はこちら」

---

### 📧 ステップ2: メール送信完了ページ

#### メインコンテンツ部

##### セクション1: 送信完了メッセージ
- **成功通知**:
  - アイコン: ✅ 「メール送信完了」
  - メッセージ: 「[メールアドレス] にリセット手順を送信しました」
  - 次の手順: 「メールのリンクをクリックしてパスワードリセットを完了してください」

##### セクション2: 注意事項・トラブルシューティング
- **メール確認ガイド**:
  - 📧 「メールが届かない場合の確認事項」
  - スパムフォルダの確認
  - メールアドレスの再確認
  - 再送信オプション（5分後に有効化）

##### セクション3: セキュリティ情報
- **セキュリティ通知**:
  - ⏰ 「リセットリンクの有効期限: 1時間」
  - 🔒 「リンクは1回のみ使用可能」
  - ⚠️ 「心当たりのないリセット要求の場合は管理者にご連絡ください」

#### アクションエリア
- **再送信ボタン**（5分後有効化）:
  - ラベル: 「メールを再送信」
  - カウントダウン表示: 「再送信まで 4:32」

---

### 🔐 ステップ3: 新パスワード設定ページ

#### ヘッダー部
- **進行状況表示**: 「ステップ 3/3: 新パスワード設定」
- **セキュリティ確認**: ✅「認証済み - 安全にパスワードを変更できます」

#### メインコンテンツ部

##### セクション1: ユーザー確認
- **アカウント情報表示**:
  - ユーザー名: 「[ユーザー名] さんのパスワードリセット」
  - メールアドレス: 一部マスク表示「user****@example.com」
  - 最終ログイン: 「前回ログイン: 2024-10-15」

##### セクション2: 新パスワード入力
- **新パスワード入力フィールド**:
  - プレースホルダー: 「新しいパスワードを入力」
  - タイプ: password（マスク表示）
  - 表示切り替えボタン: 👁️アイコン
  - リアルタイム強度評価: UC-PASS-04連携

- **パスワード確認フィールド**:
  - プレースホルダー: 「新しいパスワードを再入力」
  - 一致確認: ✅/❌ リアルタイム表示

##### セクション3: パスワード強度表示（UC-PASS-04連携）
- **強度メーター**:
  - プログレスバー: 弱（赤）→ 中（橙）→ 強（緑）→ 最強（青）
  - スコア表示: 「強度: 75/100」

- **ポリシー準拠チェック**:
  - ✅ 8文字以上
  - ✅ 大文字・小文字を含む
  - ✅ 数字を含む
  - ❌ 記号を含む（要改善）

##### セクション4: セキュリティ強化オプション
- **次回ログイン設定**:
  - チェックボックス: 「他のデバイスからのログインセッションを終了」
  - 説明: 「セキュリティ強化のため推奨されます」

#### アクションエリア
- **パスワード設定ボタン**:
  - ラベル: 「新しいパスワードを設定」
  - 有効化条件: 全バリデーション通過時
  - 色: 成功時は緑色

---

### 👨‍💼 管理者代行リセット画面（管理者専用）

#### アクセス制御
- **管理者認証確認**: セキュリティ管理者権限必須
- **多段階認証**: 管理者の追加認証要求

#### メインコンテンツ部

##### セクション1: 対象ユーザー検索
- **ユーザー検索フィールド**:
  - 検索方法: メールアドレス、ユーザーID、氏名
  - オートコンプリート機能
  - 検索結果表示: ユーザー情報一覧

##### セクション2: リセット理由・緊急度
- **リセット理由選択**:
  - 選択肢: 「パスワード忘れ」「アカウントロック」「セキュリティ侵害疑い」「その他」
  - 詳細入力: フリーテキスト（必須）

- **緊急度選択**:
  - 「低」「中」「高」「緊急」の4段階
  - 緊急度に応じた処理優先度調整

##### セクション3: リセット方式選択
- **リセット方式**:
  - 🔤 一時パスワード生成（推奨）
  - 📧 ユーザーにリセットメール送信
  - 🔐 管理者設定パスワード

##### セクション4: 影響・セキュリティ確認
- **実行前確認**:
  - 対象ユーザーの確認
  - 実行理由の最終確認
  - セキュリティ影響の説明
  - 監査ログ記録の確認

## データ表示

### 表示データ一覧
| データ項目 | 表示形式 | 更新頻度 | 説明 |
|-----------|---------|---------|------|
| リセット進行状況 | ステップインジケーター | ページ遷移時 | 現在位置の明確化 |
| パスワード強度 | プログレスバー+数値 | リアルタイム | 入力連動更新 |
| 残り有効時間 | カウントダウン | 1秒毎 | トークン期限表示 |
| セキュリティ状態 | アイコン+ステータス | リアルタイム | 異常検知時更新 |

## 入力項目

### フォーム一覧
| 入力項目 | 入力形式 | 必須 | バリデーション | 説明 |
|---------|---------|------|---------------|------|
| メールアドレス | email | ○ | RFC5322準拠 | 登録済みアドレス |
| 新パスワード | password | ○ | ポリシー準拠 | 強度リアルタイム評価 |
| パスワード確認 | password | ○ | 一致確認 | タイポ防止 |
| CAPTCHA | 画像認証 | 条件付き | reCAPTCHA | セキュリティ強化時 |

## アクション・操作

### 主要アクション
- **リセット要求実行**:
  - トリガー: メール送信ボタンクリック
  - 検証: メールアドレス形式、CAPTCHA（必要時）
  - 実行後: メール送信完了ページに遷移

- **新パスワード設定**:
  - トリガー: パスワード設定ボタンクリック
  - 検証: 強度チェック、一致確認、ポリシー準拠
  - 実行後: 設定完了ページに遷移

### 副次アクション
- **メール再送信**: 5分経過後に有効化
- **パスワード表示切り替え**: マスク解除/適用
- **ヘルプ表示**: 各ステップでのサポート情報

## 画面の振る舞い

### ユーザー操作への反応
- **メール入力時**: リアルタイム形式検証、ドメイン確認
- **パスワード入力時**: 即座に強度評価、ポリシー適合状況表示
- **セキュリティ異常検知時**: CAPTCHA自動表示、セキュリティ強化通知
- **プロセス完了時**: 成功アニメーション、次の手順案内

### 条件による表示変更
- **セキュリティ強化モード**: CAPTCHA、追加確認項目の表示
- **管理者モード**: 代行リセット専用UI、監査情報入力フォーム
- **緊急モード**: 優先処理バナー、迅速化オプション
- **エラー状態**: 明確なエラーガイド、復旧手順表示

## 画面遷移

### 遷移元画面
- **ログイン画面**: 「パスワードを忘れた場合」リンク
- **エラーページ**: 認証失敗後のリカバリー
- **管理者ダッシュボード**: 代行リセット機能
- **セキュリティアラート**: 異常検知時の対応フロー

### 遷移先画面
- **メール送信完了**: リセット要求成功後
- **新パスワード設定**: トークン検証成功後
- **設定完了**: パスワードリセット成功後
- **ログイン画面**: 全プロセス完了後
- **エラーページ**: 各種エラー発生時

## エラーハンドリング

### エラー表示方法
- **メール不存在**: 「リセット手順を送信しました」（セキュリティのため同じメッセージ）
- **トークン無効**: 「リンクが無効または期限切れです。新しいリセット要求を行ってください」
- **頻繁な要求**: 「しばらく時間をおいてから再試行してください」
- **システムエラー**: 「一時的な問題が発生しました。管理者にお問い合わせください」

### セキュリティ対応
- **異常検知時**: セキュリティチーム自動通知
- **ブルートフォース検知**: IP制限、CAPTCHA強制表示
- **不正アクセス**: セッション無効化、監査ログ記録

## アクセシビリティ要件

### キーボードナビゲーション
- タブ順序: メール入力 → ボタン → ヘルプ
- ショートカット: Enter キーでフォーム送信

### スクリーンリーダー対応
- プロセス進行状況の音声案内
- パスワード強度の音声フィードバック
- エラー内容の即座読み上げ

## レスポンシブ対応

### デスクトップ（1024px以上）
- 中央配置レイアウト: 最大幅600px
- サイドバーにヘルプ情報表示

### タブレット（768px-1023px）
- 単一カラム: 画面幅80%使用
- フォントサイズ最適化

### モバイル（767px以下）
- フルスクリーン活用: 余白最小化
- 大型ボタン: タッチフレンドリーサイズ
- ステップ表示簡略化

## セキュリティ強化機能

### 異常検知・対応
- **リクエスト頻度監視**: 同一IP/メールアドレスの制限
- **地理的異常検知**: 通常と異なる地域からのアクセス
- **デバイス指紋認証**: 通常と異なるデバイスからのアクセス

### 監査・ログ機能
- **完全な操作ログ**: 全ステップの詳細記録
- **セキュリティイベント**: 異常検知時の自動ログ
- **管理者操作**: 代行リセットの完全な追跡

---
*このページ定義は、UC-PASS-03「パスワードをリセットする」と1対1対応し、セキュリティと利便性を両立した包括的なパスワードリセット体験を実現しています*