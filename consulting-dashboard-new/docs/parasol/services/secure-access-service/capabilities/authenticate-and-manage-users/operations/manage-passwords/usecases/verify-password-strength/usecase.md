# ユースケース: パスワード強度を検証する

**バージョン**: 2.0.0
**更新日**: 2025-10-21
**設計方針**: 可視化重視・教育・改善提案

## 基本情報
- **ユースケースID**: UC-PASS-04
- **アクター**: ユーザー（主アクター）、システム（副アクター）
- **概要**: ユーザーが入力したパスワードの強度をリアルタイムで評価・可視化し、セキュリティポリシーへの準拠状況と具体的な改善提案を提供する

## 🏗️ パラソルドメイン連携

### 操作エンティティ
- **Password**（値オブジェクト作成・検証）: 強度評価、複雑性分析、ポリシー適合判定
- **PasswordPolicy**（参照のみ）: 組織のポリシー基準との比較
- **PasswordSecurityAggregate**（集約参照）: 既存パスワード履歴との重複チェック

### 他サービスユースケース利用
- **knowledge-co-creation-service**: UC-KNOWLEDGE-02: パスワード教育資料を蓄積する
- **project-success-service**: UC-AUDIT-02: ポリシー違反を監査記録する（弱いパスワード検出時）

## 事前条件
- ユーザーがパスワード入力フィールドにアクセスしている
- 組織のPasswordPolicyが設定されている
- パスワード強度評価エンジンが利用可能である
- 教育コンテンツデータベースが利用可能である

## 事後条件
### 成功時
- パスワード強度スコア（0-100）が算出・表示されている
- ポリシー準拠状況（各項目別）が可視化されている
- 具体的な改善提案が表示されている
- ユーザーの強度認識が向上している
- 教育効果がナレッジサービスに蓄積されている

### 失敗時
- デフォルト強度評価（基本チェックのみ）が表示されている
- エラー状況が内部ログに記録されている

## 基本フロー
1. **ユーザー**がパスワード入力フィールドに文字を入力する
2. **システム**が入力の500ms後にリアルタイム強度評価を開始する
3. **システム**が文字数・文字種の基本分析を実行する
4. **システム**が複雑性アルゴリズムによる詳細評価を実行する
   - エントロピー計算
   - 文字パターン分析
   - 辞書単語検出
   - キーボード配列パターン検出
5. **システム**がPasswordPolicyとの適合性を確認する
6. **システム**が過去のパスワード履歴との重複をチェックする
7. **システム**が総合強度スコア（0-100）を算出する
8. **システム**が強度レベル（弱・中・強・最強）を判定する
9. **システム**が視覚的な強度メーターを更新表示する
10. **システム**がポリシー準拠チェックリストを更新する
11. **システム**が具体的な改善提案を生成・表示する
12. **システム**が教育コンテンツ（セキュリティ知識）を推奨表示する
13. **システム**が評価結果をナレッジサービスに蓄積する（他サービス連携）

## 代替フロー

### 代替フロー1: 段階的評価（負荷分散）
- **分岐点**: ステップ2（強度評価開始）
- **条件**: システム負荷が高い、または複雑な入力
- **処理**:
  - 2a1. システムが段階的評価を選択する
  - 2a2. 基本評価（文字数・種別）を即座実行する
  - 2a3. 詳細評価（辞書・パターン）をバックグラウンド実行する
  - 2a4. 詳細評価完了時に結果を更新表示する

### 代替フロー2: 弱いパスワード検出時の緊急教育
- **分岐点**: ステップ8（強度レベル判定）
- **条件**: 極端に弱いパスワード（スコア30未満）
- **処理**:
  - 8a1. システムが緊急教育モードを起動する
  - 8a2. セキュリティリスク警告を目立つ形で表示する
  - 8a3. 即座改善可能な具体的提案を優先表示する
  - 8a4. セキュリティ教育コンテンツのポップアップ表示する

### 代替フロー3: 教育効果の個人化推奨
- **分岐点**: ステップ12（教育コンテンツ推奨）
- **条件**: ユーザーの過去の強度改善履歴が利用可能
- **処理**:
  - 12a1. システムがユーザーの学習履歴を分析する
  - 12a2. 個人の弱点領域を特定する
  - 12a3. カスタマイズされた教育コンテンツを提案する
  - 12a4. 段階的スキルアップのロードマップを表示する

## 例外フロー

### 例外1: 強度評価エンジン障害
- **発生点**: ステップ4（詳細評価実行）
- **処理**:
  - 4e1. システムが基本評価（文字数・種別のみ）に切り替える
  - 4e2. 「簡易評価モードで実行中」の通知を表示する
  - 4e3. 障害をシステムログに記録し、管理者に通知する
  - 4e4. 基本評価結果でフローを継続する

### 例外2: ポリシー情報取得失敗
- **発生点**: ステップ5（ポリシー適合性確認）
- **処理**:
  - 5e1. システムがデフォルトポリシー（NIST基準）を適用する
  - 5e2. 「標準セキュリティ基準で評価中」の注意書きを表示する
  - 5e3. ポリシー取得エラーをログに記録する

### 例外3: 履歴チェック不可
- **発生点**: ステップ6（履歴重複チェック）
- **処理**:
  - 6e1. 履歴チェックをスキップし、その旨を内部記録する
  - 6e2. ユーザーには通常通り評価結果を表示する
  - 6e3. 「履歴確認中...」の表示を継続し、後で結果更新する

## 特別要件

### 性能要件
- **リアルタイム応答**: 入力後500ms以内で基本評価表示
- **詳細評価**: 2秒以内で完全評価完了
- **同時処理**: 100ユーザーの同時評価処理
- **メモリ効率**: 評価データの即座解放

### セキュリティ要件
- **入力データ保護**: パスワード平文の即座メモリクリア
- **評価ログ制限**: パスワード内容はログに記録しない
- **プライバシー保護**: 個人の弱点情報の適切な匿名化

### ユーザビリティ要件
- **視覚的分かりやすさ**: 直感的な強度メーター表示
- **建設的フィードバック**: 批判ではなく改善提案重視
- **段階的ガイダンス**: 初心者にも分かりやすい説明
- **モチベーション維持**: 強度向上の成果の見える化

### 教育効果要件
- **セキュリティ意識向上**: パスワードセキュリティの重要性伝達
- **実践的スキル習得**: 強いパスワード作成技術の習得
- **継続的改善**: 長期的なセキュリティ行動の定着

## ドメインサービス連携
- **PasswordSecurityService.strengthen[PasswordResilience]()**: パスワード耐性強化
- **PasswordComplianceService.validate[PasswordComplexity]()**: 複雑性検証
- **PasswordComplianceService.detect[WeakPasswords]()**: 脆弱パスワード検知

## 入出力仕様

### 入力（フロントエンド → API）
```json
{
  "strengthCheck": {
    "password": "encrypted_password_data",
    "userId": "UUID",
    "context": "password_change|password_reset|new_account",
    "realTimeMode": true,
    "clientTimestamp": "2024-10-21T10:30:00Z"
  }
}
```

### 出力（API → フロントエンド）
```json
{
  "result": "success",
  "strengthAnalysis": {
    "score": 75,
    "level": "strong",
    "entropy": 45.2,
    "estimatedCrackTime": "2.3 years"
  },
  "policyCompliance": {
    "overallCompliant": true,
    "requirements": [
      {"name": "minLength", "required": 8, "actual": 12, "compliant": true},
      {"name": "upperCase", "required": true, "compliant": true},
      {"name": "lowerCase", "required": true, "compliant": true},
      {"name": "numbers", "required": true, "compliant": true},
      {"name": "symbols", "required": true, "compliant": false}
    ]
  },
  "weaknessDetection": {
    "dictionaryWords": ["password"],
    "keyboardPatterns": ["qwerty"],
    "repetitivePatterns": ["aaa"],
    "commonSubstitutions": ["@" for "a"]
  },
  "improvements": [
    {
      "priority": "high",
      "issue": "記号を含める",
      "suggestion": "!@#$%のいずれかを追加してください",
      "example": "P@ssw0rd2024!"
    },
    {
      "priority": "medium",
      "issue": "文字数を増やす",
      "suggestion": "2-3文字追加でより安全になります",
      "example": null
    }
  ],
  "education": {
    "securityTips": [
      "記号を使用すると攻撃耐性が大幅に向上します",
      "パスワードマネージャーの活用をお勧めします"
    ],
    "recommendedResources": [
      {"title": "強いパスワードの作り方", "url": "/security/guide/passwords"},
      {"title": "パスワードマネージャー活用法", "url": "/security/guide/managers"}
    ]
  },
  "motivation": {
    "currentRank": "上位25%",
    "improvement": "+20ポイント向上しました",
    "nextGoal": "最強レベルまで残り15ポイント"
  }
}
```

## 強度評価アルゴリズム

### 基本スコア計算（40点満点）
- **文字数**: 8文字以上で基本点、以降1文字+2点
- **文字種多様性**: 大文字・小文字・数字・記号の組み合わせ
- **長さボーナス**: 16文字以上で追加ボーナス

### 複雑性評価（40点満点）
- **エントロピー計算**: Shannon entropy による情報量評価
- **予測困難性**: マルコフチェーンによる推測困難度
- **ユニーク性**: 一般的なパスワードパターンとの差別化

### セキュリティ減点（-20点〜0点）
- **辞書単語使用**: 一般辞書・固有名詞辞書との照合
- **キーボードパターン**: qwerty、123456等の規則的配列
- **反復パターン**: 同一文字・文字列の反復
- **個人情報推測**: 名前・生年月日等の推測可能情報

### 総合評価（20点満点）
- **ポリシー準拠**: 組織ポリシーとの適合度
- **履歴確認**: 過去パスワードとの重複回避
- **実用性**: 覚えやすさと安全性のバランス

## 関連ユースケース
- **UC-PASS-01**: パスワードを変更する（強度確認機能として連携）
- **UC-PASS-02**: パスワードポリシーを設定する（評価基準の参照）
- **UC-PASS-03**: パスワードをリセットする（新パスワード強度確認）
- **UC-KNOWLEDGE-02**: パスワード教育資料を蓄積する（他サービス連携）

---
*このユースケースは、パスワードセキュリティの教育効果を最大化し、ユーザーの自発的なセキュリティ行動向上を実現するパラソル設計v2.0仕様に基づいています*