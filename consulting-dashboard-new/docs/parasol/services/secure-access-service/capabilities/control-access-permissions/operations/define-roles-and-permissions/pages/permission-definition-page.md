# ページ定義: 権限定義ページ

## 基本情報

- **ページID**: PG-SEC-033
- **ページ名**: 権限定義ページ
- **URL**: `/admin/permissions/definition`
- **対応ユースケース**: UC-SEC-033 (権限を定義する)
- **アクセス権限**: セキュリティ管理者, システム管理者, アプリケーション管理者, コンプライアンス担当者

## 画面の目的

システムリソースへの詳細なアクセス権限を定義し、適切なセキュリティポリシーを実装する画面。管理者が直感的に権限設計を行い、最小権限の原則に基づいた安全なアクセス制御を実現する。

## 利用者

- **セキュリティ管理者**: 組織全体の権限体系を設計・管理
- **システム管理者**: システムレベルの技術的権限設定
- **アプリケーション管理者**: アプリケーション固有の機能権限設計
- **コンプライアンス担当者**: 法規制要件に基づく権限制約の確認

## 画面構成

### ヘッダー部
- **ページタイトル**: 「権限定義」
- **パンくずナビ**: ホーム > セキュリティ管理 > アクセス制御 > 権限定義
- **ヘルプボタン**: 権限定義ガイドとベストプラクティス
- **設定メニュー**: 権限カテゴリ管理、テンプレート設定

### メインコンテンツ部

#### 権限基本情報セクション
- **権限名入力フィールド**:
  - 必須項目、最大100文字
  - 命名規約（リソース_操作_レベル）のガイダンス
  - 重複チェックと類似権限の提案
- **権限説明入力エリア**:
  - 自由記述、最大500文字
  - 具体的なアクセス内容と制限の詳細説明
- **権限カテゴリ選択**:
  - 階層ドロップダウン形式
  - システム、データ、機能、管理等の分類
- **権限レベル設定**:
  - 読取り、更新、作成、削除、管理の5段階
  - ラジオボタンまたはスライダー形式

#### リソース対象設定セクション
- **対象システム選択**:
  - チェックボックス形式
  - システム別の権限適用範囲
- **対象データ分類**:
  - 個人情報、機密情報、公開情報等
  - データ分類レベルによるアクセス制御
- **機能モジュール選択**:
  - アプリケーション機能別の詳細設定
  - モジュール依存関係の可視化

#### アクセス操作定義セクション
- **許可操作の設定**:
  - CRUD操作の詳細定義
  - 操作別の制限条件設定
- **拒否操作の設定**:
  - 明示的に禁止する操作
  - セキュリティポリシーに基づく制限
- **条件付き操作**:
  - 時間制限（営業時間内等）
  - 承認フロー必須操作
  - 多要素認証必須操作

#### 権限制約・条件セクション
- **時間制約設定**:
  - アクセス可能時間帯の設定
  - 休日・夜間制限の設定
- **場所制約設定**:
  - IP制限、地理的制限
  - デバイス制限（認証済み端末等）
- **使用制限設定**:
  - 同時アクセス数制限
  - 一日の使用回数制限
  - データ量制限

#### 権限依存関係セクション
- **前提権限設定**:
  - この権限に必要な前提権限
  - 依存関係の循環チェック
- **排他権限設定**:
  - 同時に持てない権限の設定
  - 職務分離の原則の実装
- **継承関係設定**:
  - 上位権限からの継承設定
  - 継承レベルとカスタマイズ

### サイドバー部

#### 権限テンプレート・参考情報
- **業界標準テンプレート**:
  - ISO27001、SOX法等の標準的権限
  - 業界別のベストプラクティス
- **既存権限検索**:
  - キーワードベースの検索
  - 類似権限の提案
- **権限マトリックス表示**:
  - 現在定義済みの権限一覧
  - ロール×権限のマトリックス

#### 検証・ガイダンス
- **権限設計ガイドライン**:
  - 最小権限の原則
  - 職務分離の実装方法
- **コンプライアンスチェック**:
  - 法規制要件への適合性
  - セキュリティ基準の確認
- **影響分析**:
  - 権限変更の影響範囲
  - 既存ユーザーへの影響

### フッター部
- **アクションボタン**:
  - 下書き保存、権限テスト、承認申請
  - 権限プレビュー、影響分析実行
- **バリデーション結果**:
  - 必須項目の確認状況
  - セキュリティチェック結果
- **最終更新情報**:
  - 更新者、更新日時、変更内容

## データ表示

### 表示データ一覧

| データ項目 | 表示形式 | 必須 | 説明 |
|-----------|---------|------|------|
| 既存権限一覧 | ツリー表示 | ○ | カテゴリ別の権限構造 |
| 権限テンプレート | カード表示 | × | 選択可能な権限テンプレート |
| リソース一覧 | 階層表示 | ○ | アクセス対象のシステム・データ |
| 依存関係グラフ | ネットワーク図 | × | 権限間の関連性可視化 |
| セキュリティ警告 | アラート表示 | ○ | リスク・違反の警告 |

### データの更新頻度
- **権限一覧**: リアルタイム更新
- **リソース情報**: 日次更新
- **コンプライアンス基準**: 週次更新

## 入力項目

### フォーム一覧

| 入力項目 | 入力形式 | 必須 | バリデーション | 説明 |
|---------|---------|------|---------------|------|
| 権限名 | テキスト | ○ | 1-100文字、一意性 | 権限の識別名 |
| 権限説明 | テキストエリア | ○ | 1-500文字 | 権限の詳細説明 |
| 権限カテゴリ | 階層選択 | ○ | 事前定義値 | 権限の分類 |
| 権限レベル | ラジオボタン | ○ | Read/Update/Create/Delete/Admin | アクセスレベル |
| 対象システム | チェックボックス | ○ | 1つ以上選択 | 適用対象システム |
| 許可操作 | チェックボックス | ○ | 1つ以上選択 | 許可する操作 |
| 拒否操作 | チェックボックス | × | - | 明示的に拒否する操作 |
| 時間制約 | 時間選択 | × | 24時間形式 | アクセス可能時間 |
| 場所制約 | テキスト | × | IP/地域形式 | アクセス許可場所 |

## アクション・操作

### 主要アクション
- **新規権限作成**: 空白フォームでの新規作成
- **テンプレート使用**: 既存テンプレートからの作成
- **権限複製**: 既存権限をベースとした作成
- **権限テスト**: 設定した権限での動作確認
- **影響分析実行**: 権限変更の影響範囲分析
- **承認申請**: 承認ワークフローへの送信

### 副次アクション
- **競合チェック**: 他権限との競合確認
- **依存関係確認**: 前提・排他権限の確認
- **コンプライアンス検証**: 法規制への適合性確認
- **権限プレビュー**: 実際のアクセス可能範囲表示

## 画面の振る舞い

### ユーザー操作への反応
- **権限名入力時**: リアルタイム重複チェックと命名規約確認
- **カテゴリ選択時**: 関連する権限テンプレートの自動表示
- **操作選択時**: 必要な前提権限と排他権限の自動チェック
- **制約設定時**: セキュリティレベルの自動計算と警告表示

### 条件による表示変更
- **管理権限作成時**: 追加のセキュリティ確認とリスク警告
- **データアクセス権限時**: データ分類とプライバシー要件の詳細設定
- **システム権限作成時**: 技術的制約と依存関係の詳細表示

## 画面遷移

### 遷移元画面
- 権限管理トップページ: 権限一覧からの新規作成
- ロール定義ページ: ロール作成時の関連権限定義
- セキュリティ監査ページ: 監査結果に基づく権限修正

### 遷移先画面
- ロール割り当てページ: 権限作成後のロール関連付け
- 権限テストページ: 定義した権限での動作確認
- 承認待ち一覧: 承認申請後の状況確認

## エラーハンドリング

- **権限名重複エラー**: 代替名の提案と既存権限との差分表示
- **権限競合エラー**: 競合する権限の詳細と解決案の提示
- **依存関係エラー**: 循環依存の検出と修正ガイダンス
- **セキュリティ違反**: リスクレベルの説明と緩和策の提示

## アクセシビリティ要件

- **キーボードナビゲーション**: 複雑なフォームでのTab順序最適化
- **スクリーンリーダー対応**: 権限マトリックスの適切な読み上げ
- **ハイコントラスト対応**: セキュリティレベル別の色分け配慮
- **拡大表示対応**: 複雑な図表の拡大機能

## レスポンシブ対応

- **デスクトップ（1200px以上）**:
  - 3ペインレイアウト（定義、プレビュー、参考情報）
  - 詳細な権限マトリックスと依存関係グラフ
- **タブレット（768px-1199px）**:
  - 2ペインレイアウト（メイン、折りたたみサイド）
  - 簡略化された権限表示
- **モバイル（767px以下）**:
  - 1ペインレイアウト（アコーディオン形式）
  - ステップ別の権限定義ウィザード

## パフォーマンス要件

- **初期表示**: 3秒以内
- **権限競合チェック**: 2秒以内
- **依存関係分析**: 5秒以内
- **影響分析実行**: 10秒以内

## セキュリティ要件

- **入力値検証**: SQLインジェクション、XSS攻撃の防止
- **権限昇格防止**: 現在のユーザー権限を超える権限作成の制限
- **監査ログ**: 全ての権限定義操作の詳細記録
- **暗号化保存**: 機密権限情報の暗号化

## 特殊機能

### 権限シミュレーション
- **仮想ユーザー作成**: 定義した権限での動作確認
- **アクセステスト**: 実際のリソースへのアクセス可否確認
- **権限継承テスト**: 複雑な継承関係での動作検証

### AI支援機能
- **権限推奨**: 業務内容に基づく最適権限の提案
- **リスク分析**: 権限組み合わせのリスク自動評価
- **コンプライアンス確認**: 法規制への適合性自動チェック