# ページ定義: ロール定義ページ

## 基本情報

- **ページID**: PG-SEC-032
- **ページ名**: ロール定義ページ
- **URL**: `/admin/roles/definition`
- **対応ユースケース**: UC-SEC-032 (ロールを定義する)
- **アクセス権限**: セキュリティ管理者, 部門長, HR担当者, システム管理者

## 画面の目的

組織の職務と責任に基づいて新しいロールを定義し、適切な権限体系の基盤を構築する画面。ユーザーが直感的にロール定義を行い、組織構造に適合したアクセス制御を実現する。

## 利用者

- **セキュリティ管理者**: 組織全体のロール体系を設計・管理
- **部門長**: 部門固有のロール定義と承認
- **HR担当者**: 職務に基づくロール設計の支援
- **システム管理者**: 技術的な権限要件の調整

## 画面構成

### ヘッダー部
- **ページタイトル**: 「ロール定義」
- **パンくずナビ**: ホーム > セキュリティ管理 > アクセス制御 > ロール定義
- **ヘルプボタン**: ロール定義ガイドへのリンク
- **設定メニュー**: ロール定義設定、テンプレート管理

### メインコンテンツ部

#### ロール基本情報セクション
- **ロール名入力フィールド**:
  - 必須項目、最大100文字
  - 命名規約のガイダンス表示
  - 重複チェック機能
- **ロール説明入力エリア**:
  - 自由記述、最大500文字
  - 職務内容と責任範囲の詳細説明
- **ロールカテゴリ選択**:
  - ドロップダウン形式
  - 管理者、一般、特別権限、一時的等
- **優先度レベル設定**:
  - スライダー形式（1-10）
  - 権限競合時の解決優先度

#### 組織階層設定セクション
- **親ロール選択**:
  - 階層構造での位置設定
  - 既存ロール一覧から選択
  - 継承関係の可視化
- **ロール階層プレビュー**:
  - ツリー構造での表示
  - ドラッグ&ドロップでの調整
  - 循環参照の自動チェック

#### 責任範囲定義セクション
- **対象システム選択**:
  - チェックボックス形式
  - システム別の責任範囲設定
- **業務プロセス範囲**:
  - 業務フロー図での選択
  - プロセス段階別の関与度設定
- **データ分類アクセス**:
  - 機密レベル別のアクセス範囲
  - 個人情報、機密情報等の取扱い

#### 制約・条件設定セクション
- **有効期間設定**:
  - 開始日・終了日の設定
  - 無期限・期間限定の選択
- **アクセス条件**:
  - 時間制限（勤務時間内等）
  - 場所制限（オフィス内等）
  - デバイス制限（認証デバイス等）
- **例外条件**:
  - 緊急時の特別アクセス
  - 災害時の権限昇格

### サイドバー部

#### 既存ロール参照
- **類似ロール検索**:
  - キーワードベースの検索
  - 権限範囲での絞り込み
- **ロールテンプレート**:
  - 業界標準テンプレート
  - 組織固有テンプレート
  - お気に入りテンプレート

#### 進捗・ガイダンス
- **定義進捗インジケーター**:
  - 必須項目の完了状況
  - 推奨項目の設定状況
- **ベストプラクティス**:
  - ロール設計のガイドライン
  - セキュリティ推奨事項

### フッター部
- **アクションボタン**:
  - 下書き保存、プレビュー、承認申請
  - 前の画面に戻る、キャンセル
- **承認状況表示**:
  - 承認待ち、承認済み、差し戻し
- **最終更新情報**:
  - 更新者、更新日時

## データ表示

### 表示データ一覧

| データ項目 | 表示形式 | 必須 | 説明 |
|-----------|---------|------|------|
| 既存ロール一覧 | ツリー表示 | ○ | 組織の現在のロール構造 |
| 権限テンプレート | カード表示 | × | 選択可能な権限テンプレート |
| 類似ロール候補 | リスト表示 | × | 重複回避のための参考情報 |
| 職務分離警告 | アラート表示 | ○ | 職務分離違反の警告 |
| 承認ワークフロー | フロー図 | ○ | 承認プロセスの可視化 |

### データの更新頻度
- **ロール一覧**: リアルタイム更新
- **権限テンプレート**: 日次更新
- **承認状況**: リアルタイム更新

## 入力項目

### フォーム一覧

| 入力項目 | 入力形式 | 必須 | バリデーション | 説明 |
|---------|---------|------|---------------|------|
| ロール名 | テキスト | ○ | 1-100文字、一意性 | ロールの識別名 |
| ロール説明 | テキストエリア | ○ | 1-500文字 | ロールの詳細説明 |
| カテゴリ | ドロップダウン | ○ | 事前定義値 | ロールの分類 |
| 優先度 | スライダー | × | 1-10 | 権限競合時の優先度 |
| 親ロール | 選択 | × | 既存ロール | 継承元ロール |
| 有効開始日 | 日付 | ○ | 本日以降 | ロールの有効開始日 |
| 有効終了日 | 日付 | × | 開始日以降 | ロールの有効終了日 |
| 対象システム | チェックボックス | ○ | 1つ以上選択 | アクセス対象システム |

## アクション・操作

### 主要アクション
- **新規ロール作成**: 空白フォームでの新規作成
- **テンプレート使用**: 既存テンプレートからの作成
- **既存ロール複製**: 既存ロールをベースとした作成
- **下書き保存**: 作成途中での一時保存
- **プレビュー表示**: 設定内容の確認表示
- **承認申請**: 承認ワークフローへの送信

### 副次アクション
- **重複チェック**: 類似ロールとの比較
- **権限プレビュー**: 権限割り当て結果の予測表示
- **影響分析**: 組織への影響度分析
- **テンプレート保存**: 現在の設定をテンプレート化

## 画面の振る舞い

### ユーザー操作への反応
- **ロール名入力時**: リアルタイム重複チェックと命名規約確認
- **親ロール選択時**: 継承権限の自動表示と循環参照チェック
- **システム選択時**: 関連する権限カテゴリの自動表示
- **有効期間設定時**: 一時ロールとしての特別設定項目表示

### 条件による表示変更
- **管理者ロール作成時**: 追加のセキュリティ確認項目表示
- **期間限定ロール時**: 自動失効設定と通知設定表示
- **階層ロール作成時**: 権限継承の詳細設定表示

## 画面遷移

### 遷移元画面
- ロール管理トップページ: ロール一覧からの新規作成
- ロール検索結果: 類似ロールからの派生作成
- 権限管理ページ: 権限からの逆引きロール作成

### 遷移先画面
- 権限割り当てページ: ロール作成後の権限設定
- 承認待ち一覧: 承認申請後の状況確認
- ロール一覧ページ: 作成完了後の一覧表示

## エラーハンドリング

- **ロール名重複エラー**: 代替名の提案と既存ロールとの比較表示
- **権限競合エラー**: 競合する権限の詳細表示と解決案提示
- **職務分離違反**: 違反内容の説明と対応方法のガイダンス
- **承認拒否**: 拒否理由の表示と修正ガイドの提示

## アクセシビリティ要件

- **キーボードナビゲーション**: Tab順序での全項目アクセス
- **スクリーンリーダー対応**: 入力項目の適切なラベリング
- **カラーアクセシビリティ**: 色覚障害者への配慮した色使い
- **フォントサイズ調整**: 文字サイズの動的変更対応

## レスポンシブ対応

- **デスクトップ（1200px以上）**:
  - 3カラムレイアウト（メイン、サイドバー、プレビュー）
  - 詳細な権限マトリックス表示
- **タブレット（768px-1199px）**:
  - 2カラムレイアウト（メイン、折りたたみサイドバー）
  - 簡略化された権限表示
- **モバイル（767px以下）**:
  - 1カラムレイアウト（順次表示）
  - アコーディオン形式のセクション表示

## パフォーマンス要件

- **初期表示**: 3秒以内
- **重複チェック**: 1秒以内
- **権限プレビュー**: 5秒以内
- **保存処理**: 2秒以内

## セキュリティ要件

- **入力値サニタイゼーション**: XSS攻撃の防止
- **CSRF防止**: トークンによる不正送信防止
- **操作ログ記録**: 全ての定義操作の監査証跡
- **権限確認**: 各操作前の権限チェック