# ページ定義: ロール権限割り当てページ

## 基本情報

- **ページID**: PG-SEC-034
- **ページ名**: ロール権限割り当てページ
- **URL**: `/admin/roles/{roleId}/permissions/assignment`
- **対応ユースケース**: UC-SEC-034 (ロールに権限を割り当てる)
- **アクセス権限**: セキュリティ管理者, システム管理者, アプリケーション管理者, 監査担当者

## 画面の目的

定義済みのロールに対して適切な権限を割り当て、実用的なアクセス制御マトリックスを構築する画面。管理者が直感的な操作で権限割り当てを行い、セキュリティポリシーに準拠した効果的なアクセス制御を実現する。

## 利用者

- **セキュリティ管理者**: 組織全体の権限割り当て戦略を実装
- **システム管理者**: システムレベルの権限を技術的観点から割り当て
- **アプリケーション管理者**: アプリケーション固有の機能権限を設定
- **監査担当者**: 割り当て内容のコンプライアンス適合性を確認

## 画面構成

### ヘッダー部
- **ページタイトル**: 「{ロール名} - 権限割り当て」
- **パンくずナビ**: ホーム > セキュリティ管理 > ロール管理 > {ロール名} > 権限割り当て
- **ロール基本情報**: ロール名、説明、カテゴリ、最終更新日
- **操作メニュー**: 一括操作、テンプレート適用、設定エクスポート

### メインコンテンツ部

#### 現在の権限割り当て状況セクション
- **権限マトリックス表示**:
  - 2次元テーブル形式（権限カテゴリ × アクセスレベル）
  - チェックボックスによる直感的な設定
  - 色分けによる権限レベルの可視化
- **継承権限表示**:
  - 親ロールから継承される権限
  - 継承元の明示と継承可否の設定
  - オーバーライド設定の表示
- **権限統計情報**:
  - 総権限数、有効権限数、制限付き権限数
  - セキュリティレベルスコア
  - 最小権限原則への適合度

#### 利用可能権限一覧セクション
- **カテゴリ別権限表示**:
  - アコーディオン形式での権限分類
  - 検索・フィルタリング機能
  - 権限の詳細説明表示
- **権限選択インターフェース**:
  - ドラッグ&ドロップによる権限移動
  - 一括選択・一括解除機能
  - 条件付き選択（時間・場所制限等）
- **推奨権限表示**:
  - 同類ロールでよく使用される権限
  - AIによる推奨権限の提案
  - ベストプラクティスに基づく提案

#### 権限設定詳細セクション
- **個別権限設定**:
  - 選択された権限の詳細条件設定
  - 有効期間、時間制限、場所制限
  - 承認フロー要否の設定
- **権限グループ設定**:
  - 関連権限のグループ化
  - グループ単位での一括設定
  - グループ間の依存関係設定
- **例外・特別条件**:
  - 緊急時の特別権限設定
  - 災害時・夜間等の例外条件
  - 代理権限の設定

#### 検証・プレビューセクション
- **権限競合チェック**:
  - 既存権限との競合検出
  - 職務分離違反の警告
  - 権限過多の警告表示
- **影響範囲分析**:
  - 現在のユーザーへの影響
  - システムアクセスパターンの変化
  - セキュリティリスクの評価
- **割り当て結果プレビュー**:
  - 最終的な権限セットの表示
  - 実際のアクセス可能範囲の確認
  - ユーザー視点でのアクセス画面プレビュー

### サイドバー部

#### 権限テンプレート・参考情報
- **ロールテンプレート**:
  - 業界標準ロールの権限セット
  - 組織内の類似ロール権限
  - カスタムテンプレートの管理
- **権限履歴・監査**:
  - 過去の権限変更履歴
  - 変更理由と承認者情報
  - 監査ログの詳細表示
- **関連ロール情報**:
  - 類似ロールとの権限比較
  - 階層関係にあるロールの権限
  - 権限継承関係の可視化

#### ガイダンス・ヘルプ
- **権限設計ガイドライン**:
  - 最小権限の原則
  - 職務分離の実装ガイド
  - セキュリティベストプラクティス
- **コンプライアンス要件**:
  - 適用される法規制・基準
  - 必須権限・禁止権限
  - 監査要件への対応

### フッター部
- **アクションボタン**:
  - 下書き保存、権限テスト、承認申請
  - 変更取り消し、前回保存時に戻る
- **承認ワークフロー表示**:
  - 承認ルートの可視化
  - 現在の承認状況
  - 次の承認者情報
- **保存状況**:
  - 最終保存日時、保存者
  - 未保存の変更内容

## データ表示

### 表示データ一覧

| データ項目 | 表示形式 | 必須 | 説明 |
|-----------|---------|------|------|
| 現在の権限一覧 | マトリックス表示 | ○ | ロールに現在割り当てられた権限 |
| 利用可能権限 | ツリー表示 | ○ | 選択可能な全権限のカテゴリ別表示 |
| 継承権限 | 階層表示 | × | 親ロールから継承される権限 |
| 権限依存関係 | グラフ表示 | × | 権限間の依存・排他関係 |
| 推奨権限 | ランキング表示 | × | AI・統計に基づく推奨権限 |
| 競合・警告 | アラート表示 | ○ | セキュリティリスク・違反警告 |

### データの更新頻度
- **権限割り当て状況**: リアルタイム更新
- **権限マスタ**: 日次更新
- **推奨情報**: 週次更新

## 入力項目

### フォーム一覧

| 入力項目 | 入力形式 | 必須 | バリデーション | 説明 |
|---------|---------|------|---------------|------|
| 権限選択 | チェックボックス | ○ | 1つ以上選択 | 割り当てる権限の選択 |
| 有効期間 | 日付範囲 | × | 論理的整合性 | 権限の有効期間 |
| 時間制限 | 時間選択 | × | 24時間形式 | アクセス可能時間帯 |
| 場所制限 | テキスト | × | IP/地域形式 | アクセス許可場所 |
| 承認要否 | ラジオボタン | × | Yes/No | 使用時の承認要否 |
| 継承設定 | チェックボックス | × | - | 親ロールからの継承可否 |
| 優先度 | スライダー | × | 1-10 | 権限競合時の優先度 |
| 適用理由 | テキストエリア | ○ | 1-200文字 | 割り当て理由の記載 |

## アクション・操作

### 主要アクション
- **権限追加**: 利用可能権限から選択して追加
- **権限削除**: 現在の権限から選択して削除
- **一括操作**: 複数権限の一括追加・削除
- **テンプレート適用**: 既存テンプレートの一括適用
- **権限テスト**: 設定した権限での動作確認
- **承認申請**: 承認ワークフローへの送信

### 副次アクション
- **権限比較**: 他ロールとの権限比較
- **継承設定**: 親子ロール間の権限継承設定
- **プレビュー表示**: ユーザー画面での表示確認
- **エクスポート**: 権限設定のファイル出力
- **履歴確認**: 過去の変更履歴表示

## 画面の振る舞い

### ユーザー操作への反応
- **権限選択時**: 関連権限・依存権限の自動表示と推奨
- **競合検出時**: リアルタイム警告と解決案の提示
- **権限削除時**: 影響範囲の確認とユーザーへの警告
- **テンプレート適用時**: 既存設定との差分表示と確認

### 条件による表示変更
- **管理権限選択時**: 追加のセキュリティ確認と二段階認証設定
- **機密データ権限時**: データ分類レベルと取扱い注意事項の表示
- **システム権限選択時**: 技術的影響と安定性への配慮事項表示

## 画面遷移

### 遷移元画面
- ロール管理一覧: ロールからの権限設定
- ロール詳細ページ: ロール情報確認後の権限設定
- 権限管理ページ: 権限からの逆引きロール設定

### 遷移先画面
- ロール詳細ページ: 権限設定完了後の確認
- 権限テストページ: 設定した権限での動作確認
- 承認待ち一覧: 承認申請後の状況確認
- ユーザー割り当てページ: ロール設定後のユーザー割り当て

## エラーハンドリング

- **権限競合エラー**: 競合する権限の詳細と優先度による解決案
- **職務分離違反**: 違反内容の説明と代替権限の提案
- **権限過多警告**: 最小権限原則に基づく最適化提案
- **依存関係エラー**: 必要な前提権限の自動追加提案
- **承認拒否**: 拒否理由の詳細と修正ガイダンス

## アクセシビリティ要件

- **キーボードナビゲーション**: 複雑なマトリックス表での効率的な移動
- **スクリーンリーダー対応**: 権限マトリックスの適切な読み上げ順序
- **カラーアクセシビリティ**: 権限レベル表現の色以外の識別方法
- **拡大表示対応**: 詳細な権限設定画面の可読性確保

## レスポンシブ対応

- **デスクトップ（1200px以上）**:
  - 4ペインレイアウト（現在権限、利用可能権限、設定詳細、プレビュー）
  - 詳細な権限マトリックスとリアルタイム更新
- **タブレット（768px-1199px）**:
  - 3ペインレイアウト（タブ切り替え式）
  - 簡略化された権限表示
- **モバイル（767px以下）**:
  - 1ペインレイアウト（ウィザード形式）
  - ステップバイステップの権限設定

## パフォーマンス要件

- **初期表示**: 5秒以内
- **権限競合チェック**: 2秒以内
- **権限追加・削除**: 1秒以内
- **プレビュー生成**: 3秒以内
- **一括操作**: 10秒以内

## セキュリティ要件

- **操作認証**: 重要権限変更時の再認証
- **変更制限**: 現在のユーザー権限を超える権限付与の防止
- **監査ログ**: 全ての権限変更操作の詳細記録
- **暗号化通信**: 権限情報の安全な送受信

## 特殊機能

### ドラッグ&ドロップ機能
- **権限移動**: 利用可能権限から現在権限への直感的な移動
- **グループ操作**: 関連権限のグループ単位での一括移動
- **優先度調整**: 権限リスト内での優先度の視覚的調整

### AI支援機能
- **最適化提案**: 現在の権限セットの最適化案の自動生成
- **リスク分析**: 権限組み合わせのセキュリティリスク自動評価
- **使用予測**: 実際の権限使用パターンの予測と提案

### バルク操作機能
- **CSV インポート**: 大量権限設定のファイル一括取り込み
- **テンプレート一括適用**: 複数ロールへの権限テンプレート適用
- **差分比較**: 複数ロール間の権限差分の可視化