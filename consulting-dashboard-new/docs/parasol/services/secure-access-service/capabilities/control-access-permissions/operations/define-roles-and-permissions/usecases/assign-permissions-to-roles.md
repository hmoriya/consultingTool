# ユースケース: ロールに権限を割り当てる

## 基本情報

- **ユースケースID**: UC-SEC-034
- **ユースケース名**: ロールに権限を割り当てる
- **アクター**: セキュリティ管理者, システム管理者, アプリケーション管理者, 監査担当者
- **概要**: 定義済みのロールに対して適切な権限を割り当て、アクセス制御マトリックスを構築する

## 事前条件

- ユーザーがロール・権限管理権限を持っている
- 対象ロールが定義済みである
- 割り当て対象の権限が定義済みである
- セキュリティポリシーに基づく権限割り当てルールが策定されている

## 事後条件

### 成功時
- ロールに権限が正常に割り当てられる
- アクセス制御マトリックスが更新される
- 権限継承関係が確立される
- 承認ワークフローが開始される

### 失敗時
- エラーメッセージが表示される
- 権限割り当て状態が保持される
- 失敗理由が記録される

## 基本フロー

1. セキュリティ管理者が権限割り当てプロセスを開始する
2. システムが利用可能なロール一覧を表示する
3. 管理者が対象ロールを選択する
4. システムが現在の権限割り当て状況を表示する
5. システムが割り当て可能な権限一覧を表示する
6. 管理者が追加・削除する権限を選択する
7. システムが権限競合と依存関係を検証する
8. 管理者が権限割り当ての適用範囲を設定する
9. システムが職務分離の原則への適合性を検証する
10. システムが割り当て内容のプレビューを表示する
11. 管理者が割り当て内容を確認・承認する
12. システムが権限割り当てを実行する
13. システムが権限割り当て履歴を記録する

## 代替フロー

### 代替フロー1: 権限継承による割り当て
- 6a. 親ロールからの権限継承を設定する場合
  - 6a1. 管理者が継承元ロールを選択する
  - 6a2. システムが継承される権限を表示する
  - 6a3. 管理者が継承対象外の権限を設定する
  - 6a4. 基本フロー7に進む

### 代替フロー2: 権限テンプレートからの一括割り当て
- 6a. 権限テンプレートを使用する場合
  - 6a1. 管理者が適用する権限テンプレートを選択する
  - 6a2. システムがテンプレートの権限内容を表示する
  - 6a3. 管理者がカスタマイズする権限を調整する
  - 6a4. 基本フロー7に進む

### 代替フロー3: 条件付き権限の割り当て
- 8a. 特定条件下での権限を割り当てる場合
  - 8a1. 管理者が条件付き権限として設定する
  - 8a2. システムが条件設定フォームを表示する
  - 8a3. 管理者が有効化条件（時間・場所・状況）を設定する
  - 8a4. 基本フロー9に進む

## 例外フロー

### 例外1: 権限競合の検出
- 7a. 割り当てようとする権限に競合が発生する場合
  - 7a1. システムが競合する権限を特定し表示する
  - 7a2. システムが競合解決案を提示する
  - 7a3. 管理者が競合解決方法を選択する
  - 7a4. 基本フロー7を再実行する

### 例外2: 職務分離違反
- 9a. 権限割り当てが職務分離原則に違反する場合
  - 9a1. システムが違反内容を詳細表示する
  - 9a2. システムが代替案を提示する
  - 9a3. 管理者が権限割り当てを修正する
  - 9a4. 基本フロー9を再実行する

### 例外3: 権限過多の警告
- 10a. 割り当て後の権限が過剰と判定される場合
  - 10a1. システムが過剰権限の警告を表示する
  - 10a2. システムが最小権限の原則に基づく推奨案を提示する
  - 10a3. 管理者が権限の見直しを実行する
  - 10a4. 基本フロー10を再実行する

### 例外4: 承認拒否
- 12a. 承認者が権限割り当てを拒否した場合
  - 12a1. システムが拒否理由を管理者に通知する
  - 12a2. 管理者が指摘事項に基づき権限割り当てを修正する
  - 12a3. システムが修正版を再承認に送信する

## 特別要件

### 性能要件
- 権限一覧表示: 3秒以内
- 権限競合検証: 5秒以内
- 職務分離検証: 10秒以内
- 権限割り当て実行: 3秒以内

### セキュリティ要件
- 権限割り当ての暗号化保存
- 操作者の認証と権限確認
- 全操作の監査ログ記録
- 権限変更の即座反映

### 可用性要件
- 24時間365日の権限割り当て機能提供
- 99.9%以上のシステム稼働率

## 非機能要件

### 使いやすさ
- 直感的な権限割り当てインターフェース
- ドラッグ&ドロップでの権限操作
- リアルタイムな競合チェック
- 権限プレビューと影響範囲表示

### 拡張性
- 新しい権限タイプへの対応
- 複雑な条件式の設定
- 大規模組織での権限管理

## ビジネスルール

### 権限割り当ての原則
- **最小権限の原則**: 必要最小限の権限のみを付与
- **職務分離の原則**: 重要な処理は複数の権限に分離
- **継承の制御**: 上位ロールからの権限継承を適切に管理
- **期限管理**: 一時的な権限には有効期限を設定

### 権限競合の解決ルール
- **明示的優先**: 明示的に設定された権限が継承より優先
- **拒否優先**: 拒否権限が許可権限より優先
- **最新優先**: 同レベルの権限では最新の設定が優先

### 承認ワークフロールール
- **重要権限**: 管理者権限は二段階承認が必要
- **一般権限**: 部門長の一段階承認で十分
- **緊急時**: 緊急権限は事後承認を許可

### 権限の有効化ルール
- **即座反映**: 一般権限は設定後即座に有効化
- **スケジュール反映**: 重要権限は指定時刻に有効化
- **手動反映**: 特権権限は手動承認後に有効化

## 関連ユースケース

- **前提**: UC-SEC-032 (ロールを定義する) - 割り当て対象ロールの存在
- **前提**: UC-SEC-033 (権限を定義する) - 割り当て対象権限の存在
- **関連**: UC-SEC-035 (ロールを見直す) - 権限割り当ての定期見直し
- **後続**: UC-SEC-036 (権限を検証する) - 割り当て後の権限検証

## 実装ノート

### データ要件
- ロール-権限関連（RoleID、PermissionID、関連情報）
- 権限継承関係（親子ロール、継承設定）
- 条件設定（時間制限、場所制限、状況制限）
- 承認情報（承認者、承認日時、承認状態）

### 技術的考慮事項
- 権限マトリックスの効率的な管理
- 大量権限での検索・フィルタリング最適化
- リアルタイム権限検証の実装
- 権限キャッシュの整合性管理

### UI/UX要件
- 権限マトリックスの視覚的表現
- ドラッグ&ドロップでの権限移動
- 権限依存関係の可視化
- 権限プレビューダッシュボード

### データ整合性
- ロール削除時の権限関連チェック
- 権限変更時の影響範囲確認
- 継承関係の循環参照チェック
- トランザクション整合性の保証

### 承認ワークフロー
- 権限レベル別の承認ルート設定
- 段階的承認プロセスの実装
- 緊急時の特別承認手順
- 承認期限の自動管理

### 監査要件
- 権限割り当ての完全な変更履歴
- 承認プロセスの詳細記録
- コンプライアンス要件への対応
- 定期的な権限レビューの自動化

### パフォーマンス最適化
- 権限キャッシュの戦略的配置
- データベースインデックスの最適化
- 権限評価エンジンの高速化
- バッチ処理による大量権限更新

### セキュリティ強化
- 権限変更の二要素認証
- 機密権限の特別保護
- 権限昇格の防止機能
- 異常権限変更の検出

### 国際化対応
- 多言語での権限名・説明表示
- 地域別の権限体系への対応
- タイムゾーンを考慮した権限管理