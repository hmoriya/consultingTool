# ユースケース: 権限申請の承認者に通知する

## 基本情報
- **ユースケースID**: UC-PERM-03
- **アクター**: 権限申請システム、承認者
- **概要**: 権限申請が提出された際に、適切な承認者に迅速かつ確実に通知を配信し、承認プロセスの開始を確保する

## 事前条件
- 権限申請が正常に受理されている（PermissionRequest.status = "submitted"）
- 申請者の所属組織が確定している
- 承認フローが設定されている
- 承認者の連絡先情報が利用可能である
- 通知システムが利用可能である

## 事後条件
### 成功時
- 適切な承認者に通知が配信されている
- 通知配信ログが記録されている（NotificationLog.status = "sent"）
- 承認待ち状態に遷移している（PermissionRequest.status = "awaiting_approval"）
- 承認期限タイマーが開始されている
- 承認者が申請内容を確認可能な状態になっている

### 失敗時
- 通知配信エラーが記録されている
- エスカレーション通知が管理者に送信されている
- 申請ステータスが通知失敗状態になっている
- 代替通知手段が実行されている

## 基本フロー
1. **システムが承認者を特定する**
   - 申請内容から権限レベルを分析
   - 組織階層に基づく承認者を特定
   - 承認者の権限と可用性を確認

2. **システムが通知内容を生成する**
   - → UC-NOTIFY-01: 承認依頼通知を配信する
   - 申請詳細情報の整理・表示用データ作成
   - 承認・却下アクションリンクの生成

3. **システムが承認者に通知を配信する**
   - 優先通知手段（メール・チャット）での配信
   - 通知配信状況の確認・記録
   - 配信失敗時の代替手段実行

4. **システムが承認プロセスを開始する**
   - 承認期限の設定・タイマー開始
   - 承認者のアクセス権限付与
   - 承認待ちキューへの追加

5. **システムが通知完了を確認する**
   - → UC-PERM-03: 通知配信ログを記録する
   - 承認者の通知受信確認
   - 申請者への中間ステータス更新通知

## 代替フロー
### 代替フロー1: 複数承認者による並行承認
- 3a. 複数の承認者が必要な場合
  - 3a1. 全承認者を特定し並行通知を配信
  - 3a2. 各承認者に他の関係者情報を通知
  - 3a3. 承認進捗の可視化ダッシュボードを提供
  - 3a4. 基本フロー4（プロセス開始）に進む

### 代替フロー2: 承認者不在・代理承認
- 1a. 指定承認者が不在の場合
  - 1a1. 代理承認者の自動特定
  - 1a2. エスカレーション承認者への通知
  - 1a3. 緊急承認プロセスへの切り替え
  - 1a4. 基本フロー2（通知内容生成）に戻る

## 例外フロー
### 例外1: 通知配信失敗
- *a. メール・チャット通知が失敗した場合
  - *a1. → UC-NOTIFY-01: 通知配信エラーを記録する
  - *a2. 代替通知手段（SMS・電話）の実行
  - *a3. 管理者への即座エスカレーション
  - *a4. 手動承認プロセスへのフォールバック

### 例外2: 承認者権限不足
- *b. 指定承認者に承認権限がない場合
  - *b1. 権限エラーの記録・ログ出力
  - *b2. 適切な権限を持つ承認者の自動検索
  - *b3. 組織管理者への権限設定修正依頼
  - *b4. 一時的上位承認者への自動エスカレーション

### 例外3: システム障害・ネットワーク障害
- *c. 通知システム障害が発生した場合
  - *c1. 障害検知・ログ記録・監視アラート送信
  - *c2. オフライン通知キューへの保存
  - *c3. 復旧後の自動再配信スケジューリング
  - *c4. 緊急時手動承認プロセスの準備

## 特別要件
- **性能**: 通知配信3秒以内、承認者特定1秒以内
- **可用性**: 通知システム稼働率99.8%以上
- **セキュリティ**: 通知内容暗号化、承認者本人確認、アクセスログ記録
- **精度**: 承認者特定精度100%、通知配信成功率98%
- **ユーザビリティ**: 承認者にとって分かりやすい通知内容、ワンクリック承認

## 関連ユースケース
- **包含**: UC-NOTIFY-01（通知配信）、UC-PERM-03（ログ記録）
- **前提**: UC-PERM-01（権限申請受理）必須
- **後続**: UC-PERM-04（承認判断）、UC-PERM-05（権限付与）

---
*このユースケースは パラソル設計v2.0仕様 に基づいて作成されました*
