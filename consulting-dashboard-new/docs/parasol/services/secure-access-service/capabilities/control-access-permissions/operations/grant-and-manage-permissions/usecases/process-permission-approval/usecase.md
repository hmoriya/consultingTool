# ユースケース: 権限申請の承認処理を実行する

## 基本情報
- **ユースケースID**: UC-PERM-04
- **アクター**: 承認者、権限管理システム
- **概要**: 承認者が権限申請を詳細に審査し、承認または却下の判断を行って、権限付与プロセスを完結または停止させる

## 事前条件
- 権限申請の通知を受信している（UC-PERM-03完了）
- 承認者として適切な権限を保有している
- 申請内容が完全に表示可能である
- 承認・却下を実行する権限がある
- ネットワーク接続が安定している

## 事後条件
### 成功時（承認の場合）
- 権限申請が承認されている（PermissionRequest.status = "approved"）
- 承認理由とコメントが記録されている
- 権限付与プロセスが開始されている
- 申請者に承認通知が配信されている
- 次段階の権限付与フローが準備されている

### 成功時（却下の場合）
- 権限申請が却下されている（PermissionRequest.status = "rejected"）
- 却下理由とコメントが記録されている
- 申請者に却下通知と再申請ガイダンスが配信されている
- 却下ログが監査システムに記録されている

### 失敗時
- 承認処理エラーが記録されている
- エラー内容が承認者に通知されている
- 申請ステータスが処理中のまま維持されている
- システム管理者にエラー通知が送信されている

## 基本フロー
1. **承認者が申請内容を詳細確認する**
   - 申請者情報・申請権限・業務根拠の確認
   - 組織ポリシーとの適合性評価
   - セキュリティリスクレベルの評価

2. **承認者が関連情報を参照する**
   - 申請者の現在権限・過去の申請履歴確認
   - 申請権限の詳細説明・影響範囲の把握
   - 組織階層・業務上の必要性の検証

3. **承認者が承認判断を決定する**
   - 承認・却下の判断決定
   - 判断根拠・コメントの入力
   - 特別条件（期限・制限）の設定

4. **システムが承認判断を処理する**
   - → UC-AUTH-03: 承認判断ログを記録する
   - 判断結果の正式記録・ステータス更新
   - 関連システムへの判断結果通知

5. **システムが後続処理を開始する**
   - → UC-NOTIFY-01: 承認結果通知を配信する（申請者）
   - 承認の場合：権限付与プロセス開始
   - 却下の場合：再申請ガイダンス提供

## 代替フロー
### 代替フロー1: 条件付き承認
- 3a. 特別な条件を付けて承認する場合
  - 3a1. 承認条件（期限・使用制限）の詳細設定
  - 3a2. 条件遵守の監視設定・アラート設定
  - 3a3. 申請者への条件説明・同意確認要求
  - 3a4. 基本フロー4（承認判断処理）に進む

### 代替フロー2: 上位承認者へのエスカレーション
- 3b. 承認権限を超えた申請の場合
  - 3b1. 上位承認者の特定・エスカレーション準備
  - 3b2. 推奨意見・コメントの付加
  - 3b3. → UC-PERM-03: 上位承認者への通知配信
  - 3b4. エスカレーション完了・ステータス更新

## 例外フロー
### 例外1: 承認権限不足・権限エラー
- *a. 承認者に必要な権限がない場合
  - *a1. → UC-AUTH-03: 権限エラーイベントを記録する
  - *a2. 権限不足の詳細説明・必要権限の明示
  - *a3. 適切な承認者への自動転送・権限管理者への通知
  - *a4. 権限取得後の承認プロセス再開案内

### 例外2: 申請情報不備・確認不可能
- *b. 申請内容に不備・不明点がある場合
  - *b1. 情報不備の詳細特定・不足情報の明示
  - *b2. → UC-NOTIFY-01: 申請者への情報補完要求
  - *b3. 情報補完完了まで承認処理を一時停止
  - *b4. 補完完了後、基本フロー1（申請内容確認）に復帰

### 例外3: システム障害・ネットワーク障害
- *c. 承認処理中にシステム障害が発生した場合
  - *c1. 判断データの緊急保存・障害レベル評価
  - *c2. 承認者への障害状況説明・代替手段案内
  - *c3. オフライン承認手続きの提供・復旧後同期
  - *c4. 障害復旧後の承認処理自動再開

## 特別要件
- **性能**: 承認判断記録2秒以内、通知配信3秒以内
- **可用性**: 承認システム稼働率99.9%以上
- **セキュリティ**: 承認データ暗号化、本人確認、承認ログ記録
- **精度**: 承認判断記録精度100%、通知配信成功率98%
- **ユーザビリティ**: 直感的承認インターフェース、明確な判断根拠入力

## 関連ユースケース
- **包含**: UC-AUTH-03（ログ記録）、UC-NOTIFY-01（通知配信）
- **前提**: UC-PERM-03（承認者通知）必須
- **後続**: UC-PERM-05（権限付与）、UC-PERM-06（却下処理）

---
*このユースケースは パラソル設計v2.0仕様 に基づいて作成されました*
