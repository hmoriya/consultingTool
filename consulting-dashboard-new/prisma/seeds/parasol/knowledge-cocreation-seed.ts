import { PrismaClient as ParasolPrismaClient } from '@prisma/parasol-client'

const parasolDb = new ParasolPrismaClient()

// ナレッジ共創サービスのケーパビリティとビジネスオペレーション定義
export const knowledgeCocreationData = {
  capabilities: [
    {
      name: 'knowledge-capture',
      displayName: '知識を捕獲する能力',
      description: 'プロジェクトで生まれる暗黙知を形式知として捕獲し、組織の知的資産として蓄積する能力',
      category: 'Core',
      definition: `# ビジネスケーパビリティ: 知識を捕獲する能力

## ケーパビリティ概要
日々のプロジェクト活動から生まれる貴重な知見や経験を逃さず捕獲し、再利用可能な形で蓄積する能力

## ビジネス価値
- **知識保全**: 暗黙知の形式知化
- **効率向上**: 知識の再利用による時間短縮
- **品質向上**: ベストプラクティスの共有

## 実現する成果
- 知識記録率: プロジェクトの80%以上
- 形式知化率: 暗黙知の60%以上
- 記録所要時間: 30分以内/件
- 再利用率: 70%以上

## 必要な要素
### 人材・スキル
- ナレッジエンジニア
- テクニカルライター
- インタビュアー

### プロセス・方法論
- 知識抽出手法
- インタビュー技法
- ドキュメンテーション標準

### ツール・システム
- ナレッジ記録システム
- 音声認識ツール
- マインドマップツール`,
      businessOperations: [
        {
          name: 'knowledge-extraction',
          displayName: '知識を抽出する',
          pattern: 'Analytics',
          goal: '暗黙知の効果的な抽出',
          design: `# ビジネスオペレーション: 知識を抽出する

## 目的
プロジェクトメンバーが持つ暗黙的な知識やノウハウを、体系的な手法で抽出し形式知化する

## 関係者とロール
- **ナレッジエンジニア**: 抽出プロセス主導
- **知識保有者**: 知識・経験の提供
- **インタビュアー**: 聞き取り実施
- **ドキュメンター**: 文書化

## ビジネスプロセス
1. **対象特定**: 重要な知識領域の特定
2. **手法選択**: インタビュー、観察等
3. **セッション実施**: 知識抽出活動
4. **構造化**: 抽出内容の整理
5. **検証**: 正確性・完全性確認
6. **形式知化**: ドキュメント作成

## 状態遷移
計画中 → 抽出中 → 構造化中 → 検証中 → 完成

## KPI
- 抽出成功率: 85%以上
- セッション時間: 2時間以内
- 知識保有者満足度: 4.0以上`,
          roles: ['ナレッジエンジニア', '知識保有者', 'インタビュアー', 'ドキュメンター'],
          operations: {
            steps: [
              '対象特定',
              '手法選択',
              'セッション実施',
              '構造化',
              '検証',
              '形式知化'
            ]
          },
          businessStates: {
            initial: '計画中',
            states: ['計画中', '抽出中', '構造化中', '検証中', '完成'],
            final: '完成'
          }
        },
        {
          name: 'lesson-learned',
          displayName: '教訓を記録する',
          pattern: 'CRUD',
          goal: 'プロジェクト教訓の体系的記録',
          design: `# ビジネスオペレーション: 教訓を記録する

## 目的
プロジェクトの成功・失敗体験から得られた教訓を記録し、将来のプロジェクトで活用可能にする

## 関係者とロール
- **プロジェクトマネージャー**: 教訓の特定
- **チームメンバー**: 体験の共有
- **ナレッジマネージャー**: 記録・分類
- **品質管理者**: 教訓の検証

## ビジネスプロセス
1. **振り返り会議**: プロジェクト振り返り
2. **教訓抽出**: 成功/失敗要因分析
3. **一般化**: 汎用的な教訓化
4. **記録作成**: 構造化された記録
5. **タグ付け**: 検索性の向上
6. **承認・公開**: 品質確認後の公開

## KPI
- 記録率: 全プロジェクトの90%
- 記録期限: プロジェクト終了後2週間
- 活用率: 60%以上`,
          roles: ['プロジェクトマネージャー', 'チームメンバー', 'ナレッジマネージャー', '品質管理者'],
          operations: {
            steps: [
              '振り返り会議',
              '教訓抽出',
              '一般化',
              '記録作成',
              'タグ付け',
              '承認・公開'
            ]
          },
          businessStates: {
            initial: '収集中',
            states: ['収集中', '分析中', '記録中', 'レビュー中', '公開済み'],
            final: '公開済み'
          }
        },
        {
          name: 'template-creation',
          displayName: 'テンプレートを作成する',
          pattern: 'CRUD',
          goal: '再利用可能な成果物テンプレート化',
          design: `# ビジネスオペレーション: テンプレートを作成する

## 目的
優れた成果物をテンプレート化し、品質の標準化と作業効率の向上を実現する

## 関係者とロール
- **テンプレート作成者**: 原案作成
- **レビュアー**: 品質確認
- **標準化委員会**: 承認判断
- **利用者**: フィードバック提供

## ビジネスプロセス
1. **候補選定**: テンプレート化対象
2. **汎用化**: 固有情報の除去
3. **構造設計**: 再利用しやすい構造
4. **ガイド作成**: 利用方法の文書化
5. **試用**: パイロット利用
6. **改善・公開**: フィードバック反映

## KPI
- テンプレート化率: 30%以上
- 利用率: 月10回以上
- 時間削減効果: 50%以上`,
          roles: ['テンプレート作成者', 'レビュアー', '標準化委員会', '利用者'],
          operations: {
            steps: [
              '候補選定',
              '汎用化',
              '構造設計',
              'ガイド作成',
              '試用',
              '改善・公開'
            ]
          },
          businessStates: {
            initial: '候補',
            states: ['候補', '作成中', '試用中', '承認待ち', '公開済み'],
            final: '公開済み'
          }
        }
      ]
    },
    {
      name: 'knowledge-organization',
      displayName: '知識を体系化する能力',
      description: '蓄積された知識を体系的に整理し、検索・活用しやすい形で組織化する能力',
      category: 'Core',
      definition: `# ビジネスケーパビリティ: 知識を体系化する能力

## ケーパビリティ概要
散在する知識を論理的に分類・整理し、必要な時に必要な知識にアクセスできる体系を構築する能力

## ビジネス価値
- **検索性向上**: 必要な知識への迅速なアクセス
- **関連性発見**: 知識間の繋がりの可視化
- **学習効率**: 体系的な知識習得

## 実現する成果
- 検索成功率: 90%以上
- 検索時間: 5分以内
- カテゴリ網羅率: 95%以上
- メタデータ付与率: 100%

## 必要な要素
### 人材・スキル
- 情報アーキテクト
- タクソノミー設計者
- メタデータ管理者

### プロセス・方法論
- 情報分類体系設計
- メタデータ標準
- オントロジー構築

### ツール・システム
- 分類管理システム
- メタデータ管理ツール
- 自動タグ付けシステム`,
      businessOperations: [
        {
          name: 'taxonomy-design',
          displayName: '分類体系を設計する',
          pattern: 'Administration',
          goal: '直感的で拡張可能な分類体系',
          design: `# ビジネスオペレーション: 分類体系を設計する

## 目的
組織の知識ドメインに適した分類体系を設計し、知識の整理と検索を効率化する

## 関係者とロール
- **情報アーキテクト**: 体系設計
- **ドメインエキスパート**: 専門知識提供
- **利用者代表**: ユーザビリティ確認
- **システム管理者**: 実装支援

## ビジネスプロセス
1. **現状分析**: 既存知識の調査
2. **要件定義**: 分類ニーズの把握
3. **階層設計**: カテゴリ階層構造
4. **命名規則**: 一貫性のある名称
5. **試行運用**: 小規模での検証
6. **本格導入**: 全体への展開

## KPI
- カバレッジ: 知識の95%以上
- 階層深度: 3-5階層
- 利用者理解度: 85%以上`,
          roles: ['情報アーキテクト', 'ドメインエキスパート', '利用者代表', 'システム管理者'],
          operations: {
            steps: [
              '現状分析',
              '要件定義',
              '階層設計',
              '命名規則',
              '試行運用',
              '本格導入'
            ]
          },
          businessStates: {
            initial: '分析中',
            states: ['分析中', '設計中', '試行中', '展開中', '運用中'],
            final: '運用中'
          }
        },
        {
          name: 'metadata-management',
          displayName: 'メタデータを管理する',
          pattern: 'CRUD',
          goal: '知識の属性情報の充実',
          design: `# ビジネスオペレーション: メタデータを管理する

## 目的
知識コンテンツに適切なメタデータを付与し、検索性と関連性の発見を向上させる

## 関係者とロール
- **メタデータ管理者**: 標準策定、品質管理
- **コンテンツ作成者**: メタデータ付与
- **キュレーター**: メタデータ充実
- **システム**: 自動抽出・提案

## ビジネスプロセス
1. **標準定義**: メタデータ項目定義
2. **自動抽出**: システムによる抽出
3. **手動付与**: 重要属性の追加
4. **品質チェック**: 完全性・正確性
5. **関連付け**: 知識間のリンク
6. **定期更新**: 情報の最新化

## KPI
- 必須項目充足率: 100%
- 推奨項目充足率: 80%以上
- 自動抽出率: 60%以上`,
          roles: ['メタデータ管理者', 'コンテンツ作成者', 'キュレーター', 'システム'],
          operations: {
            steps: [
              '標準定義',
              '自動抽出',
              '手動付与',
              '品質チェック',
              '関連付け',
              '定期更新'
            ]
          },
          businessStates: {
            initial: '未付与',
            states: ['未付与', '自動処理中', '手動編集中', '確認中', '完了'],
            final: '完了'
          }
        },
        {
          name: 'knowledge-curation',
          displayName: '知識をキュレーションする',
          pattern: 'Analytics',
          goal: '価値ある知識の選別と推奨',
          design: `# ビジネスオペレーション: 知識をキュレーションする

## 目的
大量の知識から価値の高いものを選別し、利用者のニーズに応じて最適な知識を推奨する

## 関係者とロール
- **キュレーター**: 知識の評価・選別
- **利用者**: フィードバック提供
- **推奨システム**: 自動推奨
- **品質管理者**: 基準設定

## ビジネスプロセス
1. **評価基準設定**: 価値判断基準
2. **知識評価**: 個別コンテンツ評価
3. **カテゴリ別選別**: 分野別ベスト選定
4. **推奨リスト作成**: 用途別リスト
5. **パーソナライズ**: 個人別カスタマイズ
6. **効果測定**: 利用状況分析

## KPI
- キュレーション率: 30%以上
- 推奨的中率: 70%以上
- 利用者満足度: 4.3以上`,
          roles: ['キュレーター', '利用者', '推奨システム', '品質管理者'],
          operations: {
            steps: [
              '評価基準設定',
              '知識評価',
              'カテゴリ別選別',
              '推奨リスト作成',
              'パーソナライズ',
              '効果測定'
            ]
          },
          businessStates: {
            initial: '評価待ち',
            states: ['評価待ち', '評価中', '選別済み', '推奨中'],
            final: '推奨中'
          }
        }
      ]
    },
    {
      name: 'knowledge-sharing',
      displayName: '知識を共有する能力',
      description: '組織内で知識を効果的に共有し、コラボレーションを通じて新たな知識を創造する能力',
      category: 'Core',
      definition: `# ビジネスケーパビリティ: 知識を共有する能力

## ケーパビリティ概要
知識を必要とする人に適切なタイミングで届け、議論や協働を通じて知識の価値を高める能力

## ビジネス価値
- **イノベーション**: 知識の組み合わせによる新価値
- **問題解決**: 集合知による迅速な解決
- **組織学習**: 知識の水平展開

## 実現する成果
- 共有率: 重要知識の100%
- 活用率: 共有知識の60%以上
- 新知識創出: 月20件以上
- コラボレーション満足度: 4.2以上

## 必要な要素
### 人材・スキル
- コミュニティマネージャー
- ファシリテーター
- ナレッジブローカー

### プロセス・方法論
- 知識共有プロセス
- コミュニティ運営
- 協調学習手法

### ツール・システム
- 知識共有プラットフォーム
- コラボレーションツール
- ソーシャル機能`,
      businessOperations: [
        {
          name: 'knowledge-publishing',
          displayName: '知識を公開する',
          pattern: 'Workflow',
          goal: '価値ある知識の組織内展開',
          design: `# ビジネスオペレーション: 知識を公開する

## 目的
検証された知識を適切な形で公開し、組織全体での活用を促進する

## 関係者とロール
- **作成者**: 知識の提供
- **レビュアー**: 品質確認
- **公開承認者**: 公開判断
- **利用者**: 知識の活用

## ビジネスプロセス
1. **公開準備**: 最終確認、整形
2. **レビュー依頼**: 専門家レビュー
3. **修正対応**: フィードバック反映
4. **公開承認**: 最終承認取得
5. **公開処理**: システムへの登録
6. **通知配信**: 関係者への周知

## KPI
- 公開所要時間: 3営業日以内
- レビュー合格率: 80%以上
- 公開後アクセス: 1週間で50回`,
          roles: ['作成者', 'レビュアー', '公開承認者', '利用者'],
          operations: {
            steps: [
              '公開準備',
              'レビュー依頼',
              '修正対応',
              '公開承認',
              '公開処理',
              '通知配信'
            ]
          },
          businessStates: {
            initial: '準備中',
            states: ['準備中', 'レビュー中', '修正中', '承認待ち', '公開済み'],
            final: '公開済み'
          }
        },
        {
          name: 'community-facilitation',
          displayName: 'コミュニティを運営する',
          pattern: 'Communication',
          goal: '活発な知識交換の場の提供',
          design: `# ビジネスオペレーション: コミュニティを運営する

## 目的
専門分野別のコミュニティを運営し、メンバー間の知識共有と協創を促進する

## 関係者とロール
- **コミュニティマネージャー**: 運営全般
- **モデレーター**: 議論の促進
- **メンバー**: 知識共有、議論参加
- **ゲストスピーカー**: 専門知識提供

## ビジネスプロセス
1. **活動計画**: イベント、トピック設定
2. **メンバー募集**: 参加者の拡大
3. **イベント開催**: 勉強会、討論会
4. **議論促進**: 活発な意見交換
5. **成果まとめ**: 議論の要約、記録
6. **フォローアップ**: 次回への繋がり

## KPI
- アクティブ率: 月間60%以上
- イベント参加率: 70%以上
- 知識創出数: イベント毎3件`,
          roles: ['コミュニティマネージャー', 'モデレーター', 'メンバー', 'ゲストスピーカー'],
          operations: {
            steps: [
              '活動計画',
              'メンバー募集',
              'イベント開催',
              '議論促進',
              '成果まとめ',
              'フォローアップ'
            ]
          },
          businessStates: {
            initial: '計画中',
            states: ['計画中', '募集中', '開催中', 'まとめ中', 'フォロー中'],
            final: 'フォロー中'
          }
        },
        {
          name: 'knowledge-collaboration',
          displayName: '知識を共創する',
          pattern: 'Workflow',
          goal: '集合知による新知識創造',
          design: `# ビジネスオペレーション: 知識を共創する

## 目的
複数の専門家が協力して、個人では生み出せない新たな知識を創造する

## 関係者とロール
- **発起人**: 共創テーマ提案
- **参加者**: 知識・アイデア提供
- **ファシリテーター**: 創造プロセス支援
- **記録者**: 成果の文書化

## ビジネスプロセス
1. **テーマ設定**: 共創目標の明確化
2. **メンバー招集**: 適切な専門家選定
3. **アイデア出し**: ブレインストーミング
4. **統合・深化**: アイデアの結合
5. **プロトタイプ**: 具体化・検証
6. **知識化**: 成果の形式知化

## KPI
- 新知識創出率: 80%以上
- 参加者満足度: 4.5以上
- 実用化率: 50%以上`,
          roles: ['発起人', '参加者', 'ファシリテーター', '記録者'],
          operations: {
            steps: [
              'テーマ設定',
              'メンバー招集',
              'アイデア出し',
              '統合・深化',
              'プロトタイプ',
              '知識化'
            ]
          },
          businessStates: {
            initial: '企画中',
            states: ['企画中', '実施中', '統合中', '検証中', '完成'],
            final: '完成'
          }
        }
      ]
    },
    {
      name: 'knowledge-application',
      displayName: '知識を活用する能力',
      description: '蓄積された知識を実際のプロジェクトや業務で効果的に活用し、価値を実現する能力',
      category: 'Supporting',
      definition: `# ビジネスケーパビリティ: 知識を活用する能力

## ケーパビリティ概要
適切な知識を適切なタイミングで発見・適用し、業務の効率化と品質向上を実現する能力

## ビジネス価値
- **効率化**: 既存知識による時間短縮
- **品質向上**: ベストプラクティスの適用
- **リスク低減**: 過去の教訓の活用

## 実現する成果
- 知識活用率: 70%以上
- 作業時間削減: 30%以上
- 品質向上: 不具合20%削減
- ROI: 投資の3倍以上

## 必要な要素
### 人材・スキル
- ナレッジブローカー
- 適用支援スペシャリスト
- 効果測定アナリスト

### プロセス・方法論
- 知識発見プロセス
- 適用ガイドライン
- 効果測定手法

### ツール・システム
- 知識検索システム
- レコメンデーション
- 適用支援ツール`,
      businessOperations: [
        {
          name: 'knowledge-search',
          displayName: '知識を検索する',
          pattern: 'Analytics',
          goal: '必要な知識の迅速な発見',
          design: `# ビジネスオペレーション: 知識を検索する

## 目的
現在の課題や状況に最適な知識を効率的に検索し、問題解決に活用する

## 関係者とロール
- **検索者**: 知識の探索
- **検索システム**: 検索処理、推奨
- **ナレッジブローカー**: 検索支援
- **知識提供者**: 追加情報提供

## ビジネスプロセス
1. **ニーズ特定**: 必要な知識の明確化
2. **検索実行**: キーワード、条件指定
3. **結果評価**: 関連性の判断
4. **絞り込み**: フィルタリング
5. **詳細確認**: 内容の精査
6. **活用記録**: 利用履歴の保存

## KPI
- 検索成功率: 85%以上
- 平均検索時間: 5分以内
- 関連性スコア: 4.0以上`,
          roles: ['検索者', '検索システム', 'ナレッジブローカー', '知識提供者'],
          operations: {
            steps: [
              'ニーズ特定',
              '検索実行',
              '結果評価',
              '絞り込み',
              '詳細確認',
              '活用記録'
            ]
          },
          businessStates: {
            initial: '検索前',
            states: ['検索前', '検索中', '評価中', '選択済み', '活用中'],
            final: '活用中'
          }
        },
        {
          name: 'knowledge-adaptation',
          displayName: '知識を適用する',
          pattern: 'Workflow',
          goal: '汎用知識の状況適応',
          design: `# ビジネスオペレーション: 知識を適用する

## 目的
一般的な知識を具体的な状況に適応させ、実践可能な形で活用する

## 関係者とロール
- **実践者**: 知識の適用実行
- **アドバイザー**: 適用方法助言
- **知識提供者**: 詳細説明
- **レビュアー**: 適用結果確認

## ビジネスプロセス
1. **状況分析**: 適用先の理解
2. **適応計画**: カスタマイズ方針
3. **調整実施**: 状況に合わせた修正
4. **試行適用**: 小規模での検証
5. **本格適用**: 全面展開
6. **結果評価**: 効果の測定

## KPI
- 適用成功率: 75%以上
- カスタマイズ時間: 2時間以内
- 効果実現率: 80%以上`,
          roles: ['実践者', 'アドバイザー', '知識提供者', 'レビュアー'],
          operations: {
            steps: [
              '状況分析',
              '適応計画',
              '調整実施',
              '試行適用',
              '本格適用',
              '結果評価'
            ]
          },
          businessStates: {
            initial: '分析中',
            states: ['分析中', '計画中', '調整中', '試行中', '適用中', '評価済み'],
            final: '評価済み'
          }
        },
        {
          name: 'impact-measurement',
          displayName: '活用効果を測定する',
          pattern: 'Analytics',
          goal: '知識活用のROI実証',
          design: `# ビジネスオペレーション: 活用効果を測定する

## 目的
知識活用による具体的な効果を定量的に測定し、知識管理の価値を実証する

## 関係者とロール
- **測定担当者**: 効果測定実施
- **活用者**: データ提供
- **分析者**: ROI分析
- **経営層**: 結果活用

## ビジネスプロセス
1. **測定指標設定**: KPI定義
2. **ベースライン測定**: 活用前の状態
3. **データ収集**: 活用後の実績
4. **効果算出**: 改善度の計算
5. **要因分析**: 成功要因特定
6. **報告書作成**: 経営層への報告

## KPI
- 測定実施率: 80%以上
- データ精度: 95%以上
- ROI達成率: 70%以上`,
          roles: ['測定担当者', '活用者', '分析者', '経営層'],
          operations: {
            steps: [
              '測定指標設定',
              'ベースライン測定',
              'データ収集',
              '効果算出',
              '要因分析',
              '報告書作成'
            ]
          },
          businessStates: {
            initial: '準備中',
            states: ['準備中', '測定中', '分析中', '報告中', '完了'],
            final: '完了'
          }
        }
      ]
    }
  ]
}

export async function createKnowledgeCocreationData(serviceId: string) {
  console.log('  Creating Knowledge Cocreation Service capabilities and operations...')
  
  let totalCapabilities = 0
  let totalOperations = 0
  
  for (const capData of knowledgeCocreationData.capabilities) {
    // ケーパビリティの作成
    const capability = await parasolDb.businessCapability.create({
      data: {
        serviceId,
        name: capData.name,
        displayName: capData.displayName,
        description: capData.description,
        definition: capData.definition,
        category: capData.category
      }
    })
    totalCapabilities++
    console.log(`    ✓ Created capability: ${capability.displayName}`)
    
    // ビジネスオペレーションの作成
    for (const opData of capData.businessOperations) {
      const operation = await parasolDb.businessOperation.create({
        data: {
          serviceId,
          capabilityId: capability.id,
          name: opData.name,
          displayName: opData.displayName,
          design: opData.design,
          pattern: opData.pattern,
          goal: opData.goal,
          roles: JSON.stringify(opData.roles),
          operations: JSON.stringify(opData.operations),
          businessStates: JSON.stringify(opData.businessStates),
          useCases: JSON.stringify([]),
          uiDefinitions: JSON.stringify({ pages: [] }),
          testCases: JSON.stringify({ criteria: opData.goal })
        }
      })
      totalOperations++
      console.log(`      ✓ Created operation: ${operation.displayName}`)
    }
  }
  
  return { capabilities: totalCapabilities, operations: totalOperations }
}