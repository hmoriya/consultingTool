import { PrismaClient as ParasolPrismaClient } from '@prisma/parasol-client'

const parasolDb = new ParasolPrismaClient()

// プロジェクト成功支援サービスのケーパビリティとビジネスオペレーション定義
export const projectSuccessData = {
  capabilities: [
    {
      name: 'project-planning',
      displayName: 'プロジェクトを計画する能力',
      description: '確実な成果達成に向けて、精緻な計画を策定し、リスクを事前に識別・対策する能力',
      category: 'Core',
      definition: `# ビジネスケーパビリティ: プロジェクトを計画する能力

## ケーパビリティ概要
クライアントの期待を的確に把握し、実現可能で効果的なプロジェクト計画を策定する能力

## ビジネス価値
- **成功率向上**: 綿密な計画による手戻り削減
- **リスク低減**: 早期のリスク識別と対策
- **信頼獲得**: 現実的で達成可能な計画提示

## 実現する成果
- 計画精度: 初期見積もりとの乖離±10%以内
- リスク事前識別率: 90%以上
- ステークホルダー満足度: 4.5以上（5点満点）
- 計画変更頻度: 月1回以下

## 必要な要素
### 人材・スキル
- プロジェクトプランナー
- リスクアナリスト
- 見積もりエキスパート

### プロセス・方法論
- プロジェクト計画手法
- リスク分析フレームワーク
- ステークホルダー分析

### ツール・システム
- プロジェクト計画ツール
- リスク管理システム
- 見積もり支援ツール`,
      businessOperations: [
        {
          name: 'scope-definition',
          displayName: 'スコープを定義する',
          pattern: 'CRUD',
          goal: 'プロジェクト範囲の明確化と合意形成',
          design: `# ビジネスオペレーション: スコープを定義する

## 目的
プロジェクトで実施する作業範囲を明確に定義し、ステークホルダー間で合意を形成する

## 関係者とロール
- **プロジェクトマネージャー**: スコープ定義の主導
- **ビジネスアナリスト**: 要求分析、文書化
- **クライアント**: 要求提示、承認
- **技術リード**: 実現可能性評価

## ビジネスオペレーション
1. **要求収集**: ステークホルダーインタビュー
2. **要求分析**: 優先順位付け、実現可能性評価
3. **スコープ文書作成**: WBS、成果物定義
4. **レビュー**: 関係者によるレビュー
5. **承認**: クライアント承認取得
6. **ベースライン設定**: 変更管理の基準設定

## 状態遷移
ドラフト → レビュー中 → 承認待ち → 確定 → （変更中）

## KPI
- スコープ定義期間: 2週間以内
- 承認一発合格率: 80%以上
- スコープ変更率: 20%以下`,
          roles: ['プロジェクトマネージャー', 'ビジネスアナリスト', 'クライアント', '技術リード'],
          operations: {
            steps: [
              '要求収集',
              '要求分析',
              'スコープ文書作成',
              'レビュー',
              '承認',
              'ベースライン設定'
            ]
          },
          businessStates: {
            initial: 'ドラフト',
            states: ['ドラフト', 'レビュー中', '承認待ち', '確定', '変更中'],
            final: '確定'
          }
        },
        {
          name: 'schedule-planning',
          displayName: 'スケジュールを策定する',
          pattern: 'Workflow',
          goal: '実現可能で効率的なスケジュールの作成',
          design: `# ビジネスオペレーション: スケジュールを策定する

## 目的
プロジェクトの全タスクを洗い出し、依存関係を考慮した最適なスケジュールを策定する

## 関係者とロール
- **プロジェクトマネージャー**: 全体スケジュール管理
- **チームリード**: 詳細タスク定義
- **リソースマネージャー**: 要員調整
- **クライアント**: マイルストーン承認

## ビジネスオペレーション
1. **WBS作成**: 成果物ベースの作業分解
2. **タスク見積もり**: 工数・期間の見積もり
3. **依存関係定義**: タスク間の関係整理
4. **リソース割当**: 要員のアサイン
5. **クリティカルパス分析**: ボトルネック特定
6. **バッファ設定**: リスクバッファの組込み

## KPI
- 見積もり精度: ±15%以内
- クリティカルパス遅延: ゼロ
- スケジュール遵守率: 90%以上`,
          roles: ['プロジェクトマネージャー', 'チームリード', 'リソースマネージャー', 'クライアント'],
          operations: {
            steps: [
              'WBS作成',
              'タスク見積もり',
              '依存関係定義',
              'リソース割当',
              'クリティカルパス分析',
              'バッファ設定'
            ]
          },
          businessStates: {
            initial: '計画中',
            states: ['計画中', 'レビュー中', '承認済み', '実行中'],
            final: '承認済み'
          }
        },
        {
          name: 'risk-planning',
          displayName: 'リスクを識別・対策する',
          pattern: 'Analytics',
          goal: 'プロジェクトリスクの事前対策',
          design: `# ビジネスオペレーション: リスクを識別・対策する

## 目的
プロジェクトの成功を阻害する可能性のあるリスクを事前に識別し、対策を準備する

## 関係者とロール
- **リスクマネージャー**: リスク分析主導
- **プロジェクトマネージャー**: 対策承認
- **技術エキスパート**: 技術リスク評価
- **ステークホルダー**: リスク情報共有

## ビジネスオペレーション
1. **リスク識別**: ブレインストーミング、チェックリスト
2. **リスク分析**: 発生確率と影響度評価
3. **優先順位付け**: リスクマトリックス作成
4. **対策立案**: 回避・軽減・受容・転嫁
5. **対策準備**: コンティンジェンシープラン
6. **モニタリング計画**: 監視指標設定

## KPI
- リスク識別数: 20件以上
- 高リスク対策率: 100%
- リスク顕在化率: 10%以下`,
          roles: ['リスクマネージャー', 'プロジェクトマネージャー', '技術エキスパート', 'ステークホルダー'],
          operations: {
            steps: [
              'リスク識別',
              'リスク分析',
              '優先順位付け',
              '対策立案',
              '対策準備',
              'モニタリング計画'
            ]
          },
          businessStates: {
            initial: '識別中',
            states: ['識別中', '分析中', '対策立案中', '監視中'],
            final: '監視中'
          }
        }
      ]
    },
    {
      name: 'project-execution',
      displayName: 'プロジェクトを実行する能力',
      description: '計画に基づいてプロジェクトを推進し、品質・コスト・納期を守りながら価値を提供する能力',
      category: 'Core',
      definition: `# ビジネスケーパビリティ: プロジェクトを実行する能力

## ケーパビリティ概要
日々のプロジェクト活動を効果的に管理し、計画通りの成果を確実に達成する能力

## ビジネス価値
- **確実な遂行**: 計画に基づく着実な進捗
- **品質確保**: 成果物の品質維持・向上
- **効率化**: リソースの最適活用

## 実現する成果
- 納期遵守率: 95%以上
- 品質基準達成率: 100%
- 予算遵守率: ±5%以内
- チーム生産性: 計画比110%

## 必要な要素
### 人材・スキル
- プロジェクトマネージャー
- チームリーダー
- 品質管理スペシャリスト

### プロセス・方法論
- アジャイル/ウォーターフォール手法
- 品質管理プロセス
- 進捗管理手法

### ツール・システム
- タスク管理システム
- コラボレーションツール
- 品質管理ツール`,
      businessOperations: [
        {
          name: 'task-management',
          displayName: 'タスクを管理する',
          pattern: 'Workflow',
          goal: '全タスクの可視化と効率的な実行',
          design: `# ビジネスオペレーション: タスクを管理する

## 目的
プロジェクトの全タスクを可視化し、優先順位に基づいて効率的に実行する

## 関係者とロール
- **プロジェクトマネージャー**: 全体管理
- **チームリーダー**: タスク割当、進捗確認
- **メンバー**: タスク実行、報告
- **クライアント**: 進捗確認

## ビジネスオペレーション
1. **タスク作成**: WBSからの詳細化
2. **優先順位設定**: 重要度・緊急度評価
3. **アサイン**: 適切なメンバーへ割当
4. **進捗更新**: 日次での状況更新
5. **障害対応**: ブロッカーの解消
6. **完了確認**: 品質チェック、承認

## 状態遷移
未着手 → 進行中 → レビュー待ち → 完了 → （再作業）

## KPI
- タスク完了率: 95%以上
- 期限遵守率: 90%以上
- 手戻り率: 5%以下`,
          roles: ['プロジェクトマネージャー', 'チームリーダー', 'メンバー', 'クライアント'],
          operations: {
            steps: [
              'タスク作成',
              '優先順位設定',
              'アサイン',
              '進捗更新',
              '障害対応',
              '完了確認'
            ]
          },
          businessStates: {
            initial: '未着手',
            states: ['未着手', '進行中', 'レビュー待ち', '完了', '再作業'],
            final: '完了'
          }
        },
        {
          name: 'quality-assurance',
          displayName: '品質を保証する',
          pattern: 'Analytics',
          goal: '高品質な成果物の継続的な提供',
          design: `# ビジネスオペレーション: 品質を保証する

## 目的
定められた品質基準を満たす成果物を継続的に提供し、クライアントの期待を超える

## 関係者とロール
- **品質管理者**: 品質基準設定、検査
- **開発者**: 品質作り込み
- **レビュアー**: ピアレビュー実施
- **クライアント**: 品質承認

## ビジネスオペレーション
1. **品質基準設定**: 成果物別の基準定義
2. **品質作り込み**: 開発時の品質確保
3. **セルフチェック**: 作成者による確認
4. **ピアレビュー**: 第三者レビュー
5. **品質検査**: 基準適合性確認
6. **改善実施**: 指摘事項の修正

## KPI
- 品質基準達成率: 100%
- 初回合格率: 85%以上
- 重大欠陥数: ゼロ
- 顧客満足度: 4.5以上`,
          roles: ['品質管理者', '開発者', 'レビュアー', 'クライアント'],
          operations: {
            steps: [
              '品質基準設定',
              '品質作り込み',
              'セルフチェック',
              'ピアレビュー',
              '品質検査',
              '改善実施'
            ]
          },
          businessStates: {
            initial: '作成中',
            states: ['作成中', 'レビュー中', '修正中', '承認済み'],
            final: '承認済み'
          }
        },
        {
          name: 'deliverable-management',
          displayName: '成果物を管理する',
          pattern: 'CRUD',
          goal: '成果物の体系的な管理と納品',
          design: `# ビジネスオペレーション: 成果物を管理する

## 目的
プロジェクトで作成される全成果物を体系的に管理し、確実にクライアントへ納品する

## 関係者とロール
- **成果物管理者**: 全体管理、納品調整
- **作成者**: 成果物作成
- **承認者**: 内容承認
- **クライアント**: 受領確認

## ビジネスオペレーション
1. **成果物計画**: 納品物リスト作成
2. **作成管理**: 進捗・品質管理
3. **バージョン管理**: 変更履歴管理
4. **内部承認**: 社内レビュー・承認
5. **納品準備**: 最終チェック、パッケージング
6. **納品・受領**: クライアント納品、確認

## KPI
- 納期遵守率: 100%
- 成果物完成度: 95%以上
- 受領拒否率: 0%`,
          roles: ['成果物管理者', '作成者', '承認者', 'クライアント'],
          operations: {
            steps: [
              '成果物計画',
              '作成管理',
              'バージョン管理',
              '内部承認',
              '納品準備',
              '納品・受領'
            ]
          },
          businessStates: {
            initial: '計画中',
            states: ['計画中', '作成中', '承認待ち', '納品準備中', '納品済み'],
            final: '納品済み'
          }
        }
      ]
    },
    {
      name: 'project-control',
      displayName: 'プロジェクトを統制する能力',
      description: '進捗・課題・変更を適切に管理し、プロジェクトを成功に導く統制力',
      category: 'Core',
      definition: `# ビジネスケーパビリティ: プロジェクトを統制する能力

## ケーパビリティ概要
プロジェクトの状況を常に把握し、問題の早期発見と迅速な対応により計画達成を確実にする能力

## ビジネス価値
- **リスク最小化**: 早期問題発見と対応
- **透明性確保**: ステークホルダーへの適時報告
- **軌道修正**: 柔軟な計画調整

## 実現する成果
- 問題早期発見率: 95%以上
- 課題解決期間: 平均3日以内
- 変更影響最小化: 計画への影響10%以下
- 報告遅延: ゼロ

## 必要な要素
### 人材・スキル
- プロジェクトコントローラー
- 課題管理スペシャリスト
- 変更管理エキスパート

### プロセス・方法論
- 進捗管理手法（EVM等）
- 課題管理プロセス
- 変更管理プロセス

### ツール・システム
- プロジェクト管理ダッシュボード
- 課題追跡システム
- 変更管理システム`,
      businessOperations: [
        {
          name: 'progress-monitoring',
          displayName: '進捗を監視する',
          pattern: 'Analytics',
          goal: 'リアルタイムな進捗把握と早期対応',
          design: `# ビジネスオペレーション: 進捗を監視する

## 目的
プロジェクトの進捗状況をリアルタイムに把握し、計画との乖離を早期に発見・対応する

## 関係者とロール
- **PMO**: 進捗データ収集、分析
- **プロジェクトマネージャー**: 状況判断、対策指示
- **チームリーダー**: 詳細状況報告
- **経営層**: 重要な意思決定

## ビジネスオペレーション
1. **データ収集**: タスク、工数、成果物の状況
2. **進捗分析**: 計画対比、トレンド分析
3. **問題検知**: 遅延、品質問題の発見
4. **影響分析**: スケジュール、コストへの影響
5. **対策検討**: リカバリープラン作成
6. **報告・承認**: ステークホルダー報告

## KPI
- データ収集頻度: 日次
- 問題検知速度: 発生から24時間以内
- 予測精度: 90%以上`,
          roles: ['PMO', 'プロジェクトマネージャー', 'チームリーダー', '経営層'],
          operations: {
            steps: [
              'データ収集',
              '進捗分析',
              '問題検知',
              '影響分析',
              '対策検討',
              '報告・承認'
            ]
          },
          businessStates: {
            initial: '収集中',
            states: ['収集中', '分析中', '問題検出', '対策実施中', '正常'],
            final: '正常'
          }
        },
        {
          name: 'issue-resolution',
          displayName: '課題を解決する',
          pattern: 'Workflow',
          goal: '課題の迅速な解決とナレッジ化',
          design: `# ビジネスオペレーション: 課題を解決する

## 目的
プロジェクトで発生する課題を迅速に解決し、再発防止のためのナレッジを蓄積する

## 関係者とロール
- **課題提起者**: 課題の報告
- **課題管理者**: 優先度判断、割当
- **解決責任者**: 課題解決の実行
- **PMO**: 全体管理、エスカレーション

## ビジネスオペレーション
1. **課題登録**: 詳細情報の記録
2. **影響評価**: 緊急度、重要度の判定
3. **担当割当**: 適切な解決者アサイン
4. **解決策検討**: 複数案の評価
5. **実行・検証**: 解決策の実施と確認
6. **ナレッジ化**: 教訓の文書化

## KPI
- 平均解決期間: 3営業日以内
- 初回解決率: 80%以上
- 再発率: 5%以下`,
          roles: ['課題提起者', '課題管理者', '解決責任者', 'PMO'],
          operations: {
            steps: [
              '課題登録',
              '影響評価',
              '担当割当',
              '解決策検討',
              '実行・検証',
              'ナレッジ化'
            ]
          },
          businessStates: {
            initial: '新規',
            states: ['新規', '分析中', '対応中', '確認中', '解決済み', 'クローズ'],
            final: 'クローズ'
          }
        },
        {
          name: 'change-control',
          displayName: '変更を管理する',
          pattern: 'Workflow',
          goal: '変更の影響を最小化した計画調整',
          design: `# ビジネスオペレーション: 変更を管理する

## 目的
プロジェクトへの変更要求を適切に評価し、影響を最小化しながら価値を最大化する

## 関係者とロール
- **変更要求者**: 変更の提案
- **変更管理委員会**: 承認判断
- **影響分析者**: 影響評価
- **実装責任者**: 変更の実施

## ビジネスオペレーション
1. **変更要求受付**: 要求内容の文書化
2. **影響分析**: スコープ、コスト、スケジュールへの影響
3. **費用対効果分析**: 変更価値の評価
4. **承認判断**: 委員会による意思決定
5. **計画更新**: ベースラインの変更
6. **変更実施**: 計画に基づく実行

## KPI
- 変更評価期間: 3営業日以内
- 承認率: 60%（価値ある変更のみ）
- 計画影響度: 10%以下`,
          roles: ['変更要求者', '変更管理委員会', '影響分析者', '実装責任者'],
          operations: {
            steps: [
              '変更要求受付',
              '影響分析',
              '費用対効果分析',
              '承認判断',
              '計画更新',
              '変更実施'
            ]
          },
          businessStates: {
            initial: '要求受付',
            states: ['要求受付', '評価中', '承認待ち', '承認済み', '実施中', '完了', '却下'],
            final: '完了'
          }
        }
      ]
    },
    {
      name: 'stakeholder-engagement',
      displayName: 'ステークホルダーと協働する能力',
      description: '多様なステークホルダーとの信頼関係を構築し、プロジェクトへの支援を獲得する能力',
      category: 'Supporting',
      definition: `# ビジネスケーパビリティ: ステークホルダーと協働する能力

## ケーパビリティ概要
ステークホルダーの期待を理解し、適切なコミュニケーションと関係構築により、プロジェクトへの積極的な支援を獲得する能力

## ビジネス価値
- **信頼構築**: 透明性の高いコミュニケーション
- **合意形成**: 利害調整と Win-Win の実現
- **支援獲得**: ステークホルダーからの積極的協力

## 実現する成果
- ステークホルダー満足度: 4.5以上（5点満点）
- コミュニケーション効果: 理解度90%以上
- エスカレーション削減: 50%減
- 意思決定迅速化: 2日以内

## 必要な要素
### 人材・スキル
- ステークホルダーマネージャー
- コミュニケーションスペシャリスト
- ファシリテーター

### プロセス・方法論
- ステークホルダー分析手法
- コミュニケーション計画
- 期待値管理プロセス

### ツール・システム
- ステークホルダー管理ツール
- コラボレーションプラットフォーム
- 報告書作成ツール`,
      businessOperations: [
        {
          name: 'stakeholder-analysis',
          displayName: 'ステークホルダーを分析する',
          pattern: 'Analytics',
          goal: 'ステークホルダーの的確な理解と対応戦略',
          design: `# ビジネスオペレーション: ステークホルダーを分析する

## 目的
プロジェクトに関わる全てのステークホルダーを識別し、その影響力と関心度を分析して適切な対応戦略を立案する

## 関係者とロール
- **プロジェクトマネージャー**: 分析主導
- **ビジネスアナリスト**: 詳細分析
- **アカウントマネージャー**: クライアント情報提供

## ビジネスオペレーション
1. **ステークホルダー識別**: 全関係者の洗い出し
2. **影響力/関心度分析**: 2軸でのマッピング
3. **期待値調査**: インタビュー、サーベイ
4. **分類・優先順位付け**: キーパーソン特定
5. **対応戦略立案**: 個別アプローチ策定
6. **計画文書化**: コミュニケーション計画

## KPI
- 識別網羅率: 95%以上
- 分析精度: 90%以上
- 戦略有効性: 80%以上`,
          roles: ['プロジェクトマネージャー', 'ビジネスアナリスト', 'アカウントマネージャー'],
          operations: {
            steps: [
              'ステークホルダー識別',
              '影響力/関心度分析',
              '期待値調査',
              '分類・優先順位付け',
              '対応戦略立案',
              '計画文書化'
            ]
          },
          businessStates: {
            initial: '識別中',
            states: ['識別中', '分析中', '戦略立案中', '承認済み'],
            final: '承認済み'
          }
        },
        {
          name: 'expectation-management',
          displayName: '期待値を調整する',
          pattern: 'Communication',
          goal: '現実的で達成可能な期待値の設定',
          design: `# ビジネスオペレーション: 期待値を調整する

## 目的
ステークホルダーの期待と現実のギャップを埋め、達成可能な共通認識を形成する

## 関係者とロール
- **アカウントマネージャー**: 期待値調整主導
- **プロジェクトマネージャー**: 実現可能性提示
- **ステークホルダー**: 期待の表明、調整

## ビジネスオペレーション
1. **期待値ヒアリング**: 詳細な要望確認
2. **ギャップ分析**: 期待と現実の差分
3. **調整案作成**: 複数の選択肢提示
4. **交渉・合意**: Win-Winの模索
5. **文書化**: 合意内容の明文化
6. **定期確認**: 期待値の変化確認

## KPI
- 期待値ギャップ: 20%以内
- 合意達成率: 90%以上
- 期待値変更頻度: 月1回以下`,
          roles: ['アカウントマネージャー', 'プロジェクトマネージャー', 'ステークホルダー'],
          operations: {
            steps: [
              '期待値ヒアリング',
              'ギャップ分析',
              '調整案作成',
              '交渉・合意',
              '文書化',
              '定期確認'
            ]
          },
          businessStates: {
            initial: 'ヒアリング中',
            states: ['ヒアリング中', '分析中', '調整中', '合意済み'],
            final: '合意済み'
          }
        },
        {
          name: 'status-reporting',
          displayName: 'ステータスを報告する',
          pattern: 'Communication',
          goal: 'タイムリーで効果的な情報共有',
          design: `# ビジネスオペレーション: ステータスを報告する

## 目的
プロジェクトの状況を適切な頻度と詳細度でステークホルダーに報告し、信頼関係を維持する

## 関係者とロール
- **プロジェクトマネージャー**: 報告責任者
- **PMO**: データ収集、資料作成
- **ステークホルダー**: 報告受領、フィードバック

## ビジネスオペレーション
1. **報告計画策定**: 頻度、形式、内容の定義
2. **データ収集**: 進捗、課題、リスク情報
3. **資料作成**: 対象者に応じた内容調整
4. **レビュー**: 内容の正確性確認
5. **報告実施**: 会議、メール等での共有
6. **フィードバック対応**: 質問、要望への対応

## KPI
- 報告遅延: ゼロ
- 理解度: 90%以上
- 満足度: 4.0以上`,
          roles: ['プロジェクトマネージャー', 'PMO', 'ステークホルダー'],
          operations: {
            steps: [
              '報告計画策定',
              'データ収集',
              '資料作成',
              'レビュー',
              '報告実施',
              'フィードバック対応'
            ]
          },
          businessStates: {
            initial: '準備中',
            states: ['準備中', '作成中', 'レビュー中', '報告済み'],
            final: '報告済み'
          }
        }
      ]
    }
  ]
}

export async function createProjectSuccessData(serviceId: string) {
  console.log('  Creating Project Success Support Service capabilities and operations...')
  
  let totalCapabilities = 0
  let totalOperations = 0
  
  for (const capData of projectSuccessData.capabilities) {
    // ケーパビリティの作成
    const capability = await parasolDb.businessCapability.create({
      data: {
        serviceId,
        name: capData.name,
        displayName: capData.displayName,
        description: capData.description,
        definition: capData.definition,
        category: capData.category
      }
    })
    totalCapabilities++
    console.log(`    ✓ Created capability: ${capability.displayName}`)
    
    // ビジネスオペレーションの作成
    for (const opData of capData.businessOperations) {
      const operation = await parasolDb.businessOperation.create({
        data: {
          serviceId,
          capabilityId: capability.id,
          name: opData.name,
          displayName: opData.displayName,
          design: opData.design,
          pattern: opData.pattern,
          goal: opData.goal,
          roles: JSON.stringify(opData.roles),
          operations: JSON.stringify(opData.operations),
          businessStates: JSON.stringify(opData.businessStates),
          useCases: JSON.stringify([]),
          uiDefinitions: JSON.stringify({ pages: [] }),
          testCases: JSON.stringify({ criteria: opData.goal })
        }
      })
      totalOperations++
      console.log(`      ✓ Created operation: ${operation.displayName}`)
    }
  }
  
  return { capabilities: totalCapabilities, operations: totalOperations }
}