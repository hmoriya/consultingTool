# ビジネスオペレーションとユースケースの階層構造

## 概念の違いと階層関係

パラソルフレームワークでは、以下の階層構造で設計を整理します：

1. **サービス** (Service)
2. **ビジネスケーパビリティ** (Business Capability) - 「XXXする能力」
3. **ビジネスオペレーション** (Business Operation) - ハイレベルユースケース
4. **ユースケース** (Use Case) - 詳細ユースケース
5. **ロバストネス図** (Robustness Diagram) - BCE要素の定義 (**NEW**)
6. **ページ定義** (Page Definition) - UI/UX定義
7. **テスト定義** (Test Definition) - テストケース定義

## 完全な階層構造図
```
サービス
└── ビジネスケーパビリティ（複数）
    └── ビジネスオペレーション群（ケーパビリティに関連）
        └── ユースケース群（オペレーションを実現）
            ├── ロバストネス図（ユースケース毎に1対1）
            ├── ページ定義群
            └── テスト定義群
```

## ディレクトリ構造
```
docs/parasol/services/[service-name]/
└── capabilities/
    └── [capability-name]/
        └── operations/
            └── [operation-name]/
                ├── operation.md                    # ビジネスオペレーション定義
                ├── usecases/                       # ユースケース群
                │   ├── [usecase-1-name]/
                │   │   ├── usecase.md             # ユースケース定義
                │   │   ├── robustness.md          # ロバストネス図（NEW）
                │   │   └── pages/                 # ページ定義群
                │   │       ├── [page-1-name].md
                │   │       └── [page-2-name].md
                │   └── [usecase-2-name]/
                │       ├── usecase.md
                │       ├── robustness.md          # ロバストネス図（NEW）
                │       └── pages/
                │           └── [page-3-name].md
                └── tests/                          # テスト定義群（オプション）
                    ├── [test-1-name].md
                    └── [test-2-name].md
```

## ビジネスオペレーション（ハイレベルユースケース）

ビジネスオペレーションは、**ビジネス価値を生み出す一連の活動**を表現します。

### 特徴
- **ビジネス成果にフォーカス**（技術的な詳細ではない）
- **複数のアクターが協調**して価値を生み出す
- **開始から完了まで**の明確なゴールがある
- **測定可能なビジネス価値**を生む

### 例
| ビジネスオペレーション | 説明 |
|----------------------|------|
| 顧客オンボーディング | 新規顧客を獲得し、サービス利用開始まで導く一連の活動 |
| 商品企画・投入 | 市場ニーズを捉えた商品を企画し、市場に投入するまでの活動 |
| 問題解決・改善提案 | 顧客の課題を分析し、解決策を提案・実行する活動 |
| リスク評価・対策立案 | プロジェクトリスクを評価し、対策を立案・実行する活動 |

## ユースケース（詳細ユースケース）

ユースケースは、ビジネスオペレーションを**具体的なシステム利用シナリオ**に分解したものです。

### 特徴
- **特定のアクターの視点**で記述
- **システムとの相互作用**を詳細に定義
- **前提条件と事後条件**が明確
- **基本フロー・代替フロー・例外フロー**を含む
- **各フローをMermaid図で可視化**（重要）

### フロー定義の仕様

ユースケースのフローは、テキストによる説明とMermaid図の両方で表現します。

#### 1. 基本フロー
正常系のシナリオをステップバイステップで記述し、Mermaid図で可視化します。

**Markdown形式**:
```markdown
### 基本フロー

\`\`\`mermaid
graph TD
    A[開始] --> B[ステップ1]
    B --> C[ステップ2]
    C --> D[ステップ3]
    D --> E[完了]
\`\`\`

1. [アクター]が[アクション]を実行する
2. システムが[処理]を行う
3. システムが[結果]を表示する
```

#### 2. 代替フロー
条件分岐による別シナリオを記述し、分岐ロジックをMermaid図で可視化します。

**Markdown形式**:
```markdown
### 代替フロー1: [条件の説明]

\`\`\`mermaid
graph TD
    A[分岐点] --> B{条件判定}
    B -->|条件A| C[代替処理]
    B -->|条件B| D[基本フロー続行]
    C --> E[基本フローに復帰]
\`\`\`

- **分岐点**: 基本フロー ステップX
- **条件**: [分岐条件の詳細]

1. システムが[条件]を検知する
2. システムが[代替処理]を実行する
3. 基本フロー ステップYに進む
```

#### 3. 例外フロー
エラーや例外処理のシナリオを記述し、エラーハンドリングをMermaid図で可視化します。

**Markdown形式**:
```markdown
### 例外フロー1: [エラー条件の説明]

\`\`\`mermaid
graph TD
    A[エラー発生点] --> B{エラー種別}
    B -->|回復可能| C[エラーメッセージ表示]
    B -->|回復不可| D[システムエラー]
    C --> E[再試行]
    D --> F[ユースケース終了]
\`\`\`

- **発生点**: 基本フロー ステップX
- **条件**: [エラー発生条件]

1. システムが[エラー]を検知する
2. システムが[エラーメッセージ]を表示する
3. [対処方法]
```

### フロー記述のベストプラクティス

1. **各フローに対応するMermaid図を必ず作成**
   - 基本フロー、代替フロー、例外フローのそれぞれに図を用意
   - 図とテキストの内容が一致していること

2. **Mermaid図は簡潔に**
   - 主要なステップのみを図示（詳細はテキストで補足）
   - 複雑な場合は複数の図に分割

3. **条件分岐は明確に**
   - 菱形（`{}`）を使用して判定ポイントを表現
   - 分岐の条件をラベルで明記

4. **テキストとの対応**
   - Mermaid図のノード名とテキストのステップを対応させる
   - 「ステップX」として参照できるようにする

### 例：「顧客オンボーディング」を分解すると

1. **アカウント作成** (ユースケース)
   - アクター：新規顧客
   - 前提条件：メールアドレスを持っている
   - 基本フロー：情報入力→検証→アカウント生成
   - 代替フロー：既存アカウントの場合の処理
   - Mermaid図：基本フロー、代替フロー（既存アカウント）、例外フロー（検証エラー）

2. **本人確認実施** (ユースケース)
   - アクター：新規顧客、コンプライアンス担当
   - 前提条件：アカウントが作成済み
   - 基本フロー：書類アップロード→審査→承認/却下
   - Mermaid図：基本フロー、代替フロー（書類不備）、例外フロー（審査タイムアウト）

3. **初期設定支援** (ユースケース)
   - アクター：新規顧客、カスタマーサポート
   - 前提条件：本人確認完了
   - 基本フロー：設定ガイド表示→設定実行→完了確認
   - Mermaid図：基本フロー、代替フロー（カスタマイズ設定）

## 判断基準

| 観点 | ビジネスオペレーション | ユースケース |
|------|---------------------|-------------|
| **スコープ** | ビジネスプロセス全体 | 単一のシステム操作 |
| **アクター** | 複数（顧客、スタッフ、システム） | 主に1〜2名 |
| **期間** | 数日〜数週間 | 数分〜数時間 |
| **成果** | ビジネス価値（売上、顧客満足度） | タスク完了 |
| **記述レベル** | What（何を達成するか） | How（どう実現するか） |

## パターン分類

ビジネスオペレーションは以下のパターンに分類されます：

- **CRUD**: 基本的なデータ管理（作成・参照・更新・削除）
- **Workflow**: 複数ステップの承認・処理フロー
- **Analytics**: 分析・レポーティング・意思決定支援
- **Communication**: コミュニケーション・コラボレーション
- **Administration**: システム管理・設定・メンテナンス